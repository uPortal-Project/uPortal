/*! infusion - v1.5.0-SNAPSHOT Wednesday, February 26th, 2014, 2:13:57 PM*/
var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){function transformInternal(source,togo,key,args){for(var transit=source[key],j=0;j<args.length-1;++j)transit=args[j+1](transit,key);togo[key]=transit}function regenerateCursor(source,segs,limit,sourceStrategy){for(var i=0;limit>i;++i)source=sourceStrategy(source,segs[i],i,fluid.makeArray(segs));return source}function regenerateSources(sources,segs,limit,sourceStrategies){for(var togo=[],i=0;i<sources.length;++i){var thisSource=regenerateCursor(sources[i],segs,limit,sourceStrategies[i]);void 0!==thisSource&&togo.push(thisSource)}return togo}fluid.version="Infusion 1.5",fluid.Error=Error,fluid.environment={fluid:fluid};var globalObject=window||{};fluid.defeatLogging=!0,fluid.activityTracing=!1,fluid.activityTrace=[];var activityParser=/(%\w+)/g;fluid.renderOneActivity=function(activity,nowhile){for(var togo=nowhile===!0?[]:["    while "],message=activity.message,index=activityParser.lastIndex=0;;){var match=activityParser.exec(message);if(!match)break;var key=match[1].substring(1);togo.push(message.substring(index,match.index)),togo.push(activity.args[key]),index=activityParser.lastIndex}return index<message.length&&togo.push(message.substring(index)),togo},fluid.renderActivity=function(activityStack,renderer){return renderer=renderer||fluid.renderOneActivity,fluid.transform(activityStack,renderer)},fluid.getActivityStack=function(){var root=fluid.globalThreadLocal();return root.activityStack||(root.activityStack=[]),root.activityStack},fluid.describeActivity=fluid.getActivityStack,fluid.logActivity=function(activity){activity=activity||fluid.describeActivity();var rendered=fluid.renderActivity(activity).reverse();fluid.log("Current activity: "),fluid.each(rendered,function(args){fluid.doLog(args)})},fluid.pushActivity=function(type,message,args){var record={type:type,message:message,args:args,time:(new Date).getTime()};fluid.activityTracing&&fluid.activityTrace.push(record),fluid.passLogLevel(fluid.logLevel.TRACE)&&fluid.doLog(fluid.renderOneActivity(record,!0));var activityStack=fluid.getActivityStack();activityStack.push(record)},fluid.popActivity=function(popframes){popframes=popframes||1,fluid.activityTracing&&fluid.activityTrace.push({pop:popframes});var activityStack=fluid.getActivityStack(),popped=activityStack.length-popframes;activityStack.length=0>popped?0:popped},fluid.FluidError=function(message){this.message=message,this.stack=(new Error).stack},fluid.FluidError.prototype=new Error,fluid.builtinFail=function(soft,args,activity){fluid.log.apply(null,[fluid.logLevel.FAIL,"ASSERTION FAILED: "].concat(args)),fluid.logActivity(activity);var message=args.join("");if(soft)throw new fluid.FluidError(message);message["Assertion failure - check console for details"]()};var softFailure=[!1];fluid.fail=function(){var args=fluid.makeArray(arguments),activity=fluid.makeArray(fluid.describeActivity());fluid.popActivity(activity.length);var topFailure=softFailure[0];"boolean"==typeof topFailure?fluid.builtinFail(topFailure,args,activity):"function"==typeof topFailure&&topFailure(args,activity)},fluid.pushSoftFailure=function(condition){"boolean"==typeof condition||"function"==typeof condition?softFailure.unshift(condition):-1===condition&&softFailure.shift()},fluid.notrycatch=!0,fluid.tryCatch=function(tryfun,catchfun,finallyfun){if(finallyfun=finallyfun||fluid.identity,fluid.notrycatch){var togo=tryfun();return finallyfun(),togo}try{return tryfun()}catch(e){if(!catchfun)throw e;catchfun(e)}finally{finallyfun()}},fluid.expect=function(name,members,target){fluid.transform(fluid.makeArray(members),function(key){"undefined"==typeof target[key]&&fluid.fail(name+" missing required parameter "+key)})},fluid.isLogging=function(){return logLevelStack[0].priority>fluid.logLevel.IMPORTANT.priority},fluid.isLogLevel=function(arg){return fluid.isMarker(arg)&&void 0!==arg.priority},fluid.passLogLevel=function(testLogLevel){return testLogLevel.priority<=logLevelStack[0].priority},fluid.setLogging=function(enabled){var logLevel;"boolean"==typeof enabled?logLevel=fluid.logLevel[enabled?"INFO":"IMPORTANT"]:fluid.isLogLevel(enabled)?logLevel=enabled:fluid.fail("Unrecognised fluid logging level ",enabled),logLevelStack.unshift(logLevel)},fluid.setLogLevel=fluid.setLogging,fluid.popLogging=function(){return 1===logLevelStack.length?logLevelStack[0]:logLevelStack.shift()},fluid.doLog=function(args){var str=args.join("");"undefined"!=typeof console?console.debug?console.debug.apply(console,args):"function"==typeof console.log?console.log.apply(console,args):console.log(str):"undefined"!=typeof YAHOO?YAHOO.log(str):"undefined"!=typeof opera&&opera.postError(str)},fluid.log=function(){var directArgs=fluid.makeArray(arguments),userLogLevel=fluid.logLevel.INFO;if(fluid.isLogLevel(directArgs[0])&&(userLogLevel=directArgs.shift()),fluid.passLogLevel(userLogLevel)){var arg0=fluid.renderTimestamp(new Date)+":  ",args=[arg0].concat(directArgs);fluid.doLog(args)}},fluid.identity=function(arg){return arg},fluid.isValue=function(value){return void 0!==value&&null!==value},fluid.isPrimitive=function(value){var valueType=typeof value;return!value||"string"===valueType||"boolean"===valueType||"number"===valueType||"function"===valueType},fluid.isArrayable=function(totest){return totest&&(totest.jquery||"[object Array]"===Object.prototype.toString.call(totest))},fluid.isPlainObject=function(totest){if(!totest)return!1;var string=Object.prototype.toString.call(totest);return"[object Array]"===string||"[object Object]"===string},fluid.isDOMNode=function(obj){return obj&&"number"==typeof obj.nodeType},fluid.isDOMish=function(obj){return fluid.isDOMNode(obj)||obj.jquery},fluid.isComponent=function(obj){return obj&&obj.typeName&&obj.id},fluid.freshContainer=function(tocopy){return fluid.isArrayable(tocopy)?[]:{}},fluid.copy=function(tocopy){return fluid.isPrimitive(tocopy)?tocopy:$.extend(!0,fluid.freshContainer(tocopy),tocopy)},fluid.makeArray=function(arg){var togo=[];if(null!==arg&&void 0!==arg)if(fluid.isPrimitive(arg)||"number"!=typeof arg.length)togo.push(arg);else for(var i=0;i<arg.length;++i)togo[i]=arg[i];return togo},fluid.transform=function(source){var togo=fluid.freshContainer(source);if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)transformInternal(source,togo,i,arguments);else for(var key in source)transformInternal(source,togo,key,arguments);return togo},fluid.each=function(source,func){if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)func(source[i],i);else for(var key in source)func(source[key],key)},fluid.make_find=function(find_if){var target=find_if?!1:void 0;return function(source,func,deffolt){var disp;if(fluid.isArrayable(source)){for(var i=0;i<source.length;++i)if(disp=func(source[i],i),disp!==target)return find_if?source[i]:disp}else for(var key in source)if(disp=func(source[key],key),disp!==target)return find_if?source[key]:disp;return deffolt}},fluid.find=fluid.make_find(!1),fluid.find_if=fluid.make_find(!0),fluid.accumulate=function(list,fn,arg){for(var i=0;i<list.length;++i)arg=fn(list[i],arg,i);return arg},fluid.remove_if=function(source,fn,target){if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)fn(source[i],i)&&(target&&target.push(source[i]),source.splice(i,1),--i);else for(var key in source)fn(source[key],key)&&(target&&(target[key]=source[key]),delete source[key]);return target||source},fluid.generate=function(n,generator,applyFunc){for(var togo=[],i=0;n>i;++i)togo[i]=applyFunc?generator(i):generator;return togo},fluid.iota=function(count,first){first=first||0;for(var togo=[],i=0;count>i;++i)togo[togo.length]=first++;return togo},fluid.getMembers=function(holder,name){return fluid.transform(holder,function(member){return fluid.get(member,name)})},fluid.filterKeys=function(toFilter,keys,exclude){return fluid.remove_if($.extend({},toFilter),function(value,key){return exclude^-1===$.inArray(key,keys)})},fluid.censorKeys=function(toCensor,keys){return fluid.filterKeys(toCensor,keys,!0)},fluid.makeFlatten=function(index){return function(obj){var togo=[];return fluid.each(obj,function(){togo.push(arguments[index])}),togo}},fluid.keys=fluid.makeFlatten(1),fluid.values=fluid.makeFlatten(0),fluid.contains=function(obj,value){return obj?fluid.isArrayable(obj)?-1!==$.inArray(value,obj):fluid.find(obj,function(thisValue){return value===thisValue?!0:void 0}):void 0},fluid.keyForValue=function(obj,value){return fluid.find(obj,function(thisValue,key){return value===thisValue?key:void 0})},fluid.findKeyInObject=fluid.keyForValue,fluid.arrayToHash=function(array){var togo={};return fluid.each(array,function(el){togo[el]=!0}),togo},fluid.clear=function(target){if(fluid.isArrayable(target))target.length=0;else for(var i in target)delete target[i]},fluid.compareStringLength=function(ascending){return ascending?function(a,b){return a.length-b.length}:function(a,b){return b.length-a.length}},fluid.logLevelsSpec={FATAL:0,FAIL:5,WARN:10,IMPORTANT:12,INFO:15,TRACE:20},fluid.logLevel=fluid.transform(fluid.logLevelsSpec,function(value,key){return{type:"fluid.marker",value:key,priority:value}});var logLevelStack=[fluid.logLevel.IMPORTANT];fluid.VALUE={type:"fluid.marker",value:"VALUE"},fluid.NO_VALUE={type:"fluid.marker",value:"NO_VALUE"},fluid.EXPAND={type:"fluid.marker",value:"EXPAND"},fluid.EXPAND_NOW={type:"fluid.marker",value:"EXPAND_NOW"},fluid.isMarker=function(totest,type){return totest&&"object"==typeof totest&&"fluid.marker"===totest.type?type?totest.value===type.value:!0:!1},fluid.model={},fluid.model.copyModel=function(target,source){fluid.clear(target),$.extend(!0,target,source)},fluid.model.parseEL=function(EL){return""===EL?[]:String(EL).split(".")},fluid.model.composePath=function(prefix,suffix){return""===prefix?suffix:""===suffix?prefix:prefix+"."+suffix},fluid.model.composeSegments=function(){return fluid.makeArray(arguments).join(".")},fluid.path=fluid.model.composeSegments,fluid.composePath=fluid.model.composePath,fluid.requireDataBinding=function(){fluid.fail("Please include DataBinding.js in order to operate complex model accessor configuration")},fluid.model.setWithStrategy=fluid.model.getWithStrategy=fluid.requireDataBinding,fluid.model.resolvePathSegment=function(root,segment,create,origEnv){return!origEnv&&root.resolvePathSegment?root.resolvePathSegment(segment):create&&void 0===root[segment]?root[segment]={}:root[segment]},fluid.model.pathToSegments=function(EL,config){var parser=config&&config.parser?config.parser.parse:fluid.model.parseEL,segs="number"==typeof EL||"string"==typeof EL?parser(EL):EL;return segs},fluid.model.accessImpl=function(root,EL,newValue,config,initSegs,returnSegs,traverser){var segs=fluid.model.pathToSegments(EL,config),initPos=0;initSegs&&(initPos=initSegs.length,segs=initSegs.concat(segs));var uncess=newValue===fluid.NO_VALUE?0:1;return root=traverser(root,segs,initPos,config,uncess),newValue===fluid.NO_VALUE||newValue===fluid.VALUE?returnSegs?{root:root,segs:segs}:root:void(root[segs[segs.length-1]]=newValue)},fluid.model.accessSimple=function(root,EL,newValue,environment,initSegs,returnSegs){return fluid.model.accessImpl(root,EL,newValue,environment,initSegs,returnSegs,fluid.model.traverseSimple)},fluid.model.traverseSimple=function(root,segs,initPos,environment,uncess){for(var origEnv=environment,limit=segs.length-uncess,i=0;limit>i;++i){if(!root)return root;var segment=segs[i];root=environment&&environment[segment]?environment[segment]:fluid.model.resolvePathSegment(root,segment,1===uncess,origEnv),environment=null}return root},fluid.model.setSimple=function(root,EL,newValue,environment,initSegs){fluid.model.accessSimple(root,EL,newValue,environment,initSegs,!1)},fluid.model.getSimple=function(root,EL,environment,initSegs){return null===EL||void 0===EL||0===EL.length?root:fluid.model.accessSimple(root,EL,fluid.NO_VALUE,environment,initSegs,!1)},fluid.decodeAccessorArg=function(arg3){return arg3&&arg3!==fluid.model.defaultGetConfig&&arg3!==fluid.model.defaultSetConfig?"environment"===arg3.type?arg3.value:void 0:null},fluid.set=function(root,EL,newValue,config,initSegs){var env=fluid.decodeAccessorArg(config);void 0===env?fluid.model.setWithStrategy(root,EL,newValue,config,initSegs):fluid.model.setSimple(root,EL,newValue,env,initSegs)},fluid.get=function(root,EL,config,initSegs){var env=fluid.decodeAccessorArg(config);return void 0===env?fluid.model.getWithStrategy(root,EL,config,initSegs):fluid.model.accessImpl(root,EL,fluid.NO_VALUE,env,null,!1,fluid.model.traverseSimple)},fluid.model.setBeanValue=fluid.set,fluid.model.getBeanValue=fluid.get,fluid.getGlobalValue=function(path,env){return path?(env=env||fluid.environment,fluid.get(globalObject,path,{type:"environment",value:env})):void 0},fluid.bind=function(obj,fnName,args){return obj[fnName].apply(obj,fluid.makeArray(args))},fluid.invokeGlobalFunction=function(functionPath,args,environment){var func=fluid.getGlobalValue(functionPath,environment);return func?func.apply(null,args||[]):void fluid.fail("Error invoking global function: "+functionPath+" could not be located")},fluid.registerGlobalFunction=function(functionPath,func,env){env=env||fluid.environment,fluid.set(globalObject,functionPath,func,{type:"environment",value:env})},fluid.setGlobalValue=fluid.registerGlobalFunction,fluid.registerNamespace=function(naimspace,env){env=env||fluid.environment;var existing=fluid.getGlobalValue(naimspace,env);return existing||(existing={},fluid.setGlobalValue(naimspace,existing,env)),existing},fluid.dumpEl=fluid.identity,fluid.renderTimestamp=fluid.identity,fluid.registerNamespace("fluid.event"),fluid.generateUniquePrefix=function(){return Math.floor(1e12*Math.random()).toString(36)+"-"};var fluid_prefix=fluid.generateUniquePrefix();fluid.fluidInstance=fluid_prefix;var fluid_guid=1;fluid.allocateGuid=function(){return fluid_prefix+fluid_guid++},fluid.event.identifyListener=function(listener){return listener.$$fluid_guid||(listener.$$fluid_guid=fluid.allocateGuid()),listener.$$fluid_guid},fluid.event.impersonateListener=function(origListener,newListener){fluid.event.identifyListener(origListener),newListener.$$fluid_guid=origListener.$$fluid_guid},fluid.event.mapPriority=function(priority,count){return null===priority||void 0===priority?count:"last"===priority?Number.MAX_VALUE:"first"===priority?-Number.MAX_VALUE:-priority},fluid.priorityComparator=function(recA,recB){return recA.priority-recB.priority},fluid.event.sortListeners=function(listeners){var togo=[];return fluid.each(listeners,function(listener){void 0!==listener.length?togo=togo.concat(listener):togo.push(listener)}),togo.sort(fluid.priorityComparator)},fluid.event.invokeListener=function(listener,args){return"string"==typeof listener&&(listener=fluid.event.resolveListener({globalName:listener})),listener.apply(null,args)},fluid.event.resolveListener=function(listener){if(listener.globalName){var listenerFunc=fluid.getGlobalValue(listener.globalName);listenerFunc?listener=listenerFunc:fluid.fail("Unable to look up name "+listener.globalName+" as a global function")}return listener},fluid.nameComponent=function(that){return that?"component with typename "+that.typeName+" and id "+that.id:"[unknown component]"},fluid.event.nameEvent=function(that,eventName){return eventName+" of "+fluid.nameComponent(that)},fluid.makeEventFirer=function(unicast,preventable,name,ownerId){function fireToListeners(listeners,args,wrapper){if(listeners){fluid.log("Firing event "+name+" to list of "+listeners.length+" listeners");for(var i=0;i<listeners.length;++i){var lisrec=listeners[i];lisrec.listener=fluid.event.resolveListener(lisrec.listener);var listener=lisrec.listener;if(!lisrec.predicate||lisrec.predicate(listener,args)){var value,ret=(wrapper?wrapper(listener):listener).apply(null,args);if(preventable&&ret===!1&&(value=!1),unicast&&(value=ret),void 0!==value)return value}}}}var that,identify=fluid.event.identifyListener,lazyInit=function(){that.listeners={},that.byId={},that.sortedListeners=[],that.addListener=function(listener,namespace,predicate,priority,softNamespace){if(listener){unicast&&(namespace="unicast"),"string"==typeof listener&&(listener={globalName:listener});var id=identify(listener);namespace=namespace||id;var record={listener:listener,predicate:predicate,namespace:namespace,softNamespace:softNamespace,priority:fluid.event.mapPriority(priority,that.sortedListeners.length)};if(that.byId[id]=record,softNamespace){var thisListeners=that.listeners[namespace]=fluid.makeArray(that.listeners[namespace]);thisListeners.push(record)}else that.listeners[namespace]=record;that.sortedListeners=fluid.event.sortListeners(that.listeners)}},that.addListener.apply(null,arguments)};return that={eventId:fluid.allocateGuid(),ownerId:ownerId,name:name,typeName:"fluid.event.firer",addListener:function(){lazyInit.apply(null,arguments)},removeListener:function(listener){if(that.listeners){var namespace,id;if("string"==typeof listener){namespace=listener;var record=that.listeners[listener];if(!record)return;listener=void 0!==record.length?record:record.listener}"function"==typeof listener&&(id=identify(listener),id||fluid.fail("Cannot remove unregistered listener function ",listener," from event "+that.name));var rec=that.byId[id],softNamespace=rec&&rec.softNamespace;namespace=namespace||rec&&rec.namespace||id,delete that.byId[id],softNamespace?fluid.remove_if(that.listeners[namespace],function(thisLis){return thisLis.listener.$$fluid_guid===id}):delete that.listeners[namespace],that.sortedListeners=fluid.event.sortListeners(that.listeners)}},fireToListeners:function(listeners,args,wrapper){return fireToListeners(listeners,args,wrapper)},fire:function(){return fireToListeners(that.sortedListeners,arguments)}}},fluid.event.getEventFirer=fluid.makeEventFirer,fluid.fireEvent=function(component,path,args){var firer=fluid.get(component,path);firer&&firer.fire.apply(null,fluid.makeArray(args))},fluid.event.addListenerToFirer=function(firer,value,namespace,wrapper){if(wrapper=wrapper||fluid.identity,fluid.isArrayable(value))for(var i=0;i<value.length;++i)fluid.event.addListenerToFirer(firer,value[i],namespace,wrapper);else"function"==typeof value||"string"==typeof value?wrapper(firer).addListener(value,namespace):value&&"object"==typeof value&&wrapper(firer).addListener(value.listener,namespace||value.namespace,value.predicate,value.priority,value.softNamespace)},fluid.event.resolveListenerRecord=function(records){return{records:records}},fluid.expandOptions=function(material){fluid.fail("fluid.expandOptions could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor "+material)},fluid.mergeListeners=function(that,events,listeners){fluid.each(listeners,function(value,key){var firer,namespace;if("{"===key.charAt(0))firer=fluid.expandOptions(key,that),firer||fluid.fail("Error in listener record: key "+key+' could not be looked up to an event firer - did you miss out "events." when referring to an event firer?');else{var keydot=key.indexOf(".");-1!==keydot&&(namespace=key.substring(keydot+1),key=key.substring(0,keydot)),events[key]||fluid.fail("Listener registered for event "+key+" which is not defined for this component"),firer=events[key]}var record=fluid.event.resolveListenerRecord(value,that,key,namespace,!0);fluid.event.addListenerToFirer(firer,record.records,namespace,record.adderWrapper)})},fluid.eventFromRecord=function(eventSpec,eventKey,that){var event,isIoCEvent=eventSpec&&("string"!=typeof eventSpec||"{"===eventSpec.charAt(0));return isIoCEvent?fluid.event.resolveEvent?event=fluid.event.resolveEvent(that,eventKey,eventSpec):fluid.fail("fluid.event.resolveEvent could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor ",eventSpec):event=fluid.makeEventFirer("unicast"===eventSpec,"preventable"===eventSpec,fluid.event.nameEvent(that,eventKey),that.id),event},fluid.instantiateFirers=function(that,options){fluid.each(options.events,function(eventSpec,eventKey){that.events[eventKey]=fluid.eventFromRecord(eventSpec,eventKey,that)})},fluid.mergeListenerPolicy=function(target,source,key){var hasNamespace="{"!==key.charAt(0)&&-1!==key.indexOf(".");return hasNamespace?source||target:fluid.arrayConcatPolicy(target,source)},fluid.makeMergeListenersPolicy=function(merger){return function(target,source){return target=target||{},fluid.each(source,function(listeners,key){target[key]=merger(target[key],listeners,key)}),target}},fluid.unique=function(array){return fluid.remove_if(array,function(element,i){return!element||i>0&&element===array[i-1]})},fluid.arrayConcatPolicy=function(target,source){return fluid.makeArray(target).concat(fluid.makeArray(source))},fluid.typeTag=function(name){return name?{typeName:name,id:fluid.allocateGuid()}:null},fluid.staticEnvironment=fluid.typeTag("fluid.staticEnvironment"),fluid.singleThreadLocal=function(initFunc){var value=initFunc();return function(newValue){return void 0===newValue?value:value=newValue}},fluid.threadLocal=fluid.singleThreadLocal,fluid.globalThreadLocal=fluid.threadLocal(function(){return fluid.typeTag("fluid.dynamicEnvironment")});var gradeTick=1,gradeTickStore={},defaultsStore={},resolveGradesImpl=function(gs,gradeNames,base){var raw=!0;return base?raw=1===gradeNames.length:gradeNames=fluid.makeArray(gradeNames),fluid.each(gradeNames,function(gradeName){if(gradeName&&!gs.gradeHash[gradeName]){var isDynamic="{"===gradeName.charAt(0),options=(isDynamic?null:raw?fluid.rawDefaults(gradeName):fluid.getGradedDefaults(gradeName))||{},thisTick=gradeTickStore[gradeName]||gradeTick-1;gs.lastTick=Math.max(gs.lastTick,thisTick),gs.gradeHash[gradeName]=!0,gs.gradeChain.push(gradeName),gs.optionsChain.push(options);for(var oGradeNames=fluid.makeArray(options.gradeNames),i=0;i<oGradeNames.length;++i){var oGradeName=oGradeNames[i],isAuto="autoInit"===oGradeName;raw?isAuto||resolveGradesImpl(gs,oGradeName):gs.gradeHash[oGradeName]||isAuto||(gs.gradeHash[oGradeName]=!0,gs.gradeChain.push(oGradeName))}}}),gs};fluid.resolveGradeStructure=function(defaultName,gradeNames){var gradeStruct={lastTick:0,gradeChain:[],gradeHash:{},optionsChain:[]};return resolveGradesImpl(gradeStruct,(fluid.makeArray(gradeNames).reverse()||[]).concat([defaultName]),!0)};var mergedDefaultsCache={};fluid.gradeNamesToKey=function(defaultName,gradeNames){return defaultName+"|"+gradeNames.join("|")},fluid.hasGrade=function(options,gradeName){return options&&options.gradeNames?fluid.contains(options.gradeNames,gradeName):!1},fluid.resolveGrade=function(defaults,defaultName,gradeNames){for(var gradeStruct=fluid.resolveGradeStructure(defaultName,gradeNames),mergeArgs=gradeStruct.optionsChain.reverse(),mergePolicy={},i=0;i<mergeArgs.length;++i)mergeArgs[i]&&mergeArgs[i].mergePolicy&&(mergePolicy=$.extend(!0,mergePolicy,mergeArgs[i].mergePolicy));mergeArgs=[mergePolicy,{}].concat(mergeArgs);var mergedDefaults=fluid.merge.apply(null,mergeArgs);return mergedDefaults.gradeNames=gradeStruct.gradeChain,fluid.hasGrade(defaults,"autoInit")&&mergedDefaults.gradeNames.push("autoInit"),{defaults:mergedDefaults,lastTick:gradeStruct&&gradeStruct.lastTick}},fluid.getGradedDefaults=function(defaultName,gradeNames){gradeNames=fluid.makeArray(gradeNames);var key=fluid.gradeNamesToKey(defaultName,gradeNames),mergedDefaults=mergedDefaultsCache[key];if(mergedDefaults){for(var lastTick=0,searchGrades=mergedDefaults.defaults.gradeNames||[],i=0;i<searchGrades.length;++i)lastTick=Math.max(lastTick,gradeTickStore[searchGrades[i]]||0);lastTick>mergedDefaults.lastTick&&(fluid.log("Clearing cache for component "+defaultName+" with gradeNames ",searchGrades),mergedDefaults=null)}if(!mergedDefaults){var defaults=fluid.rawDefaults(defaultName);if(!defaults)return defaults;mergedDefaults=mergedDefaultsCache[key]=fluid.resolveGrade(defaults,defaultName,gradeNames)}return mergedDefaults.defaults},fluid.annotateListeners=function(componentName,options){options.listeners&&(options.listeners=fluid.transform(options.listeners,function(record){var togo=fluid.makeArray(record);return fluid.transform(togo,function(onerec){return onerec.componentSource=componentName,onerec})}))},fluid.rawDefaults=function(componentName,options){if(void 0===options)return defaultsStore[componentName];fluid.pushActivity("registerDefaults","registering defaults for grade %componentName with options %options",{componentName:componentName,options:options});var optionsCopy=fluid.expandCompact?fluid.expandCompact(options):fluid.copy(options);fluid.annotateListeners(componentName,optionsCopy),defaultsStore[componentName]=optionsCopy,gradeTickStore[componentName]=gradeTick++,fluid.popActivity()},fluid.doIndexDefaults=function(defaultName,defaults,index,indexSpec){for(var requiredGrades=fluid.makeArray(indexSpec.gradeNames),i=0;i<requiredGrades.length;++i)if(!fluid.hasGrade(defaults,requiredGrades[i]))return;for(var indexFunc="function"==typeof indexSpec.indexFunc?indexSpec.indexFunc:fluid.getGlobalValue(indexSpec.indexFunc),keys=indexFunc(defaults)||[],j=0;j<keys.length;++j)(index[keys[j]]=index[keys[j]]||[]).push(defaultName)},fluid.indexDefaults=function(indexName,indexSpec){var index={};for(var defaultName in defaultsStore){var defaults=fluid.getGradedDefaults(defaultName);fluid.doIndexDefaults(defaultName,defaults,index,indexSpec)}return index},fluid.defaults=function(componentName,options){return void 0===options?fluid.getGradedDefaults(componentName):(options&&options.options&&fluid.fail("Probable error in options structure for "+componentName+' with option named "options" - perhaps you meant to write these options at top level in fluid.defaults? - ',options),fluid.rawDefaults(componentName,options),fluid.hasGrade(options,"autoInit")&&fluid.makeComponent(componentName,fluid.getGradedDefaults(componentName)),void 0)},fluid.makeComponent=function(componentName,options){options.initFunction&&options.gradeNames||fluid.fail("Cannot autoInit component "+componentName+" which does not have an initFunction and gradeNames defined");var creator=function(){return fluid.initComponent(componentName,arguments)},existing=fluid.getGlobalValue(componentName);existing&&$.extend(creator,existing),fluid.setGlobalValue(componentName,creator)},fluid.makeComponents=function(components){fluid.each(components,function(value,key){var options={gradeNames:fluid.makeArray(value).concat(["autoInit"])};fluid.defaults(key,options)})},fluid.model.mergeModel=function(target,source){if(!fluid.isPrimitive(target)){var copySource=fluid.copy(source);$.extend(!0,source,target),$.extend(!0,source,copySource)}return source};var emptyPolicy={};fluid.derefMergePolicy=function(policy){return(policy?policy["*"]:emptyPolicy)||emptyPolicy},fluid.compileMergePolicy=function(mergePolicy){var builtins={},defaultValues={},togo={builtins:builtins,defaultValues:defaultValues};return mergePolicy?(fluid.each(mergePolicy,function(value,key){var parsed={},builtin=!0;if("function"==typeof value)parsed.func=value;else if("object"==typeof value)parsed=value;else if(fluid.isDefaultValueMergePolicy(value))fluid.set(defaultValues,key,"{that}.options."+value),togo.hasDefaults=!0,builtin=!1;else for(var split=value.split(/\s*,\s*/),i=0;i<split.length;++i)parsed[split[i]]=!0;builtin&&fluid.set(builtins,fluid.composePath(key,"*"),parsed)}),togo):togo},fluid.isDefaultValueMergePolicy=function(policy){return"string"==typeof policy&&-1===policy.indexOf(",")&&!/replace|preserve|nomerge|noexpand/.test(policy)},fluid.mergeOneImpl=function(thisTarget,thisSource,j,sources,newPolicy,i,segs){var togo=thisTarget,primitiveTarget=fluid.isPrimitive(thisTarget);return void 0!==thisSource&&(newPolicy.func||null===thisSource||!fluid.isPlainObject(thisSource)||fluid.isDOMish(thisSource)||thisSource===fluid.VALUE||newPolicy.preserve||newPolicy.nomerge?(sources[j]=void 0,togo=newPolicy.func?newPolicy.func.call(null,thisTarget,thisSource,segs[i-1],segs,i):fluid.isValue(thisTarget)&&newPolicy.preserve?fluid.model.mergeModel(thisTarget,thisSource):thisSource):primitiveTarget&&(togo=thisTarget=fluid.freshContainer(thisSource))),togo},fluid.fetchMergeChildren=function(target,i,segs,sources,mergePolicy,options){for(var thisPolicy=fluid.derefMergePolicy(mergePolicy),j=sources.length-1;j>=0;--j){var source=sources[j];if(void 0!==source&&(fluid.each(source,function(newSource,name){target.hasOwnProperty(name)||(segs[i]=name,options.strategy(target,name,i+1,segs,sources,mergePolicy))}),thisPolicy.replace))break}return target},fluid.inEvaluationMarker={__CURRENTLY_IN_EVALUATION__:!0},fluid.strategyRecursionBailout=50,fluid.makeMergeStrategy=function(options){var strategy=function(target,name,i,segs,sources,policy){i>fluid.strategyRecursionBailout&&fluid.fail("Overflow/circularity in options merging, current path is ",segs," at depth ",i,' - please protect components from merging using the "nomerge" merge policy'),fluid.isTracing&&fluid.tracing.pathCount.push(fluid.path(segs.slice(0,i)));var oldTarget=void 0;if(target.hasOwnProperty(name)){if(oldTarget=target[name],!options.evaluateFully)return oldTarget}else target[name]=fluid.inEvaluationMarker;void 0===sources&&(segs=fluid.makeArray(segs),sources=regenerateSources(options.sources,segs,i-1,options.sourceStrategies),policy=regenerateCursor(options.mergePolicy,segs,i-1,fluid.concreteTrundler));var start,limit,mul,newPolicyHolder=fluid.concreteTrundler(policy,name),newPolicy=fluid.derefMergePolicy(newPolicyHolder);newPolicy.replace?(start=1-sources.length,limit=0,mul=-1):(start=0,limit=sources.length-1,mul=1);for(var newSources=[],thisTarget=void 0,j=start;limit>=j;++j){var k=mul*j,thisSource=options.sourceStrategies[k](sources[k],name,i,segs);if(void 0!==thisSource&&(newSources[k]=thisSource,void 0===oldTarget)){if(-1===mul){thisTarget=target[name]=thisSource;break}thisTarget=target[name]=fluid.mergeOneImpl(thisTarget,thisSource,j,newSources,newPolicy,i,segs,options)}}return void 0!==oldTarget&&(thisTarget=oldTarget),newSources.length>0&&(fluid.isPrimitive(thisTarget)||fluid.fetchMergeChildren(thisTarget,i,segs,newSources,newPolicyHolder,options)),void 0===oldTarget&&0===newSources.length&&delete target[name],thisTarget};return options.strategy=strategy,strategy},fluid.driveStrategy=function(root,pathSegs,strategy){pathSegs=fluid.makeArray(pathSegs);for(var i=0;i<pathSegs.length;++i){if(!root)return void 0;root=strategy(root,pathSegs[i],i+1,pathSegs)}return root},fluid.concreteTrundler=function(source,seg){return source?source[seg]:void 0},fluid.merge=function(policy){var sources=Array.prototype.slice.call(arguments,1),compiled=fluid.compileMergePolicy(policy).builtins,options=fluid.makeMergeOptions(compiled,sources,{});return options.initter(),options.target},fluid.simpleGingerBlock=function(source,recordType){var block={target:source,simple:!0,strategy:fluid.concreteTrundler,initter:fluid.identity,recordType:recordType,priority:fluid.mergeRecordTypes[recordType]};return block},fluid.makeMergeOptions=function(policy,sources,userOptions){var options={mergePolicy:policy,sources:sources};return options=$.extend(options,userOptions),options.target=options.target||fluid.freshContainer(options.sources[0]),options.sourceStrategies=options.sourceStrategies||fluid.generate(options.sources.length,fluid.concreteTrundler),options.initter=function(){options.evaluateFully=!0,fluid.fetchMergeChildren(options.target,0,[],options.sources,options.mergePolicy,options)},fluid.makeMergeStrategy(options),options},fluid.transformOptions=function(options,transRec){fluid.expect("Options transformation record",["transformer","config"],transRec);var transFunc=fluid.getGlobalValue(transRec.transformer);return transFunc.call(null,options,transRec.config)},fluid.findMergeBlocks=function(mergeBlocks,recordType){return fluid.remove_if(fluid.makeArray(mergeBlocks),function(block){return block.recordType!==recordType})},fluid.transformOptionsBlocks=function(mergeBlocks,transformOptions,recordTypes){fluid.each(recordTypes,function(recordType){var blocks=fluid.findMergeBlocks(mergeBlocks,recordType);
fluid.each(blocks,function(block){block[block.simple?"target":"source"]=fluid.transformOptions(block.source,transformOptions)})})},fluid.deliverOptionsStrategy=fluid.identity,fluid.computeComponentAccessor=fluid.identity,fluid.computeDynamicComponents=fluid.identity,fluid.mergeRecordTypes={defaults:0,localOptions:50,defaultValueMerge:100,subcomponentRecord:200,distribution:300,user:500,demands:600},fluid.destroyValue=function(target,path){target&&fluid.model.applyChangeRequest(target,{type:"DELETE",path:path})},fluid.mergeComponentOptions=function(that,componentName,userOptions,localOptions){function computeMergePolicy(){var mergePolicy=fluid.driveStrategy(options,"mergePolicy",mergeOptions.strategy);mergePolicy=$.extend({},fluid.rootMergePolicy,mergePolicy),compiledPolicy=fluid.compileMergePolicy(mergePolicy),$.extend(!0,sharedMergePolicy,compiledPolicy.builtins)}var rawDefaults=fluid.rawDefaults(componentName),defaults=fluid.getGradedDefaults(componentName,rawDefaults&&rawDefaults.gradeNames?null:localOptions.gradeNames),sharedMergePolicy={},mergeBlocks=[];mergeBlocks=mergeBlocks.concat(fluid.expandComponentOptions?fluid.expandComponentOptions(sharedMergePolicy,defaults,userOptions,that):[fluid.simpleGingerBlock(defaults,"defaults"),fluid.simpleGingerBlock(userOptions,"user")]);var options={},sourceStrategies=[],sources=[],baseMergeOptions={target:options,sourceStrategies:sourceStrategies},updateBlocks=function(){mergeBlocks.sort(fluid.priorityComparator),sourceStrategies.length=0,sources.length=0,fluid.each(mergeBlocks,function(block){sourceStrategies.push(block.strategy),sources.push(block.target)})};updateBlocks();var mergeOptions=fluid.makeMergeOptions(sharedMergePolicy,sources,baseMergeOptions);mergeOptions.mergeBlocks=mergeBlocks,mergeOptions.updateBlocks=updateBlocks,mergeOptions.destroyValue=function(path){for(var i=0;i<mergeBlocks.length;++i)fluid.destroyValue(mergeBlocks[i].target,path);fluid.destroyValue(baseMergeOptions.target,path)};var compiledPolicy;computeMergePolicy(),compiledPolicy.hasDefaults&&(fluid.generateExpandBlock?(mergeBlocks.push(fluid.generateExpandBlock({options:compiledPolicy.defaultValues,recordType:"defaultValueMerge",priority:fluid.mergeRecordTypes.defaultValueMerge},that,{})),updateBlocks()):fluid.fail("Cannot operate mergePolicy ",mergePolicy," for component ",that," without including FluidIoC.js")),that.options=options;var optionsNickName=fluid.driveStrategy(options,"nickName",mergeOptions.strategy);that.nickName=optionsNickName||fluid.computeNickName(that.typeName),fluid.driveStrategy(options,"gradeNames",mergeOptions.strategy),fluid.deliverOptionsStrategy(that,options,mergeOptions);var transformOptions=fluid.driveStrategy(options,"transformOptions",mergeOptions.strategy);return transformOptions&&(fluid.transformOptionsBlocks(mergeBlocks,transformOptions,["user","subcomponentRecord"]),updateBlocks()),fluid.computeComponentAccessor(that),baseMergeOptions.target.mergePolicy||computeMergePolicy(),mergeOptions},fluid.defaults("fluid.function",{}),fluid.lifecycleFunctions={preInitFunction:!0,postInitFunction:!0,finalInitFunction:!0},fluid.rootMergePolicy=$.extend({gradeNames:fluid.arrayConcatPolicy,distributeOptions:fluid.arrayConcatPolicy,transformOptions:"replace"},fluid.transform(fluid.lifecycleFunctions,function(){return fluid.mergeListenerPolicy})),fluid.defaults("fluid.littleComponent",{gradeNames:["autoInit"],initFunction:"fluid.initLittleComponent",mergePolicy:fluid.rootMergePolicy,argumentMap:{options:0}}),fluid.defaults("fluid.eventedComponent",{gradeNames:["fluid.littleComponent","autoInit"],events:{onCreate:null,onAttach:null,onClear:null,onDestroy:null,afterDestroy:null},mergePolicy:{listeners:fluid.makeMergeListenersPolicy(fluid.mergeListenerPolicy)}}),fluid.COMPONENT_OPTIONS={type:"fluid.marker",value:"COMPONENT_OPTIONS"},fluid.emptySubcomponent=function(options){var that=fluid.typeTag("fluid.emptySubcomponent");that.options=options||{},that.options.gradeNames=[that.typeName],options=fluid.makeArray(options);for(var i=0;i<options.length;++i)that[options[i]]=fluid.identity;return that},fluid.computeNickName=function(typeName){var segs=fluid.model.parseEL(typeName);return segs[segs.length-1]},fluid.typeFount=function(options){var that=fluid.initLittleComponent("fluid.typeFount",options);return fluid.typeTag(that.options.targetTypeName)},fluid.initLittleComponent=function(name,userOptions,localOptions,receiver){var that=fluid.typeTag(name);localOptions=localOptions||{gradeNames:"fluid.littleComponent"},that.destroy=fluid.makeRootDestroy(that);var mergeOptions=fluid.mergeComponentOptions(that,name,userOptions,localOptions),options=that.options,evented=fluid.hasGrade(options,"fluid.eventedComponent");evented&&(that.events={}),(receiver||fluid.identity)(that,options,mergeOptions.strategy),fluid.computeDynamicComponents(that,mergeOptions);for(var i=0;i<mergeOptions.mergeBlocks.length;++i)mergeOptions.mergeBlocks[i].initter();return mergeOptions.initter(),delete options.mergePolicy,fluid.initLifecycleFunctions(that),fluid.fireEvent(options,"preInitFunction",that),evented&&(fluid.instantiateFirers(that,options),fluid.mergeListeners(that,that.events,options.listeners)),fluid.hasGrade(options,"autoInit")||fluid.clearLifecycleFunctions(options),that},fluid.updateWithDefaultLifecycle=function(key,value,typeName){var funcName=typeName+"."+key.substring(0,key.length-"function".length),funcVal=fluid.getGlobalValue(funcName);if("function"==typeof funcVal){value=fluid.makeArray(value);var existing=fluid.find(value,function(el){var listener=el.listener||el;return listener===funcVal||listener===funcName?!0:void 0});existing||value.push(funcVal)}return value},fluid.initLifecycleFunctions=function(that){var gradeNames=that.options.gradeNames||[];fluid.each(fluid.lifecycleFunctions,function(func,key){for(var value=that.options[key],i=gradeNames.length-1;i>=0;--i)"autoInit"!==gradeNames[i]&&(value=fluid.updateWithDefaultLifecycle(key,value,gradeNames[i]));value&&(that.options[key]=fluid.makeEventFirer(null,null,key,that.id),fluid.event.addListenerToFirer(that.options[key],value))})},fluid.clearLifecycleFunctions=function(options){fluid.each(fluid.lifecycleFunctions,function(value,key){delete options[key]}),delete options.initFunction},fluid.diagnoseFailedView=fluid.identity,fluid.makeRootDestroy=function(that){return function(){fluid.fireEvent(that,"events.onClear",[that,"",null]),fluid.fireEvent(that,"events.onDestroy",[that,"",null]),fluid.fireEvent(that,"events.afterDestroy",[that,"",null])}},fluid.resolveReturnedPath=fluid.identity,fluid.initComponent=function(componentName,initArgs){var options=fluid.defaults(componentName);options.gradeNames||fluid.fail("Cannot initialise component "+componentName+" which has no gradeName registered");var that,args=[componentName].concat(fluid.makeArray(initArgs));return fluid.pushActivity("initComponent","constructing component of type %componentName with arguments %initArgs",{componentName:componentName,initArgs:initArgs}),that=fluid.invokeGlobalFunction(options.initFunction,args),fluid.diagnoseFailedView(componentName,that,options,args),fluid.fireEvent(that.options,"postInitFunction",that),fluid.initDependents&&fluid.initDependents(that),fluid.fireEvent(that.options,"finalInitFunction",that),fluid.clearLifecycleFunctions(that.options),fluid.fireEvent(that,"events.onCreate",that),fluid.popActivity(),fluid.resolveReturnedPath(that.options.returnedPath,that)?fluid.get(that,that.options.returnedPath):that},fluid.initSubcomponentImpl=function(that,entry,args){var togo;if("function"!=typeof entry){var entryType="string"==typeof entry?entry:entry.type;togo="fluid.emptySubcomponent"===entryType?fluid.emptySubcomponent(entry.options):fluid.invokeGlobalFunction(entryType,args)}else togo=entry.apply(null,args);return togo},fluid.initSubcomponents=function(that,className,args){var entry=that.options[className];if(entry){var entries=fluid.makeArray(entry),optindex=-1,togo=[];args=fluid.makeArray(args);for(var i=0;i<args.length;++i)args[i]===fluid.COMPONENT_OPTIONS&&(optindex=i);for(i=0;i<entries.length;++i)entry=entries[i],-1!==optindex&&(args[optindex]=entry.options),togo[i]=fluid.initSubcomponentImpl(that,entry,args);return togo}},fluid.initSubcomponent=function(that,className,args){return fluid.initSubcomponents(that,className,args)[0]};var charStart="(?:[\\w\\u00c0-\\uFFFF*_-";fluid.simpleCSSMatcher={regexp:new RegExp("([#.]?)("+charStart+"]|\\\\.)+)","g"),charToTag:{"":"tag","#":"id",".":"clazz"}},fluid.IoCSSMatcher={regexp:new RegExp("([&#]?)("+charStart+"]|\\.)+)","g"),charToTag:{"":"context","&":"context","#":"id"}};var childSeg=new RegExp("\\s*(>)?\\s*","g");fluid.parseSelector=function(selstring,strategy){var togo=[];selstring=$.trim(selstring);var regexp=strategy.regexp;regexp.lastIndex=0;for(var lastIndex=0;;){for(var atNode=[],first=!0;;){var segMatch=regexp.exec(selstring);if(!segMatch)break;if(segMatch.index!==lastIndex){if(!first)break;fluid.fail("Error in selector string - cannot match child selector expression starting at "+selstring.substring(lastIndex))}var thisNode={},text=segMatch[2],targetTag=strategy.charToTag[segMatch[1]];targetTag&&(thisNode[targetTag]=text),atNode[atNode.length]=thisNode,lastIndex=regexp.lastIndex,first=!1}childSeg.lastIndex=lastIndex;var fullAtNode={predList:atNode},childMatch=childSeg.exec(selstring);if(childMatch&&childMatch.index===lastIndex||fluid.fail("Error in selector string - can not match child selector expression at "+selstring.substring(lastIndex)),">"===childMatch[1]&&(fullAtNode.child=!0),togo[togo.length]=fullAtNode,childSeg.lastIndex>=selstring.length)break;lastIndex=childSeg.lastIndex,regexp.lastIndex=childSeg.lastIndex}return togo},fluid.stringToRegExp=function(str,flags){return new RegExp(str.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),flags)},fluid.stringTemplate=function(template,values){var keys=fluid.keys(values);keys=keys.sort(fluid.compareStringLength());for(var i=0;i<keys.length;++i){var key=keys[i],re=fluid.stringToRegExp("%"+key,"g");template=template.replace(re,values[key])}return template},fluid.defaults("fluid.messageResolver",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{messageBase:"nomerge",parents:"nomerge"},resolveFunc:fluid.stringTemplate,parseFunc:fluid.identity,messageBase:{},parents:[]}),fluid.messageResolver.preInit=function(that){that.messageBase=that.options.parseFunc(that.options.messageBase),that.lookup=function(messagecodes){var resolved=fluid.messageResolver.resolveOne(that.messageBase,messagecodes);return void 0===resolved?fluid.find(that.options.parents,function(parent){return parent?parent.lookup(messagecodes):void 0}):{template:resolved,resolveFunc:that.options.resolveFunc}},that.resolve=function(messagecodes,args){if(!messagecodes)return"[No messagecodes provided]";messagecodes=fluid.makeArray(messagecodes);var looked=that.lookup(messagecodes);return looked?looked.resolveFunc(looked.template,args):"[Message string for key "+messagecodes[0]+" not found]"}},fluid.messageResolver.resolveOne=function(messageBase,messagecodes){for(var i=0;i<messagecodes.length;++i){var code=messagecodes[i],message=messageBase[code];if(void 0!==message)return message}},fluid.messageLocator=function(messageBase,resolveFunc){var resolver=fluid.messageResolver({messageBase:messageBase,resolveFunc:resolveFunc});return function(messagecodes,args){return resolver.resolve(messagecodes,args)}}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){function applyOp(node,func){return node=$(node),node.trigger("fluid-"+func),node.triggerHandler(func),node[func](),node}fluid.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};var matched,browser;$.browser||(navigator.userAgent.match(/Trident\/7\./)?browser={msie:!0,version:11}:(matched=fluid.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0)),$.browser=browser);var NAMESPACE_KEY="fluid-scoped-data";fluid.getScopedData=function(target,key){var data=$(target).data(NAMESPACE_KEY);return data?data[key]:void 0},fluid.setScopedData=function(target,key,value){$(target).each(function(){var data=$.data(this,NAMESPACE_KEY)||{};data[key]=value,$.data(this,NAMESPACE_KEY,data)})};var lastFocusedElement=null;$(document).bind("focusin",function(event){lastFocusedElement=event.target}),fluid.getLastFocusedElement=function(){return lastFocusedElement};var ENABLEMENT_KEY="enablement";fluid.enabled=function(target,state){return target=$(target),void 0===state?fluid.getScopedData(target,ENABLEMENT_KEY)!==!1:($("*",target).add(target).each(function(){void 0!==fluid.getScopedData(this,ENABLEMENT_KEY)?fluid.setScopedData(this,ENABLEMENT_KEY,state):/select|textarea|input/i.test(this.nodeName)&&$(this).prop("disabled",!state)}),void fluid.setScopedData(target,ENABLEMENT_KEY,state))},fluid.initEnablement=function(target){fluid.setScopedData(target,ENABLEMENT_KEY,!0)},fluid.resolveEventTarget=function(event){for(;event.originalEvent&&event.originalEvent.target;)event=event.originalEvent;return event.target},$.each(["focus","blur"],function(i,name){fluid[name]=function(elem){return applyOp(elem,name)}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.dom=fluid.dom||{};var getNextNode=function(iterator){if(iterator.node.firstChild)return iterator.node=iterator.node.firstChild,iterator.depth+=1,iterator;for(;iterator.node;){if(iterator.node.nextSibling)return iterator.node=iterator.node.nextSibling,iterator;iterator.node=iterator.node.parentNode,iterator.depth-=1}return iterator};fluid.dom.iterateDom=function(node,acceptor,allNodes){for(var condition,currentNode={node:node,depth:0},prevNode=node;null!==currentNode.node&&currentNode.depth>=0&&currentNode.depth<fluid.dom.iterateDom.DOM_BAIL_DEPTH;){if(condition=null,(1===currentNode.node.nodeType||allNodes)&&(condition=acceptor(currentNode.node,currentNode.depth)),condition)if("delete"===condition)currentNode.node.parentNode.removeChild(currentNode.node),currentNode.node=prevNode;else if("stop"===condition)return currentNode.node;prevNode=currentNode.node,currentNode=getNextNode(currentNode)}},fluid.dom.iterateDom.DOM_BAIL_DEPTH=256,fluid.dom.isContainer=function(container,containee){for(;containee;containee=containee.parentNode)if(container===containee)return!0;return!1},fluid.dom.getElementText=function(element){for(var nodes=element.childNodes,text="",i=0;i<nodes.length;++i){var child=nodes[i];3===child.nodeType&&(text+=child.nodeValue)}return text}}(jQuery,fluid_1_5);;fluid_1_5=fluid_1_5||{},function($,fluid){var unUnicode=/(\\u[\dabcdef]{4}|\\x[\dabcdef]{2})/g;fluid.unescapeProperties=function(string){string=string.replace(unUnicode,function(match){var code=match.substring(2),parsed=parseInt(code,16);return String.fromCharCode(parsed)});for(var pos=0;;){var backpos=string.indexOf("\\",pos);if(-1===backpos)break;if(backpos===string.length-1)return[string.substring(0,string.length-1),!0];var replace=string.charAt(backpos+1);"n"===replace&&(replace="\n"),"r"===replace&&(replace="\r"),"t"===replace&&(replace="	"),string=string.substring(0,backpos)+replace+string.substring(backpos+2),pos=backpos+1}return[string,!1]};var breakPos=/[^\\][\s:=]/;fluid.parseJavaProperties=function(text){var togo={};text=text.replace(/\r\n/g,"\n"),text=text.replace(/\r/g,"\n"),lines=text.split("\n");for(var contin,key,valueComp,valueRaw,valueEsc,i=0;i<lines.length;++i){var line=$.trim(lines[i]);if(line&&"#"!==line.charAt(0)&&"!"!==line.charAt(0)){if(contin)valueEsc=fluid.unescapeProperties(line);else{valueComp="";var breakpos=line.search(breakPos);-1===breakpos?(key=line,valueRaw=""):(key=$.trim(line.substring(0,breakpos+1)),valueRaw=$.trim(line.substring(breakpos+2)),(":"===valueRaw.charAt(0)||"="===valueRaw.charAt(0))&&(valueRaw=$.trim(valueRaw.substring(1)))),key=fluid.unescapeProperties(key)[0],valueEsc=fluid.unescapeProperties(valueRaw)}contin=valueEsc[1],valueEsc[1]?valueComp+=valueEsc[0]:togo[key]=valueComp+valueEsc[0]}}return togo},fluid.formatMessage=function(messageString,args){if(!args)return messageString;"string"==typeof args&&(args=[args]);for(var i=0;i<args.length;++i)messageString=messageString.replace("{"+i+"}",args[i]);return messageString}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){function generate(c,count){for(var togo="",i=0;count>i;++i)togo+=c;return togo}function printImpl(obj,small,options){var big=small+options.indentChars;if(null===obj)return"null";if(fluid.isPrimitive(obj))return JSON.stringify(obj);var j=[];if(fluid.isArrayable(obj)){if(0===obj.length)return"[]";for(var i=0;i<obj.length;++i)j[i]=printImpl(obj[i],big,options);return"[\n"+big+j.join(",\n"+big)+"\n"+small+"]"}var i=0;return fluid.each(obj,function(value,key){j[i++]=JSON.stringify(key)+": "+printImpl(value,big,options)}),"{\n"+big+j.join(",\n"+big)+"\n"+small+"}"}fluid.renderTimestamp=function(date){var zeropad=function(num,width){width||(width=2);var numstr=void 0==num?"":num.toString();return"00000".substring(5-width+numstr.length)+numstr};return zeropad(date.getHours())+":"+zeropad(date.getMinutes())+":"+zeropad(date.getSeconds())+"."+zeropad(date.getMilliseconds(),3)},fluid.isTracing=!1,fluid.registerNamespace("fluid.tracing"),fluid.tracing.pathCount=[],fluid.tracing.summarisePathCount=function(pathCount){pathCount=pathCount||fluid.tracing.pathCount;for(var togo={},i=0;i<pathCount.length;++i){var path=pathCount[i];togo[path]?++togo[path]:togo[path]=1}var toReallyGo=[];return fluid.each(togo,function(el,path){toReallyGo.push({path:path,count:el})}),toReallyGo.sort(function(a,b){return b.count-a.count}),toReallyGo},fluid.tracing.condensePathCount=function(prefixes,pathCount){prefixes=fluid.makeArray(prefixes);var prefixCount={};fluid.each(prefixes,function(prefix){prefixCount[prefix]=0});var togo=[];return fluid.each(pathCount,function(el){var path=el.path;fluid.find(prefixes,function(prefix){return 0===path.indexOf(prefix)?(prefixCount[prefix]+=el.count,!0):void 0})||togo.push(el)}),fluid.each(prefixCount,function(count,path){togo.unshift({path:path,count:count})}),togo},fluid.detectStackStyle=function(e){var style="other",stackStyle={offset:0};return e.arguments?style="chrome":"undefined"!=typeof window&&window.opera&&e.stacktrace?style="opera10":e.stack?(style="firefox",stackStyle.offset=-1===e.stack.indexOf("Trace exception")?1:0):"undefined"==typeof window||!window.opera||"stacktrace"in e||(style="opera"),stackStyle.style=style,stackStyle},fluid.obtainException=function(){try{throw new Error("Trace exception")}catch(e){return e}};var stackStyle=fluid.detectStackStyle(fluid.obtainException());fluid.registerNamespace("fluid.exceptionDecoders"),fluid.decodeStack=function(){if("firefox"!==stackStyle.style)return null;var e=fluid.obtainException();return fluid.exceptionDecoders[stackStyle.style](e)},fluid.exceptionDecoders.firefox=function(e){var lines=e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");return fluid.transform(lines,function(line){var atind=line.indexOf("@");return-1===atind?[line]:[line.substring(atind+1),line.substring(0,atind)]})},fluid.getCallerInfo=function(atDepth){atDepth=(atDepth||3)-stackStyle.offset;var stack=fluid.decodeStack();return stack?stack[atDepth][0]:null},fluid.prettyPrintJSON=function(obj,options){return options=$.extend({indent:4},options),options.indentChars=generate(" ",options.indent),printImpl(obj,"",options)},fluid.dumpEl=function(element){var togo;if(!element)return"null";if(3===element.nodeType||8===element.nodeType)return"[data: "+element.data+"]";if(9===element.nodeType)return"[document: location "+element.location+"]";if(!element.nodeType&&fluid.isArrayable(element)){togo="[";for(var i=0;i<element.length;++i)togo+=fluid.dumpEl(element[i]),i<element.length-1&&(togo+=", ");return togo+"]"}return element=$(element),togo=element.get(0).tagName,element.id&&(togo+="#"+element.id),element.attr("class")&&(togo+="."+element.attr("class")),togo}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){function searchDemands(demandingName,contextNames){var exist=dependentStore[demandingName]||[];outer:for(var i=0;i<exist.length;++i){for(var rec=exist[i],j=0;j<contextNames.length;++j)if(rec.contexts[j]!==contextNames[j])continue outer;return rec.spec}}function regenerateCursor(source,segs,limit,sourceStrategy){for(var i=0;limit>i;++i)source=sourceStrategy(source,segs[i],i,fluid.makeArray(segs));return source}fluid.visitComponentChildren=function(that,visitor,options,path,i){var instantiator=fluid.getInstantiator(that);for(var name in that){var newPath=instantiator.composePath(path,name),component=that[name];if(!(!fluid.isComponent(component)||options.visited&&options.visited[component.id])){if(options.visited&&(options.visited[component.id]=!0),visitor(component,name,newPath,path,i))return!0;options.flat||fluid.visitComponentChildren(component,visitor,options,newPath)}}},fluid.getMemberNames=function(instantiator,thatStack){var path=instantiator.idToPath(thatStack[thatStack.length-1].id),segs=fluid.model.parseEL(path);return segs.unshift.apply(segs,fluid.generate(thatStack.length-segs.length,"")),segs};var visitComponents=function(instantiator,thatStack,visitor,options){options=options||{visited:{},flat:!0,instantiator:instantiator};for(var memberNames=fluid.getMemberNames(instantiator,thatStack),i=thatStack.length-1;i>=0;--i){var path,that=thatStack[i];if(that.typeName&&(options.visited[that.id]=!0,path=instantiator.idToPath[that.id],visitor(that,memberNames[i],path,path,i)))return;if(fluid.visitComponentChildren(that,visitor,options,path,i))return}};fluid.mountStrategy=function(prefix,root,toMount){var offset=prefix.length;return function(target,name,i,segs){if(!(i<=prefix.length)){for(var j=0;j<prefix.length;++j)if(segs[j]!==prefix[j])return;return toMount(target,name,i-prefix.length,segs.slice(offset))}}},fluid.invokerFromRecord=function(invokerec,name,that){fluid.pushActivity("makeInvoker","beginning instantiation of invoker with name %name and record %record as child of %that",{name:name,record:invokerec,that:that});var invoker=fluid.makeInvoker(that,invokerec,name);return fluid.popActivity(),invoker},fluid.memberFromRecord=function(memberrec,name,that){var value=fluid.expandOptions(memberrec,that,null,null,{freeRoot:!0});return value},fluid.recordStrategy=function(that,options,optionsStrategy,recordPath,recordMaker,prefix){return prefix=prefix||[],{strategy:function(target,name,i){if(1===i){var record=fluid.driveStrategy(options,[recordPath,name],optionsStrategy);if(void 0!==record){fluid.set(target,[name],fluid.inEvaluationMarker);var member=recordMaker(record,name,that);return fluid.set(target,[name],member),member}}},initter:function(){var records=fluid.driveStrategy(options,recordPath,optionsStrategy)||{};for(var name in records)fluid.getForComponent(that,prefix.concat([name]))}}},fluid.instantiateFirers=function(that){var shadow=fluid.shadowForComponent(that),initter=fluid.get(shadow,["eventStrategyBlock","initter"])||fluid.identity;initter()},fluid.makeDistributionRecord=function(contextThat,sourceRecord,sourcePath,targetSegs,exclusions,offset,sourceType){offset=offset||0,sourceType=sourceType||"distribution";var source=fluid.copy(fluid.get(sourceRecord,sourcePath));fluid.each(exclusions,function(exclusion){fluid.model.applyChangeRequest(source,{path:exclusion,type:"DELETE"})});var record={options:{}},primitiveSource=fluid.isPrimitive(source);return fluid.model.applyChangeRequest(record,{path:targetSegs,type:primitiveSource?"ADD":"MERGE",value:source}),$.extend(record,{contextThat:contextThat,recordType:sourceType,priority:fluid.mergeRecordTypes.distribution+offset})},fluid.filterBlocks=function(contextThat,sourceBlocks,sourcePath,targetSegs,exclusions,removeSource){var togo=[],offset=0;return fluid.each(sourceBlocks,function(block){var source=fluid.get(block.source,sourcePath);if(source){togo.push(fluid.makeDistributionRecord(contextThat,block.source,sourcePath,targetSegs,exclusions,offset++,block.recordType));var rescued=$.extend({},source);removeSource&&fluid.model.applyChangeRequest(block.source,{path:sourcePath,type:"DELETE"}),fluid.each(exclusions,function(exclusion){var orig=fluid.get(rescued,exclusion);fluid.set(block.source,sourcePath.concat(exclusion),orig)})}}),togo},fluid.matchIoCSelector=function(selector,thatStack,contextHashes,memberNames,i){for(var thatpos=thatStack.length-1,selpos=selector.length-1;;){for(var mustMatchHere=thatpos===thatStack.length-1||selector[selpos].child,that=thatStack[thatpos],selel=selector[selpos],match=!0,j=0;j<selel.predList.length;++j){var pred=selel.predList[j];if(pred.context&&!contextHashes[thatpos][pred.context]&&memberNames[thatpos]!==pred.context){match=!1;break}if(pred.id&&that.id!==pred.id){match=!1;break}}if(0===selpos&&thatpos>i&&mustMatchHere&&(match=!1),match){if(0===selpos)return!0;--thatpos,--selpos}else{if(mustMatchHere)return!1;--thatpos}if(i>thatpos)return!1}},fluid.noteCollectedDistribution=function(parentShadow,memberName,distribution){fluid.model.setSimple(parentShadow,["collectedDistributions",memberName,distribution.id],!0)},fluid.isCollectedDistribution=function(parentShadow,memberName,distribution){return fluid.model.getSimple(parentShadow,["collectedDistributions",memberName,distribution.id])},fluid.clearCollectedDistributions=function(parentShadow,memberName){fluid.model.applyChangeRequest(parentShadow,{path:["collectedDistributions",memberName],type:"DELETE"})},fluid.collectDistributions=function(distributedBlocks,parentShadow,distribution,thatStack,contextHashes,memberNames,i){var lastMember=memberNames[memberNames.length-1];!fluid.isCollectedDistribution(parentShadow,lastMember,distribution)&&fluid.matchIoCSelector(distribution.selector,thatStack,contextHashes,memberNames,i)&&(distributedBlocks.push.apply(distributedBlocks,distribution.blocks),fluid.noteCollectedDistribution(parentShadow,lastMember,distribution))},fluid.registerCollectedClearer=function(shadow,parentShadow,memberName){!shadow.collectedClearer&&parentShadow&&(shadow.collectedClearer=function(){fluid.clearCollectedDistributions(parentShadow,memberName)})},fluid.receiveDistributions=function(parentThat,gradeNames,memberName,that){var instantiator=fluid.getInstantiator(parentThat||that),thatStack=instantiator.getThatStack(parentThat||that),memberNames=fluid.getMemberNames(instantiator,thatStack),distributedBlocks=[],shadows=fluid.transform(thatStack,function(thisThat){return instantiator.idToShadow[thisThat.id]}),parentShadow=shadows[shadows.length-(parentThat?1:2)],contextHashes=fluid.getMembers(shadows,"contextHash");parentThat?(memberNames.push(memberName),contextHashes.push(fluid.gradeNamesToHash(gradeNames)),thatStack.push(that)):fluid.registerCollectedClearer(shadows[shadows.length-1],parentShadow,memberNames[memberNames.length-1]);for(var i=0;i<thatStack.length-1;++i)fluid.each(shadows[i].distributions,function(distribution){fluid.collectDistributions(distributedBlocks,parentShadow,distribution,thatStack,contextHashes,memberNames,i)});return distributedBlocks},fluid.applyDistributions=function(that,preBlocks,targetShadow){var distributedBlocks=fluid.transform(preBlocks,function(preBlock){return fluid.generateExpandBlock(preBlock,that,targetShadow.mergePolicy)}),mergeOptions=targetShadow.mergeOptions;return mergeOptions.mergeBlocks.push.apply(mergeOptions.mergeBlocks,distributedBlocks),mergeOptions.updateBlocks(),distributedBlocks},fluid.parseExpectedOptionsPath=function(path,role){var segs=fluid.model.parseEL(path);return segs.length>1&&"options"!==segs[0]&&fluid.fail("Error in options distribution path ",path," - only "+role+' paths beginning with "options" are supported'),segs.slice(1)},fluid.isIoCSSSelector=function(context){return-1!==context.indexOf(" ")},fluid.pushDistributions=function(targetHead,selector,blocks){var targetShadow=fluid.shadowForComponent(targetHead),id=fluid.allocateGuid(),distributions=targetShadow.distributions=targetShadow.distributions||[];return distributions.push({id:id,selector:selector,blocks:blocks}),id},fluid.clearDistributions=function(targetHead,id){var targetShadow=fluid.shadowForComponent(targetHead);fluid.remove_if(targetShadow.distributions,function(distribution){return distribution.id===id})},fluid.extractSelectorHead=function(parsedSelector){var predList=parsedSelector[0].predList,context=predList[0].context;return predList.length=0,context},fluid.undistributableOptions=["gradeNames","distributeOptions","returnedPath","argumentMap","initFunction","mergePolicy","progressiveCheckerOptions"],fluid.distributeOptions=function(that,optionsStrategy){var records=fluid.makeArray(fluid.driveStrategy(that.options,"distributeOptions",optionsStrategy));fluid.each(records,function(record){var targetComp,selector,targetRef=fluid.parseContextReference(record.target);if(fluid.isIoCSSSelector(targetRef.context)){selector=fluid.parseSelector(targetRef.context,fluid.IoCSSMatcher);var headContext=fluid.extractSelectorHead(selector);"that"!==headContext&&fluid.fail('Downwards options distribution not supported from component other than "that"'),targetComp=that}else targetComp=fluid.resolveContext(targetRef.context,that),targetComp||fluid.fail("Error in options distribution record ",record," - could not resolve context selector {"+targetRef.context+"} to a root component");var preBlocks,targetSegs=fluid.model.parseEL(targetRef.path);if(void 0!==record.record)preBlocks=[fluid.makeDistributionRecord(that,record.record,[],targetSegs,[],0)];else{var thatShadow=fluid.shadowForComponent(that),source=fluid.parseContextReference(record.source||"{that}.options");"that"!==source.context&&fluid.fail("Error in options distribution record ",record," only a context of {that} is supported");var sourcePath=fluid.parseExpectedOptionsPath(source.path,"source"),fullExclusions=fluid.makeArray(record.exclusions).concat(0===sourcePath.length?fluid.undistributableOptions:[]),exclusions=fluid.transform(fullExclusions,function(exclusion){return fluid.model.parseEL(exclusion)});preBlocks=fluid.filterBlocks(that,thatShadow.mergeOptions.mergeBlocks,sourcePath,targetSegs,exclusions,record.removeSource),thatShadow.mergeOptions.updateBlocks()}if(selector)fluid.pushDistributions(targetComp,selector,preBlocks);else{var targetShadow=fluid.shadowForComponent(targetComp);fluid.applyDistributions(that,preBlocks,targetShadow)}})},fluid.gradeNamesToHash=function(gradeNames){var contextHash={};return fluid.each(gradeNames,function(gradeName){contextHash[gradeName]=!0,contextHash[fluid.computeNickName(gradeName)]=!0}),contextHash},fluid.cacheShadowGrades=function(that,shadow){var contextHash=fluid.gradeNamesToHash(that.options.gradeNames);contextHash[that.nickName]=!0,shadow.contextHash=contextHash},fluid.deliverOptionsStrategy=function(that,target,mergeOptions){var shadow=fluid.shadowForComponent(that,shadow);fluid.cacheShadowGrades(that,shadow),shadow.mergeOptions=mergeOptions},fluid.resolveReturnedPath=function(returnedPath,that){var shadow=fluid.shadowForComponent(that);return shadow&&""!==shadow.path?null:returnedPath},fluid.defaults("fluid.gradeLinkageRecord",{gradeNames:["fluid.littleComponent"]}),fluid.defaults("fluid.applyGradeLinkage",{}),fluid.gradeLinkageIndexer=function(defaults){return defaults.contextGrades&&defaults.resultGrades?["*"]:void 0},fluid.getLinkedGrades=function(gradeNames){var togo=[],gradeLinkages=fluid.indexDefaults("gradeLinkages",{gradeNames:"fluid.gradeLinkageRecord",indexFunc:fluid.gradeLinkageIndexer});return fluid.each(gradeLinkages["*"],function(defaultsName){var defaults=fluid.defaults(defaultsName),exclude=fluid.find(fluid.makeArray(defaults.contextGrades),function(grade){return fluid.contains(gradeNames,grade)?void 0:!0});exclude||togo.push.apply(togo,fluid.makeArray(defaults.resultGrades))}),togo},fluid.expandDynamicGrades=function(that,shadow,gradeNames,dynamicGrades){var resolved=[];fluid.each(dynamicGrades,function(dynamicGrade){var expanded=fluid.expandOptions(dynamicGrade,that);"function"==typeof expanded&&(expanded=expanded()),expanded&&(resolved=resolved.concat(expanded))});var allGrades=fluid.makeArray(gradeNames).concat(resolved);if(fluid.contains(allGrades,"fluid.applyGradeLinkage")){var linkedGrades=fluid.getLinkedGrades(allGrades);fluid.remove_if(linkedGrades,function(gradeName){return fluid.contains(allGrades,gradeName)}),resolved=resolved.concat(linkedGrades)}var distributedBlocks=fluid.receiveDistributions(null,null,null,that);if(distributedBlocks.length>0){var readyBlocks=fluid.applyDistributions(that,distributedBlocks,shadow),gradeNamesList=fluid.transform(fluid.getMembers(readyBlocks,["source","gradeNames"]),fluid.makeArray);resolved=resolved.concat.apply(resolved,gradeNamesList)}return resolved},fluid.collectDynamicGrades=function(that,shadow,defaultsBlock,gradeNames,dynamicGrades,resolved){var newDefaults=fluid.copy(fluid.getGradedDefaults(that.typeName,resolved));gradeNames.length=0,gradeNames.push.apply(gradeNames,newDefaults.gradeNames),fluid.cacheShadowGrades(that,shadow),shadow.mergeOptions.destroyValue("mergePolicy"),shadow.mergeOptions.destroyValue("components"),shadow.mergeOptions.destroyValue("invokers"),defaultsBlock.source=newDefaults,shadow.mergeOptions.updateBlocks();var furtherResolved=fluid.remove_if(gradeNames,function(gradeName){return"{"===gradeName.charAt(0)&&!fluid.contains(dynamicGrades,gradeName)},[]);return dynamicGrades.push.apply(dynamicGrades,furtherResolved),furtherResolved=fluid.expandDynamicGrades(that,shadow,gradeNames,furtherResolved),resolved.push.apply(resolved,furtherResolved),furtherResolved},fluid.computeDynamicGrades=function(that,shadow,strategy){delete that.options.gradeNames;var gradeNames=fluid.driveStrategy(that.options,"gradeNames",strategy),defaultsBlock=fluid.findMergeBlocks(shadow.mergeOptions.mergeBlocks,"defaults")[0],dynamicGrades=fluid.remove_if(gradeNames,function(gradeName){return"{"===gradeName.charAt(0)||!fluid.hasGrade(defaultsBlock.target,gradeName)},[]),resolved=fluid.expandDynamicGrades(that,shadow,gradeNames,dynamicGrades);if(0!==resolved.length)do var furtherResolved=fluid.collectDynamicGrades(that,shadow,defaultsBlock,gradeNames,dynamicGrades,resolved);while(0!==furtherResolved.length);shadow.collectedClearer&&(shadow.collectedClearer(),delete shadow.collectedClearer)},fluid.computeDynamicComponentKey=function(recordKey,sourceKey){return recordKey+(0===sourceKey?"":"-"+sourceKey)},fluid.registerDynamicRecord=function(that,recordKey,sourceKey,record,toCensor){var key=fluid.computeDynamicComponentKey(recordKey,sourceKey),cRecord=fluid.copy(record);return delete cRecord[toCensor],fluid.set(that.options,["components",key],cRecord),key},fluid.computeDynamicComponents=function(that,mergeOptions){var shadow=fluid.shadowForComponent(that),localSub=shadow.subcomponentLocal={},records=fluid.driveStrategy(that.options,"dynamicComponents",mergeOptions.strategy);fluid.each(records,function(record,recordKey){if(record.sources||record.createOnEvent||fluid.fail("Cannot process dynamicComponents record ",record,' without a "sources" or "createOnEvent" entry'),record.sources){var sources=fluid.expandOptions(record.sources,that);fluid.each(sources,function(source,sourceKey){var key=fluid.registerDynamicRecord(that,recordKey,sourceKey,record,"sources");localSub[key]={source:source,sourcePath:sourceKey}})}else if(record.createOnEvent){var event=fluid.event.expandOneEvent(that,record.createOnEvent);fluid.set(shadow,["dynamicComponentCount",recordKey],0);var listener=function(){var key=fluid.registerDynamicRecord(that,recordKey,shadow.dynamicComponentCount[recordKey]++,record,"createOnEvent");localSub[key]={arguments:fluid.makeArray(arguments)},fluid.initDependent(that,key)};event.addListener(listener),fluid.recordListener(event,listener,shadow)}})},fluid.computeComponentAccessor=function(that){var shadow=fluid.shadowForComponent(that),options=that.options,strategy=shadow.mergeOptions.strategy,optionsStrategy=fluid.mountStrategy(["options"],options,strategy);shadow.invokerStrategy=fluid.recordStrategy(that,options,strategy,"invokers",fluid.invokerFromRecord),shadow.eventStrategyBlock=fluid.recordStrategy(that,options,strategy,"events",fluid.eventFromRecord,["events"]);var eventStrategy=fluid.mountStrategy(["events"],that,shadow.eventStrategyBlock.strategy,["events"]);return shadow.memberStrategy=fluid.recordStrategy(that,options,strategy,"members",fluid.memberFromRecord),shadow.getConfig={strategies:[fluid.model.funcResolverStrategy,fluid.makeGingerStrategy(that),optionsStrategy,shadow.invokerStrategy.strategy,shadow.memberStrategy.strategy,eventStrategy]},fluid.computeDynamicGrades(that,shadow,strategy,shadow.mergeOptions.mergeBlocks),fluid.distributeOptions(that,strategy),shadow.getConfig},fluid.shadowForComponent=function(component){var instantiator=fluid.getInstantiator(component);return instantiator&&component?instantiator.idToShadow[component.id]:null},fluid.getForComponent=function(component,path){var shadow=fluid.shadowForComponent(component),getConfig=shadow?shadow.getConfig:void 0;return fluid.get(component,path,getConfig)},fluid.makeGingerStrategy=function(that){var instantiator=fluid.getInstantiator(that);return function(component,thisSeg,index,segs){var atval=component[thisSeg];if(atval===fluid.inEvaluationMarker&&index===segs.length&&fluid.fail('Error in component configuration - a circular reference was found during evaluation of path segment "'+thisSeg+'": for more details, see the activity records following this message in the console, or issue fluid.setLogging(fluid.logLevel.TRACE) when running your application'),index>1)return atval;if(void 0===atval&&component.hasOwnProperty(thisSeg))return fluid.NO_VALUE;if(void 0===atval){var parentPath=instantiator.idToShadow[component.id].path,childPath=fluid.composePath(parentPath,thisSeg);atval=instantiator.pathToComponent[childPath]}return void 0===atval&&fluid.getForComponent(component,["options","components",thisSeg])&&(fluid.initDependent(component,thisSeg),atval=component[thisSeg]),atval}},fluid.filterBuiltinGrades=function(gradeNames){return fluid.remove_if(fluid.makeArray(gradeNames),function(gradeName){return/^(autoInit|fluid.littleComponent|fluid.modelComponent|fluid.eventedComponent|fluid.viewComponent|fluid.typeFount)$/.test(gradeName)})},fluid.dumpGradeNames=function(that){return that.options&&that.options.gradeNames?" gradeNames: "+JSON.stringify(fluid.filterBuiltinGrades(that.options.gradeNames)):""},fluid.dumpThat=function(that){return'{ typeName: "'+that.typeName+'"'+fluid.dumpGradeNames(that)+" id: "+that.id+"}"},fluid.dumpThatStack=function(thatStack,instantiator){var togo=fluid.transform(thatStack,function(that){var path=instantiator.idToPath(that.id);return fluid.dumpThat(that)+(path?" - path: "+path:"")});return togo.join("\n")},fluid.resolveContext=function(context,that){var instantiator=fluid.getInstantiator(that);if("instantiator"===context)return instantiator;if("that"===context)return that;var foundComponent,thatStack=instantiator.getFullStack(that);return visitComponents(instantiator,thatStack,function(component,name){var shadow=fluid.shadowForComponent(component);return context===name||shadow&&shadow.contextHash&&shadow.contextHash[context]||context===component.typeName||context===component.nickName?(foundComponent=component,!0):fluid.getForComponent(component,["options","components",context,"type"])&&!component[context]?(foundComponent=fluid.getForComponent(component,context),!0):void 0}),foundComponent};var localRecordExpected=/^(arguments|options|container|source|sourcePath|change)$/;fluid.makeStackFetcher=function(parentThat,localRecord){var fetcher=function(parsed){var context=parsed.context;if(localRecord&&localRecordExpected.test(context)){var fetched=fluid.get(localRecord[context],parsed.path);return"arguments"===context||"source"===context||"sourcePath"===context||"change"===context?fetched:{marker:"options"===context?fluid.EXPAND:fluid.EXPAND_NOW,value:fetched}}var foundComponent=fluid.resolveContext(context,parentThat);if(!foundComponent&&""!==parsed.path){var ref=fluid.renderContextReference(parsed);fluid.fail("Failed to resolve reference "+ref+" - could not match context with name "+context+" from component "+fluid.dumpThat(parentThat),parentThat)}return fluid.getForComponent(foundComponent,parsed.path)};return fetcher},fluid.makeStackResolverOptions=function(parentThat,localRecord){return $.extend(fluid.copy(fluid.rawDefaults("fluid.makeExpandOptions")),{fetcher:fluid.makeStackFetcher(parentThat,localRecord),contextThat:parentThat})},fluid.clearListeners=function(shadow){fluid.each(shadow.listeners,function(rec){rec.event.removeListener(rec.listener)}),delete shadow.listeners},fluid.recordListener=function(event,listener,shadow){if(event.ownerId!==shadow.that.id){var listeners=shadow.listeners;listeners||(listeners=shadow.listeners=[]),listeners.push({event:event,listener:listener})}};var idToInstantiator={};fluid.instantiator=function(freeInstantiator){function recordComponent(component,path,created){if(created){idToInstantiator[component.id]=that;var shadow=that.idToShadow[component.id]={};shadow.that=component,shadow.path=path}that.pathToComponent[path]&&fluid.fail("Error during instantiation - path "+path+" which has just created component "+fluid.dumpThat(component)+" has already been used for component "+fluid.dumpThat(that.pathToComponent[path])+" - this is a circular instantiation or other oversight. Please clear the component using instantiator.clearComponent() before reusing the path."),that.pathToComponent[path]=component}var that={id:fluid.allocateGuid(),nickName:"instantiator",pathToComponent:{},idToShadow:{},modelTransactions:{init:{}},composePath:fluid.composePath};return that.idToPath=function(id){var shadow=that.idToShadow[id];return shadow?shadow.path:""},that.getThatStack=function(component){var shadow=that.idToShadow[component.id];if(shadow){var path=shadow.path,parsed=fluid.model.parseEL(path),togo=fluid.transform(parsed,function(value,i){var parentPath=fluid.model.composeSegments.apply(null,parsed.slice(0,i+1));return that.pathToComponent[parentPath]}),root=that.pathToComponent[""];return root&&togo.unshift(root),togo}return[component]},that.getEnvironmentalStack=function(){var togo=[fluid.staticEnvironment];return freeInstantiator||togo.push(fluid.globalThreadLocal()),togo},that.getFullStack=function(component){var thatStack=component?that.getThatStack(component):[];return that.getEnvironmentalStack().concat(thatStack)},that.recordRoot=function(component){component&&component.id&&!that.pathToComponent[""]&&recordComponent(component,"",!0)},that.recordKnownComponent=function(parent,component,name,created){var parentPath=that.idToShadow[parent.id].path,path=that.composePath(parentPath,name);recordComponent(component,path,created)},that.clearComponent=function(component,name,child,options,noModTree,path){var record=that.idToShadow[component.id].path;options=options||{flat:!0,instantiator:that},child=child||component[name],path=path||record,void 0===path&&fluid.fail("Cannot clear component "+name+" from component ",component," which was not created by this instantiator"),fluid.fireEvent(child,"events.onClear",[child,name,component]);var childPath=that.composePath(path,name),childRecord=that.idToShadow[child.id];childRecord&&childRecord.path===childPath&&(fluid.fireEvent(child,"events.onDestroy",[child,name,component]),fluid.clearListeners(childRecord),fluid.visitComponentChildren(child,function(gchild,gchildname,newPath,parentPath){that.clearComponent(child,gchildname,null,options,!0,parentPath)},options,childPath),fluid.fireEvent(child,"events.afterDestroy",[child,name,component]),delete that.idToShadow[child.id],delete idToInstantiator[child.id]),delete that.pathToComponent[childPath],noModTree||delete component[name]},that},fluid.freeInstantiator=fluid.instantiator(!0),fluid.getInstantiator=function(component){return component&&idToInstantiator[component.id]||fluid.freeInstantiator},fluid.expandOptions=function(args,that,mergePolicy,localRecord,outerExpandOptions){if(!args)return args;fluid.pushActivity("expandOptions","expanding options %args for component %that ",{that:that,args:args});var expandOptions=fluid.makeStackResolverOptions(that,localRecord);expandOptions.mergePolicy=mergePolicy,expandOptions.freeRoot=outerExpandOptions&&outerExpandOptions.freeRoot;var expanded=outerExpandOptions&&outerExpandOptions.defer?fluid.makeExpandOptions(args,expandOptions):fluid.expand(args,expandOptions);return fluid.popActivity(),expanded},fluid.localRecordExpected=["type","options","args","mergeOptions","createOnEvent","priority","recordType"],fluid.checkComponentRecord=function(defaults,localRecord){var expected=fluid.arrayToHash(fluid.localRecordExpected);fluid.each(defaults&&defaults.argumentMap,function(value,key){expected[key]=!0}),fluid.each(localRecord,function(value,key){expected[key]||fluid.fail('Probable error in subcomponent record - key "'+key+'" found, where the only legal options are '+fluid.keys(expected).join(", "))})},fluid.pushDemands=function(list,demands){function push(rec){rec.recordType="demands",rec.priority=thisp++,list.push(rec)}demands=fluid.makeArray(demands);for(var thisp=fluid.mergeRecordTypes.demands,i=0;i<demands.length;++i){var thisd=demands[i];if(thisd.options)push(thisd);else if(thisd.mergeOptions){var mergeOptions=fluid.makeArray(thisd.mergeOptions);fluid.each(mergeOptions,function(record){push({options:record})})}else fluid.fail("Uninterpretable demands record without options or mergeOptions ",thisd)}},fluid.mergeRecordsToList=function(mergeRecords){var list=[];return fluid.each(mergeRecords,function(value,key){if(value.recordType=key,"distributions"===key)list.push.apply(list,value);else if("demands"!==key){if(!value.options)return;value.priority=fluid.mergeRecordTypes[key],void 0===value.priority&&fluid.fail("Merge record with unrecognised type "+key+": ",value),list.push(value)}else fluid.pushDemands(list,value)}),list};var addPolicyBuiltins=function(policy){return fluid.each(["gradeNames","mergePolicy","argumentMap","components","dynamicComponents","members","invokers","events","listeners","modelListeners","distributeOptions","transformOptions"],function(key){fluid.set(policy,[key,"*","noexpand"],!0)}),policy};fluid.generateExpandBlock=function(record,that,mergePolicy,localRecord){var expanded=fluid.expandOptions(record.options,record.contextThat||that,mergePolicy,localRecord,{defer:!0});return expanded.priority=record.priority,expanded.recordType=record.recordType,expanded};var expandComponentOptionsImpl=function(mergePolicy,defaults,userOptions,that){var defaultCopy=fluid.copy(defaults);addPolicyBuiltins(mergePolicy);var shadow=fluid.shadowForComponent(that);shadow.mergePolicy=mergePolicy;var mergeRecords={defaults:{options:defaultCopy}};userOptions&&(userOptions.marker===fluid.EXPAND?($.extend(mergeRecords,userOptions.mergeRecords),mergeRecords.subcomponentRecord&&fluid.checkComponentRecord(defaults,mergeRecords.subcomponentRecord)):mergeRecords.user={options:fluid.expandCompact(userOptions,!0)});var expandList=fluid.mergeRecordsToList(mergeRecords),togo=fluid.transform(expandList,function(value){return fluid.generateExpandBlock(value,that,mergePolicy,userOptions&&userOptions.localRecord)});return togo};fluid.makeIoCRootDestroy=function(instantiator,that){return function(){instantiator.clearComponent(that,"",that,null,!0),fluid.fireEvent(that,"events.onDestroy",[that,"",null]),fluid.fireEvent(that,"events.afterDestroy",[that,"",null])}},fluid.expandComponentOptions=function(mergePolicy,defaults,userOptions,that){var fresh,instantiator=userOptions&&userOptions.marker===fluid.EXPAND&&void 0!==userOptions.memberName?userOptions.instantiator:null;instantiator||(instantiator=fluid.instantiator(),fresh=!0,fluid.log("Created new instantiator with id "+instantiator.id+" in order to operate on component "+(that?that.typeName:"[none]")),that.destroy=fluid.makeIoCRootDestroy(instantiator,that)),fluid.pushActivity("expandComponentOptions","expanding component options %options with record %record for component %that",{options:userOptions&&userOptions.mergeRecords,record:userOptions,that:that}),fresh?instantiator.recordRoot(that):instantiator.recordKnownComponent(userOptions.parentThat,that,userOptions.memberName,!0);var togo=expandComponentOptionsImpl(mergePolicy,defaults,userOptions,that);return fluid.popActivity(),togo},fluid.argMapToDemands=function(argMap){var togo=[];return fluid.each(argMap,function(value,key){togo[value]="{"+key+"}"}),togo},fluid.makePassArgsSpec=function(initArgs){return fluid.transform(initArgs,function(arg,index){return"{arguments}."+index})},fluid.pushDemandSpec=function(record,options,mergeOptions){options&&"{options}"!==options&&record.push({options:options}),mergeOptions&&record.push({mergeOptions:mergeOptions})},fluid.embodyDemands=function(parentThat,demandspec,initArgs,options){options=options||{},demandspec.mergeOptions&&demandspec.options&&fluid.fail("demandspec ",demandspec," is invalid - cannot specify literal options together with mergeOptions"),demandspec.transformOptions&&(demandspec.options=$.extend(!0,{},demandspec.options,{transformOptions:demandspec.transformOptions}));var demands=fluid.makeArray(demandspec.args),upDefaults=fluid.defaults(demandspec.funcName),fakeThat={},distributions=upDefaults&&parentThat?fluid.receiveDistributions(parentThat,upDefaults.gradeNames,options.memberName,fakeThat):[],argMap=upDefaults?upDefaults.argumentMap:null,inferMap=!1;if(upDefaults&&(options.passArgs=!1),!argMap&&(upDefaults||options&&options.componentRecord))if(inferMap=!0,demands.length<2)argMap=fluid.rawDefaults("fluid.littleComponent").argumentMap;else{var optionpos=$.inArray("{options}",demands);-1===optionpos&&(optionpos=demands.length-1),argMap={options:optionpos}}options=options||{},0===demands.length&&(argMap?demands=fluid.argMapToDemands(argMap):options.passArgs&&(demands=fluid.makePassArgsSpec(initArgs)));var shadow=fluid.shadowForComponent(parentThat),localDynamic=shadow&&options.memberName?shadow.subcomponentLocal[options.memberName]:null,localRecord=$.extend({arguments:initArgs},fluid.censorKeys(options.componentRecord,["type"]),localDynamic);fluid.each(argMap,function(index,name){if(initArgs.length>0&&(localRecord[name]=localRecord.arguments[index]),void 0!==demandspec[name]&&void 0===localRecord[name]&&(localRecord[name]=demandspec[name]),"options"!==name)for(var i=0;i<distributions.length;++i)void 0!==distributions[i][name]&&(localRecord[name]=distributions[i][name])});for(var i=0;i<distributions.length;++i)void 0!==distributions[i].type&&(demandspec.funcName=distributions[i].type);var mergeRecords={distributions:distributions};void 0!==options.componentRecord&&(mergeRecords.subcomponentRecord=$.extend({},options.componentRecord));var expandOptions=fluid.makeStackResolverOptions(parentThat,localRecord),args=[];if(demands)for(var i=0;i<demands.length;++i){var arg=demands[i];if(fluid.isMarker(arg)&&arg.value===fluid.COMPONENT_OPTIONS.value&&(arg="{options}",inferMap&&(argMap={options:i})),"string"==typeof arg&&"@"===arg.charAt(0)){var argpos=arg.substring(1);arg="{arguments}."+argpos}demands[i]=arg,argMap&&argMap.options===i?(options.passArgs&&fluid.fail("Error invoking function "+demandspec.funcName+": found component creator rather than free function"),"object"!=typeof arg||arg.targetTypeName||(arg.targetTypeName=demandspec.funcName),mergeRecords.demands=[],fluid.each(demandspec.backSpecs.reverse(),function(backSpec){fluid.pushDemandSpec(mergeRecords.demands,backSpec.options,backSpec.mergeOptions)}),fluid.pushDemandSpec(mergeRecords.demands,demandspec.options||arg,demandspec.mergeOptions),initArgs.length>0&&(mergeRecords.user={options:localRecord.options}),args[i]={marker:fluid.EXPAND,localRecord:localDynamic,mergeRecords:mergeRecords,instantiator:fluid.getInstantiator(parentThat),parentThat:parentThat,memberName:options.memberName}):args[i]=fluid.expand(arg,expandOptions),args[i]&&fluid.isMarker(args[i].marker,fluid.EXPAND_NOW)&&(args[i]=fluid.expand(args[i].value,expandOptions))
}else args=initArgs?initArgs:[];var togo={args:args,preExpand:demands,funcName:demandspec.funcName};return togo},fluid.fabricateDestroyMethod=function(that,name,instantiator,child){return function(){instantiator.clearComponent(that,name,child)}},fluid.initDependent=function(that,name,directArgs){if(!that[name]){directArgs=directArgs||[];var component=that.options.components[name];fluid.pushActivity("initDependent",'instantiating dependent component with name "%name" with record %record as child of %parent',{name:name,record:component,parent:that});var instance,instantiator=idToInstantiator[that.id];if("string"==typeof component)instance=fluid.expandOptions(component,that),instantiator.recordKnownComponent(that,instance,name,!1);else if(component.type){var type=fluid.expandOptions(component.type,that);type||fluid.fail("Error in subcomponent record: ",component.type," could not be resolved to a type for component ",name," of parent ",that);var invokeSpec=fluid.resolveDemands(that,[type,name],directArgs,{componentRecord:component,memberName:name});instance=fluid.initSubcomponentImpl(that,{type:invokeSpec.funcName},invokeSpec.args);var path=instantiator.composePath(instantiator.idToPath(that.id),name),existing=instantiator.pathToComponent[path];existing&&existing!==instance&&instantiator.clearComponent(that,name,existing),instance&&instance.typeName&&instance.id&&instance!==existing&&instantiator.recordKnownComponent(that,instance,name,!0),instance.destroy=fluid.fabricateDestroyMethod(that,name,instantiator,instance)}else fluid.fail("Unrecognised material in place of subcomponent "+name+' - no "type" field found');return that[name]=instance,fluid.fireEvent(instance,"events.onAttach",[instance,name,that]),fluid.popActivity(),instance}},fluid.bindDeferredComponent=function(that,componentName,component){var events=fluid.makeArray(component.createOnEvent);fluid.each(events,function(eventName){var event="{"===eventName.charAt(0)?fluid.expandOptions(eventName,that):that.events[eventName];event.addListener(function(){if(fluid.pushActivity("initDeferred","instantiating deferred component %componentName of parent %that due to event %eventName",{componentName:componentName,that:that,eventName:eventName}),that[componentName]){var instantiator=idToInstantiator[that.id];instantiator.clearComponent(that,componentName)}fluid.initDependent(that,componentName),fluid.popActivity()},null,null,component.priority)})},fluid.priorityForComponent=function(component){return component.priority?component.priority:"fluid.typeFount"===component.type||fluid.hasGrade(fluid.defaults(component.type),"fluid.typeFount")?"first":void 0},fluid.initDependents=function(that){fluid.pushActivity("initDependents","instantiating dependent components for component %that",{that:that});var shadow=fluid.shadowForComponent(that);shadow.memberStrategy.initter();var options=that.options,components=options.components||{},componentSort={};fluid.each(components,function(component,name){if(component.createOnEvent)fluid.bindDeferredComponent(that,name,component);else{var priority=fluid.priorityForComponent(component);componentSort[name]={key:name,priority:fluid.event.mapPriority(priority,0)}}});var componentList=fluid.event.sortListeners(componentSort);fluid.each(componentList,function(entry){fluid.initDependent(that,entry.key)}),shadow.invokerStrategy.initter(),fluid.popActivity()};var dependentStore={},isDemandLogging=!1;fluid.setDemandLogging=function(set){isDemandLogging=set},fluid.isDemandLogging=function(){return isDemandLogging&&fluid.isLogging()},fluid.demands=function(demandingName,contextName,spec){var contextNames=fluid.makeArray(contextName).sort();if(!spec)return searchDemands(demandingName,contextNames);if(spec.length&&(spec={args:spec}),fluid.getCallerInfo&&fluid.isDemandLogging()){var callerInfo=fluid.getCallerInfo(5);callerInfo&&(spec.registeredFrom=callerInfo)}spec.demandId=fluid.allocateGuid();var exist=dependentStore[demandingName];exist||(exist=[],dependentStore[demandingName]=exist),exist.push({contexts:contextNames,spec:spec})},fluid.compareDemands=function(speca,specb){return specb.intersect-speca.intersect},fluid.locateAllDemands=function(parentThat,demandingNames){var demandLogging=fluid.isDemandLogging(demandingNames);demandLogging&&fluid.log("Resolving demands for function names ",demandingNames," in context of "+(parentThat?"component "+parentThat.typeName:"no component"));var contextNames={},visited=[],instantiator=fluid.getInstantiator(parentThat),thatStack=instantiator.getFullStack(parentThat);visitComponents(instantiator,thatStack,function(component,xname,path,xpath,depth){contextNames[component.typeName]=depth;var gradeNames=fluid.makeArray(fluid.get(component,["options","gradeNames"]));fluid.each(gradeNames,function(gradeName){contextNames[gradeName]=depth}),visited.push(component)}),demandLogging&&fluid.log("Components in scope for resolution:\n"+fluid.dumpThatStack(visited,instantiator));for(var matches=[],i=0;i<demandingNames.length;++i)for(var rec=dependentStore[demandingNames[i]]||[],j=0;j<rec.length;++j){for(var spec=rec[j],horizonLevel=spec.spec.horizon?contextNames[spec.spec.horizon]:-1,record={spec:spec,intersect:0,uncess:0},k=0;k<spec.contexts.length;++k){var depth=contextNames[spec.contexts[k]];record[void 0!==depth&&depth>=horizonLevel?"intersect":"uncess"]+=2}0===spec.contexts.length&&record.intersect++,0===record.uncess&&matches.push(record)}return matches.sort(fluid.compareDemands),matches},fluid.locateDemands=function(parentThat,demandingNames){var matches=fluid.locateAllDemands(parentThat,demandingNames),demandspec=fluid.getMembers(matches,["spec","spec"]);return fluid.isDemandLogging(demandingNames)&&(demandspec.length?fluid.log("Located "+matches.length+" potential match"+(1===matches.length?"":"es")+", selected best match with "+matches[0].intersect+" matched context names: ",demandspec):fluid.log("No matches found for demands, using direct implementation")),demandspec},fluid.determineDemands=function(parentThat,funcNames){funcNames=fluid.makeArray(funcNames);var newFuncName=funcNames[0],demandspec=fluid.locateDemands(parentThat,funcNames);return demandspec.length&&demandspec[0].funcName&&(newFuncName=demandspec[0].funcName),$.extend(!0,{funcName:newFuncName,args:demandspec[0]?fluid.makeArray(demandspec[0].args):[]},{backSpecs:demandspec.slice(1)},fluid.censorKeys(demandspec[0],["funcName","args"]))},fluid.resolveDemands=function(parentThat,funcNames,initArgs,options){var demandspec=fluid.determineDemands(parentThat,funcNames);return fluid.embodyDemands(parentThat,demandspec,initArgs,options)},fluid.thisistToApplicable=function(record,recthis,that){return{apply:function(noThis,args){var resolvedThis=fluid.expandOptions(recthis,that);"string"==typeof resolvedThis&&(resolvedThis=fluid.getGlobalValue(resolvedThis)),resolvedThis||fluid.fail("Could not resolve reference "+recthis+" to a value");var resolvedFunc=resolvedThis[record.method];return"function"!=typeof resolvedFunc&&fluid.fail("Object ",resolvedThis," at reference "+recthis+" has no member named "+record.method+" which is a function "),fluid.log("Applying arguments ",args," to method "+record.method+" of instance ",resolvedThis),resolvedFunc.apply(resolvedThis,args)}}},fluid.changeToApplicable=function(record,that){return{apply:function(noThis,args){var parsed=fluid.parseValidModelReference(that,"changePath listener record",record.changePath),value=fluid.expandOptions(record.value,that,{},{arguments:args});fluid.fireSourcedChange(parsed.applier,parsed.path,value,record.source)}}},fluid.recordToApplicable=function(record,that){if(record.changePath)return fluid.changeToApplicable(record,that);var recthis=record["this"];return record.method^recthis&&fluid.fail("Record ",that,' must contain both entries "method" and "this" if it contains either'),record.method?fluid.thisistToApplicable(record,recthis,that):null},fluid.invoke=function(functionName,args,that,environment){fluid.pushActivity("invokeFunc",'invoking function with name "%functionName" from component %that',{functionName:functionName,that:that});var invokeSpec=fluid.resolveDemands(that,functionName,fluid.makeArray(args),{passArgs:!0}),togo=fluid.invokeGlobalFunction(invokeSpec.funcName,invokeSpec.args,environment);return fluid.popActivity(),togo},fluid.makeFreeInvoker=function(functionName,environment){var demandSpec=fluid.determineDemands(null,functionName);return function(){var invokeSpec=fluid.embodyDemands(null,demandSpec,fluid.makeArray(arguments),{passArgs:!0});return fluid.invokeGlobalFunction(invokeSpec.funcName,invokeSpec.args,environment)}};var argPrefix="{arguments}.";fluid.parseInteger=function(string){return isFinite(string)&&string%1===0?Number(string):0/0},fluid.makeFastInvoker=function(invokeSpec,func){var argMap;if(invokeSpec.preExpand){argMap={};for(var i=0;i<invokeSpec.preExpand.length;++i){var value=invokeSpec.preExpand[i];if("string"==typeof value){if(-1!==value.indexOf("}.model"))return{noFast:!0};if("{arguments}"===value)argMap[i]="*";else if(0===value.indexOf(argPrefix)){var argIndex=fluid.parseInteger(value.substring(argPrefix.length));if(isNaN(argIndex))return{noFast:!0};argMap[i]=argIndex}}}}var outArgs=invokeSpec.args,invoke=argMap?function(args){for(var i in argMap)outArgs[i]="*"===argMap[i]?args:args[argMap[i]];return func.apply(null,outArgs)}:function(args){return func.apply(null,args)};return{invoke:invoke}},fluid.makeInvoker=function(that,invokerec,name,environment){var functionName;"string"==typeof invokerec&&("{"===invokerec.charAt(0)?invokerec={func:invokerec}:functionName=invokerec);var demandspec=functionName?fluid.determineDemands(that,functionName):invokerec,fastRec={noFast:invokerec.dynamic};return function(){fluid.defeatLogging===!1&&fluid.pushActivity("invokeInvoker","invoking invoker with name %name and record %record from component %that",{name:name,record:invokerec,that:that});var togo;if(fastRec.invoke)togo=fastRec.invoke(arguments);else{var func=fluid.recordToApplicable(invokerec,that),args=fluid.makeArray(arguments),invokeSpec=fluid.embodyDemands(that,demandspec,args,{passArgs:!0});func=func||(invokeSpec.funcName?fluid.getGlobalValue(invokeSpec.funcName,environment):fluid.expandOptions(demandspec.func,that)),func&&func.apply||fluid.fail("Error in invoker record: could not resolve members func, funcName or method to a function implementation - got "+func+" from ",demandspec),fastRec.noFast!==!0&&(fastRec=fluid.makeFastInvoker(invokeSpec,func)),togo=func.apply(null,invokeSpec.args)}return fluid.defeatLogging===!1&&fluid.popActivity(),togo}},fluid.event.makeTrackedListenerAdder=function(source){var shadow=fluid.shadowForComponent(source);return function(event){return{addListener:function(listener){fluid.recordListener(event,listener,shadow),event.addListener.apply(null,arguments)}}}},fluid.event.listenerEngine=function(eventSpec,callback,adder){function checkFire(){var notall=fluid.find(eventSpec,function(value,key){return void 0===argstruc[key]?!0:void 0});if(!notall){var oldstruc=argstruc;argstruc={},callback(oldstruc)}}var argstruc={};fluid.each(eventSpec,function(event,eventName){adder(event).addListener(function(){argstruc[eventName]=fluid.makeArray(arguments),checkFire()})})},fluid.event.dispatchListener=function(that,listener,eventName,eventSpec,indirectArgs){var togo=function(){fluid.pushActivity("dispatchListener","firing to listener to event named %eventName of component %that",{eventName:eventName,that:that});var args=indirectArgs?arguments[0]:fluid.makeArray(arguments),demandspec=fluid.determineDemands(that,eventName);0===demandspec.args.length&&eventSpec.args&&(demandspec.args=eventSpec.args);var resolved=fluid.embodyDemands(that,demandspec,args,{passArgs:!0}),togo=fluid.event.invokeListener(listener,resolved.args);return fluid.popActivity(),togo};return fluid.event.impersonateListener(listener,togo),togo},fluid.event.resolveSoftNamespace=function(key){if("string"!=typeof key)return null;var lastpos=Math.max(key.lastIndexOf("."),key.lastIndexOf("}"));return key.substring(lastpos+1)},fluid.event.resolveListenerRecord=function(lisrec,that,eventName,namespace,standard){var badRec=function(record,extra){fluid.fail("Error in listener record - could not resolve reference ",record,' to a listener or firer. Did you miss out "events." when referring to an event firer?'+extra)};fluid.pushActivity("resolveListenerRecord","resolving listener record for event named %eventName for component %that",{eventName:eventName,that:that});var records=fluid.makeArray(lisrec),transRecs=fluid.transform(records,function(record){var expanded=fluid.isPrimitive(record)||record.expander?{listener:record}:fluid.copy(record),methodist=fluid.recordToApplicable(record,that);expanded.listener=methodist?methodist:expanded.listener||expanded.func||expanded.funcName,expanded.listener||badRec(record,' Listener record must contain a member named "listener", "func", "funcName" or "method"');var softNamespace=record.method?fluid.event.resolveSoftNamespace(record["this"])+"."+record.method:fluid.event.resolveSoftNamespace(expanded.listener);expanded.namespace||namespace||!softNamespace||(expanded.softNamespace=!0,expanded.namespace=(record.componentSource?record.componentSource:that.typeName)+"."+softNamespace);var listener=expanded.listener=fluid.expandOptions(expanded.listener,that);listener||badRec(record,"");var firer=!1;return"fluid.event.firer"===listener.typeName&&(listener=listener.fire,firer=!0),expanded.listener=standard&&(expanded.args||firer)?fluid.event.dispatchListener(that,listener,eventName,expanded):listener,expanded}),togo={records:transRecs,adderWrapper:standard?fluid.event.makeTrackedListenerAdder(that):null};return fluid.popActivity(),togo},fluid.event.expandOneEvent=function(that,event){var origin;return origin="string"==typeof event&&"{"!==event.charAt(0)?fluid.getForComponent(that,["events",event]):fluid.expandOptions(event,that),origin&&"fluid.event.firer"===origin.typeName||fluid.fail("Error in event specification - could not resolve base event reference ",event," to an event firer: got ",origin),origin},fluid.event.expandEvents=function(that,event){return"string"==typeof event?fluid.event.expandOneEvent(that,event):fluid.transform(event,function(oneEvent){return fluid.event.expandOneEvent(that,oneEvent)})},fluid.event.resolveEvent=function(that,eventName,eventSpec){fluid.pushActivity("resolveEvent","resolving event with name %eventName attached to component %that",{eventName:eventName,that:that});var adder=fluid.event.makeTrackedListenerAdder(that);"string"==typeof eventSpec&&(eventSpec={event:eventSpec});var event=eventSpec.event||eventSpec.events;event||fluid.fail("Event specification for event with name "+eventName+" does not include a base event specification: ",eventSpec);var firer,origin=fluid.event.expandEvents(that,event),isMultiple="fluid.event.firer"!==origin.typeName,isComposite=eventSpec.args||isMultiple;if(isComposite){firer=fluid.makeEventFirer(null,null," [composite] "+fluid.event.nameEvent(that,eventName));var dispatcher=fluid.event.dispatchListener(that,firer.fire,eventName,eventSpec,isMultiple);isMultiple?fluid.event.listenerEngine(origin,dispatcher,adder):adder(origin).addListener(dispatcher)}else firer={typeName:"fluid.event.firer"},firer.fire=function(){var outerArgs=fluid.makeArray(arguments);fluid.pushActivity("fireSynthetic","firing synthetic event %eventName ",{eventName:eventName});var togo=origin.fire.apply(null,outerArgs);return fluid.popActivity(),togo},firer.addListener=function(listener,namespace,predicate,priority,softNamespace){var dispatcher=fluid.event.dispatchListener(that,listener,eventName,eventSpec);adder(origin).addListener(dispatcher,namespace,predicate,priority,softNamespace)},firer.removeListener=function(listener){origin.removeListener(listener)};return fluid.popActivity(),firer},fluid.withEnvironment=function(envAdd,func,root){return root=root||fluid.globalThreadLocal(),fluid.tryCatch(function(){for(var key in envAdd)root[key]=envAdd[key];return $.extend(root,envAdd),func()},null,function(){for(var key in envAdd)delete root[key]})},fluid.fetchContextReference=function(parsed,directModel,env,elResolver,externalFetcher){elResolver&&(parsed=elResolver(parsed,env));var base=parsed.context?env[parsed.context]:directModel;if(!base){var resolveExternal=externalFetcher&&externalFetcher(parsed);return resolveExternal||base}return parsed.noDereference?parsed.path:fluid.get(base,parsed.path)},fluid.makeEnvironmentFetcher=function(directModel,elResolver,envGetter,externalFetcher){return envGetter=envGetter||fluid.globalThreadLocal,function(parsed){var env=envGetter();return fluid.fetchContextReference(parsed,directModel,env,elResolver,externalFetcher)}},fluid.coerceToPrimitive=function(string){return"false"===string?!1:"true"===string?!0:isFinite(string)?Number(string):string},fluid.compactStringToRec=function(string,type){var openPos=string.indexOf("("),closePos=string.indexOf(")");if((-1===openPos^-1===closePos||openPos>closePos)&&fluid.fail("Badly-formed compact "+type+" record without matching parentheses: ",string),-1!==openPos&&-1!==closePos){var prefix=string.substring(0,openPos),body=string.substring(openPos+1,closePos),args=fluid.transform(body.split(","),$.trim,fluid.coerceToPrimitive),togo={args:args};return"invoker"===type&&"!"===prefix.charAt(openPos-1)&&(prefix=string.substring(0,openPos-1),togo.dynamic=!0),togo["{"===prefix.charAt(0)?"func":"funcName"]=prefix,togo}return"expander"===type&&fluid.fail("Badly-formed compact expander record without parentheses: ",string),string},fluid.expandPrefix="@expand:",fluid.expandCompactString=function(string,active){var rec=string;if(0===string.indexOf(fluid.expandPrefix)){var rem=string.substring(fluid.expandPrefix.length);rec={expander:fluid.compactStringToRec(rem,"expander")}}else active&&(rec=fluid.compactStringToRec(string,active));return rec};var singularPenRecord={listeners:"listener",modelListeners:"modelListener"},singularRecord=$.extend({invokers:"invoker"},singularPenRecord);fluid.expandCompactRec=function(segs,target,source,userOptions){var pen=segs.length>0?segs[segs.length-1]:"",active=singularRecord[pen];!active&&segs.length>1&&(active=singularPenRecord[segs[segs.length-2]]),fluid.each(source,function(value,key){return!fluid.isPlainObject(value)||fluid.isDOMish(value)||userOptions&&"model"===key&&0===segs.length?("string"==typeof value&&(value=fluid.expandCompactString(value,active)),void(target[key]=value)):(target[key]=fluid.freshContainer(value),segs.push(key),fluid.expandCompactRec(segs,target[key],value),void segs.pop())})},fluid.expandCompact=function(options,userOptions){var togo={};return fluid.expandCompactRec([],togo,options,userOptions),togo},fluid.extractEL=function(string,options){if("ALL"===options.ELstyle)return string;if(1===options.ELstyle.length){if(string.charAt(0)===options.ELstyle)return string.substring(1)}else if("${}"===options.ELstyle){var i1=string.indexOf("${"),i2=string.lastIndexOf("}");if(0===i1&&-1!==i2)return string.substring(2,i2)}},fluid.extractELWithContext=function(string,options){var EL=fluid.extractEL(string,options);return EL&&"{"===EL.charAt(0)&&EL.indexOf("}")>0?fluid.parseContextReference(EL):EL?{path:EL}:EL},fluid.parseContextReference=function(reference,index,delimiter){index=index||0;var endcpos=reference.indexOf("}",index+1);-1===endcpos&&fluid.fail('Cannot parse context reference "'+reference+'": Malformed context reference without }');var context=reference.substring(index+1,endcpos),endpos=delimiter?reference.indexOf(delimiter,endcpos+1):reference.length,path=reference.substring(endcpos+1,endpos);return"."===path.charAt(0)&&(path=path.substring(1)),{context:context,path:path,endpos:endpos}},fluid.renderContextReference=function(parsed){return"{"+parsed.context+"}."+parsed.path},fluid.resolveContextValue=function(string,options){function fetch(parsed){fluid.pushActivity("resolveContextValue","resolving context value %string",{string:string});var togo=options.fetcher(parsed);return fluid.pushActivity("resolvedContextValue","resolved value %string to value %value",{string:string,value:togo}),fluid.popActivity(2),togo}if(options.bareContextRefs&&"{"===string.charAt(0)&&string.indexOf("}")>0){var parsed=fluid.parseContextReference(string);return fetch(parsed)}if(options.ELstyle&&"${}"!==options.ELstyle){var parsed=fluid.extractELWithContext(string,options);if(parsed)return fetch(parsed)}for(;"string"==typeof string;){var i1=string.indexOf("${"),i2=string.indexOf("}",i1+2);if(-1===i1||-1===i2)break;var parsed;"{"===string.charAt(i1+2)?(parsed=fluid.parseContextReference(string,i1+2,"}"),i2=parsed.endpos):parsed={path:string.substring(i1+2,i2)};var subs=fetch(parsed),all=0===i1&&i2===string.length-1;if(void 0===subs||null===subs)return subs;string=all?subs:string.substring(0,i1)+subs+string.substring(i2+1)}return string},fluid.expandExpander=function(target,source,options){var expander=fluid.getGlobalValue(source.expander.type||"fluid.deferredInvokeCall");return expander?expander.call(null,target,source,options):void 0},fluid.fetchExpandChildren=function(target,i,segs,source,mergePolicy,miniWorld,options){if(source.expander){var expanded=fluid.expandExpander(target,source,options);if(options.freeRoot||fluid.isPrimitive(expanded)||fluid.isDOMish(expanded)||!fluid.isPlainObject(expanded)||fluid.isArrayable(expanded)^fluid.isArrayable(target))return expanded;$.extend(!0,target,expanded)}return fluid.each(source,function(newSource,key){void 0===newSource?target[key]=void 0:"expander"!==key&&(segs[i]=key,options.strategy(target,key,i+1,segs,source,mergePolicy,miniWorld))}),target},fluid.isUnexpandable=function(source){return fluid.isPrimitive(source)||fluid.isComponent(source)||void 0!==source.nodeType||source.jquery||!fluid.isPlainObject(source)},fluid.expandSource=function(options,target,i,segs,deliverer,source,policy,miniWorld,recurse){var expanded,isTrunk,isLate,thisPolicy=fluid.derefMergePolicy(policy);return"string"!=typeof source||thisPolicy.noexpand?thisPolicy.noexpand||fluid.isUnexpandable(source)?expanded=source:source.expander?expanded=fluid.expandExpander(deliverer,source,options):(thisPolicy.preserve?(expanded=source,isLate=!0):expanded=fluid.freshContainer(source),isTrunk=!0):options.defaultEL&&"{"!==source.charAt(0)?expanded=source:(fluid.pushActivity("expandContextValue","expanding context value %source held at path %path",{source:source,path:fluid.path.apply(null,segs.slice(0,i))}),expanded=fluid.resolveContextValue(source,options),fluid.popActivity(1)),isLate||expanded===fluid.NO_VALUE||deliverer(expanded),isTrunk&&recurse(expanded,source,i,segs,policy,miniWorld||isLate),isLate&&expanded!==fluid.NO_VALUE&&deliverer(expanded),expanded},fluid.makeExpandStrategy=function(options){var recurse=function(target,source,i,segs,policy,miniWorld){return fluid.fetchExpandChildren(target,i||0,segs||[],source,policy,miniWorld,options)},strategy=function(target,name,i,segs,source,policy,miniWorld){function deliverer(value){target[name]=value}if(i>fluid.strategyRecursionBailout&&fluid.fail("Overflow/circularity in options expansion, current path is ",segs," at depth ",i,' - please ensure options are not circularly connected, or protect from expansion using the "noexpand" policy or expander'),target){if(!miniWorld&&target.hasOwnProperty(name))return target[name];void 0===source&&(source=regenerateCursor(options.source,segs,i-1,options.sourceStrategy),policy=regenerateCursor(options.mergePolicy,segs,i-1,fluid.concreteTrundler));var thisSource=options.sourceStrategy(source,name,i,segs),thisPolicy=fluid.concreteTrundler(policy,name);return fluid.expandSource(options,target,i,segs,deliverer,thisSource,thisPolicy,miniWorld,recurse)}};return options.recurse=recurse,options.strategy=strategy,strategy},fluid.defaults("fluid.makeExpandOptions",{ELstyle:"${}",bareContextRefs:!0,target:fluid.inCreationMarker}),fluid.makeExpandOptions=function(source,options){return options=$.extend({},fluid.rawDefaults("fluid.makeExpandOptions"),options),options.defaultEL="${}"===options.ELStyle&&options.bareContextRefs,options.expandSource=function(source){return fluid.expandSource(options,null,0,[],fluid.identity,source,options.mergePolicy,!1)},fluid.isUnexpandable(source)?(options.strategy=fluid.concreteTrundler,options.initter=fluid.identity,options.target="string"==typeof source?options.expandSource(source):source):(options.source=source,options.target=fluid.freshContainer(source),options.sourceStrategy=options.sourceStrategy||fluid.concreteTrundler,fluid.makeExpandStrategy(options),options.initter=function(){options.target=fluid.fetchExpandChildren(options.target,0,[],options.source,options.mergePolicy,!1,options)}),options},fluid.expand=function(source,options){var expandOptions=fluid.makeExpandOptions(source,options);return expandOptions.initter(),expandOptions.target},fluid.registerNamespace("fluid.expander"),fluid.expander.deferredCall=function(deliverer,source,options){var expander=source.expander,args=!expander.args||fluid.isArrayable(expander.args)?expander.args:fluid.makeArray(expander.args);return args=options.recurse([],args),fluid.invokeGlobalFunction(expander.func,args)},fluid.deferredCall=fluid.expander.deferredCall,fluid.deferredInvokeCall=function(deliverer,source,options){var expander=source.expander,args=fluid.makeArray(expander.args);args=options.recurse([],args);var funcEntry=expander.func||expander.funcName,func=options.expandSource(funcEntry)||fluid.recordToApplicable(expander,options.contextThat);return func||fluid.fail("Error in expander record - "+funcEntry+" could not be resolved to a function for component ",options.contextThat),func.apply?func.apply(null,args):fluid.invoke(func,args,options.contextThat)},fluid.expander.noexpand=function(deliverer,source){return source.expander.value?source.expander.value:source.expander.tree},fluid.noexpand=fluid.expander.noexpand}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){function lastDotIndex(path){return path.lastIndexOf(".")}function sourceWrapModelChanged(modelChanged,threadLocal){return function(changeRequest){var sources=threadLocal().sources,args=arguments,source=changeRequest.source||"";fluid.tryCatch(function(){void 0===sources[source]&&(sources[source]=0),++sources[source],modelChanged.apply(null,args)},null,function(){--sources[source]})}}fluid.model.makeEnvironmentStrategy=function(environment){return function(root,segment,index){return 0===index&&environment[segment]?environment[segment]:void 0}},fluid.model.defaultCreatorStrategy=function(root,segment){return void 0===root[segment]?(root[segment]={},root[segment]):void 0},fluid.model.defaultFetchStrategy=function(root,segment){return root[segment]},fluid.model.funcResolverStrategy=function(root,segment){return root.resolvePathSegment?root.resolvePathSegment(segment):void 0},fluid.model.traverseWithStrategy=function(root,segs,initPos,config,uncess){for(var strategies=config.strategies,limit=segs.length-uncess,i=initPos;limit>i;++i){if(!root)return root;for(var accepted=void 0,j=0;j<strategies.length&&(accepted=strategies[j](root,segs[i],i+1,segs),void 0===accepted);++j);accepted===fluid.NO_VALUE&&(accepted=void 0),root=accepted}return root},fluid.model.getValueAndSegments=function(root,EL,config,initSegs){return fluid.model.accessWithStrategy(root,EL,fluid.NO_VALUE,config,initSegs,!0)},fluid.model.makeTrundler=function(config){return function(valueSeg,EL){return fluid.model.getValueAndSegments(valueSeg.root,EL,config,valueSeg.segs)}},fluid.model.getWithStrategy=function(root,EL,config,initSegs){return fluid.model.accessWithStrategy(root,EL,fluid.NO_VALUE,config,initSegs)},fluid.model.setWithStrategy=function(root,EL,newValue,config,initSegs){fluid.model.accessWithStrategy(root,EL,newValue,config,initSegs)},fluid.model.accessWithStrategy=function(root,EL,newValue,config,initSegs,returnSegs){if(fluid.isPrimitive(EL)||fluid.isArrayable(EL))return fluid.model.accessImpl(root,EL,newValue,config,initSegs,returnSegs,fluid.model.traverseWithStrategy);var key=EL.type||"default",resolver=config.resolvers[key];resolver||fluid.fail("Unable to find resolver of type "+key);var trundler=fluid.model.makeTrundler(config),valueSeg={root:root,segs:initSegs};return valueSeg=resolver(valueSeg,EL,trundler),EL.path&&valueSeg&&(valueSeg=trundler(valueSeg,EL.path)),returnSegs?valueSeg:valueSeg?valueSeg.root:void 0},fluid.registerNamespace("fluid.pathUtil");var getPathSegmentImpl=function(accept,path,i){var segment=null;accept&&(segment="");for(var escaped=!1,limit=path.length;limit>i;++i){var c=path.charAt(i);if(escaped)escaped=!1,null!==segment&&(segment+=c);else{if("."===c)break;"\\"===c?escaped=!0:null!==segment&&(segment+=c)}}return null!==segment&&(accept[0]=segment),i},globalAccept=[];fluid.pathUtil.parseEL=function(path){for(var togo=[],index=0,limit=path.length;limit>index;){var firstdot=getPathSegmentImpl(globalAccept,path,index);togo.push(globalAccept[0]),index=firstdot+1}return togo},fluid.pathUtil.composeSegment=function(prefix,toappend){toappend=toappend.toString();for(var i=0;i<toappend.length;++i){var c=toappend.charAt(i);("."===c||"\\"===c||"}"===c)&&(prefix+="\\"),prefix+=c}return prefix},fluid.pathUtil.escapeSegment=function(segment){return fluid.pathUtil.composeSegment("",segment)},fluid.pathUtil.composePath=function(prefix,suffix){return 0!==prefix.length&&(prefix+="."),fluid.pathUtil.composeSegment(prefix,suffix)},fluid.pathUtil.composeSegments=function(){for(var path="",i=0;i<arguments.length;++i)path=fluid.pathUtil.composePath(path,arguments[i]);return path},fluid.model.unescapedParser={parse:fluid.model.parseEL,compose:fluid.model.composeSegments},fluid.model.defaultGetConfig={parser:fluid.model.unescapedParser,strategies:[fluid.model.funcResolverStrategy,fluid.model.defaultFetchStrategy]},fluid.model.defaultSetConfig={parser:fluid.model.unescapedParser,strategies:[fluid.model.funcResolverStrategy,fluid.model.defaultFetchStrategy,fluid.model.defaultCreatorStrategy]},fluid.model.escapedParser={parse:fluid.pathUtil.parseEL,compose:fluid.pathUtil.composeSegments},fluid.model.escapedGetConfig={parser:fluid.model.escapedParser,strategies:[fluid.model.defaultFetchStrategy]},fluid.model.escapedSetConfig={parser:fluid.model.escapedParser,strategies:[fluid.model.defaultFetchStrategy,fluid.model.defaultCreatorStrategy]},fluid.initSimpleModel=function(that,optionsModel){return that.model=optionsModel||{}},fluid.initRelayModel=function(that,modelRelayModel){return modelRelayModel},fluid.isModelComplete=function(that){return that.model!==fluid.inEvaluationMarker},fluid.enlistModelComponent=function(that){var instantiator=fluid.getInstantiator(that),enlist=(that.applier||fluid.getForComponent(that,"applier"),instantiator.modelTransactions.init[that.id]);return enlist||(enlist={that:that,complete:fluid.isModelComplete(that)},instantiator.modelTransactions.init[that.id]=enlist),enlist},fluid.clearLinkCounts=function(transRec,relaysAlso){fluid.each(transRec,function(value,key){"number"==typeof value?transRec[key]=0:relaysAlso&&value.options&&"number"==typeof value.options.relayCount&&(value.options.relayCount=0)})},fluid.operateInitialTransaction=function(instantiator,mrec){var transac,transId=fluid.allocateGuid(),transRec=fluid.getModelTransactionRec(instantiator,transId),transacs=fluid.transform(mrec,function(recel){return transac=recel.that.applier.initiate(transId),transRec[recel.that.applier.applierId]={transaction:transac},transac});fluid.each(mrec,function(recel){var that=recel.that,transac=transacs[that.id];recel.completeOnInit?fluid.initModelEvent(transac,that.applier.changeListeners.listeners):fluid.each(recel.initModels,function(initModel){transac.fireChangeRequest({type:"ADD",segs:[],value:initModel}),fluid.clearLinkCounts(transRec,!0)});var shadow=fluid.shadowForComponent(that);shadow.modelComplete=!0}),transac.commit()},fluid.deenlistModelComponent=function(that){var instantiator=fluid.getInstantiator(that),mrec=instantiator.modelTransactions.init;that.model=void 0,mrec[that.id].complete=!0;var incomplete=fluid.find_if(mrec,function(recel){return recel.complete!==!0});incomplete||(fluid.operateInitialTransaction(instantiator,mrec),instantiator.modelTransactions.init={})},fluid.model.commitRelays=function(instantiator,transactionId){var transRec=instantiator.modelTransactions[transactionId];fluid.each(transRec,function(trans){trans.transaction&&(trans.transaction.commit("relay"),trans.transaction.reset())}),fluid.clearLinkCounts(transRec,!0),delete instantiator.modelTransactions[transactionId]},fluid.model.updateRelays=function(instantiator,transactionId){var transRec=instantiator.modelTransactions[transactionId],updates=0;return fluid.each(transRec,function(transEl){transEl.options&&transEl.transaction&&transEl.transaction.changeRecord.changes>0&&transEl.options.relayCount<2&&transEl.options.update&&(transEl.options.relayCount++,fluid.clearLinkCounts(transRec),transEl.options.update(transEl.transaction,transRec),++updates)}),updates},fluid.transformToAdapter=function(transform,targetPath){var basedTransform={};return basedTransform[targetPath]=transform,function(trans,newValue){fluid.model.transformWithRules(newValue,basedTransform,{finalApplier:trans})}},fluid.parseModelReference=function(that,ref){var parsed=fluid.parseContextReference(ref);return parsed.segs=that.applier.parseEL(parsed.path),parsed},fluid.parseValidModelReference=function(that,name,ref){var parsed,target,reject=function(message){fluid.fail("Error in "+name+": "+ref+message)};return"{"===ref.charAt(0)?(parsed=fluid.parseModelReference(that,ref),"model"!==parsed.segs[0]?reject(' must be a reference into a component model beginning with "model"'):(parsed.modelSegs=parsed.segs.slice(1),delete parsed.path),target=fluid.resolveContext(parsed.context,that),target||reject(" must be a reference to an existing component")):(target=that,parsed={path:ref,modelSegs:that.applier.parseEL(ref)}),target.applier||fluid.getForComponent(target,["applier"]),target.applier||reject(" must be a reference to a component with a ChangeApplier (descended from fluid.modelComponent)"),parsed.that=target,parsed.applier=target.applier,parsed.path||(parsed.path=target.applier.composeSegments.apply(null,parsed.modelSegs)),parsed},fluid.getModelTransactionRec=function(instantiator,transId){var transRec=instantiator.modelTransactions[transId];return transRec||(transRec=instantiator.modelTransactions[transId]={}),transRec},fluid.recordChangeListener=function(component,applier,sourceListener){var shadow=fluid.shadowForComponent(component);fluid.recordListener(applier.modelChanged,sourceListener,shadow)},fluid.registerDirectChangeRelay=function(target,targetSegs,source,sourceSegs,linkId,transducer,options){var instantiator=fluid.getInstantiator(target),targetApplier=options.targetApplier||target.applier,sourceApplier=options.sourceApplier||source.applier,applierId=targetApplier.applierId;targetSegs=fluid.makeArray(targetSegs),sourceSegs=sourceSegs?fluid.makeArray(sourceSegs):sourceSegs;var sourceListener=function(newValue,oldValue,path,changeRequest,trans,applier){var transId=changeRequest.transactionId,transRec=fluid.getModelTransactionRec(instantiator,transId);applier&&trans&&(transRec[applier.applierId]={transaction:trans});var existing=transRec[applierId];transRec[linkId]=transRec[linkId]||0;var relay=transRec[linkId]<2;if(relay){if(++transRec[linkId],!existing){var newTrans=targetApplier.initiate(transId);existing=transRec[applierId]={transaction:newTrans,options:options}}transducer&&!options.targetApplier?transducer(existing.transaction,options.sourceApplier?null:newValue,sourceSegs,targetSegs):void 0!==newValue&&existing.transaction.fireChangeRequest({type:"ADD",segs:targetSegs,value:newValue})}};sourceSegs&&sourceApplier.modelChanged.addListener({segs:sourceSegs,transactional:options.transactional},sourceListener),source&&(fluid.recordChangeListener(source,sourceApplier,sourceListener),target!==source&&fluid.recordChangeListener(target,sourceApplier,sourceListener))},fluid.connectModelRelay=function(source,sourceSegs,target,targetSegs,options){function enlistComponent(component){var enlist=fluid.enlistModelComponent(component);if(enlist.complete){var shadow=fluid.shadowForComponent(component);shadow.modelComplete&&(enlist.completeOnInit=!0)}}var linkId=fluid.allocateGuid();enlistComponent(target),enlistComponent(source),options.update?options.targetApplier?fluid.registerDirectChangeRelay(source,sourceSegs,target,targetSegs,linkId,null,{targetApplier:options.targetApplier,relayCount:options.relayCount,update:options.update}):fluid.registerDirectChangeRelay(target,targetSegs,source,[],linkId+"-transform",options.forwardAdapter,{transactional:!0,sourceApplier:options.forwardApplier}):(fluid.registerDirectChangeRelay(target,targetSegs,source,sourceSegs,linkId,options.forwardAdapter,{}),sourceSegs&&fluid.registerDirectChangeRelay(source,sourceSegs,target,targetSegs,linkId,options.backwardAdapter,{}))},fluid.makeTransformPackage=function(componentThat,transform,sourcePath,targetPath){var that={forwardHolder:{model:transform},backwardHolder:{model:null}};that.generateAdapters=function(trans){that.forwardAdapterImpl=fluid.transformToAdapter(trans?trans.newHolder.model:that.forwardHolder.model,targetPath),null!==sourcePath&&(that.backwardHolder.model=fluid.model.transform.invertConfiguration(transform),that.backwardAdapterImpl=fluid.transformToAdapter(that.backwardHolder.model,sourcePath))},that.forwardAdapter=function(){that.forwardAdapterImpl.apply(null,arguments)},that.runTransform=function(trans){trans.commit(),trans.reset()},that.forwardApplier=fluid.makeNewChangeApplier(that.forwardHolder),that.forwardApplier.isRelayApplier=!0,that.invalidator=fluid.makeEventFirer(null,null,"Invalidator for model relay with applier "+that.forwardApplier.applierId),null!==sourcePath&&(that.backwardApplier=fluid.makeNewChangeApplier(that.backwardHolder),that.backwardAdapter=function(){that.backwardAdapterImpl.apply(null,arguments)}),that.update=that.invalidator.fire;var implicitOptions={relayCount:0,targetApplier:that.forwardApplier,update:that.update,refCount:0};return that.forwardHolder.model=fluid.parseImplicitRelay(componentThat,transform,[],implicitOptions),that.refCount=implicitOptions.refCount,that.generateAdapters(),that.invalidator.addListener(that.generateAdapters),that.invalidator.addListener(that.runTransform),that},fluid.singleTransformToFull=function(singleTransform){var withPath=$.extend(!0,{valuePath:""},singleTransform);return{"":{transform:withPath}}},fluid.parseModelRelay=function(that,mrrec){var parsedSource=mrrec.source?fluid.parseValidModelReference(that,'modelRelay record member "source"',mrrec.source):{path:null,modelSegs:null},parsedTarget=fluid.parseValidModelReference(that,'modelRelay record member "target"',mrrec.target),transform=mrrec.singleTransform?fluid.singleTransformToFull(mrrec.singleTransform):mrrec.transform,transformPackage=fluid.makeTransformPackage(that,transform,parsedSource.path,parsedTarget.path);0===transformPackage.refCount?fluid.connectModelRelay(parsedSource.that||that,parsedSource.modelSegs,parsedTarget.that,parsedTarget.modelSegs,{forwardAdapter:transformPackage.forwardAdapter,backwardAdapter:transformPackage.backwardAdapter}):fluid.connectModelRelay(parsedSource.that||that,parsedSource.modelSegs,parsedTarget.that,parsedTarget.modelSegs,transformPackage)},fluid.parseImplicitRelay=function(that,modelRec,segs,options){var value;if("string"==typeof modelRec&&"{"===modelRec.charAt(0)){var parsed=fluid.parseModelReference(that,modelRec),target=fluid.resolveContext(parsed.context,that);if("model"===parsed.segs[0]){var modelSegs=parsed.segs.slice(1);++options.refCount,fluid.connectModelRelay(that,segs,target,modelSegs,options)}else value=fluid.getForComponent(target,parsed.segs)}else fluid.isPrimitive(modelRec)||!fluid.isPlainObject(modelRec)?value=modelRec:modelRec.expander&&fluid.isPlainObject(modelRec.expander)?value=fluid.expandOptions(modelRec,that):(value=fluid.freshContainer(modelRec),fluid.each(modelRec,function(innerValue,key){segs.push(key);var innerTrans=fluid.parseImplicitRelay(that,innerValue,segs,options);void 0!==innerTrans&&(value[key]=innerTrans),segs.pop()}));return value},fluid.establishModelRelay=function(that,optionsModel,optionsML,optionsMR,applier){function updateRelays(transaction){do;while(fluid.model.updateRelays(instantiator,transaction.id)>0)}function commitRelays(transaction,applier,code){"relay"!==code&&fluid.model.commitRelays(instantiator,transaction.id)}fluid.mergeModelListeners(that,optionsML);var enlist=fluid.enlistModelComponent(that);fluid.each(optionsMR,function(mrrec){fluid.parseModelRelay(that,mrrec)});var initModels=fluid.transform(optionsModel,function(modelRec){return fluid.parseImplicitRelay(that,modelRec,[],{refCount:0})});enlist.initModels=initModels;var instantiator=fluid.getInstantiator(that);return applier.preCommit.addListener(updateRelays),applier.preCommit.addListener(commitRelays),fluid.deenlistModelComponent(that),applier.holder.model},fluid.defaults("fluid.commonModelComponent",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{modelListeners:fluid.makeMergeListenersPolicy(fluid.arrayConcatPolicy)}}),fluid.defaults("fluid.modelComponent",{gradeNames:["fluid.commonModelComponent","autoInit"],members:{model:"@expand:fluid.initSimpleModel({that}, {that}.options.model)",applier:"@expand:fluid.makeChangeApplier({that}.model, {that}.options.changeApplierOptions)",modelListeners:"@expand:fluid.mergeModelListeners({that}, {that}.options.modelListeners)"},mergePolicy:{model:"preserve"}}),fluid.defaults("fluid.modelRelayComponent",{gradeNames:["fluid.commonModelComponent","fluid.eventedComponent","autoInit"],changeApplierOptions:{relayStyle:!0,cullUnchanged:!0},members:{model:"@expand:fluid.initRelayModel({that}, {that}.modelRelay)",applier:"@expand:fluid.makeNewChangeApplier({that}, {that}.options.changeApplierOptions)",modelRelay:"@expand:fluid.establishModelRelay({that}, {that}.options.model, {that}.options.modelListeners, {that}.options.modelRelay, {that}.applier)"},mergePolicy:{model:{noexpand:!0,func:fluid.arrayConcatPolicy},modelRelay:{noexpand:!0,func:fluid.arrayConcatPolicy}}}),fluid.defaults("fluid.standardComponent",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"]}),fluid.defaults("fluid.standardRelayComponent",{gradeNames:["fluid.modelRelayComponent","autoInit"]}),fluid.modelChangedToChange=function(isNewApplier,args){var newModel=args[0],oldModel=args[1],path=args[3];return isNewApplier?{value:args[0],oldValue:args[1],path:args[2]}:{value:fluid.get(newModel,path),oldValue:fluid.get(oldModel,path),path:path}},fluid.resolveModelListener=function(that,record,isNewApplier){var togo=function(){var change=fluid.modelChangedToChange(isNewApplier,arguments),args=[change],localRecord={change:change,arguments:args};record.args&&(args=fluid.expandOptions(record.args,that,{},localRecord)),fluid.event.invokeListener(record.listener,fluid.makeArray(args))};return fluid.event.impersonateListener(record.listener,togo),togo},fluid.mergeModelListeners=function(that,listeners){fluid.each(listeners,function(value,path){"string"==typeof value&&(value={funcName:value});var records=fluid.event.resolveListenerRecord(value,that,"modelListeners",null,!1),parsed=fluid.parseValidModelReference(that,"modelListeners entry",path),isNewApplier=parsed.applier.preCommit;fluid.each(records.records,function(record){function initModelEvent(){if(isNewApplier&&fluid.isModelComplete(parsed.that)){var trans=parsed.applier.initiate();fluid.initModelEvent(trans,[spec]),trans.commit()}}var func=fluid.resolveModelListener(that,record,isNewApplier),spec={listener:func,segs:parsed.modelSegs,path:parsed.path,transactional:!0};fluid.addSourceGuardedListener(parsed.applier,spec,record.guardSource,func,"modelChanged",record.namespace,record.softNamespace),fluid.recordChangeListener(that,parsed.applier,func),that===parsed.that||fluid.isModelComplete(that)||that.events.onCreate.addListener(initModelEvent)})})},fluid.addSourceGuardedListener=function(applier,path,source,func,eventName,namespace,softNamespace){eventName=eventName||"modelChanged";var wrapped=function(newValue,oldValue,path,changes){return applier.hasChangeSource(source,changes)?void 0:func.apply(null,arguments)};fluid.event.impersonateListener(func,wrapped),applier[eventName].addListener(path,wrapped,namespace,softNamespace)},fluid.fireSourcedChange=function(applier,path,value,source){applier.fireChangeRequest({path:path,value:value,source:source})},fluid.requestChanges=function(applier,changes){for(var i=0;i<changes.length;++i)applier.fireChangeRequest(changes[i])},fluid.bindRequestChange=function(that){that.requestChange=that.change=function(path,value,type){var changeRequest={path:path,value:value,type:type};that.fireChangeRequest(changeRequest)}},fluid.identifyChangeListener=function(listener){return fluid.event.identifyListener(listener)||listener},fluid.typeCode=function(totest){return fluid.isPrimitive(totest)||!fluid.isPlainObject(totest)?"primitive":fluid.isArrayable(totest)?"array":"object"},fluid.model.isChangedPath=function(changeMap,segs){for(var i=0;i<=segs.length;++i){if("string"==typeof changeMap)return!0;i<segs.length&&changeMap&&(changeMap=changeMap[segs[i]])}return!1},fluid.model.setChangedPath=function(options,segs,value){var notePath=function(record){segs.unshift(record),fluid.model.setSimple(options,segs,value),segs.shift()};fluid.model.isChangedPath(options.changeMap,segs)||(++options.changes,notePath("changeMap")),notePath("deltaMap")},fluid.model.fetchChangeChildren=function(target,i,segs,source,options){fluid.each(source,function(value,key){segs[i]=key,fluid.model.applyChangeStrategy(target,key,i,segs,value,options),segs.length=i})},fluid.model.isSameValue=function(a,b){if("number"!=typeof a||"number"!=typeof b)return a===b;if(a===b)return!0;var relError=Math.abs((a-b)/b);return 1e-12>relError},fluid.model.applyChangeStrategy=function(target,name,i,segs,source,options){var targetSlot=target[name],sourceCode=fluid.typeCode(source),targetCode=fluid.typeCode(targetSlot),changedValue=fluid.NO_VALUE;"primitive"===sourceCode?fluid.model.isSameValue(targetSlot,source)||(changedValue=source):targetCode!==sourceCode&&(changedValue=fluid.freshContainer(source)),changedValue!==fluid.NO_VALUE&&(target[name]=changedValue,options.changeMap&&fluid.model.setChangedPath(options,segs,"ADD")),"primitive"!==sourceCode&&fluid.model.fetchChangeChildren(target[name],i+1,segs,source,options)},fluid.model.stepTargetAccess=function(target,type,segs,startpos,endpos,options){for(var i=startpos;endpos>i;++i){var oldTrunk=target[segs[i]];target=fluid.model.traverseWithStrategy(target,segs,i,options["ADD"===type?"resolverSetConfig":"resolverGetConfig"],segs.length-i-1),oldTrunk!==target&&options.changeMap&&fluid.model.setChangedPath(options,segs.slice(0,i+1),"ADD")}return{root:target,last:segs[endpos]}},fluid.model.defaultAccessorConfig=function(options){return options=options||{},options.resolverSetConfig=options.resolverSetConfig||fluid.model.defaultSetConfig,options.resolverGetConfig=options.resolverGetConfig||fluid.model.defaultGetConfig,options},fluid.model.applyHolderChangeRequest=function(holder,request,options){options=fluid.model.defaultAccessorConfig(options),options.deltaMap=options.changeMap?{}:null;var pen,length=request.segs.length,atRoot=0===length;if(atRoot?pen={root:holder,last:"model"}:(holder.model||(holder.model={},fluid.model.setChangedPath(options,[],"ADD")),pen=fluid.model.stepTargetAccess(holder.model,request.type,request.segs,0,length-1,options)),"ADD"===request.type){var value=request.value,segs=fluid.makeArray(request.segs);fluid.model.applyChangeStrategy(pen.root,pen.last,length-1,segs,value,options,atRoot)}else"DELETE"===request.type?pen.root&&void 0!==pen.root[pen.last]&&(delete pen.root[pen.last],options.changeMap&&fluid.model.setChangedPath(options,request.segs,"DELETE")):fluid.fail("Unrecognised change type of "+request.type);return options.deltaMap},fluid.matchChanges=function(changeMap,specSegs,newHolder){for(var root=newHolder.model,map=changeMap,outSegs=["model"],wildcard=!1,togo=[],i=0;i<specSegs.length;++i){var seg=specSegs[i];"*"===seg?i===specSegs.length-1?wildcard=!0:fluid.fail("Wildcard specification in modelChanged listener is only supported for the final path segment: "+specSegs.join(".")):(outSegs.push(seg),map=fluid.isPrimitive(map)?map:map[seg],root=root?root[seg]:void 0)}return map&&(wildcard?fluid.each(root,function(value,key){togo.push(outSegs.concat(key))}):togo.push(outSegs)),togo},fluid.notifyModelChanges=function(listeners,changeMap,newHolder,oldHolder,changeRequest,transaction,applier){for(var i=0;i<listeners.length;++i)for(var spec=listeners[i],invalidPaths=fluid.matchChanges(changeMap,spec.segs,newHolder),j=0;j<invalidPaths.length;++j){var invalidPath=invalidPaths[j];spec.listener=fluid.event.resolveListener(spec.listener),spec.listener(fluid.model.getSimple(newHolder,invalidPath),fluid.model.getSimple(oldHolder,invalidPath),invalidPath.slice(1),changeRequest,transaction,applier)}},fluid.bindELMethods=function(applier){applier.parseEL=function(EL){return fluid.model.pathToSegments(EL,applier.options.resolverSetConfig)},applier.composeSegments=function(){return applier.options.resolverSetConfig.parser.compose.apply(null,arguments)}},fluid.initModelEvent=function(trans,listeners){fluid.notifyModelChanges(listeners,"ADD",trans.newHolder,fluid.emptyHolder,{transactionId:trans.id})},fluid.emptyHolder={model:void 0},fluid.makeNewChangeApplier=function(holder,options){function preFireChangeRequest(changeRequest){changeRequest.type||(changeRequest.type="ADD"),changeRequest.segs=changeRequest.segs||that.parseEL(changeRequest.path)}options=fluid.model.defaultAccessorConfig(options);var applierId=fluid.allocateGuid(),that={applierId:applierId,holder:holder,changeListeners:{listeners:[],transListeners:[]},options:options,modelChanged:{},preCommit:fluid.makeEventFirer(null,null,"preCommit event for ChangeApplier "+applierId)};return that.modelChanged.addListener=function(spec,listener,namespace,softNamespace){spec="string"==typeof spec?{path:spec}:fluid.copy(spec),spec.id=fluid.event.identifyListener(listener),spec.namespace=namespace,spec.softNamespace=softNamespace,"string"==typeof listener&&(listener={globalName:listener}),spec.listener=listener,transactional=spec.transactional,spec.segs=spec.segs||that.parseEL(spec.path);var collection=transactional?"transListeners":"listeners";that.changeListeners[collection].push(spec)},that.modelChanged.removeListener=function(listener){var id=fluid.event.identifyListener(listener),removePred=function(record){return record.id===id};fluid.remove_if(that.changeListeners.listeners,removePred),fluid.remove_if(that.changeListeners.transListeners,removePred)},that.fireChangeRequest=function(changeRequest){var ation=that.initiate();ation.fireChangeRequest(changeRequest),ation.commit()},that.initiate=function(transactionId){var trans={instanceId:fluid.allocateGuid(),id:transactionId||fluid.allocateGuid(),changeRecord:{resolverSetConfig:options.resolverSetConfig,resolverGetConfig:options.resolverGetConfig},reset:function(){trans.newHolder={model:fluid.copy(holder.model)},trans.changeRecord.changes=0,trans.changeRecord.changeMap={}},commit:function(code){if(that.preCommit.fire(trans,that,code),trans.changeRecord.changes>0){var oldHolder={model:holder.model};holder.model=trans.newHolder.model,fluid.notifyModelChanges(that.changeListeners.transListeners,trans.changeRecord.changeMap,holder,oldHolder,{transactionId:trans.id})}},fireChangeRequest:function(changeRequest){preFireChangeRequest(changeRequest),changeRequest.transactionId=trans.id;var deltaMap=fluid.model.applyHolderChangeRequest(trans.newHolder,changeRequest,trans.changeRecord);fluid.notifyModelChanges(that.changeListeners.listeners,deltaMap,trans.newHolder,holder,changeRequest,trans,that)}};return trans.reset(),fluid.bindRequestChange(trans),trans},that.hasChangeSource=function(source,changes){return changes?changes[source]:!1},fluid.bindRequestChange(that),fluid.bindELMethods(that),that},fluid.pathUtil.getPathSegment=function(path,i){return getPathSegmentImpl(globalAccept,path,i),globalAccept[0]},fluid.pathUtil.getHeadPath=function(path){return fluid.pathUtil.getPathSegment(path,0)},fluid.pathUtil.getFromHeadPath=function(path){var firstdot=getPathSegmentImpl(null,path,0);return firstdot===path.length?"":path.substring(firstdot+1)},fluid.pathUtil.getToTailPath=function(path){var lastdot=lastDotIndex(path);return-1===lastdot?"":path.substring(0,lastdot)},fluid.pathUtil.getTailPath=function(path){var lastdot=lastDotIndex(path);return fluid.pathUtil.getPathSegment(path,lastdot+1)},fluid.pathUtil.matchSegments=function(toMatch,segs,start,end){if(end-start!==toMatch.length)return!1;for(var i=start;end>i;++i)if(segs[i]!==toMatch[i-start])return!1;return!0},fluid.pathUtil.getExcessPath=function(base,longer){var index=longer.indexOf(base);return 0!==index&&fluid.fail("Path "+base+" is not a prefix of path "+longer),base.length===longer.length?"":("."!==longer[base.length]&&fluid.fail("Path "+base+" is not properly nested in path "+longer),longer.substring(base.length+1))},fluid.pathUtil.matchPath=function(spec,path,exact){for(var togo=[];;){if(""===path^""===spec&&exact)return null;if(!spec||!path)break;var spechead=fluid.pathUtil.getHeadPath(spec),pathhead=fluid.pathUtil.getHeadPath(path);if("*"!==spechead&&spechead!==pathhead)return null;togo.push(pathhead),spec=fluid.pathUtil.getFromHeadPath(spec),path=fluid.pathUtil.getFromHeadPath(path)}return togo},fluid.model.isNullChange=function(model,request,resolverGetConfig){if("ADD"===request.type&&!request.forceChange){var existing=fluid.get(model,request.segs,resolverGetConfig);if(existing===request.value)return!0}},fluid.model.applyChangeRequest=function(model,request,resolverSetConfig){var pen=fluid.model.accessWithStrategy(model,request.path,fluid.VALUE,resolverSetConfig||fluid.model.defaultSetConfig,null,!0),last=pen.segs[pen.segs.length-1];"ADD"===request.type||"MERGE"===request.type?0===pen.segs.length||"MERGE"===request.type&&pen.root[last]?("ADD"===request.type&&fluid.clear(pen.root),$.extend(!0,0===pen.segs.length?pen.root:pen.root[last],request.value)):pen.root[last]=request.value:"DELETE"===request.type&&(0===pen.segs.length?fluid.clear(pen.root):delete pen.root[last])},fluid.makeChangeApplier=function(model,options){return fluid.makeHolderChangeApplier({model:model},options)},fluid.makeHolderChangeApplier=function(holder,options){function makeGuardWrapper(cullUnchanged){if(!cullUnchanged)return null;var togo=function(guard){return function(model,changeRequest,internalApplier){var oldRet=guard(model,changeRequest,internalApplier);return oldRet===!1?!1:fluid.model.isNullChange(model,changeRequest)?(togo.culled=!0,!1):void 0}};return togo}function wrapListener(listener,spec){var pathSpec=spec,transactional=!1,priority=Number.MAX_VALUE;"string"==typeof spec&&(spec={path:spec}),pathSpec=spec.path,transactional=spec.transactional,void 0!==spec.priority&&(priority=spec.priority),"!"===pathSpec.charAt(0)&&(transactional=!0,pathSpec=pathSpec.substring(1));var wrapped=function(changePath,fireSpec,accum){var guid=fluid.event.identifyListener(listener),exist=fireSpec.guids[guid];if(exist&&accum)accum&&(exist.accumulate||(exist.accumulate=[]),exist.accumulate.push(accum));else{var match=fluid.pathUtil.matchPath(pathSpec,changePath);if(null!==match){var record={match:match,pathSpec:pathSpec,listener:listener,priority:priority,transactional:transactional};accum&&(record.accumulate=[accum]),fireSpec.guids[guid]=record;var collection=transactional?"transListeners":"listeners";fireSpec[collection].push(record),fireSpec.all.push(record)}}};return fluid.event.impersonateListener(listener,wrapped),wrapped}function fireFromSpec(name,fireSpec,args,category,wrapper){return baseEvents[name].fireToListeners(fireSpec[category],args,wrapper)}function fireComparator(recA,recB){return recA.priority-recB.priority}function prepareFireEvent(name,changePath,fireSpec,accum){baseEvents[name].fire(changePath,fireSpec,accum),fireSpec.all.sort(fireComparator),fireSpec.listeners.sort(fireComparator),fireSpec.transListeners.sort(fireComparator)}function makeFireSpec(){return{guids:{},all:[],listeners:[],transListeners:[]}}function getFireSpec(name,changePath){var fireSpec=makeFireSpec();return prepareFireEvent(name,changePath,fireSpec),fireSpec}function fireEvent(name,changePath,args,wrapper){var fireSpec=getFireSpec(name,changePath);return fireFromSpec(name,fireSpec,args,"all",wrapper)}function adaptListener(that,name){that[name]={addListener:function(spec,listener,namespace,softNamespace){baseEvents[name].addListener(wrapListener(listener,spec),namespace,null,null,softNamespace)},removeListener:function(listener){baseEvents[name].removeListener(listener)}}}function preFireChangeRequest(changeRequest){changeRequest.type||(changeRequest.type="ADD"),changeRequest.segs=that.parseEL(changeRequest.path)}function fireAgglomerated(eventName,formName,changes,args,accpos,matchpos){for(var fireSpec=makeFireSpec(),i=0;i<changes.length;++i)prepareFireEvent(eventName,changes[i].path,fireSpec,changes[i]);for(var j=0;j<fireSpec[formName].length;++j){var spec=fireSpec[formName][j];void 0!==accpos&&(args[accpos]=spec.accumulate),void 0!==matchpos&&(args[matchpos]=spec.match);var ret=spec.listener.apply(null,args);if(ret===!1)return!1}}options=fluid.model.defaultAccessorConfig(options);var baseEvents={guards:fluid.event.getEventFirer(!1,!0,"guard event"),postGuards:fluid.event.getEventFirer(!1,!0,"postGuard event"),modelChanged:fluid.event.getEventFirer(!1,!1,"modelChanged event")},threadLocal=fluid.threadLocal(function(){return{sources:{}}}),that={applierId:fluid.allocateGuid(),holder:holder,options:options};
adaptListener(that,"guards"),adaptListener(that,"postGuards"),adaptListener(that,"modelChanged");var bareApplier={fireChangeRequest:function(changeRequest){that.fireChangeRequest(changeRequest,!0)}};return fluid.bindRequestChange(bareApplier),that.fireChangeRequest=function(changeRequest,defeatGuards){preFireChangeRequest(changeRequest);var ation=(defeatGuards?null:getFireSpec("guards",changeRequest.path),getFireSpec("postGuards",changeRequest.path),that.initiate());ation.fireChangeRequest(changeRequest),ation.commit()},that.fireChangeRequest=sourceWrapModelChanged(that.fireChangeRequest,threadLocal),fluid.bindRequestChange(that),fluid.bindELMethods(that),that.initiate=function(newModel){var cancelled=!1,changes=[];options.thin?newModel=holder.model:(newModel=newModel||{},fluid.model.copyModel(newModel,holder.model));var ation={commit:function(){var oldModel;if(cancelled)return!1;var ret=fireAgglomerated("postGuards","transListeners",changes,[newModel,null,ation],1);return ret===!1||cancelled?!1:(options.thin?oldModel=holder.model:(oldModel={},fluid.model.copyModel(oldModel,holder.model),fluid.clear(holder.model),fluid.model.copyModel(holder.model,newModel)),void fireAgglomerated("modelChanged","all",changes,[holder.model,oldModel,null,null],2,3))},fireChangeRequest:function(changeRequest){if(preFireChangeRequest(changeRequest),!options.cullUnchanged||!fluid.model.isNullChange(holder.model,changeRequest,options.resolverGetConfig)){var wrapper=makeGuardWrapper(options.cullUnchanged),prevent=fireEvent("guards",changeRequest.path,[newModel,changeRequest,ation],wrapper);prevent!==!1||wrapper&&wrapper.culled||(cancelled=!0),cancelled||wrapper&&wrapper.culled||(fluid.model.applyChangeRequest(newModel,changeRequest,options.resolverSetConfig),changes.push(changeRequest))}}};return ation.fireChangeRequest=sourceWrapModelChanged(ation.fireChangeRequest,threadLocal),fluid.bindRequestChange(ation),ation},that.hasChangeSource=function(source){return threadLocal().sources[source]>0},that},fluid.makeSuperApplier=function(){var subAppliers=[],that={};return that.addSubApplier=function(path,subApplier){subAppliers.push({path:path,subApplier:subApplier})},that.fireChangeRequest=function(request){for(var i=0;i<subAppliers.length;++i){var path=subAppliers[i].path;if(0===request.path.indexOf(path)){var subpath=request.path.substring(path.length+1),subRequest=fluid.copy(request);subRequest.path=subpath,subAppliers[i].subApplier.fireChangeRequest(subRequest)}}},fluid.bindRequestChange(that),that},fluid.attachModel=function(baseModel,path,model){for(var segs=fluid.model.parseEL(path),i=0;i<segs.length-1;++i){var seg=segs[i],subModel=baseModel[seg];subModel||(baseModel[seg]=subModel={}),baseModel=subModel}baseModel[segs[segs.length-1]]=model},fluid.assembleModel=function(modelSpec){var model={},superApplier=fluid.makeSuperApplier(),togo={model:model,applier:superApplier};for(var path in modelSpec){var rec=modelSpec[path];fluid.attachModel(model,path,rec.model),rec.applier&&superApplier.addSubApplier(path,rec.applier)}return togo}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){"use strict";fluid.registerNamespace("fluid.model.transform"),fluid.defaults("fluid.transformFunction",{gradeNames:"fluid.function"}),fluid.defaults("fluid.standardInputTransformFunction",{gradeNames:"fluid.transformFunction"}),fluid.defaults("fluid.standardOutputTransformFunction",{gradeNames:"fluid.transformFunction"}),fluid.defaults("fluid.multiInputTransformFunction",{gradeNames:"fluid.transformFunction"}),fluid.defaults("fluid.standardTransformFunction",{gradeNames:["fluid.standardInputTransformFunction","fluid.standardOutputTransformFunction"]}),fluid.defaults("fluid.lens",{gradeNames:"fluid.transformFunction",invertConfiguration:null}),fluid.model.transform.pathToRule=function(inputPath){return{transform:{type:"fluid.transforms.value",inputPath:inputPath}}},fluid.model.transform.literalValueToRule=function(value){return{transform:{type:"fluid.transforms.literalValue",value:value}}},fluid.model.composePaths=function(prefix,suffix){return prefix=0===prefix?"0":prefix||"",suffix=0===suffix?"0":suffix||"",prefix?suffix?prefix+"."+suffix:prefix:suffix},fluid.model.transform.accumulateInputPath=function(inputPath,transform,paths){void 0!==inputPath&&paths.push(fluid.model.composePaths(transform.inputPrefix,inputPath))},fluid.model.transform.accumulateStandardInputPath=function(input,transformSpec,transform,paths){fluid.model.transform.getValue(void 0,transformSpec[input],transform),fluid.model.transform.accumulateInputPath(transformSpec[input+"Path"],transform,paths)},fluid.model.transform.accumulateMultiInputPaths=function(inputVariables,transformSpec,transform,paths){fluid.each(inputVariables,function(v,k){fluid.model.transform.accumulateStandardInputPath(k,transformSpec,transform,paths)})},fluid.model.transform.getValue=function(inputPath,value,transform){var togo;return void 0!==inputPath&&(togo=fluid.get(transform.source,fluid.model.composePaths(transform.inputPrefix,inputPath),transform.resolverGetConfig)),void 0===togo&&(togo=fluid.isPrimitive(value)?value:transform.expand(value)),togo},fluid.model.transform.NONDEFAULT_OUTPUT_PATH_RETURN={},fluid.model.transform.setValue=function(userOutputPath,value,transform,merge){var toset=fluid.copy(value),outputPath=fluid.model.composePaths(transform.outputPrefix,userOutputPath);return void 0!==toset&&transform.applier.requestChange(outputPath,toset,merge?"MERGE":void 0),userOutputPath?fluid.model.transform.NONDEFAULT_OUTPUT_PATH_RETURN:toset},fluid.model.transform.resolveParam=function(transformSpec,transform,key,def){var val=fluid.model.transform.getValue(transformSpec[key+"Path"],transformSpec[key],transform);return void 0!==val?val:def},fluid.deepEquals=function(expected,actual,stats){fluid.isPrimitive(expected)?expected===actual?++stats.matchCount:(++stats.mismatchCount,stats.messages.push("Value mismatch at path "+stats.path+": expected "+expected+" actual "+actual)):typeof expected!=typeof actual?(++stats.mismatchCount,stats.messages.push("Type mismatch at path "+stats.path+": expected "+typeof expected+" actual "+typeof actual)):fluid.each(expected,function(value,key){stats.pathOps.push(key),fluid.deepEquals(expected[key],actual[key],stats),stats.pathOps.pop(key)})},fluid.model.transform.matchValue=function(expected,actual){if(fluid.isPrimitive(expected))return expected===actual?1:0;var stats={matchCount:0,mismatchCount:0,messages:[]};return fluid.model.makePathStack(stats,"path"),fluid.deepEquals(expected,actual,stats),stats.matchCount},fluid.model.transform.compareMatches=function(speca,specb){return specb.matchCount-speca.matchCount},fluid.firstDefined=function(a,b){return void 0===a?b:a},fluid.model.transform.prefixApplier=function(transformSpec,transform){transformSpec.inputPrefix&&transform.inputPrefixOp.push(transformSpec.inputPrefix),transformSpec.outputPrefix&&transform.outputPrefixOp.push(transformSpec.outputPrefix),transform.expand(transformSpec.value),transformSpec.inputPrefix&&transform.inputPrefixOp.pop(),transformSpec.outputPrefix&&transform.outputPrefixOp.pop()},fluid.defaults("fluid.model.transform.prefixApplier",{gradeNames:["fluid.transformFunction"]}),fluid.model.makePathStack=function(transform,prefixName){var stack=transform[prefixName+"Stack"]=[];return transform[prefixName]="",{push:function(prefix){var newPath=fluid.model.composePaths(transform[prefixName],prefix);stack.push(transform[prefixName]),transform[prefixName]=newPath},pop:function(){transform[prefixName]=stack.pop()}}},fluid.model.transform.doTransform=function(transformSpec,transform,transformOpts){var expdef=transformOpts.defaults,transformFn=fluid.getGlobalValue(transformOpts.typeName);"function"!=typeof transformFn&&fluid.fail("Transformation record specifies transformation function with name "+transformSpec.type+" which is not a function - ",transformFn),fluid.hasGrade(expdef,"fluid.transformFunction")||(expdef=fluid.defaults("fluid.standardTransformFunction"));var transformArgs=[transformSpec,transform];if(fluid.hasGrade(expdef,"fluid.standardInputTransformFunction")){void 0!==transformSpec.input&&(transformSpec.value=transformSpec.input);var expanded=fluid.model.transform.getValue(transformSpec.inputPath,transformSpec.value,transform);if(transformArgs.unshift(expanded),void 0===expanded)return void 0}else if(fluid.hasGrade(expdef,"fluid.multiInputTransformFunction")){var inputs={};fluid.each(expdef.inputVariables,function(v,k){var input=fluid.model.transform.getValue(transformSpec[k+"Path"],transformSpec[k],transform);inputs[k]=void 0===input&&null!==v?v:input}),transformArgs.unshift(inputs)}var transformed=transformFn.apply(null,transformArgs);if(fluid.hasGrade(expdef,"fluid.standardOutputTransformFunction")){var outputPath=void 0!==transformSpec.outputPath?transformSpec.outputPath:transformOpts.doOutput?"":void 0;void 0!==outputPath&&void 0!==transformed&&(fluid.model.transform.setValue(transformSpec.outputPath,transformed,transform,transformSpec.merge),transformed=void 0)}return transformed},fluid.model.transform.expandWildcards=function(transform,source){fluid.each(source,function(value,key){var q=transform.queuedTransforms;transform.pathOp.push(fluid.pathUtil.escapeSegment(key.toString()));for(var i=0;i<q.length;++i)if(fluid.pathUtil.matchPath(q[i].matchPath,transform.path,!0)){var esCopy=fluid.copy(q[i].transformSpec);(void 0===esCopy.inputPath||fluid.model.transform.hasWildcard(esCopy.inputPath))&&(esCopy.inputPath=""),transform.inputPrefixOp.push(transform.path),transform.outputPrefixOp.push(transform.path);var transformOpts=fluid.model.transform.lookupType(esCopy.type),result=fluid.model.transform.doTransform(esCopy,transform,transformOpts);void 0!==result&&fluid.model.transform.setValue(null,result,transform),transform.outputPrefixOp.pop(),transform.inputPrefixOp.pop()}fluid.isPrimitive(value)||fluid.model.transform.expandWildcards(transform,value),transform.pathOp.pop()})},fluid.model.transform.hasWildcard=function(path){return"string"==typeof path&&-1!==path.indexOf("*")},fluid.model.transform.maybePushWildcard=function(transformSpec,transform){var matchPath,hw=fluid.model.transform.hasWildcard;return hw(transformSpec.inputPath)?matchPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.inputPath):(hw(transform.outputPrefix)||hw(transformSpec.outputPath))&&(matchPath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath)),matchPath?(transform.queuedTransforms.push({transformSpec:transformSpec,outputPrefix:transform.outputPrefix,inputPrefix:transform.inputPrefix,matchPath:matchPath}),!0):!1},fluid.model.sortByKeyLength=function(inObject){var keys=fluid.keys(inObject);return keys.sort(fluid.compareStringLength(!0))},fluid.model.transform.handleTransformStrategy=function(transformSpec,transform,transformOpts){return fluid.model.transform.maybePushWildcard(transformSpec,transform)?void 0:fluid.model.transform.doTransform(transformSpec,transform,transformOpts)},fluid.model.transform.handleInvertStrategy=function(transformSpec,transform,transformOpts){var invertor=transformOpts.defaults.invertConfiguration;if(invertor){var inverted=fluid.invokeGlobalFunction(invertor,[transformSpec,transform]);transform.inverted.push(inverted)}},fluid.model.transform.handleCollectStrategy=function(transformSpec,transform,transformOpts){var defaults=transformOpts.defaults,standardInput=fluid.hasGrade(defaults,"fluid.standardInputTransformFunction"),multiInput=fluid.hasGrade(defaults,"fluid.multiInputTransformFunction");if(standardInput)fluid.model.transform.accumulateStandardInputPath("input",transformSpec,transform,transform.inputPaths);else if(multiInput)fluid.model.transform.accumulateMultiInputPaths(defaults.inputVariables,transformSpec,transform,transform.inputPaths);else{var collector=defaults.collectInputPaths;if(collector){var collected=fluid.makeArray(fluid.invokeGlobalFunction(collector,[transformSpec,transform]));transform.inputPaths=transform.inputPaths.concat(collected)}}},fluid.model.transform.lookupType=function(typeName){typeName||fluid.fail("Transformation record is missing a type name: ",transformSpec),-1===typeName.indexOf(".")&&(typeName="fluid.transforms."+typeName);var defaults=fluid.defaults(typeName);return{defaults:defaults,typeName:typeName}},fluid.model.transform.processRule=function(rule,transform){"string"==typeof rule?rule=fluid.model.transform.pathToRule(rule):rule.literalValue&&""!==transform.outputPrefix&&(rule=fluid.model.transform.literalValueToRule(rule.literalValue));var togo;if(rule.transform){var transformSpec,transformOpts;if(fluid.isArrayable(rule.transform)){var transforms=rule.transform;togo=void 0;for(var i=0;i<transforms.length;++i)transformSpec=transforms[i],transformOpts=fluid.model.transform.lookupType(transformSpec.type),transform.transformHandler(transformSpec,transform,transformOpts)}else transformSpec=rule.transform,transformOpts=fluid.model.transform.lookupType(transformSpec.type),togo=transform.transformHandler(transformSpec,transform,transformOpts)}return fluid.isArrayable(rule)&&(transform.collectedFlatSchemaOpts=transform.collectedFlatSchemaOpts||{},transform.collectedFlatSchemaOpts[transform.outputPrefix]="array"),fluid.each(rule,function(value,key){if("transform"!==key){transform.outputPrefixOp.push(key);var togo=transform.expand(value,transform);void 0!==togo&&(fluid.model.transform.setValue(null,togo,transform),togo=void 0),transform.outputPrefixOp.pop()}}),togo},fluid.model.transform.makeStrategy=function(transform,handleFn,transformFn){transformFn=transformFn||fluid.model.transform.processRule,transform.expand=function(rules){return transformFn(rules,transform)},transform.outputPrefixOp=fluid.model.makePathStack(transform,"outputPrefix"),transform.inputPrefixOp=fluid.model.makePathStack(transform,"inputPrefix"),transform.transformHandler=handleFn},fluid.model.transform.invertConfiguration=function(rules){var transform={inverted:[]};return fluid.model.transform.makeStrategy(transform,fluid.model.transform.handleInvertStrategy),transform.expand(rules),{transform:transform.inverted}},fluid.model.transform.collectInputPaths=function(rules){var transform={inputPaths:[]};return fluid.model.transform.makeStrategy(transform,fluid.model.transform.handleCollectStrategy),transform.expand(rules),transform.inputPaths},fluid.model.transform.flatSchemaStrategy=function(flatSchema,getConfig){var keys=fluid.model.sortByKeyLength(flatSchema);return function(root,segment,index,segs){for(var path=getConfig.parser.compose.apply(null,segs.slice(0,index)),i=0;i<keys.length;++i){var key=keys[i];if(null!==fluid.pathUtil.matchPath(key,path,!0))return flatSchema[key]}}},fluid.model.transform.defaultSchemaValue=function(schemaValue){var type=fluid.isPrimitive(schemaValue)?schemaValue:schemaValue.type;return"array"===type?[]:{}},fluid.model.transform.isomorphicSchemaStrategy=function(source,getConfig){return function(root,segment,index,segs){var existing=fluid.get(source,segs.slice(0,index),getConfig);return fluid.isArrayable(existing)?"array":"object"}},fluid.model.transform.decodeStrategy=function(source,options,getConfig){return options.isomorphic?fluid.model.transform.isomorphicSchemaStrategy(source,getConfig):options.flatSchema?fluid.model.transform.flatSchemaStrategy(options.flatSchema,getConfig):void 0},fluid.model.transform.schemaToCreatorStrategy=function(strategy){return function(root,segment,index,segs){if(void 0===root[segment]){var schemaValue=strategy(root,segment,index,segs);return root[segment]=fluid.model.transform.defaultSchemaValue(schemaValue),root[segment]}}},fluid.model.transform.sequence=function(source,rules,options){for(var i=0;i<rules.length;++i)source=fluid.model.transform(source,rules[i],options);return source},fluid.model.compareByPathLength=function(changea,changeb){var pdiff=changea.path.length-changeb.path.length;return 0===pdiff?changea.sequence-changeb.sequence:pdiff},fluid.model.fireSortedChanges=function(changes,applier){changes.sort(fluid.model.compareByPathLength),fluid.requestChanges(applier,changes)},fluid.model.transformWithRules=function(source,rules,options){options=options||{};var getConfig=fluid.model.escapedGetConfig,schemaStrategy=fluid.model.transform.decodeStrategy(source,options,getConfig),transform={source:source,target:schemaStrategy?fluid.model.transform.defaultSchemaValue(schemaStrategy(null,"",0,[""])):{},resolverGetConfig:getConfig,collectedFlatSchemaOpts:void 0,queuedChanges:[],queuedTransforms:[]};fluid.model.transform.makeStrategy(transform,fluid.model.transform.handleTransformStrategy),transform.applier={fireChangeRequest:function(changeRequest){changeRequest.sequence=transform.queuedChanges.length,transform.queuedChanges.push(changeRequest)}},fluid.bindRequestChange(transform.applier),transform.expand(rules);var setConfig=fluid.copy(fluid.model.escapedSetConfig);return void 0!==transform.collectedFlatSchemaOpts&&($.extend(transform.collectedFlatSchemaOpts,options.flatSchema),schemaStrategy=fluid.model.transform.flatSchemaStrategy(transform.collectedFlatSchemaOpts,getConfig)),setConfig.strategies=[fluid.model.defaultFetchStrategy,schemaStrategy?fluid.model.transform.schemaToCreatorStrategy(schemaStrategy):fluid.model.defaultCreatorStrategy],transform.finalApplier=options.finalApplier||fluid.makeChangeApplier(transform.target,{resolverSetConfig:setConfig}),transform.queuedTransforms.length>0&&(transform.typeStack=[],transform.pathOp=fluid.model.makePathStack(transform,"path"),fluid.model.transform.expandWildcards(transform,source)),fluid.model.fireSortedChanges(transform.queuedChanges,transform.finalApplier),transform.target},$.extend(fluid.model.transformWithRules,fluid.model.transform),fluid.model.transform=fluid.model.transformWithRules,fluid.transformOne=function(rules){return{transformOptions:{transformer:"fluid.model.transformWithRules",config:rules}}},fluid.transformMany=function(rules){return{transformOptions:{transformer:"fluid.model.transform.sequence",config:rules}}}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){"use strict";fluid.registerNamespace("fluid.model.transform"),fluid.registerNamespace("fluid.transforms"),fluid.defaults("fluid.transforms.value",{gradeNames:"fluid.standardTransformFunction",invertConfiguration:"fluid.transforms.value.invert"}),fluid.transforms.value=fluid.identity,fluid.transforms.value.invert=function(transformSpec,transform){var togo=fluid.copy(transformSpec);return togo.inputPath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath),togo.outputPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.inputPath),togo},fluid.defaults("fluid.transforms.literalValue",{gradeNames:"fluid.standardOutputTransformFunction"}),fluid.transforms.literalValue=function(transformSpec){return transformSpec.value},fluid.defaults("fluid.transforms.arrayValue",{gradeNames:"fluid.standardTransformFunction"}),fluid.transforms.arrayValue=fluid.makeArray,fluid.defaults("fluid.transforms.count",{gradeNames:"fluid.standardTransformFunction"}),fluid.transforms.count=function(value){return fluid.makeArray(value).length},fluid.defaults("fluid.transforms.round",{gradeNames:"fluid.standardTransformFunction"}),fluid.transforms.round=function(value){return Math.round(value)},fluid.defaults("fluid.transforms.delete",{gradeNames:"fluid.transformFunction"}),fluid.transforms["delete"]=function(transformSpec,transform){var outputPath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath);transform.applier.requestChange(outputPath,null,"DELETE")},fluid.defaults("fluid.transforms.firstValue",{gradeNames:"fluid.transformFunction"}),fluid.transforms.firstValue=function(transformSpec,transform){transformSpec.values&&transformSpec.values.length||fluid.fail('firstValue transformer requires an array of values at path named "values", supplied',transformSpec);for(var i=0;i<transformSpec.values.length;i++){var value=transformSpec.values[i],expanded=transform.expand(value);if(void 0!==expanded)return expanded}},fluid.defaults("fluid.transforms.linearScale",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.linearScale.invert",inputVariables:{value:null,factor:1,offset:0}}),fluid.transforms.linearScale=function(inputs){return"number"!=typeof inputs.value||"number"!=typeof inputs.factor||"number"!=typeof inputs.offset?void 0:inputs.value*inputs.factor+inputs.offset},fluid.transforms.linearScale.invert=function(transformSpec,transform){var togo=fluid.copy(transformSpec);return togo.factor&&(togo.factor=0===togo.factor?0:1/togo.factor),togo.offset&&(togo.offset=-togo.offset*(void 0!==togo.factor?togo.factor:1)),togo.valuePath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath),togo.outputPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.valuePath),togo},fluid.defaults("fluid.transforms.binaryOp",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction"],inputVariables:{left:null,right:null}}),fluid.transforms.binaryLookup={"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"<=":function(a,b){return b>=a},"<":function(a,b){return b>a},">=":function(a,b){return a>=b},">":function(a,b){return a>b},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b}},fluid.transforms.binaryOp=function(inputs,transformSpec,transform){var operator=fluid.model.transform.getValue(void 0,transformSpec.operator,transform),fun=fluid.transforms.binaryLookup[operator];return void 0===fun||void 0===inputs.left||void 0===inputs.right?void 0:fun(inputs.left,inputs.right)},fluid.defaults("fluid.transforms.condition",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction"],inputVariables:{"true":null,"false":null,condition:null}}),fluid.transforms.condition=function(inputs){return null===inputs.condition?void 0:inputs[inputs.condition]},fluid.defaults("fluid.transforms.valueMapper",{gradeNames:["fluid.transformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.valueMapper.invert",collectInputPaths:"fluid.transforms.valueMapper.collect"}),fluid.model.transform.matchValueMapperFull=function(outerValue,transformSpec,transform){var o=transformSpec.options;if(0===o.length&&fluid.fail("valueMapper supplied empty list of options: ",transformSpec),1===o.length)return 0;for(var matchPower=[],i=0;i<o.length;++i){var option=o[i],value=fluid.firstDefined(fluid.model.transform.getValue(option.inputPath,void 0,transform),outerValue),matchCount=fluid.model.transform.matchValue(option.undefinedInputValue?void 0:option.inputValue,value);matchPower[i]={index:i,matchCount:matchCount}}return matchPower.sort(fluid.model.transform.compareMatches),matchPower[0].matchCount===matchPower[1].matchCount?-1:matchPower[0].index},fluid.transforms.valueMapper=function(transformSpec,transform){transformSpec.options||fluid.fail('demultiplexValue requires a list or hash of options at path named "options", supplied ',transformSpec);var value=fluid.model.transform.getValue(transformSpec.inputPath,void 0,transform),deref=fluid.isArrayable(transformSpec.options)?function(testVal){var index=fluid.model.transform.matchValueMapperFull(testVal,transformSpec,transform);return-1===index?null:transformSpec.options[index]}:function(testVal){return transformSpec.options[testVal]},indexed=deref(value);if(indexed||(indexed=deref(transformSpec.defaultInputValue)),indexed){var outputPath=void 0===indexed.outputPath?transformSpec.defaultOutputPath:indexed.outputPath;transform.outputPrefixOp.push(outputPath);var outputValue;return fluid.isPrimitive(indexed)?outputValue=indexed:indexed.undefinedOutputValue?outputValue=void 0:(outputValue=fluid.model.transform.resolveParam(indexed,transform,"outputValue",void 0),outputValue=void 0===outputValue?transformSpec.defaultOutputValue:outputValue),"string"==typeof outputPath&&void 0!==outputValue&&(fluid.model.transform.setValue(void 0,outputValue,transform,transformSpec.merge),outputValue=void 0),transform.outputPrefixOp.pop(),outputValue}},fluid.transforms.valueMapper.invert=function(transformSpec,transform){var options=[],togo={type:"fluid.transforms.valueMapper",options:options},isArray=fluid.isArrayable(transformSpec.options),findCustom=function(name){return fluid.find(transformSpec.options,function(option){return option[name]?!0:void 0})},anyCustomOutput=findCustom("outputPath"),anyCustomInput=findCustom("inputPath");anyCustomOutput||(togo.inputPath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath)),anyCustomInput||(togo.defaultOutputPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.inputPath));var def=fluid.firstDefined;return fluid.each(transformSpec.options,function(option,key){var outOption={},origInputValue=def(isArray?option.inputValue:key,transformSpec.defaultInputValue);void 0===origInputValue&&fluid.fail("Failure inverting configuration for valueMapper - inputValue could not be resolved for record "+key+": ",transformSpec),outOption.outputValue=origInputValue;var origOutputValue=def(option.outputValue,transformSpec.defaultOutputValue);outOption.inputValue=fluid.model.transform.getValue(option.outputValuePath,origOutputValue,transform),anyCustomOutput&&(outOption.inputPath=fluid.model.composePaths(transform.outputPrefix,def(option.outputPath,transformSpec.outputPath))),anyCustomInput&&(outOption.outputPath=fluid.model.composePaths(transform.inputPrefix,def(option.inputPath,transformSpec.inputPath))),option.outputValuePath&&(outOption.inputValuePath=option.outputValuePath),options.push(outOption)}),togo},fluid.transforms.valueMapper.collect=function(transformSpec,transform){var togo=[];return fluid.model.transform.accumulateInputPath(transformSpec.inputPath,transform,togo),fluid.each(transformSpec.options,function(option){fluid.model.transform.accumulateInputPath(option.inputPath,transform,togo)}),togo},fluid.defaults("fluid.transforms.arrayToSetMembership",{gradeNames:["fluid.standardInputTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.arrayToSetMembership.invert"}),fluid.transforms.arrayToSetMembership=function(value,transformSpec,transform){var options=transformSpec.options;value&&fluid.isArrayable(value)||fluid.fail("arrayToSetMembership didn't find array at inputPath nor passed as value.",transformSpec),options||fluid.fail("arrayToSetMembership requires an options block set"),void 0===transformSpec.presentValue&&(transformSpec.presentValue=!0),void 0===transformSpec.missingValue&&(transformSpec.missingValue=!1),fluid.each(options,function(outPath,key){var outVal=-1!==$.inArray(key,value)?transformSpec.presentValue:transformSpec.missingValue;fluid.model.transform.setValue(outPath,outVal,transform)})},fluid.transforms.arrayToSetMembership.invert=function(transformSpec,transform){var togo=fluid.copy(transformSpec);delete togo.inputPath,togo.type="fluid.transforms.setMembershipToArray",togo.outputPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.inputPath);var newOptions={};return fluid.each(transformSpec.options,function(path,oldKey){var newKey=fluid.model.composePaths(transform.outputPrefix,path);newOptions[newKey]=oldKey}),togo.options=newOptions,togo},fluid.defaults("fluid.transforms.setMembershipToArray",{gradeNames:["fluid.standardOutputTransformFunction"]}),fluid.transforms.setMembershipToArray=function(transformSpec,transform){var options=transformSpec.options;options||fluid.fail("setMembershipToArray requires an options block specified"),void 0===transformSpec.presentValue&&(transformSpec.presentValue=!0),void 0===transformSpec.missingValue&&(transformSpec.missingValue=!1);var outputArr=[];return fluid.each(options,function(arrVal,inPath){var val=fluid.model.transform.getValue(inPath,void 0,transform);val===transformSpec.presentValue&&outputArr.push(arrVal)}),outputArr},fluid.model.transform.applyPaths=function(operation,pathOp,paths){for(var i=0;i<paths.length;++i)"push"===operation?pathOp.push(paths[i]):pathOp.pop()},fluid.model.transform.expandInnerValues=function(inputPath,outputPath,transform,innerValues){var inputPrefixOp=transform.inputPrefixOp,outputPrefixOp=transform.outputPrefixOp,apply=fluid.model.transform.applyPaths;apply("push",inputPrefixOp,inputPath),apply("push",outputPrefixOp,outputPath);var expanded={};return fluid.each(innerValues,function(innerValue){var expandedInner=transform.expand(innerValue);fluid.isPrimitive(expandedInner)?expanded=expandedInner:$.extend(!0,expanded,expandedInner)}),apply("pop",outputPrefixOp,outputPath),apply("pop",inputPrefixOp,inputPath),expanded},fluid.defaults("fluid.transforms.arrayToObject",{gradeNames:["fluid.standardTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.arrayToObject.invert"}),fluid.transforms.arrayToObject=function(arr,transformSpec,transform){void 0===transformSpec.key&&fluid.fail("arrayToObject requires a 'key' option.",transformSpec),fluid.isArrayable(arr)||fluid.fail("arrayToObject didn't find array at inputPath.",transformSpec);var newHash={},pivot=transformSpec.key;return fluid.each(arr,function(v,k){var newKey=v[pivot],keyType=typeof newKey;"string"!==keyType&&"boolean"!==keyType&&"number"!==keyType&&fluid.fail("arrayToObject encountered untransformable array due to missing or invalid key",v);var content=fluid.copy(v);delete content[pivot],transformSpec.innerValue&&(content=fluid.model.transform.expandInnerValues([transform.inputPrefix,transformSpec.inputPath,k.toString()],[newKey],transform,transformSpec.innerValue)),newHash[newKey]=content}),newHash},fluid.transforms.arrayToObject.invert=function(transformSpec,transform){var togo=fluid.copy(transformSpec);if(togo.type="fluid.transforms.objectToArray",togo.inputPath=fluid.model.composePaths(transform.outputPrefix,transformSpec.outputPath),togo.outputPath=fluid.model.composePaths(transform.inputPrefix,transformSpec.inputPath),togo.innerValue)for(var innerValue=togo.innerValue,i=0;i<innerValue.length;++i)innerValue[i]=fluid.model.transform.invertConfiguration(innerValue[i]);return togo},fluid.defaults("fluid.transforms.objectToArray",{gradeNames:"fluid.standardTransformFunction"}),fluid.transforms.objectToArray=function(hash,transformSpec,transform){void 0===transformSpec.key&&fluid.fail("objectToArray requires a 'key' option.",transformSpec);var newArray=[],pivot=transformSpec.key;return fluid.each(hash,function(v,k){var content={};content[pivot]=k,transformSpec.innerValue&&(v=fluid.model.transform.expandInnerValues([transformSpec.inputPath,k],[transformSpec.outputPath,newArray.length.toString()],transform,transformSpec.innerValue)),$.extend(!0,content,v),newArray.push(content)}),newArray},fluid.defaults("fluid.transforms.limitRange",{gradeNames:"fluid.standardTransformFunction"}),fluid.transforms.limitRange=function(value,transformSpec){var min=transformSpec.min;if(void 0!==min){var excludeMin=transformSpec.excludeMin||0;min+=excludeMin,min>value&&(value=min)}var max=transformSpec.max;if(void 0!==max){var excludeMax=transformSpec.excludeMax||0;max-=excludeMax,value>max&&(value=max)}return value},fluid.defaults("fluid.transforms.free",{gradeNames:"fluid.transformFunction"}),fluid.transforms.free=function(transformSpec){var args=fluid.makeArray(transformSpec.args);return fluid.invokeGlobalFunction(transformSpec.func,args)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){fluid.thatistBridge=function(name,peer){var togo=function(funcname){for(var segs=funcname.split("."),move=peer,i=0;i<segs.length;++i)move=move[segs[i]];var args=[this];2===arguments.length&&(args=args.concat($.makeArray(arguments[1])));var ret=move.apply(null,args);this.that=function(){return ret};var type=typeof ret;return!ret||"string"===type||"number"===type||"boolean"===type||ret&&void 0!==ret.length?ret:this};return $.fn[name]=togo,togo},fluid.thatistBridge("fluid",fluid),fluid.thatistBridge("fluid_1_5",fluid_1_5);var normalizeTabindexName=function(){return $.browser.msie?"tabIndex":"tabindex"},canHaveDefaultTabindex=function(elements){return elements.length<=0?!1:$(elements[0]).is("a, input, button, select, area, textarea, object")},getValue=function(elements){if(elements.length<=0)return void 0;if(!fluid.tabindex.hasAttr(elements))return canHaveDefaultTabindex(elements)?Number(0):void 0;var value=elements.attr(normalizeTabindexName());return Number(value)},setValue=function(elements,toIndex){return elements.each(function(i,item){$(item).attr(normalizeTabindexName(),toIndex)})};fluid.tabindex=function(target,toIndex){return target=$(target),null!==toIndex&&void 0!==toIndex?setValue(target,toIndex):getValue(target)},fluid.tabindex.remove=function(target){return target=$(target),target.each(function(i,item){$(item).removeAttr(normalizeTabindexName())})},fluid.tabindex.hasAttr=function(target){if(target=$(target),target.length<=0)return!1;var togo=target.map(function(){var attributeNode=this.getAttributeNode(normalizeTabindexName());return attributeNode?attributeNode.specified:!1});return 1===togo.length?togo[0]:togo},fluid.tabindex.has=function(target){return target=$(target),fluid.tabindex.hasAttr(target)||canHaveDefaultTabindex(target)},fluid.a11y=$.a11y||{},fluid.a11y.orientation={HORIZONTAL:0,VERTICAL:1,BOTH:2};var UP_DOWN_KEYMAP={next:$.ui.keyCode.DOWN,previous:$.ui.keyCode.UP},LEFT_RIGHT_KEYMAP={next:$.ui.keyCode.RIGHT,previous:$.ui.keyCode.LEFT},unwrap=function(element){return element.jquery?element[0]:element},makeElementsTabFocussable=function(elements){elements.each(function(idx,item){item=$(item),(!item.fluid("tabindex.has")||item.fluid("tabindex")<0)&&item.fluid("tabindex",0)})};fluid.tabbable=function(target){target=$(target),makeElementsTabFocussable(target)};var CONTEXT_KEY="selectionContext",NO_SELECTION=-32768,cleanUpWhenLeavingContainer=function(selectionContext){selectionContext.activeItemIndex!==NO_SELECTION&&(selectionContext.options.onLeaveContainer?selectionContext.options.onLeaveContainer(selectionContext.selectables[selectionContext.activeItemIndex]):selectionContext.options.onUnselect&&selectionContext.options.onUnselect(selectionContext.selectables[selectionContext.activeItemIndex])),selectionContext.options.rememberSelectionState||(selectionContext.activeItemIndex=NO_SELECTION)},drawSelection=function(elementToSelect,handler){handler&&handler(elementToSelect)},eraseSelection=function(selectedElement,handler){handler&&selectedElement&&handler(selectedElement)},unselectElement=function(selectedElement,selectionContext){eraseSelection(selectedElement,selectionContext.options.onUnselect)},selectElement=function(elementToSelect,selectionContext){unselectElement(selectionContext.selectedElement(),selectionContext),elementToSelect=unwrap(elementToSelect);var newIndex=selectionContext.selectables.index(elementToSelect);-1!==newIndex&&(selectionContext.activeItemIndex=newIndex,drawSelection(elementToSelect,selectionContext.options.onSelect))},selectableFocusHandler=function(selectionContext){return function(evt){return $(evt.target).fluid("tabindex",0),selectElement(evt.target,selectionContext),evt.stopPropagation()}},selectableBlurHandler=function(selectionContext){return function(evt){return $(evt.target).fluid("tabindex",selectionContext.options.selectablesTabindex),unselectElement(evt.target,selectionContext),evt.stopPropagation()}},reifyIndex=function(sc_that){var elements=sc_that.selectables;sc_that.activeItemIndex>=elements.length&&(sc_that.activeItemIndex=sc_that.options.noWrap?elements.length-1:0),sc_that.activeItemIndex<0&&sc_that.activeItemIndex!==NO_SELECTION&&(sc_that.activeItemIndex=sc_that.options.noWrap?0:elements.length-1),sc_that.activeItemIndex>=0&&fluid.focus(elements[sc_that.activeItemIndex])},prepareShift=function(selectionContext){var selElm=selectionContext.selectedElement();selElm&&fluid.blur(selElm),unselectElement(selectionContext.selectedElement(),selectionContext),selectionContext.activeItemIndex===NO_SELECTION&&(selectionContext.activeItemIndex=-1)},focusNextElement=function(selectionContext){prepareShift(selectionContext),++selectionContext.activeItemIndex,reifyIndex(selectionContext)},focusPreviousElement=function(selectionContext){prepareShift(selectionContext),--selectionContext.activeItemIndex,reifyIndex(selectionContext)},arrowKeyHandler=function(selectionContext,keyMap){return function(evt){evt.which===keyMap.next?(focusNextElement(selectionContext),evt.preventDefault()):evt.which===keyMap.previous&&(focusPreviousElement(selectionContext),evt.preventDefault())}},getKeyMapForDirection=function(direction){var keyMap;return direction===fluid.a11y.orientation.HORIZONTAL?keyMap=LEFT_RIGHT_KEYMAP:direction===fluid.a11y.orientation.VERTICAL&&(keyMap=UP_DOWN_KEYMAP),keyMap},tabKeyHandler=function(selectionContext){return function(evt){evt.which===$.ui.keyCode.TAB&&(cleanUpWhenLeavingContainer(selectionContext),evt.shiftKey&&(selectionContext.focusIsLeavingContainer=!0))}},containerFocusHandler=function(selectionContext){return function(evt){var shouldOrig=selectionContext.options.autoSelectFirstItem,shouldSelect="function"==typeof shouldOrig?shouldOrig():shouldOrig;return selectionContext.focusIsLeavingContainer&&(shouldSelect=!1),shouldSelect&&evt.target===selectionContext.container.get(0)&&(selectionContext.activeItemIndex===NO_SELECTION&&(selectionContext.activeItemIndex=0),fluid.focus(selectionContext.selectables[selectionContext.activeItemIndex])),evt.stopPropagation()}},containerBlurHandler=function(selectionContext){return function(evt){return selectionContext.focusIsLeavingContainer=!1,evt.stopPropagation()}},makeElementsSelectable=function(container,defaults,userOptions){var options=$.extend(!0,{},defaults,userOptions),keyMap=getKeyMapForDirection(options.direction),selectableElements=options.selectableElements?options.selectableElements:container.find(options.selectableSelector),that={container:container,activeItemIndex:NO_SELECTION,selectables:selectableElements,focusIsLeavingContainer:!1,options:options};return that.selectablesUpdated=function(focusedItem){"number"==typeof that.options.selectablesTabindex&&that.selectables.fluid("tabindex",that.options.selectablesTabindex),that.selectables.unbind("focus."+CONTEXT_KEY),that.selectables.unbind("blur."+CONTEXT_KEY),that.selectables.bind("focus."+CONTEXT_KEY,selectableFocusHandler(that)),that.selectables.bind("blur."+CONTEXT_KEY,selectableBlurHandler(that)),keyMap&&that.options.noBubbleListeners&&(that.selectables.unbind("keydown."+CONTEXT_KEY),that.selectables.bind("keydown."+CONTEXT_KEY,arrowKeyHandler(that,keyMap))),focusedItem?selectElement(focusedItem,that):reifyIndex(that)},that.refresh=function(){that.options.selectableSelector||fluid.fail("Cannot refresh selectable context which was not initialised by a selector"),that.selectables=container.find(options.selectableSelector),that.selectablesUpdated()},that.selectedElement=function(){return that.activeItemIndex<0?null:that.selectables[that.activeItemIndex]},keyMap&&!that.options.noBubbleListeners&&container.keydown(arrowKeyHandler(that,keyMap)),container.keydown(tabKeyHandler(that)),container.focus(containerFocusHandler(that)),container.blur(containerBlurHandler(that)),that.selectablesUpdated(),that};fluid.selectable=function(target,options){target=$(target);var that=makeElementsSelectable(target,fluid.selectable.defaults,options);return fluid.setScopedData(target,CONTEXT_KEY,that),that},fluid.selectable.select=function(target,toSelect){fluid.focus(toSelect)},fluid.selectable.selectNext=function(target){target=$(target),focusNextElement(fluid.getScopedData(target,CONTEXT_KEY))},fluid.selectable.selectPrevious=function(target){target=$(target),focusPreviousElement(fluid.getScopedData(target,CONTEXT_KEY))},fluid.selectable.currentSelection=function(target){target=$(target);var that=fluid.getScopedData(target,CONTEXT_KEY);return $(that.selectedElement())},fluid.selectable.defaults={direction:fluid.a11y.orientation.VERTICAL,selectablesTabindex:-1,autoSelectFirstItem:!0,rememberSelectionState:!0,selectableSelector:".selectable",selectableElements:null,onSelect:null,onUnselect:null,onLeaveContainer:null,noWrap:!1};var checkForModifier=function(binding,evt){if(!binding.modifier)return!0;var modifierKey=binding.modifier,isCtrlKeyPresent=modifierKey&&evt.ctrlKey,isAltKeyPresent=modifierKey&&evt.altKey,isShiftKeyPresent=modifierKey&&evt.shiftKey;return isCtrlKeyPresent||isAltKeyPresent||isShiftKeyPresent},makeActivationHandler=function(binding){return function(evt){var target=evt.target;if(fluid.enabled(target)){var code=evt.which?evt.which:evt.keyCode;if(code===binding.key&&binding.activateHandler&&checkForModifier(binding,evt)){var event=$.Event("fluid-activate");$(target).trigger(event,[binding.activateHandler]),event.isDefaultPrevented()&&evt.preventDefault()}}}},makeElementsActivatable=function(elements,onActivateHandler,defaultKeys,options){var bindings=[];$(defaultKeys).each(function(index,key){bindings.push({modifier:null,key:key,activateHandler:onActivateHandler})}),options&&options.additionalBindings&&(bindings=bindings.concat(options.additionalBindings)),fluid.initEnablement(elements);for(var i=0;i<bindings.length;++i){var binding=bindings[i];elements.keydown(makeActivationHandler(binding))}elements.bind("fluid-activate",function(evt,handler){return handler=handler||onActivateHandler,handler?handler(evt):null})};fluid.activatable=function(target,fn,options){target=$(target),makeElementsActivatable(target,fn,fluid.activatable.defaults.keys,options)},fluid.activate=function(target){$(target).trigger("fluid-activate")},fluid.activatable.defaults={keys:[$.ui.keyCode.ENTER,$.ui.keyCode.SPACE]}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.commonViewComponent",{gradeNames:["fluid.littleComponent","autoInit"],initFunction:"fluid.initView",argumentMap:{container:0,options:1},members:{dom:"@expand:fluid.initDomBinder({that}, {that}.options.selectors)"}}),fluid.defaults("fluid.viewComponent",{gradeNames:["fluid.commonViewComponent","fluid.standardComponent","autoInit"]}),fluid.defaults("fluid.viewRelayComponent",{gradeNames:["fluid.commonViewComponent","fluid.standardRelayComponent","autoInit"]}),fluid.dumpSelector=function(selectable){return"string"==typeof selectable?selectable:selectable.selector?selectable.selector:""},fluid.diagnoseFailedView=function(componentName,that,options,args){if(!that&&fluid.hasGrade(options,"fluid.viewComponent")){var container=fluid.wrap(args[1]),message1="Instantiation of autoInit component with type "+componentName+" failed, since ";container?0===container.length?fluid.fail(message1+'selector "',fluid.dumpSelector(args[1]),'" did not match any markup in the document'):fluid.fail(message1+" component creator function did not return a value"):fluid.fail(message1+" container argument is empty")}},fluid.checkTryCatchParameter=function(){var location=window.location||{search:"",protocol:"file:"},GETparams=location.search.slice(1).split("&");return fluid.find(GETparams,function(param){return 0===param.indexOf("notrycatch")?!0:void 0})===!0},fluid.notrycatch=fluid.checkTryCatchParameter(),fluid.wrap=function(obj,userJQuery){return userJQuery=userJQuery||$,!obj||obj.jquery?obj:userJQuery(obj)},fluid.unwrap=function(obj){return obj&&obj.jquery&&1===obj.length?obj[0]:obj},fluid.container=function(containerSpec,fallible,userJQuery){userJQuery&&(containerSpec=fluid.unwrap(containerSpec));var container=fluid.wrap(containerSpec,userJQuery);if(fallible&&(!container||0===container.length))return null;if(!container||!container.jquery||1!==container.length){"string"!=typeof containerSpec&&(containerSpec=container.selector);var count=void 0!==container.length?container.length:0;fluid.fail((count>1?"More than one ("+count+") container elements were":"No container element was")+" found for selector "+containerSpec)}return fluid.isDOMNode(container[0])||fluid.fail("fluid.container was supplied a non-jQueryable element"),container},fluid.createDomBinder=function(container,selectors){function cacheKey(name,thisContainer){return fluid.allocateSimpleId(thisContainer)+"-"+name}function record(name,thisContainer,result){cache[cacheKey(name,thisContainer)]=result}var cache={},that={id:fluid.allocateGuid()},userJQuery=container.constructor;return that.locate=function(name,localContainer){var selector,thisContainer,togo;return selector=selectors[name],thisContainer=localContainer?localContainer:container,thisContainer||fluid.fail("DOM binder invoked for selector "+name+" without container"),selector?(togo="function"==typeof selector?userJQuery(selector.call(null,fluid.unwrap(thisContainer))):userJQuery(selector,thisContainer),togo.get(0)===document&&(togo=[]),togo.selector||(togo.selector=selector,togo.context=thisContainer),togo.selectorName=name,record(name,thisContainer,togo),togo):thisContainer},that.fastLocate=function(name,localContainer){var thisContainer=localContainer?localContainer:container,key=cacheKey(name,thisContainer),togo=cache[key];return togo?togo:that.locate(name,localContainer)},that.clear=function(){cache={}},that.refresh=function(names,localContainer){var thisContainer=localContainer?localContainer:container;"string"==typeof names&&(names=[names]),void 0===thisContainer.length&&(thisContainer=[thisContainer]);for(var i=0;i<names.length;++i)for(var j=0;j<thisContainer.length;++j)that.locate(names[i],thisContainer[j])},that.resolvePathSegment=that.locate,that},fluid.expectFilledSelector=function(result,message){result&&0===result.length&&result.jquery&&fluid.fail(message+': selector "'+result.selector+'" with name '+result.selectorName+" returned no results in context "+fluid.dumpEl(result.context))},fluid.initView=function(componentName,containerSpec,userOptions,localOptions){var container=fluid.container(containerSpec,!0);if(fluid.expectFilledSelector(container,'Error instantiating component with name "'+componentName),!container)return null;var receiver=function(that){that.container=container},that=fluid.initLittleComponent(componentName,userOptions,localOptions||{gradeNames:["fluid.viewComponent"]},receiver);that.dom||fluid.initDomBinder(that);var userJQuery=that.options.jQuery;return fluid.log("Constructing view component "+componentName+" with container "+container.constructor.expando+(userJQuery?" user jQuery "+userJQuery.expando:"")+" env: "+$.expando),that},fluid.initDomBinder=function(that,selectors){return that.dom=fluid.createDomBinder(that.container,selectors||that.options.selectors||{}),that.locate=that.dom.locate,that.dom},fluid.findAncestor=function(element,test){for(element=fluid.unwrap(element);element;){if(test(element))return element;element=element.parentNode}},fluid.findForm=function(node){return fluid.findAncestor(node,function(element){return"form"===element.nodeName.toLowerCase()})},fluid.each(["text","html"],function(method){fluid[method]=function(node,newValue){return node=$(node),void 0===newValue?node[method]():node[method](newValue)}}),fluid.value=function(nodeIn,newValue){var node=fluid.unwrap(nodeIn),multiple=!1;if(void 0===node.nodeType&&node.length>1&&(node=node[0],multiple=!0),"input"!==node.nodeName.toLowerCase()||!/radio|checkbox/.test(node.type))return void 0===newValue?$(node).val():$(node).val(newValue);var name=node.name;void 0===name&&fluid.fail("Cannot acquire value from node "+fluid.dumpEl(node)+" which does not have name attribute set");var elements;if(multiple)elements=nodeIn;else{elements=node.ownerDocument.getElementsByName(name);var scope=fluid.findForm(node);elements=$.grep(elements,function(element){return element.name!==name?!1:!scope||fluid.dom.isContainer(scope,element)})}if(void 0===newValue){var checked=$.map(elements,function(element){return element.checked?element.value:null});return"radio"===node.type?checked[0]:checked}"boolean"==typeof newValue&&(newValue=newValue?"true":"false"),$.each(elements,function(){this.checked=newValue instanceof Array?-1!==$.inArray(this.value,newValue):newValue===this.value})},fluid.BINDING_ROOT_KEY="fluid-binding-root",fluid.findData=function(elem,name){for(;elem;){var data=$.data(elem,name);if(data)return data;elem=elem.parentNode}},fluid.bindFossils=function(node,data,fossils){$.data(node,fluid.BINDING_ROOT_KEY,{data:data,fossils:fossils})},fluid.boundPathForNode=function(node,fossils){node=fluid.unwrap(node);var key=node.name||node.id,record=fossils[key];return record?record.EL:null},fluid.applyBoundChange=function(node,newValue,applier){node=fluid.unwrap(node),void 0===newValue&&(newValue=fluid.value(node)),void 0===node.nodeType&&node.length>0&&(node=node[0]);var root=fluid.findData(node,fluid.BINDING_ROOT_KEY);root||fluid.fail("Bound data could not be discovered in any node above "+fluid.dumpEl(node));var name=node.name,fossil=root.fossils[name];fossil||fluid.fail("No fossil discovered for name "+name+" in fossil record above "+fluid.dumpEl(node)),"boolean"==typeof fossil.oldvalue&&(newValue=newValue[0]?!0:!1);var EL=root.fossils[name].EL;applier?applier.fireChangeRequest({path:EL,value:newValue,source:"DOM:"+node.id}):fluid.set(root.data,EL,newValue)},fluid.jById=function(id,dokkument){dokkument=dokkument&&9===dokkument.nodeType?dokkument:document;var element=fluid.byId(id,dokkument),togo=element?$(element):[];return togo.selector="#"+id,togo.context=dokkument,togo},fluid.byId=function(id,dokkument){dokkument=dokkument&&9===dokkument.nodeType?dokkument:document;var el=dokkument.getElementById(id);return el?(el.id!==id&&fluid.fail("Problem in document structure - picked up element "+fluid.dumpEl(el)+" for id "+id+" without this id - most likely the element has a name which conflicts with this id"),el):null},fluid.getId=function(element){return fluid.unwrap(element).id},fluid.allocateSimpleId=function(element){var simpleId="fluid-id-"+fluid.allocateGuid();return element?(element=fluid.unwrap(element),element.id||(element.id=simpleId),element.id):simpleId},fluid.defaults("fluid.ariaLabeller",{labelAttribute:"aria-label",liveRegionMarkup:'<div class="liveRegion fl-offScreen-hidden" aria-live="polite"></div>',liveRegionId:"fluid-ariaLabeller-liveRegion",events:{generateLiveElement:"unicast"},listeners:{generateLiveElement:"fluid.ariaLabeller.generateLiveElement"}}),fluid.ariaLabeller=function(element,options){var that=fluid.initView("fluid.ariaLabeller",element,options);return that.update=function(newOptions){if(newOptions=newOptions||that.options,that.container.attr(that.options.labelAttribute,newOptions.text),newOptions.dynamicLabel){var live=fluid.jById(that.options.liveRegionId);0===live.length&&(live=that.events.generateLiveElement.fire(that)),live.text(newOptions.text)}},that.update(),that},fluid.ariaLabeller.generateLiveElement=function(that){var liveEl=$(that.options.liveRegionMarkup);return liveEl.prop("id",that.options.liveRegionId),$("body").append(liveEl),liveEl};var LABEL_KEY="aria-labelling";fluid.getAriaLabeller=function(element){element=$(element);var that=fluid.getScopedData(element,LABEL_KEY);return that},fluid.updateAriaLabel=function(element,text,options){options=$.extend({},options||{},{text:text});var that=fluid.getAriaLabeller(element);return that?that.update(options):(that=fluid.ariaLabeller(element,options),fluid.setScopedData(element,LABEL_KEY,that)),that};var dismissList={};$(document).click(function(event){for(var target=fluid.resolveEventTarget(event);target;){if(dismissList[target.id])return;target=target.parentNode}fluid.each(dismissList,function(dismissFunc,key){dismissFunc(event),delete dismissList[key]})}),fluid.globalDismissal=function(nodes,dismissFunc){fluid.each(nodes,function(node){var id=fluid.unwrap(node).ownerDocument===document?fluid.allocateSimpleId(node):fluid.allocateGuid();dismissFunc?dismissList[id]=dismissFunc:delete dismissList[id]})},fluid.now=function(){return Date.now?Date.now():(new Date).getTime()},fluid.deadMansBlur=function(control,options){var that={options:$.extend(!0,{},fluid.defaults("fluid.deadMansBlur"),options)};return that.blurPending=!1,that.lastCancel=0,that.canceller=function(event){fluid.log("Cancellation through "+event.type+" on "+fluid.dumpEl(event.target)),that.lastCancel=fluid.now(),that.blurPending=!1},that.noteProceeded=function(){fluid.globalDismissal(that.options.exclusions)},that.reArm=function(){fluid.globalDismissal(that.options.exclusions,that.proceed)},that.addExclusion=function(exclusions){fluid.globalDismissal(exclusions,that.proceed)},that.proceed=function(event){fluid.log("Direct proceed through "+event.type+" on "+fluid.dumpEl(event.target)),that.blurPending=!1,that.options.handler(control)},fluid.each(that.options.exclusions,function(exclusion){exclusion=$(exclusion),fluid.each(exclusion,function(excludeEl){$(excludeEl).bind("focusin",that.canceller).bind("fluid-focus",that.canceller).click(that.canceller).mousedown(that.canceller)})}),that.options.cancelByDefault?that.reArm():$(control).bind("focusout",function(event){fluid.log("Starting blur timer for element "+fluid.dumpEl(event.target));var now=fluid.now();fluid.log("back delay: "+(now-that.lastCancel)),now-that.lastCancel>that.options.backDelay&&(that.blurPending=!0),setTimeout(function(){that.blurPending&&that.options.handler(control)},that.options.delay)}),that},fluid.defaults("fluid.deadMansBlur",{delay:150,backDelay:100})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){function canonUrl(url){return url}var resourceCache={},pendingClass={};fluid.fetchResources=function(resourceSpecs,callback,options){var that=fluid.initLittleComponent("fluid.fetchResources",options);return that.resourceSpecs=resourceSpecs,that.callback=callback,that.operate=function(){fluid.fetchResources.fetchResourcesImpl(that)},fluid.each(resourceSpecs,function(resourceSpec,key){resourceSpec.recurseFirer=fluid.event.getEventFirer(null,null,'I/O completion for resource "'+key+'"'),resourceSpec.recurseFirer.addListener(that.operate),resourceSpec.url&&!resourceSpec.href&&(resourceSpec.href=resourceSpec.url)}),that.options.amalgamateClasses&&fluid.fetchResources.amalgamateClasses(resourceSpecs,that.options.amalgamateClasses,that.operate),that.operate(),that},fluid.fetchResources.amalgamateClasses=function(specs,classes,operator){fluid.each(classes,function(clazz){var pending=pendingClass[clazz];fluid.each(pending,function(pendingrec,canon){specs[clazz+"!"+canon]=pendingrec,pendingrec.recurseFirer.addListener(operator)})})},fluid.fetchResources.timeSuccessCallback=function(resourceSpec){if(resourceSpec.timeSuccess&&resourceSpec.options&&resourceSpec.options.success){var success=resourceSpec.options.success;resourceSpec.options.success=function(){var startTime=new Date,ret=success.apply(null,arguments);return fluid.log("External callback for URL "+resourceSpec.href+" completed - callback time: "+((new Date).getTime()-startTime.getTime())+"ms"),ret}}},fluid.fetchResources.clearResourceCache=function(url){url?delete resourceCache[canonUrl(url)]:fluid.clear(resourceCache)},fluid.fetchResources.handleCachedRequest=function(resourceSpec,response){var canon=canonUrl(resourceSpec.href),cached=resourceCache[canon];if(cached.$$firer$$){fluid.log("Handling request for "+canon+" from cache");var fetchClass=resourceSpec.fetchClass;fetchClass&&pendingClass[fetchClass]&&(fluid.log("Clearing pendingClass entry for class "+fetchClass),delete pendingClass[fetchClass][canon]),resourceCache[canon]=response,cached.fire(response)}},fluid.fetchResources.completeRequest=function(thisSpec){thisSpec.queued=!1,thisSpec.completeTime=new Date,fluid.log("Request to URL "+thisSpec.href+" completed - total elapsed time: "+(thisSpec.completeTime.getTime()-thisSpec.initTime.getTime())+"ms"),thisSpec.recurseFirer.fire()},fluid.fetchResources.makeResourceCallback=function(thisSpec){return{success:function(response){thisSpec.resourceText=response,thisSpec.resourceKey=thisSpec.href,thisSpec.forceCache&&fluid.fetchResources.handleCachedRequest(thisSpec,response),fluid.fetchResources.completeRequest(thisSpec)},error:function(response,textStatus,errorThrown){thisSpec.fetchError={status:response.status,textStatus:response.textStatus,errorThrown:errorThrown},fluid.fetchResources.completeRequest(thisSpec)}}},fluid.fetchResources.issueCachedRequest=function(resourceSpec,options){var canon=canonUrl(resourceSpec.href),cached=resourceCache[canon];if(cached)cached.$$firer$$?(fluid.log("Request for cached resource which is in flight: url "+canon),cached.addListener(function(response){options.success(response)})):options.success(cached);else{fluid.log("First request for cached resource with url "+canon),cached=fluid.event.getEventFirer(null,null,"cache notifier for resource URL "+canon),cached.$$firer$$=!0,resourceCache[canon]=cached;var fetchClass=resourceSpec.fetchClass;fetchClass&&(pendingClass[fetchClass]||(pendingClass[fetchClass]={}),pendingClass[fetchClass][canon]=resourceSpec),options.cache=!1,$.ajax(options)}},fluid.fetchResources.composeCallbacks=function(internal,external){return external?internal?function(){try{external.apply(null,arguments)}catch(e){fluid.log("Exception applying external fetchResources callback: "+e)}internal.apply(null,arguments)}:external:internal},fluid.fetchResources.composePolicy=function(target,source){return fluid.fetchResources.composeCallbacks(target,source)},fluid.defaults("fluid.fetchResources.issueRequest",{mergePolicy:{success:fluid.fetchResources.composePolicy,error:fluid.fetchResources.composePolicy,url:"reverse"}}),fluid.fetchResources.issueRequest=function(resourceSpec,key){var thisCallback=fluid.fetchResources.makeResourceCallback(resourceSpec),options={url:resourceSpec.href,success:thisCallback.success,error:thisCallback.error,dataType:resourceSpec.dataType||"text"};fluid.fetchResources.timeSuccessCallback(resourceSpec),options=fluid.merge(fluid.defaults("fluid.fetchResources.issueRequest").mergePolicy,options,resourceSpec.options),resourceSpec.queued=!0,resourceSpec.initTime=new Date,fluid.log("Request with key "+key+" queued for "+resourceSpec.href),resourceSpec.forceCache?fluid.fetchResources.issueCachedRequest(resourceSpec,options):$.ajax(options)},fluid.fetchResources.fetchResourcesImpl=function(that){var complete=!0,allSync=!0,resourceSpecs=that.resourceSpecs;for(var key in resourceSpecs){var resourceSpec=resourceSpecs[key];if((!resourceSpec.options||resourceSpec.options.async)&&(allSync=!1),resourceSpec.href&&!resourceSpec.completeTime)resourceSpec.queued||fluid.fetchResources.issueRequest(resourceSpec,key),resourceSpec.queued&&(complete=!1);else if(resourceSpec.nodeId&&!resourceSpec.resourceText){var node=document.getElementById(resourceSpec.nodeId);resourceSpec.resourceText=fluid.dom.getElementText(node),resourceSpec.resourceKey=resourceSpec.nodeId}}complete&&that.callback&&!that.callbackCalled&&(that.callbackCalled=!0,$.browser.mozilla&&!allSync?setTimeout(function(){that.callback(resourceSpecs)},1):that.callback(resourceSpecs))},fluid.fetchResources.primeCacheFromResources=function(componentName){var resources=fluid.defaults(componentName).resources,expanded=(fluid.expandOptions?fluid.expandOptions:fluid.identity)(fluid.copy(resources));fluid.fetchResources(expanded)},fluid.registerNamespace("fluid.expander"),fluid.expander.makeDefaultFetchOptions=function(successdisposer,failid,options){return $.extend(!0,{dataType:"text"},options,{success:function(response,environmentdisposer){var json=JSON.parse(response);environmentdisposer(successdisposer(json))},error:function(response,textStatus){fluid.log("Error fetching "+failid+": "+textStatus)}})},fluid.expander.makeFetchExpander=function(options){return{expander:{type:"fluid.expander.deferredFetcher",href:options.url,options:fluid.expander.makeDefaultFetchOptions(options.disposer,options.url,options.options),resourceSpecCollector:"{resourceSpecCollector}",fetchKey:options.fetchKey}}},fluid.expander.deferredFetcher=function(deliverer,source,expandOptions){var expander=source.expander,spec=fluid.copy(expander),collector=fluid.expand(expander.resourceSpecCollector,expandOptions);delete spec.type,delete spec.resourceSpecCollector,delete spec.fetchKey;var environmentdisposer=function(disposed){deliverer(disposed)};spec.options.success=function(response){expander.options.success(response,environmentdisposer)};var key=expander.fetchKey||fluid.allocateGuid();return collector[key]=spec,fluid.NO_VALUE}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.undo"),fluid.undo.STATE_INITIAL="state_initial",fluid.undo.STATE_CHANGED="state_changed",fluid.undo.STATE_REVERTED="state_reverted",fluid.undo.defaultRenderer=function(that,targetContainer){var str=that.options.strings,markup="<span class='flc-undo'><a href='#' class='flc-undo-undoControl'>"+str.undo+"</a><a href='#' class='flc-undo-redoControl'>"+str.redo+"</a></span>",markupNode=$(markup).attr({role:"region","aria-live":"polite","aria-relevant":"all"});return targetContainer.append(markupNode),markupNode},fluid.undo.refreshView=function(that){that.state===fluid.undo.STATE_INITIAL?(that.locate("undoContainer").hide(),that.locate("redoContainer").hide()):that.state===fluid.undo.STATE_CHANGED?(that.locate("undoContainer").show(),that.locate("redoContainer").hide()):that.state===fluid.undo.STATE_REVERTED&&(that.locate("undoContainer").hide(),that.locate("redoContainer").show())},fluid.undo.undoControlClick=function(that){return that.state!==fluid.undo.STATE_REVERTED&&(fluid.model.copyModel(that.extremalModel,that.component.model),that.component.updateModel(that.initialModel,that),that.state=fluid.undo.STATE_REVERTED,fluid.undo.refreshView(that),that.locate("redoControl").focus()),!1},fluid.undo.redoControlClick=function(that){return that.state!==fluid.undo.STATE_CHANGED&&(that.component.updateModel(that.extremalModel,that),that.state=fluid.undo.STATE_CHANGED,fluid.undo.refreshView(that),that.locate("undoControl").focus()),!1},fluid.undo.modelChanged=function(that,newModel,oldModel,source){source!==that&&(that.state=fluid.undo.STATE_CHANGED,fluid.model.copyModel(that.initialModel,oldModel),fluid.undo.refreshView(that))},fluid.undo.finalInit=function(that){fluid.tabindex(that.locate("undoControl"),0),fluid.tabindex(that.locate("redoControl"),0),fluid.model.copyModel(that.initialModel,that.component.model),fluid.model.copyModel(that.extremalModel,that.component.model)},fluid.defaults("fluid.undo",{gradeNames:["fluid.eventedComponent","autoInit"],members:{state:fluid.undo.STATE_INITIAL,initialModel:{},extremalModel:{},component:"{fluid.undoable}",container:{expander:{func:"{that}.options.renderer",args:["{that}","{that}.component.container"]}},dom:{expander:{funcName:"fluid.initDomBinder",args:["{that}","{that}.options.selectors"]}}},invokers:{undoControlClick:{funcName:"fluid.undo.undoControlClick",args:"{that}"},redoControlClick:{funcName:"fluid.undo.redoControlClick",args:"{that}"}},listeners:{onCreate:[{funcName:"fluid.undo.refreshView",args:"{that}"},{"this":"{that}.dom.undoControl",method:"click",args:"{that}.undoControlClick"},{"this":"{that}.dom.redoControl",method:"click",args:"{that}.redoControlClick"}],"{fluid.undoable}.events.modelChanged":{funcName:"fluid.undo.modelChanged",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]}},selectors:{undoContainer:".flc-undo-undoControl",undoControl:".flc-undo-undoControl",redoContainer:".flc-undo-redoControl",redoControl:".flc-undo-redoControl"},strings:{undo:"undo edit",redo:"redo edit"},renderer:fluid.undo.defaultRenderer}),fluid.defaults("fluid.undoable",{gradeNames:["fluid.modelComponent"],invokers:{updateModel:{}},events:{modelChanged:null}}),fluid.defaults("fluid.undoDecorator",{gradeNames:["fluid.undo","autoInit"]})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.tooltip"),fluid.tooltip.computeContentFunc=function(that){that.contentFunc=that.options.contentFunc?that.options.contentFunc:that.modelToContentFunc()},fluid.tooltip.updateContentImpl=function(that){that.computeContentFunc(),that.initialised&&that.container.tooltip("option","content",that.contentFunc)},fluid.tooltip.updateContent=function(that,content){that.model.content!==content&&that.applier.requestChange("content",content)},fluid.tooltip.idSearchFunc=function(idToContentFunc){return function(){var target=this,idToContent=idToContentFunc(),ancestor=fluid.findAncestor(target,function(element){return idToContent[element.id]});return ancestor?idToContent[ancestor.id]:null}},fluid.tooltip.modelToContentFunc=function(that){var model=that.model;return model.idToContent?fluid.tooltip.idSearchFunc(function(){return that.model.idToContent}):model.content?function(){return model.content}:void 0},fluid.tooltip.makeOpenHandler=function(that){return function(event,tooltip){fluid.tooltip.closeAll(that);var originalTarget=fluid.resolveEventTarget(event);that.openIdMap[fluid.allocateSimpleId(originalTarget)]=!0,that.initialised&&that.events.afterOpen.fire(that,originalTarget,tooltip.tooltip,event)}},fluid.tooltip.makeCloseHandler=function(that){return function(event,tooltip){if(that.initialised){var originalTarget=fluid.resolveEventTarget(event);delete that.openIdMap[originalTarget.id],that.events.afterClose.fire(that,originalTarget,tooltip.tooltip,event)}}},fluid.tooltip.closeAll=function(that){fluid.each(that.openIdMap,function(value,key){var target=fluid.byId(key);that.container.tooltip("close",{type:"close",currentTarget:target,target:target})}),fluid.clear(that.openIdMap)},fluid.tooltip.setup=function(that){fluid.tooltip.updateContentImpl(that);var directOptions={content:that.contentFunc,open:fluid.tooltip.makeOpenHandler(that),close:fluid.tooltip.makeCloseHandler(that)},fullOptions=$.extend(!0,directOptions,that.options.widgetOptions);that.container.tooltip(fullOptions),that.initialised=!0},fluid.tooltip.doDestroy=function(that){that.initialised&&(fluid.tooltip.closeAll(that),$.contains(document,that.container[0])&&that.container.tooltip("destroy"),that.initialised=!1)},fluid.defaults("fluid.tooltip",{gradeNames:["fluid.viewComponent","autoInit"],widgetOptions:{tooltipClass:"{that}.options.styles.tooltip",position:"{that}.options.position",items:"{that}.options.items",show:{duration:"{that}.options.duration",delay:"{that}.options.delay"},hide:{duration:"{that}.options.duration",delay:"{that}.options.delay"}},invokers:{open:{"this":"{that}.container",method:"tooltip",args:"open"},close:{funcName:"fluid.tooltip.closeAll",args:"{that}"},updateContent:{funcName:"fluid.tooltip.updateContent",args:["{that}","{arguments}.0"]},computeContentFunc:{funcName:"fluid.tooltip.computeContentFunc",args:["{that}"]},modelToContentFunc:{funcName:"fluid.tooltip.modelToContentFunc",args:"{that}"}},model:{content:"{that}.options.content"},members:{openIdMap:{}},styles:{tooltip:""},events:{afterOpen:null,afterClose:null},listeners:{onCreate:"fluid.tooltip.setup",onDestroy:"fluid.tooltip.doDestroy"},modelListeners:{"":{funcName:"fluid.tooltip.updateContentImpl",args:"{that}"}},position:{my:"left top",at:"left bottom",offset:"0 5"},items:"*",delay:300})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.inlineEdit"),fluid.inlineEdit.sendKey=function(control,event,virtualCode,charCode){var kE=document.createEvent("KeyEvents");kE.initKeyEvent(event,1,1,null,0,0,0,0,virtualCode,charCode),control.dispatchEvent(kE)},fluid.setCaretToEnd=function(control,value){var pos=value?value.length:0;try{if(control.focus(),control.setSelectionRange)control.setSelectionRange(pos,pos),$.browser.mozilla&&pos>0&&(fluid.inlineEdit.sendKey(control,"keypress",92,92),fluid.inlineEdit.sendKey(control,"keydown",8,0),fluid.inlineEdit.sendKey(control,"keypress",8,0));else if(control.createTextRange){var range=control.createTextRange();range.move("character",pos),range.select()}}catch(e){}},fluid.inlineEdit.switchToViewMode=function(that){that.editContainer.hide(),that.displayModeRenderer.show()},fluid.inlineEdit.cancel=function(that){that.isEditing()&&(setTimeout(function(){that.editView.value(that.model.value)},1),fluid.inlineEdit.switchToViewMode(that),that.events.afterFinishEdit.fire(that.model.value,that.model.value,that.editField[0],that.viewEl[0]))},fluid.inlineEdit.finish=function(that){var newValue=that.editView.value(),oldValue=that.model.value,viewNode=that.viewEl[0],editNode=that.editField[0],ret=that.events.onFinishEdit.fire(newValue,oldValue,editNode,viewNode);ret!==!1&&(that.updateModelValue(newValue),that.events.afterFinishEdit.fire(newValue,oldValue,editNode,viewNode),fluid.inlineEdit.switchToViewMode(that))},fluid.inlineEdit.bindEditFinish=function(that){function keyCode(evt){return evt.keyCode?evt.keyCode:evt.which?evt.which:0}void 0===that.options.submitOnEnter&&(that.options.submitOnEnter="textarea"!==fluid.unwrap(that.editField).nodeName.toLowerCase());var button=that.textEditButton||$(),escHandler=function(evt){var code=keyCode(evt);return code===$.ui.keyCode.ESCAPE?(button.focus(),fluid.inlineEdit.cancel(that),!1):void 0},finishHandler=function(evt){var code=keyCode(evt);return code!==$.ui.keyCode.ENTER?(button.blur(),!0):(fluid.inlineEdit.finish(that),button.focus(),!1)};that.options.submitOnEnter&&that.editContainer.keypress(finishHandler),that.editContainer.keydown(escHandler)},fluid.inlineEdit.bindBlurHandler=function(that){if(that.options.blurHandlerBinder)that.options.blurHandlerBinder(that);else{var blurHandler=function(){return that.isEditing()&&fluid.inlineEdit.finish(that),!1};that.editField.blur(blurHandler)}},fluid.inlineEdit.initializeEditView=function(that,initial){that.editInitialized||(fluid.inlineEdit.renderEditContainer(that,!that.options.lazyEditView||!initial),that.options.lazyEditView&&initial||(that.events.onCreateEditView.fire(),that.textEditButton&&fluid.inlineEdit.bindEditFinish(that),fluid.inlineEdit.bindBlurHandler(that),that.editView.refreshView(that),that.editInitialized=!0))},fluid.inlineEdit.edit=function(that){fluid.inlineEdit.initializeEditView(that,!1);var viewEl=that.viewEl,displayText=that.displayView.value();that.updateModelValue(""===that.model.value?"":displayText),that.options.applyEditPadding&&that.editField.width(Math.max(viewEl.width()+that.options.paddings.edit,that.options.paddings.minimumEdit)),that.displayModeRenderer.hide(),that.editContainer.show(),setTimeout(function(){fluid.setCaretToEnd(that.editField[0],that.editView.value()),that.options.selectOnEdit&&that.editField[0].select()},0),that.events.afterBeginEdit.fire()},fluid.inlineEdit.clearEmptyViewStyles=function(textEl,styles,originalViewPadding){textEl.removeClass(styles.defaultViewStyle),textEl.css("padding-right",originalViewPadding),textEl.removeClass(styles.emptyDefaultViewText)},fluid.inlineEdit.showDefaultViewText=function(that){that.displayView.value(that.options.strings.defaultViewText),that.viewEl.css("padding-right",that.existingPadding),that.viewEl.addClass(that.options.styles.defaultViewStyle)},fluid.inlineEdit.showNothing=function(that){that.displayView.value(""),$.browser.msie&&"inline"===that.viewEl.css("display")&&that.viewEl.css("display","inline-block")},fluid.inlineEdit.showEditedText=function(that){that.displayView.value(that.model.value),fluid.inlineEdit.clearEmptyViewStyles(that.viewEl,that.options.styles,that.existingPadding)},fluid.inlineEdit.refreshView=function(that,source){that.displayView.refreshView(that,source),that.editView&&that.editView.refreshView(that,source)},fluid.inlineEdit.updateModelValue=function(that,newValue,source){var comparator=that.options.modelComparator,unchanged=comparator?comparator(that.model.value,newValue):that.model.value===newValue;if(!unchanged){var oldModel=$.extend(!0,{},that.model);that.model.value=newValue,that.events.modelChanged.fire(that.model,oldModel,source),that.refreshView(source)}},fluid.inlineEdit.editHandler=function(that){var prevent=that.events.onBeginEdit.fire();return prevent===!1?!1:(fluid.inlineEdit.edit(that),!0)},fluid.inlineEdit.initTooltips=function(that){var tooltipOptions={content:that.options.tooltipText,position:{my:"left top",at:"left bottom",offset:"0 5"},target:"*",delay:that.options.tooltipDelay,styles:{tooltip:that.options.styles.tooltip}};fluid.tooltip(that.viewEl,tooltipOptions),that.textEditButton&&fluid.tooltip(that.textEditButton,tooltipOptions)},fluid.inlineEdit.calculateInitialPadding=function(viewEl){var padding=viewEl.css("padding-right");return padding?parseFloat(padding):0},fluid.inlineEdit.setupEditField=function(editStyle,editField,editFieldMarkup){var eField=$(editField);return eField=eField.length?eField:$(editFieldMarkup),eField.addClass(editStyle),eField},fluid.inlineEdit.setupEditContainer=function(displayContainer,editField,editContainer,editContainerMarkup){var eContainer=$(editContainer);return eContainer=eContainer.length?eContainer:$(editContainerMarkup),displayContainer.after(eContainer),eContainer.append(editField),eContainer},fluid.inlineEdit.defaultEditModeRenderer=function(that){var editField=fluid.inlineEdit.setupEditField(that.options.styles.edit,that.editField,that.options.markup.editField),editContainer=fluid.inlineEdit.setupEditContainer(that.displayModeRenderer,editField,that.editContainer,that.options.markup.editContainer),editModeInstruction=fluid.inlineEdit.setupEditModeInstruction(that.options.styles.editModeInstruction,that.options.strings.editModeInstruction,that.options.markup.editModeInstruction),id=fluid.allocateSimpleId(editModeInstruction);return editField.attr("aria-describedby",id),fluid.inlineEdit.positionEditModeInstruction(editModeInstruction,editContainer,editField),{container:editContainer,field:editField}},fluid.inlineEdit.renderEditContainer=function(that,lazyEditView){if(that.editContainer=that.locate("editContainer"),that.editField=that.locate("edit"),1!==that.editContainer.length&&that.editContainer.length>1&&fluid.fail("InlineEdit did not find a unique container for selector "+that.options.selectors.editContainer+": "+fluid.dumpEl(that.editContainer)),lazyEditView){var editElms=that.options.editModeRenderer(that);editElms&&(that.editContainer=editElms.container,that.editField=editElms.field)}},fluid.inlineEdit.setupEditModeInstruction=function(editModeInstructionStyle,editModeInstructionText,editModeInstructionMarkup){var editModeInstruction=$(editModeInstructionMarkup);return editModeInstruction.addClass(editModeInstructionStyle),editModeInstruction.text(editModeInstructionText),editModeInstruction},fluid.inlineEdit.positionEditModeInstruction=function(editModeInstruction,editContainer,editField){editContainer.append(editModeInstruction),editField.focus(function(){editModeInstruction.show();var editFieldPosition=editField.offset();editModeInstruction.css({left:editFieldPosition.left}),editModeInstruction.css({top:editFieldPosition.top+editField.height()+5})})},fluid.inlineEdit.setupDisplayModeContainer=function(styles,displayModeWrapper){var displayModeContainer=$(displayModeWrapper);return displayModeContainer=displayModeContainer.length?displayModeContainer:$("<span></span>"),displayModeContainer.addClass(styles.displayView),displayModeContainer},fluid.inlineEdit.setupDisplayText=function(viewEl,textStyle){return viewEl.attr("tabindex","-1"),viewEl.addClass(textStyle),viewEl},fluid.inlineEdit.setupTextEditButton=function(that,model){var opts=that.options,textEditButton=that.locate("textEditButton");if(0===textEditButton.length){var markup=$(that.options.markup.textEditButton);markup.addClass(opts.styles.textEditButton),markup.text(opts.tooltipText),fluid.inlineEdit.updateTextEditButton(markup,model.value||opts.strings.defaultViewText,opts.strings.textEditButton),that.events.modelChanged.addListener(function(){fluid.inlineEdit.updateTextEditButton(markup,model.value||opts.strings.defaultViewText,opts.strings.textEditButton)}),that.locate("text").after(markup),textEditButton=that.locate("textEditButton")}return textEditButton},fluid.inlineEdit.updateTextEditButton=function(textEditButton,value,stringTemplate){var buttonText=fluid.stringTemplate(stringTemplate,{text:value});textEditButton.text(buttonText)},fluid.inlineEdit.bindHoverHandlers=function(displayModeRenderer,invitationStyle){var over=function(){displayModeRenderer.addClass(invitationStyle)},out=function(){displayModeRenderer.removeClass(invitationStyle)};displayModeRenderer.hover(over,out)},fluid.inlineEdit.bindHighlightHandler=function(element,displayModeRenderer,styles,strings,model){element=$(element);var makeFocusSwitcher=function(focusOn){return function(){displayModeRenderer.toggleClass(styles.focus,focusOn),displayModeRenderer.toggleClass(styles.invitation,focusOn),model&&model.value||displayModeRenderer.prevObject.text(focusOn?strings.defaultFocussedViewText:strings.defaultViewText)}};element.focus(makeFocusSwitcher(!0)),element.blur(makeFocusSwitcher(!1))},fluid.inlineEdit.bindMouseHandlers=function(element,edit){element=$(element);var triggerGuard=fluid.inlineEdit.makeEditTriggerGuard(element,edit);element.click(function(e){return triggerGuard(e),!1})},fluid.inlineEdit.bindKeyboardHandlers=function(element,edit){element=$(element),element.attr("role","button");var guard=fluid.inlineEdit.makeEditTriggerGuard(element,edit);fluid.activatable(element,function(event){return guard(event)})},fluid.inlineEdit.makeEditTriggerGuard=function(jElement,edit){var element=fluid.unwrap(jElement);return function(event){var outer=fluid.findAncestor(event.target,function(elem){return/input|select|textarea|button|a/i.test(elem.nodeName)||elem===element?!0:void 0});return outer===element?(edit(),!1):void 0}},fluid.inlineEdit.bindEventHandlers=function(that,edit,displayModeContainer){var styles=that.options.styles;fluid.inlineEdit.bindHoverHandlers(displayModeContainer,styles.invitation),fluid.inlineEdit.bindMouseHandlers(that.viewEl,edit),fluid.inlineEdit.bindMouseHandlers(that.textEditButton,edit),fluid.inlineEdit.bindKeyboardHandlers(that.textEditButton,edit),fluid.inlineEdit.bindHighlightHandler(that.viewEl,displayModeContainer,that.options.styles,that.options.strings,that.model),fluid.inlineEdit.bindHighlightHandler(that.textEditButton,displayModeContainer,that.options.styles,that.options.strings,that.model)},fluid.inlineEdit.defaultDisplayModeRenderer=function(that,edit,model){var styles=that.options.styles,displayModeWrapper=fluid.inlineEdit.setupDisplayModeContainer(styles);return displayModeContainer=that.viewEl.wrap(displayModeWrapper).parent(),that.textEditButton=fluid.inlineEdit.setupTextEditButton(that,model),displayModeContainer.append(that.textEditButton),fluid.inlineEdit.bindEventHandlers(that,edit,displayModeContainer),displayModeContainer},fluid.inlineEdit.getNodeName=function(element){return fluid.unwrap(element).nodeName.toLowerCase()},fluid.defaults("fluid.inlineEdit.standardAccessor",{gradeNames:["fluid.viewComponent","autoInit"],members:{nodeName:{expander:{funcName:"fluid.inlineEdit.getNodeName",args:"{that}.container"}}},invokers:{value:{funcName:"fluid.inlineEdit.standardAccessor.value",args:["{that}.nodeName","{that}.container","{arguments}.0"]}}}),fluid.inlineEdit.standardAccessor.value=function(nodeName,element,newValue){return fluid["input"===nodeName||"textarea"===nodeName?"value":"text"]($(element),newValue)},fluid.defaults("fluid.inlineEdit.standardDisplayView",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{refreshView:{funcName:"fluid.inlineEdit.standardDisplayView.refreshView",args:["{fluid.inlineEdit}","{that}.container","{arguments}.0"]}}}),fluid.inlineEdit.standardDisplayView.refreshView=function(componentThat){componentThat.model.value?fluid.inlineEdit.showEditedText(componentThat):componentThat.options.strings.defaultViewText?fluid.inlineEdit.showDefaultViewText(componentThat):fluid.inlineEdit.showNothing(componentThat),0===$.trim(componentThat.viewEl.text()).length&&(componentThat.viewEl.addClass(componentThat.options.styles.emptyDefaultViewText),componentThat.existingPadding<componentThat.options.paddings.minimumView&&componentThat.viewEl.css("padding-right",componentThat.options.paddings.minimumView))},fluid.defaults("fluid.inlineEdit.standardEditView",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{refreshView:{funcName:"fluid.inlineEdit.standardEditView.refreshView",args:["{fluid.inlineEdit}","{that}.container","{arguments}.0"]}}}),fluid.inlineEdit.standardEditView.refreshView=function(componentThat,editField,source){(!source||editField&&-1===editField.index(source))&&componentThat.editView.value(componentThat.model.value)},fluid.inlineEdit.setup=function(that){that.editContainer&&that.editContainer.hide(),that.tooltipEnabled()&&fluid.inlineEdit.initTooltips(that)},fluid.inlineEdit.setIsEditing=function(that,state){that.isEditingState=state},fluid.inlineEdit.tooltipEnabled=function(useTooltip){return useTooltip&&$.fn.tooltip},fluid.inlineEdit.processUndoDecorator=function(that){if(that.options.componentDecorators){var decorators=fluid.makeArray(that.options.componentDecorators),decorator=decorators[0];"string"==typeof decorator&&(decorator={type:decorator}),"fluid.undoDecorator"===decorator.type&&(fluid.set(that.options,["components","undo"],{type:"fluid.undo",options:decorator.options}),that.decorators=[fluid.initDependent(that,"undo")])}},fluid.defaults("fluid.inlineEdit",{gradeNames:["fluid.viewComponent","fluid.undoable","autoInit"],mergePolicy:{"strings.defaultViewText":"defaultViewText"},members:{isEditingState:!1,viewEl:{expander:{funcName:"fluid.inlineEdit.setupDisplayText",args:["{that}.dom.text","{that}.options.styles.text"]}},existingPadding:{expander:{funcName:"fluid.inlineEdit.calculateInitialPadding",args:"{that}.viewEl"}},displayModeRenderer:{expander:{func:"{that}.options.displayModeRenderer",args:["{that}","{that}.edit","{that}.model"]}}},invokers:{edit:{funcName:"fluid.inlineEdit.editHandler",args:"{that}"},isEditing:{funcName:"fluid.identity",args:"{that}.isEditingState",dynamic:!0},finish:{funcName:"fluid.inlineEdit.finish",args:"{that}"},cancel:{funcName:"fluid.inlineEdit.cancel",args:"{that}"},tooltipEnabled:{funcName:"fluid.inlineEdit.tooltipEnabled",args:"{that}.options.useTooltip"},refreshView:{funcName:"fluid.inlineEdit.refreshView",args:["{that}","{arguments}.0"]},updateModelValue:{funcName:"fluid.inlineEdit.updateModelValue",args:["{that}","{arguments}.0","{arguments}.1"]},updateModel:{funcName:"fluid.inlineEdit.updateModelValue",args:["{that}","{arguments}.0.value","{arguments}.1"]}},components:{displayView:{type:"{that}.options.displayView.type",container:"{that}.viewEl",options:{gradeNames:"{fluid.inlineEdit}.options.displayAccessor.type"}},editView:{type:"{that}.options.editView.type",createOnEvent:"onCreateEditView",container:"{that}.editField",options:{gradeNames:"{fluid.inlineEdit}.options.editAccessor.type"}}},model:{value:{expander:{func:"{that}.displayView.value"}}},selectors:{text:".flc-inlineEdit-text",editContainer:".flc-inlineEdit-editContainer",edit:".flc-inlineEdit-edit",textEditButton:".flc-inlineEdit-textEditButton"},styles:{text:"fl-inlineEdit-text",edit:"fl-inlineEdit-edit",invitation:"fl-inlineEdit-invitation",defaultViewStyle:"fl-inlineEdit-emptyText-invitation",emptyDefaultViewText:"fl-inlineEdit-emptyDefaultViewText",focus:"fl-inlineEdit-focus",tooltip:"fl-inlineEdit-tooltip",editModeInstruction:"fl-inlineEdit-editModeInstruction",displayView:"fl-inlineEdit-simple-editableText fl-inlineEdit-textContainer",textEditButton:"fl-offScreen-hidden"},events:{modelChanged:null,onBeginEdit:"preventable",afterBeginEdit:null,onFinishEdit:"preventable",afterFinishEdit:null,afterInitEdit:null,onCreateEditView:null},listeners:{onCreate:[{func:"{that}.refreshView"},{funcName:"fluid.inlineEdit.initializeEditView",args:["{that}",!0]},{funcName:"fluid.inlineEdit.setup",args:"{that}"},{funcName:"fluid.inlineEdit.processUndoDecorator",args:"{that}"}],onBeginEdit:{funcName:"fluid.inlineEdit.setIsEditing",args:["{that}",!0]},afterFinishEdit:{funcName:"fluid.inlineEdit.setIsEditing",args:["{that}",!1]}},strings:{textEditButton:"Edit text %text",editModeInstruction:"Escape to cancel, Enter or Tab when finished",defaultViewText:"Click here to edit",defaultFocussedViewText:"Click here or press enter to edit"},markup:{editField:"<input type='text' class='flc-inlineEdit-edit'/>",editContainer:"<span></span>",editModeInstruction:"<p></p>",textEditButton:"<a href='#_' class='flc-inlineEdit-textEditButton'></a>"},paddings:{edit:10,minimumEdit:80,minimumView:60},applyEditPadding:!0,blurHandlerBinder:null,submitOnEnter:void 0,modelComparator:null,displayAccessor:{type:"fluid.inlineEdit.standardAccessor"},displayView:{type:"fluid.inlineEdit.standardDisplayView"},editAccessor:{type:"fluid.inlineEdit.standardAccessor"},editView:{type:"fluid.inlineEdit.standardEditView"},displayModeRenderer:fluid.inlineEdit.defaultDisplayModeRenderer,editModeRenderer:fluid.inlineEdit.defaultEditModeRenderer,lazyEditView:!1,useTooltip:!0,tooltipText:"Select or press Enter to edit",tooltipDelay:1e3,selectOnEdit:!1}),fluid.setupInlineEdits=function(that,editables){return fluid.transform(editables,function(editable,i){var componentDef={type:"fluid.inlineEdit",container:editable},name="inlineEdit-"+i;return fluid.set(that.options,["components",name],componentDef),fluid.initDependent(that,name)})},fluid.defaults("fluid.inlineEdits",{gradeNames:["fluid.viewComponent","autoInit"],distributeOptions:{source:"{that}.options",exclusions:["members.inlineEdits","selectors.editables"],removeSource:!0,target:"{that > fluid.inlineEdit}.options"},members:{inlineEdits:{expander:{funcName:"fluid.setupInlineEdits",args:["{that}","{that}.dom.editables"]}}},returnedPath:"inlineEdits",selectors:{editables:".flc-inlineEditable"}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.inlineEdit.editorViewAccessor",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{value:{funcName:"fluid.inlineEdit.editorViewAccessor.value",args:["{that}.container","{that}.options","{arguments}.0"]}}}),fluid.inlineEdit.editorViewAccessor.value=function(editField,options,newValue){var editor=options.editorGetFn(editField);return editor&&0!==editor.length?void 0===newValue?options.getValueFn(editor):void options.setValueFn(editField,editor,newValue):(void 0!==newValue&&$(editField).val(newValue),"")},fluid.defaults("fluid.inlineEdit.richTextViewAccessor",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{value:{funcName:"fluid.inlineEdit.richTextViewAccessor.value",args:["{that}.container","{arguments}.0"]}}}),fluid.inlineEdit.richTextViewAccessor.value=function(element,newValue){return fluid.html(element,newValue)},fluid.inlineEdit.normalizeHTML=function(value){var togo=$.trim(value.replace(/\s+/g," "));return togo=togo.replace(/\s+<\//g,"</"),togo=togo.replace(/\<([a-z0-9A-Z\/]+)\>/g,function(match){return match.toLowerCase()})},fluid.inlineEdit.htmlComparator=function(el1,el2){return fluid.inlineEdit.normalizeHTML(el1)===fluid.inlineEdit.normalizeHTML(el2)},fluid.inlineEdit.bindRichTextHighlightHandler=function(element,displayModeRenderer,invitationStyle){element=$(element);var focusOn=function(){displayModeRenderer.addClass(invitationStyle)},focusOff=function(){displayModeRenderer.removeClass(invitationStyle)};element.focus(focusOn),element.blur(focusOff)},fluid.inlineEdit.setupRichTextEditButton=function(that){var opts=that.options,textEditButton=that.locate("textEditButton");if(0===textEditButton.length){var markup=$("<a href='#_' class='flc-inlineEdit-textEditButton'></a>");markup.text(opts.strings.textEditButton),that.locate("text").after(markup),textEditButton=that.locate("textEditButton")}return textEditButton},fluid.inlineEdit.richTextDisplayModeRenderer=function(that,edit){var styles=that.options.styles,displayModeWrapper=fluid.inlineEdit.setupDisplayModeContainer(styles),displayModeRenderer=that.viewEl.wrap(displayModeWrapper).parent();return that.textEditButton=fluid.inlineEdit.setupRichTextEditButton(that),displayModeRenderer.append(that.textEditButton),displayModeRenderer.addClass(styles.focus),fluid.inlineEdit.bindHoverHandlers(displayModeRenderer,styles.invitation),fluid.inlineEdit.bindMouseHandlers(that.textEditButton,edit),fluid.inlineEdit.bindKeyboardHandlers(that.textEditButton,edit),fluid.inlineEdit.bindRichTextHighlightHandler(that.viewEl,displayModeRenderer,styles.invitation),fluid.inlineEdit.bindRichTextHighlightHandler(that.textEditButton,displayModeRenderer,styles.invitation),displayModeRenderer};var flTinyMCE=fluid.registerNamespace("fluid.inlineEdit.tinyMCE");fluid.inlineEdit.tinyMCE.getEditor=function(editField){return tinyMCE.get(editField.prop("id"))},fluid.inlineEdit.tinyMCE.setValue=function(editField,editor,value){$(editField).val(value),editor.setContent(value,{format:"raw"})},fluid.inlineEdit.tinyMCE.getValue=function(editor){return editor.getContent()},fluid.defaults("fluid.inlineEdit.tinyMCE.viewAccessor",{gradeNames:["fluid.inlineEdit.editorViewAccessor","autoInit"],editorGetFn:flTinyMCE.getEditor,setValueFn:flTinyMCE.setValue,getValueFn:flTinyMCE.getValue}),fluid.inlineEdit.tinyMCE.blurHandlerBinder=function(that){function focusEditor(editor){setTimeout(function(){tinyMCE.execCommand("mceFocus",!1,that.editField[0].id),editor.selection.select(editor.getBody(),1),editor.selection.collapse(0)},10)}that.events.afterInitEdit.addListener(function(editor){focusEditor(editor);var editorBody=editor.getBody();that.deadMansBlur=fluid.deadMansBlur(that.editField,{cancelByDefault:!0,exclusions:{body:$(editorBody),container:that.container},handler:function(){that[that.options.onBlur]()}}),editor.controlManager.onAdd.add(function(e){e.onShowMenu&&e.onShowMenu.add(function(){var el=fluid.byId(e.element.id);el&&that.deadMansBlur.addExclusion({id:el})})})}),that.events.afterBeginEdit.addListener(function(){var editor=tinyMCE.get(that.editField[0].id);editor&&focusEditor(editor),that.deadMansBlur&&that.deadMansBlur.reArm()}),that.events.afterFinishEdit.addListener(function(){that.deadMansBlur.noteProceeded()})},fluid.inlineEdit.tinyMCE.editModeRenderer=function(that){var options=that.options.tinyMCE;options.elements=fluid.allocateSimpleId(that.editField);var oldinit=options.init_instance_callback;options.init_instance_callback=function(instance){that.events.afterInitEdit.fire(instance),oldinit&&oldinit()},setTimeout(function(){tinyMCE.init(options)},1)},fluid.defaults("fluid.inlineEdit.tinyMCE",{gradeNames:["fluid.inlineEdit","autoInit"],tinyMCE:{mode:"exact",theme:"simple"},listeners:{onCreate:{"this":"tinyMCE",method:"init",namespace:"initTinyMCE",args:"{that}.options.tinyMCE"}},useTooltip:!0,selectors:{edit:"textarea"},styles:{invitation:"fl-inlineEdit-richText-invitation",displayView:"fl-inlineEdit-textContainer",text:""},strings:{textEditButton:"Edit"},displayAccessor:{type:"fluid.inlineEdit.richTextViewAccessor"},editAccessor:{type:"fluid.inlineEdit.tinyMCE.viewAccessor"},lazyEditView:!0,defaultViewText:"Click Edit",modelComparator:fluid.inlineEdit.htmlComparator,onBlur:"finish",blurHandlerBinder:fluid.inlineEdit.tinyMCE.blurHandlerBinder,displayModeRenderer:fluid.inlineEdit.richTextDisplayModeRenderer,editModeRenderer:fluid.inlineEdit.tinyMCE.editModeRenderer});var flCKEditor=fluid.registerNamespace("fluid.inlineEdit.CKEditor");fluid.inlineEdit.CKEditor.getEditor=function(editField){return CKEDITOR.instances[editField.prop("id")]},fluid.inlineEdit.CKEditor.setValue=function(editField,editor,value){editor.setData(value)},fluid.inlineEdit.CKEditor.getValue=function(editor){return editor.getData()},fluid.defaults("fluid.inlineEdit.CKEditor.viewAccessor",{gradeNames:["fluid.inlineEdit.editorViewAccessor","autoInit"],editorGetFn:flCKEditor.getEditor,setValueFn:flCKEditor.setValue,getValueFn:flCKEditor.getValue}),fluid.inlineEdit.CKEditor.focus=function(editor){setTimeout(function(){editor.focus()},0)},fluid.inlineEdit.CKEditor.normalizeHTML=function(value){var togo=fluid.inlineEdit.normalizeHTML(value),angpos=togo.indexOf(">");return-1!==angpos&&angpos<togo.length-1&&" "!==togo.charAt(angpos+1)&&(togo=togo.substring(0,angpos+1)+" "+togo.substring(angpos+1)),togo},fluid.inlineEdit.CKEditor.htmlComparator=function(el1,el2){return fluid.inlineEdit.CKEditor.normalizeHTML(el1)===fluid.inlineEdit.CKEditor.normalizeHTML(el2)},fluid.inlineEdit.CKEditor.blurHandlerBinder=function(that){that.events.afterInitEdit.addListener(fluid.inlineEdit.CKEditor.focus),that.events.afterBeginEdit.addListener(function(){var editor=fluid.inlineEdit.CKEditor.getEditor(that.editField);editor&&fluid.inlineEdit.CKEditor.focus(editor)})},fluid.inlineEdit.CKEditor.editModeRenderer=function(that){var id=fluid.allocateSimpleId(that.editField);$.data(fluid.unwrap(that.editField),"fluid.inlineEdit.CKEditor",that);var editor=CKEDITOR.replace(id,that.options.CKEditor);editor.on("instanceReady",function(e){fluid.inlineEdit.CKEditor.focus(e.editor),that.events.afterInitEdit.fire(e.editor)})},fluid.defaults("fluid.inlineEdit.CKEditor",{gradeNames:["fluid.inlineEdit","autoInit"],selectors:{edit:"textarea"},styles:{invitation:"fl-inlineEdit-richText-invitation",displayView:"fl-inlineEdit-textContainer",text:""},strings:{textEditButton:"Edit"},displayAccessor:{type:"fluid.inlineEdit.richTextViewAccessor"},editAccessor:{type:"fluid.inlineEdit.CKEditor.viewAccessor"},lazyEditView:!0,defaultViewText:"Click Edit",modelComparator:fluid.inlineEdit.CKEditor.htmlComparator,blurHandlerBinder:fluid.inlineEdit.CKEditor.blurHandlerBinder,displayModeRenderer:fluid.inlineEdit.richTextDisplayModeRenderer,editModeRenderer:fluid.inlineEdit.CKEditor.editModeRenderer,CKEditor:{}}),fluid.registerNamespace("fluid.inlineEdit.dropdown"),fluid.inlineEdit.dropdown.editModeRenderer=function(that){fluid.allocateSimpleId(that.editField);return that.editField.selectbox({finishHandler:function(){that.finish()}}),{container:that.editContainer,field:$("input.selectbox",that.editContainer)}},fluid.inlineEdit.dropdown.blurHandlerBinder=function(that){fluid.deadMansBlur(that.editField,{exclusions:{selectBox:$("div.selectbox-wrapper",that.editContainer)},handler:function(){that.cancel()}})},fluid.defaults("fluid.inlineEdit.dropdown",{gradeNames:["fluid.inlineEdit","autoInit"],applyEditPadding:!1,blurHandlerBinder:fluid.inlineEdit.dropdown.blurHandlerBinder,editModeRenderer:fluid.inlineEdit.dropdown.editModeRenderer})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.XMLP=function(strXML){return fluid.XMLP.XMLPImpl(strXML)},fluid.XMLP.closedTags={abbr:!0,br:!0,col:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,hr:!0,area:!0,embed:!0},fluid.XMLP._NONE=0,fluid.XMLP._ELM_B=1,fluid.XMLP._ELM_E=2,fluid.XMLP._ELM_EMP=3,fluid.XMLP._ATT=4,fluid.XMLP._TEXT=5,fluid.XMLP._ENTITY=6,fluid.XMLP._PI=7,fluid.XMLP._CDATA=8,fluid.XMLP._COMMENT=9,fluid.XMLP._DTD=10,fluid.XMLP._ERROR=11,fluid.XMLP._CONT_XML=0,fluid.XMLP._CONT_ALT=1,fluid.XMLP._ATT_NAME=0,fluid.XMLP._ATT_VAL=1,fluid.XMLP._STATE_PROLOG=1,fluid.XMLP._STATE_DOCUMENT=2,fluid.XMLP._STATE_MISC=3,fluid.XMLP._errs=[],fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_PI=0]="PI: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_DTD=1]="DTD: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_COMMENT=2]="Comment: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_CDATA=3]="CDATA: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_ELM=4]="Element: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_CLOSE_ENTITY=5]="Entity: missing closing sequence",fluid.XMLP._errs[fluid.XMLP.ERR_PI_TARGET=6]="PI: target is required",fluid.XMLP._errs[fluid.XMLP.ERR_ELM_EMPTY=7]="Element: cannot be both empty and closing",fluid.XMLP._errs[fluid.XMLP.ERR_ELM_NAME=8]='Element: name must immediately follow "<"',fluid.XMLP._errs[fluid.XMLP.ERR_ELM_LT_NAME=9]='Element: "<" not allowed in element names',fluid.XMLP._errs[fluid.XMLP.ERR_ATT_VALUES=10]="Attribute: values are required and must be in quotes",fluid.XMLP._errs[fluid.XMLP.ERR_ATT_LT_NAME=11]='Element: "<" not allowed in attribute names',fluid.XMLP._errs[fluid.XMLP.ERR_ATT_LT_VALUE=12]='Attribute: "<" not allowed in attribute values',fluid.XMLP._errs[fluid.XMLP.ERR_ATT_DUP=13]="Attribute: duplicate attributes not allowed",fluid.XMLP._errs[fluid.XMLP.ERR_ENTITY_UNKNOWN=14]="Entity: unknown entity",fluid.XMLP._errs[fluid.XMLP.ERR_INFINITELOOP=15]="Infinite loop",fluid.XMLP._errs[fluid.XMLP.ERR_DOC_STRUCTURE=16]="Document: only comments, processing instructions, or whitespace allowed outside of document element",fluid.XMLP._errs[fluid.XMLP.ERR_ELM_NESTING=17]="Element: must be nested correctly",fluid.XMLP._checkStructure=function(that,iEvent){var stack=that.m_stack;if(fluid.XMLP._STATE_PROLOG==that.m_iState&&(that.m_iState=fluid.XMLP._STATE_DOCUMENT),fluid.XMLP._STATE_DOCUMENT===that.m_iState&&((fluid.XMLP._ELM_B==iEvent||fluid.XMLP._ELM_EMP==iEvent)&&(that.m_stack[stack.length]=that.getName()),fluid.XMLP._ELM_E==iEvent||fluid.XMLP._ELM_EMP==iEvent)){if(0===stack.length)return fluid.XMLP._NONE;var strTop=stack[stack.length-1];if(that.m_stack.length--,null===strTop||strTop!==that.getName())return that._setErr(that,fluid.XMLP.ERR_ELM_NESTING)}return iEvent},fluid.XMLP._parseCDATA=function(that,iB){var iE=that.m_xml.indexOf("]]>",iB);return-1==iE?fluid.XMLP._setErr(that,fluid.XMLP.ERR_CLOSE_CDATA):(fluid.XMLP._setContent(that,fluid.XMLP._CONT_XML,iB,iE),that.m_iP=iE+3,fluid.XMLP._CDATA)},fluid.XMLP._parseComment=function(that,iB){var iE=that.m_xml.indexOf("-->",iB);return-1==iE?fluid.XMLP._setErr(that,fluid.XMLP.ERR_CLOSE_COMMENT):(fluid.XMLP._setContent(that,fluid.XMLP._CONT_XML,iB-4,iE+3),that.m_iP=iE+3,fluid.XMLP._COMMENT)},fluid.XMLP._parseDTD=function(that,iB){var iE,strClose,iInt,iLast;if(iE=that.m_xml.indexOf(">",iB),-1==iE)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_CLOSE_DTD);for(iInt=that.m_xml.indexOf("[",iB),strClose=-1!=iInt&&iE>iInt?"]>":">";;){if(iE==iLast)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_INFINITELOOP);if(iLast=iE,iE=that.m_xml.indexOf(strClose,iB),-1==iE)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_CLOSE_DTD);if("]]>"!=that.m_xml.substring(iE-1,iE+2))break}return that.m_iP=iE+strClose.length,fluid.XMLP._DTD},fluid.XMLP._parsePI=function(that,iB){var iE,iTB,iTE,iCB,iCE;return iE=that.m_xml.indexOf("?>",iB),-1==iE?fluid.XMLP._setErr(that,fluid.XMLP.ERR_CLOSE_PI):(iTB=fluid.SAXStrings.indexOfNonWhitespace(that.m_xml,iB,iE),-1==iTB?fluid.XMLP._setErr(that,fluid.XMLP.ERR_PI_TARGET):(iTE=fluid.SAXStrings.indexOfWhitespace(that.m_xml,iTB,iE),-1==iTE&&(iTE=iE),iCB=fluid.SAXStrings.indexOfNonWhitespace(that.m_xml,iTE,iE),-1==iCB&&(iCB=iE),iCE=fluid.SAXStrings.lastIndexOfNonWhitespace(that.m_xml,iCB,iE),-1==iCE&&(iCE=iE-1),that.m_name=that.m_xml.substring(iTB,iTE),fluid.XMLP._setContent(that,fluid.XMLP._CONT_XML,iCB,iCE+1),that.m_iP=iE+2,fluid.XMLP._PI))},fluid.XMLP._parseText=function(that,iB){var iE=that.m_xml.indexOf("<",iB);return-1==iE&&(iE=that.m_xml.length),fluid.XMLP._setContent(that,fluid.XMLP._CONT_XML,iB,iE),that.m_iP=iE,fluid.XMLP._TEXT},fluid.XMLP._setContent=function(that,iSrc){var args=arguments;fluid.XMLP._CONT_XML==iSrc?(that.m_cAlt=null,that.m_cB=args[2],that.m_cE=args[3]):(that.m_cAlt=args[2],that.m_cB=0,that.m_cE=args[2].length),that.m_cSrc=iSrc},fluid.XMLP._setErr=function(that,iErr){var strErr=fluid.XMLP._errs[iErr];return that.m_cAlt=strErr,that.m_cB=0,that.m_cE=strErr.length,that.m_cSrc=fluid.XMLP._CONT_ALT,fluid.XMLP._ERROR},fluid.XMLP._parseElement=function(that,iB){var iE,iDE,iType,strN;if(iDE=iE=that.m_xml.indexOf(">",iB),-1==iE)return that._setErr(that,fluid.XMLP.ERR_CLOSE_ELM);if("/"==that.m_xml.charAt(iB)?(iType=fluid.XMLP._ELM_E,iB++):iType=fluid.XMLP._ELM_B,"/"==that.m_xml.charAt(iE-1)){if(iType==fluid.XMLP._ELM_E)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ELM_EMPTY);iType=fluid.XMLP._ELM_EMP,iDE--}that.nameRegex.lastIndex=iB;var nameMatch=that.nameRegex.exec(that.m_xml);if(!nameMatch)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ELM_NAME);if(strN=nameMatch[1].toLowerCase(),"li"===strN&&iType!==fluid.XMLP._ELM_E&&that.m_stack.length>0&&"li"===that.m_stack[that.m_stack.length-1]&&!that.m_emitSynthetic)return that.m_name="li",that.m_emitSynthetic=!0,fluid.XMLP._ELM_E;if(that.m_attributes={},that.m_cAlt="",that.nameRegex.lastIndex<iDE)for(that.m_iP=that.nameRegex.lastIndex;that.m_iP<iDE;){that.attrStartRegex.lastIndex=that.m_iP;var attrMatch=that.attrStartRegex.exec(that.m_xml);if(!attrMatch)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ATT_VALUES);var attrval,attrname=attrMatch[1].toLowerCase();if(61===that.m_xml.charCodeAt(that.attrStartRegex.lastIndex)){var valRegex=34===that.m_xml.charCodeAt(that.attrStartRegex.lastIndex+1)?that.attrValRegex:that.attrValIERegex;if(valRegex.lastIndex=that.attrStartRegex.lastIndex+1,attrMatch=valRegex.exec(that.m_xml),!attrMatch)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ATT_VALUES);attrval=attrMatch[1]}else attrval=attrname,valRegex=that.attrStartRegex;if(that.m_attributes[attrname]&&that.m_attributes[attrname]!==attrval)return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ATT_DUP);that.m_attributes[attrname]=attrval,that.m_iP=valRegex.lastIndex}if(-1!=strN.indexOf("<"))return fluid.XMLP._setErr(that,fluid.XMLP.ERR_ELM_LT_NAME);if(that.m_name=strN,that.m_iP=iE+1,fluid.XMLP.closedTags[strN]){that.closeRegex.lastIndex=iE+1;var closeMatch=that.closeRegex.exec;if(closeMatch){var matchclose=that.m_xml.indexOf(strN,closeMatch.lastIndex);return matchclose===closeMatch.lastIndex?iType:fluid.XMLP._ELM_EMP}}return that.m_emitSynthetic=!1,iType},fluid.XMLP._parse=function(that){var iP=that.m_iP,xml=that.m_xml;if(iP===xml.length)return fluid.XMLP._NONE;var c=xml.charAt(iP);if("<"!==c)return fluid.XMLP._parseText(that,iP);var c2=xml.charAt(iP+1);return"?"===c2?fluid.XMLP._parsePI(that,iP+2):"!"!==c2?fluid.XMLP._parseElement(that,iP+1):iP===xml.indexOf("<!DOCTYPE",iP)?fluid.XMLP._parseDTD(that,iP+9):iP===xml.indexOf("<!--",iP)?fluid.XMLP._parseComment(that,iP+4):iP===xml.indexOf("<![CDATA[",iP)?fluid.XMLP._parseCDATA(that,iP+9):void 0},fluid.XMLP.XMLPImpl=function(strXML){var that={};return that.m_xml=strXML,that.m_iP=0,that.m_iState=fluid.XMLP._STATE_PROLOG,that.m_stack=[],that.m_attributes={},that.m_emitSynthetic=!1,that.getColumnNumber=function(){return fluid.SAXStrings.getColumnNumber(that.m_xml,that.m_iP)},that.getContent=function(){return that.m_cSrc==fluid.XMLP._CONT_XML?that.m_xml:that.m_cAlt},that.getContentBegin=function(){return that.m_cB},that.getContentEnd=function(){return that.m_cE},that.getLineNumber=function(){return fluid.SAXStrings.getLineNumber(that.m_xml,that.m_iP)},that.getName=function(){return that.m_name},that.next=function(){return fluid.XMLP._checkStructure(that,fluid.XMLP._parse(that))},that.nameRegex=/([^\s\/>]+)/g,that.attrStartRegex=/\s*([\w:_][\w:_\-\.]*)/gm,that.attrValRegex=/\"([^\"]*)\"\s*/gm,that.attrValIERegex=/([^\>\s]+)\s*/gm,that.closeRegex=/\s*<\//g,that},fluid.SAXStrings={},fluid.SAXStrings.WHITESPACE=" 	\n\r",fluid.SAXStrings.QUOTES="\"'",fluid.SAXStrings.getColumnNumber=function(strD,iP){if(!strD)return-1;iP=iP||strD.length;var arrD=strD.substring(0,iP).split("\n");arrD.length--;var iLinePos=arrD.join("\n").length;return iP-iLinePos},fluid.SAXStrings.getLineNumber=function(strD,iP){return strD?(iP=iP||strD.length,strD.substring(0,iP).split("\n").length):-1},fluid.SAXStrings.indexOfNonWhitespace=function(strD,iB,iE){if(!strD)return-1;iB=iB||0,iE=iE||strD.length;for(var i=iB;iE>i;++i){var c=strD.charAt(i);if(" "!==c&&"	"!==c&&"\n"!==c&&"\r"!==c)return i}return-1},fluid.SAXStrings.indexOfWhitespace=function(strD,iB,iE){if(!strD)return-1;iB=iB||0,iE=iE||strD.length;for(var i=iB;iE>i;i++)if(-1!=fluid.SAXStrings.WHITESPACE.indexOf(strD.charAt(i)))return i;return-1},fluid.SAXStrings.lastIndexOfNonWhitespace=function(strD,iB,iE){if(!strD)return-1;iB=iB||0,iE=iE||strD.length;for(var i=iE-1;i>=iB;i--)if(-1==fluid.SAXStrings.WHITESPACE.indexOf(strD.charAt(i)))return i;return-1},fluid.SAXStrings.replace=function(strD,iB,iE,strF,strR){return strD?(iB=iB||0,iE=iE||strD.length,strD.substring(iB,iE).split(strF).join(strR)):""}}(jQuery,fluid_1_5);;fluid_1_5=fluid_1_5||{},function($,fluid){fluid.parseTemplate=function(template,baseURL,scanStart,cutpoints_in,opts){function isSimpleClassCutpoint(tree){return 1===tree.length&&1===tree[0].predList.length&&tree[0].predList[0].clazz}function init(baseURLin,debugModeIn,cutpointsIn){if(t.rootlump=XMLLump(0,-1),tagstack=[t.rootlump],lumpindex=0,nestingdepth=0,justended=!1,defstart=-1,defend=-1,baseURL=baseURLin,debugMode=debugModeIn,cutpointsIn)for(var i=0;i<cutpointsIn.length;++i){var tree=fluid.parseSelector(cutpointsIn[i].selector,fluid.simpleCSSMatcher),clazz=isSimpleClassCutpoint(tree);clazz?simpleClassCutpoints[clazz]=cutpointsIn[i].id:(cutstatus.push([]),cutpoints.push($.extend({},cutpointsIn[i],{tree:tree})))}}function findTopContainer(){for(var i=tagstack.length-1;i>=0;--i){var lump=tagstack[i];if(void 0!==lump.rsfID)return lump}return t.rootlump}function newLump(){var togo=XMLLump(lumpindex,nestingdepth);return debugMode&&(togo.line=parser.getLineNumber(),togo.column=parser.getColumnNumber()),t.lumps[lumpindex]=togo,++lumpindex,togo}function addLump(mmap,ID,lump){var list=mmap[ID];list||(list=[],mmap[ID]=list),list[list.length]=lump}function checkContribute(ID,lump){if(-1!==ID.indexOf("scr=contribute-")){var scr=ID.substring("scr=contribute-".length);addLump(t.collectmap,scr,lump)}}function debugLump(lump){return"<"+lump.tagname+">"}function hasCssClass(clazz,totest){return totest?-1!==(" "+totest+" ").indexOf(" "+clazz+" "):!1}function matchNode(term,headlump,headclazz){if(term.predList){for(var i=0;i<term.predList.length;++i){var pred=term.predList[i];if(pred.id&&headlump.attributemap.id!==pred.id)return!1;if(pred.clazz&&!hasCssClass(pred.clazz,headclazz))return!1;if(pred.tag&&headlump.tagname!==pred.tag)return!1}return!0}}function tagStartCut(headlump){var togo,headclazz=headlump.attributemap["class"];if(headclazz)for(var split=headclazz.split(" "),i=0;i<split.length;++i){var simpleCut=simpleClassCutpoints[$.trim(split[i])];if(simpleCut)return simpleCut}for(var i=0;i<cutpoints.length;++i){var cut=cutpoints[i],cutstat=cutstatus[i],nextterm=cutstat.length;if(nextterm<cut.tree.length){var term=cut.tree[nextterm];if(nextterm>0&&cut.tree[nextterm-1].child&&cutstat[nextterm-1]!==headlump.nestingdepth-1)continue;var isMatch=matchNode(term,headlump,headclazz);isMatch&&(cutstat[cutstat.length]=headlump.nestingdepth,cutstat.length===cut.tree.length&&(void 0!==togo&&fluid.fail("Cutpoint specification error - node "+debugLump(headlump)+" has already matched with rsf:id of "+togo),(void 0===cut.id||null===cut.id)&&fluid.fail("Error in cutpoints list - entry at position "+i+" does not have an id set"),togo=cut.id))}}return togo}function tagEndCut(){if(cutpoints)for(var i=0;i<cutpoints.length;++i){var cutstat=cutstatus[i];cutstat.length>0&&cutstat[cutstat.length-1]===nestingdepth&&cutstat.length--}}function processTagEnd(){tagEndCut();var endlump=newLump();--nestingdepth,endlump.text="</"+parser.getName()+">";var oldtop=tagstack[tagstack.length-1];oldtop.close_tag=t.lumps[lumpindex-1],tagstack.length--,justended=!0}function processTagStart(isempty){if(++nestingdepth,justended){justended=!1;var backlump=newLump();backlump.nestingdepth--}-1===t.firstdocumentindex&&(t.firstdocumentindex=lumpindex);var headlump=newLump(),stacktop=tagstack[tagstack.length-1];headlump.uplump=stacktop;var tagname=parser.getName();headlump.tagname=tagname;var attrs=headlump.attributemap=parser.m_attributes,ID=attrs[fluid.ID_ATTRIBUTE];void 0===ID&&(ID=tagStartCut(headlump));for(var attrname in attrs)void 0===ID&&(/href|src|codebase|action/.test(attrname)?ID="scr=rewrite-url":void 0===ID&&/for|headers/.test(attrname)&&(ID="scr=null"));if(ID){126===ID.charCodeAt(0)&&(ID=ID.substring(1),headlump.elide=!0),checkContribute(ID,headlump),headlump.rsfID=ID;var downreg=findTopContainer();for(downreg.downmap||(downreg.downmap={});downreg;)downreg.downmap&&addLump(downreg.downmap,ID,headlump),downreg=downreg.uplump;addLump(t.globalmap,ID,headlump);var colpos=ID.indexOf(":");if(-1!==colpos){var prefix=ID.substring(0,colpos);stacktop.finallump||(stacktop.finallump={}),stacktop.finallump[prefix]=headlump}}headlump.text="<"+tagname+fluid.dumpAttributes(attrs)+(isempty&&!ID?"/>":">"),tagstack[tagstack.length]=headlump,isempty&&(ID?processTagEnd():(--nestingdepth,tagstack.length--))}function processDefaultTag(){if(-1!==defstart){-1===t.firstdocumentindex&&(t.firstdocumentindex=lumpindex);var text=parser.getContent().substr(defstart,defend-defstart);justended=!1;var newlump=newLump();newlump.text=text,defstart=-1}}opts=opts||{},template||fluid.fail("empty template supplied to fluid.parseTemplate");var t,parser,tagstack,lumpindex=0,nestingdepth=0,justended=!1,defstart=-1,defend=-1,debugMode=!1,cutpoints=[],simpleClassCutpoints={},cutstatus=[],XMLLump=function(lumpindex,nestingdepth){return{nestingdepth:nestingdepth,lumpindex:lumpindex,parent:t}};t=fluid.XMLViewTemplate(),init(baseURL,opts.debugMode,cutpoints_in);var idpos=template.indexOf(fluid.ID_ATTRIBUTE);if(scanStart){var brackpos=template.indexOf(">",idpos);parser=fluid.XMLP(template.substring(brackpos+1))}else parser=fluid.XMLP(template);parseloop:for(;;){var iEvent=parser.next();switch(iEvent){case fluid.XMLP._ELM_B:processDefaultTag(),processTagStart(!1,"");break;case fluid.XMLP._ELM_E:processDefaultTag(),processTagEnd();break;case fluid.XMLP._ELM_EMP:processDefaultTag(),processTagStart(!0,"");break;case fluid.XMLP._PI:case fluid.XMLP._DTD:defstart=-1;continue;case fluid.XMLP._TEXT:case fluid.XMLP._ENTITY:case fluid.XMLP._CDATA:case fluid.XMLP._COMMENT:-1===defstart&&(defstart=parser.m_cB),defend=parser.m_cE;break;case fluid.XMLP._ERROR:fluid.setLogging(!0);var message="Error parsing template: "+parser.m_cAlt+" at line "+parser.getLineNumber();fluid.log(message),fluid.log("Just read: "+parser.m_xml.substring(parser.m_iP-30,parser.m_iP)),fluid.log("Still to read: "+parser.m_xml.substring(parser.m_iP,parser.m_iP+30)),fluid.fail(message);break parseloop;case fluid.XMLP._NONE:break parseloop}}processDefaultTag();var excess=tagstack.length-1;return excess&&fluid.fail("Error parsing template - unclosed tag(s) of depth "+excess+": "+fluid.transform(tagstack.splice(1,excess),function(lump){return debugLump(lump)}).join(", ")),t},fluid.debugLump=function(lump){var togo=lump.text;return togo+=" at ",togo+="lump line "+lump.line+" column "+lump.column+" index "+lump.lumpindex,togo+=null===lump.parent.href?"":" in file "+lump.parent.href},fluid.ID_ATTRIBUTE="rsf:id",fluid.getPrefix=function(id){var colpos=id.indexOf(":");return-1===colpos?id:id.substring(0,colpos)},fluid.SplitID=function(id){var that={},colpos=id.indexOf(":");return-1===colpos?that.prefix=id:(that.prefix=id.substring(0,colpos),that.suffix=id.substring(colpos+1)),that},fluid.XMLViewTemplate=function(){return{globalmap:{},collectmap:{},lumps:[],firstdocumentindex:-1}},fluid.XMLEncode=function(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;")},fluid.dumpAttributes=function(attrcopy){var togo="";for(var attrname in attrcopy){var attrvalue=attrcopy[attrname];null!==attrvalue&&void 0!==attrvalue&&(togo+=" "+attrname+'="'+attrvalue+'"')}return togo},fluid.aggregateMMap=function(target,source){for(var key in source){var targhas=target[key];targhas||(target[key]=[]),target[key]=target[key].concat(source[key])}},fluid.parseTemplates=function(resourceSpec,templateList,opts){var togo=[];opts=opts||{},togo.globalmap={};for(var i=0;i<templateList.length;++i){var resource=resourceSpec[templateList[i]],lastslash=resource.href.lastIndexOf("/"),baseURL=-1===lastslash?"":resource.href.substring(0,lastslash+1),template=fluid.parseTemplate(resource.resourceText,baseURL,opts.scanStart&&0===i,resource.cutpoints,opts);0===i&&fluid.aggregateMMap(togo.globalmap,template.globalmap),template.href=resource.href,template.baseURL=baseURL,template.resourceKey=resource.resourceKey,togo[i]=template,fluid.aggregateMMap(togo.globalmap,template.rootlump.downmap)}return togo}}(jQuery,fluid_1_5);;fluid_1_5=fluid_1_5||{},function($,fluid){function debugPosition(component){return"as child of "+(component.parent.fullID?"component with full ID "+component.parent.fullID:"root")}function computeFullID(component){var togo="",move=component;for(void 0===component.children&&(togo=component.ID+(void 0!==component.localID?component.localID:""),move=component.parent);move.parent;){var parent=move.parent;if(void 0!==move.fullID)return togo=move.fullID+togo;if(void 0===move.noID){var ID=move.ID;void 0===ID&&fluid.fail("Error in component tree - component found with no ID "+debugPosition(parent)+": please check structure");var colpos=ID.indexOf(":"),prefix=-1===colpos?ID:ID.substring(0,colpos);togo=prefix+":"+(void 0===move.localID?"":move.localID)+":"+togo}move=parent}return togo}function processChild(value,key){if(renderer.isBoundPrimitive(value))return{componentType:"UIBound",value:value,ID:key};var unzip=unzipComponent(value);return unzip.ID?{ID:key,componentType:"UIContainer",children:[unzip]}:(unzip.ID=key,unzip)}function fixChildren(children){if(fluid.isArrayable(children))return children;var togo=[];for(var key in children){var value=children[key];if(fluid.isArrayable(value))for(var i=0;i<value.length;++i){var processed=processChild(value[i],key);togo[togo.length]=processed}else togo[togo.length]=processChild(value,key)}return togo}function fixupValue(uibound,model,resolverGetConfig){void 0===uibound.value&&void 0!==uibound.valuebinding&&(model||fluid.fail("Cannot perform value fixup for valuebinding "+uibound.valuebinding+" since no model was supplied to rendering"),uibound.value=fluid.get(model,uibound.valuebinding,resolverGetConfig))}function upgradeBound(holder,property,model,resolverGetConfig){void 0!==holder[property]?renderer.isBoundPrimitive(holder[property])?holder[property]={value:holder[property]}:holder[property].messagekey&&(holder[property].componentType="UIMessage"):holder[property]={value:null},fixupValue(holder[property],model,resolverGetConfig)}function fixupTree(tree,model,resolverGetConfig){if(void 0===tree.componentType&&(tree=unzipComponent(tree,model,resolverGetConfig)),"UIContainer"===tree.componentType||tree.parent||(tree={children:[tree]}),tree.children){tree.childmap={};for(var i=0;i<tree.children.length;++i){var child=tree.children[i];void 0===child.componentType&&(child=unzipComponent(child,model,resolverGetConfig),tree.children[i]=child),child.parent=tree,void 0===child.ID&&fluid.fail("Error in component tree: component found with no ID "+debugPosition(child)),tree.childmap[child.ID]=child;var colpos=child.ID.indexOf(":");if(-1===colpos);else{var prefix=child.ID.substring(0,colpos),childlist=tree.childmap[prefix];childlist||(childlist=[],tree.childmap[prefix]=childlist),void 0===child.localID&&0!==childlist.length&&(child.localID=childlist.length),childlist[childlist.length]=child}child.fullID=computeFullID(child);var componentType=child.componentType;if("UISelect"===componentType)child.selection.fullID=child.fullID;else if("UIInitBlock"===componentType){for(var call=child.functionname+"(",j=0;j<child.arguments.length;++j)child.arguments[j]instanceof fluid.ComponentReference&&(child.arguments[j]=child.parent.fullID+child.arguments[j].reference),call+=JSON.stringify(child.arguments[j]),j<child.arguments.length-1&&(call+=", ");child.markup={value:call+")\n"},child.componentType="UIVerbatim"}else"UIBound"===componentType&&fixupValue(child,model,resolverGetConfig);fixupTree(child,model,resolverGetConfig)}}return tree}function findNodeValue(rootNode){var node=fluid.dom.iterateDom(rootNode,function(node){return 8===node.nodeType||4===node.nodeType?"stop":null},!0),value=node.nodeValue;return 0===value.indexOf("[CDATA[")?value.substring(6,value.length-2):value}var renderer={};renderer.isBoundPrimitive=function(value){return fluid.isPrimitive(value)||fluid.isArrayable(value)&&(0===value.length||"string"==typeof value[0])};var unzipComponent;renderer.duckMap={children:"UIContainer",value:"UIBound",valuebinding:"UIBound",messagekey:"UIMessage",markup:"UIVerbatim",selection:"UISelect",target:"UILink",choiceindex:"UISelectChoice",functionname:"UIInitBlock"};var boundMap={UISelect:["selection","optionlist","optionnames"],UILink:["target","linktext"],UIVerbatim:["markup"],UIMessage:["messagekey"]};renderer.boundMap=fluid.transform(boundMap,fluid.arrayToHash),renderer.inferComponentType=function(component){for(var key in renderer.duckMap)if(void 0!==component[key])return renderer.duckMap[key]},renderer.applyComponentType=function(component){component.componentType=renderer.inferComponentType(component),void 0===component.componentType&&void 0!==component.ID&&(component.componentType="UIBound")},unzipComponent=function(component,model,resolverGetConfig){if(component&&renderer.applyComponentType(component),!component||void 0===component.componentType){var decorators=component.decorators;decorators&&delete component.decorators,component={componentType:"UIContainer",children:component},component.decorators=decorators}var cType=component.componentType;if("UIContainer"===cType)component.children=fixChildren(component.children);else{var map=renderer.boundMap[cType];map&&fluid.each(map,function(value,key){upgradeBound(component,key,model,resolverGetConfig)})}return component},fluid.NULL_STRING="null";var LINK_ATTRIBUTES={a:"href",link:"href",img:"src",frame:"src",script:"src",style:"src",input:"src",embed:"src",form:"action",applet:"codebase",object:"codebase"};renderer.decoratorComponentPrefix="**-renderer-",renderer.IDtoComponentName=function(ID,num){return renderer.decoratorComponentPrefix+ID.replace(/\./g,"")+"-"+num},renderer.invokeFluidDecorator=function(func,args,ID,num,options){var that;if(options.parentComponent){var parent=options.parentComponent,name=renderer.IDtoComponentName(ID,num);fluid.set(parent,fluid.path("options","components",name),{type:func}),that=fluid.initDependent(options.parentComponent,name,args)}else that=fluid.invokeGlobalFunction(func,args);return that},fluid.renderer=function(templates,tree,options,fossilsIn){function getRewriteKey(template,parent,id){return template.resourceKey+parent.fullID+id}function resolveInScope(searchID,defprefix,scope){var deflump,scopelook=scope?scope[searchID]:null;if(scopelook)for(var i=0;i<scopelook.length;++i){var scopelump=scopelook[i];if(deflump||scopelump.rsfID!==defprefix||(deflump=scopelump),scopelump.rsfID===searchID)return scopelump}return deflump}function resolveCall(sourcescope,child){var searchID=child.jointID?child.jointID:child.ID,split=fluid.SplitID(searchID),defprefix=split.prefix+":",match=resolveInScope(searchID,defprefix,sourcescope.downmap,child);return match?match:child.children&&(match=resolveInScope(searchID,defprefix,globalmap,child))?match:null}function noteCollected(template){seenset[template.href]||(fluid.aggregateMMap(collected,template.collectmap),seenset[template.href]=!0)}function resolveRecurse(basecontainer,parentlump){for(var i=0;i<basecontainer.children.length;++i){var branch=basecontainer.children[i];if(branch.children){var resolved=resolveCall(parentlump,branch);if(resolved){branchmap[branch.fullID]=resolved;var id=resolved.attributemap.id;void 0!==id&&(rewritemap[getRewriteKey(parentlump.parent,basecontainer,id)]=branch.fullID),noteCollected(resolved.parent),resolveRecurse(branch,resolved)}}}if(parentlump.downmap)for(var id in parentlump.downmap)for(var lumps=parentlump.downmap[id],i=0;i<lumps.length;++i){var lump=lumps[i],lumpid=lump.attributemap.id;if(void 0!==lumpid&&void 0!==lump.rsfID){var resolved=fetchComponent(basecontainer,lump.rsfID);if(null!==resolved){var resolveID=resolved.fullID;rewritemap[getRewriteKey(parentlump.parent,basecontainer,lumpid)]=resolveID}}}}function resolveBranches(globalmapp,basecontainer,parentlump){branchmap={},rewritemap={},seenset={},collected={},globalmap=globalmapp,branchmap[basecontainer.fullID]=parentlump,resolveRecurse(basecontainer,parentlump)}function dumpTillLump(lumps,start,limit){for(;limit>start;++start){var text=lumps[start].text;text&&(out+=lumps[start].text)}}function dumpScan(lumps,renderindex,basedepth,closeparent,insideleaf){for(var start=renderindex;;){if(renderindex===lumps.length)break;var lump=lumps[renderindex];if(lump.nestingdepth<basedepth)break;if(void 0!==lump.rsfID){if(!insideleaf)break;if(!(insideleaf&&lump.nestingdepth>basedepth+(closeparent?0:1)))break;fluid.log("Error in component tree - leaf component found to contain further components - at "+lump.toString())}++renderindex}return closeparent||renderindex!==lumps.length&&lumps[renderindex].rsfID||--renderindex,dumpTillLump(lumps,start,renderindex),renderindex}function isPlaceholder(){return!1}function isValue(value){return null!==value&&void 0!==value&&!isPlaceholder(value)}function openTag(){trc.iselide||(out+="<"+trc.uselump.tagname)}function closeTag(){trc.iselide||(out+="</"+trc.uselump.tagname+">")}function renderUnchanged(){dumpTillLump(trc.uselump.parent.lumps,trc.uselump.lumpindex+1,trc.close.lumpindex+(trc.iselide?0:1))}function isSelfClose(){return trc.endopen.lumpindex===trc.close.lumpindex&&fluid.XMLP.closedTags[trc.uselump.tagname]}function dumpTemplateBody(){isSelfClose()?trc.iselide||(out+="/>"):(trc.iselide||(out+=">"),dumpTillLump(trc.uselump.parent.lumps,trc.endopen.lumpindex,trc.close.lumpindex+(trc.iselide?0:1)))}function replaceAttributes(){trc.iselide||(out+=fluid.dumpAttributes(trc.attrcopy)),dumpTemplateBody()}function replaceAttributesOpen(){if(trc.iselide)replaceAttributes();else{out+=fluid.dumpAttributes(trc.attrcopy);var selfClose=isSelfClose();out+=selfClose?"/>":">",trc.nextpos=selfClose?trc.close.lumpindex+1:trc.endopen.lumpindex}}function replaceBody(value){out+=fluid.dumpAttributes(trc.attrcopy),trc.iselide||(out+=">"),out+=fluid.XMLEncode(value.toString()),closeTag()}function rewriteLeaf(value){isValue(value)?replaceBody(value):replaceAttributes()}function rewriteLeafOpen(value){trc.iselide?rewriteLeaf(trc.value):isValue(value)?replaceBody(value):replaceAttributesOpen()}function rewriteUrl(template,url){if(renderOptions.urlRewriter){var rewritten=renderOptions.urlRewriter(url);if(rewritten)return rewritten}if(!renderOptions.rebaseURLs)return url;var protpos=url.indexOf(":/");return"/"===url.charAt(0)||-1!==protpos&&7>protpos?url:renderOptions.baseURL+url}function dumpHiddenField(todump){out+='<input type="hidden" ';var isvirtual=todump.virtual,outattrs={};outattrs[isvirtual?"id":"name"]=todump.name,outattrs.value=todump.value,out+=fluid.dumpAttributes(outattrs),out+=" />\n"}function applyAutoBind(torender,finalID){function applyFunc(){fluid.applyBoundChange(fluid.byId(finalID,renderOptions.document),void 0,applier)}if(finalID){var tagname=trc.uselump.tagname,applier=renderOptions.applier;if(renderOptions.autoBind&&/input|select|textarea/.test(tagname)&&!renderedbindings[finalID]){var decorators=[{jQuery:["change",applyFunc]}];$.browser.msie&&"input"===tagname&&/radio|checkbox/.test(trc.attrcopy.type)&&decorators.push({jQuery:["click",applyFunc]}),$.browser.safari&&"input"===tagname&&"radio"===trc.attrcopy.type&&decorators.push({jQuery:["keyup",applyFunc]}),outDecoratorsImpl(torender,decorators,trc.attrcopy,finalID)}}}function dumpBoundFields(torender,parent){if(torender){var holder=parent?parent:torender;if(renderOptions.fossils&&holder.valuebinding){var fossilKey=holder.submittingname||torender.finalID;renderOptions.fossils[fossilKey]={name:fossilKey,EL:holder.valuebinding,oldvalue:holder.value},applyAutoBind(torender,torender.finalID)}torender.fossilizedbinding&&dumpHiddenField(torender.fossilizedbinding),torender.fossilizedshaper&&dumpHiddenField(torender.fossilizedshaper)}}function dumpSelectionBindings(uiselect){renderedbindings[uiselect.selection.fullID]||(renderedbindings[uiselect.selection.fullID]=!0,dumpBoundFields(uiselect.selection),dumpBoundFields(uiselect.optionlist),dumpBoundFields(uiselect.optionnames))}function isSelectedValue(torender,value){var selection=torender.selection;return selection.value&&"string"!=typeof selection.value&&"number"==typeof selection.value.length?-1!==$.inArray(value,selection.value):selection.value===value}function getRelativeComponent(component,relativeID){for(component=component.parent;0===relativeID.indexOf("..::");)relativeID=relativeID.substring(4),component=component.parent;return component.childmap[relativeID]}function rewriteRewriteMap(from,to){fluid.each(rewritemap,function(value,key){value===from&&(rewritemap[key]=to)})}function adjustForID(attrcopy,component,late,forceID){late||delete attrcopy["rsf:id"],void 0!==component.finalID?attrcopy.id=component.finalID:void 0!==forceID?attrcopy.id=forceID:(attrcopy.id||late)&&(attrcopy.id=component.fullID);for(var count=1,baseid=attrcopy.id;renderOptions.document.getElementById(attrcopy.id)||usedIDs[attrcopy.id];)attrcopy.id=baseid+"-"+count++;return 1!==count&&rewriteRewriteMap(baseid,attrcopy.id),component.finalID=attrcopy.id,attrcopy.id}function assignSubmittingName(attrcopy,component,parent){var submitting=parent||component;return adjustForID(attrcopy,component,!0,component.fullID),void 0===submitting.submittingname&&submitting.willinput!==!1&&(submitting.submittingname=submitting.finalID||submitting.fullID),submitting.submittingname}function explodeDecorators(decorators){var togo=[];if(decorators.type)togo[0]=decorators;else for(var key in decorators){"$"===key&&(key="jQuery");var value=decorators[key],decorator={type:key};"jQuery"===key?(decorator.func=value[0],decorator.args=value.slice(1)):"addClass"===key||"removeClass"===key?decorator.classes=value:"attrs"===key?decorator.attributes=value:"identify"===key&&(decorator.key=value),togo[togo.length]=decorator}return togo}function outDecorators(torender,attrcopy){torender.decorators&&(void 0===torender.decorators.length&&(torender.decorators=explodeDecorators(torender.decorators)),outDecoratorsImpl(torender,torender.decorators,attrcopy))}function dumpBranchHead(branch,targetlump){if(!targetlump.elide){var attrcopy={};$.extend(!0,attrcopy,targetlump.attributemap),adjustForID(attrcopy,branch),outDecorators(branch,attrcopy),out+="<"+targetlump.tagname+" ",out+=fluid.dumpAttributes(attrcopy),out+=">"}}function resolveArgs(args){return args?(args=fluid.copy(args),fluid.transform(args,function(arg,index){return upgradeBound(args,index,renderOptions.model,renderOptions.resolverGetConfig),args[index].value})):args}function degradeMessage(torender){if("UIMessage"===torender.componentType)if(torender.componentType="UIBound",renderOptions.messageLocator){upgradeBound(torender,"messagekey",renderOptions.model,renderOptions.resolverGetConfig);var resArgs=resolveArgs(torender.args);torender.value=renderOptions.messageLocator(torender.messagekey.value,resArgs)}else torender.value="[No messageLocator is configured in options - please consult documentation on options.messageSource]"}function renderComponent(torender){function makeFail(torender,end){fluid.fail("Error in component tree - UISelectChoice with id "+torender.fullID+end)}var attrcopy=trc.attrcopy;degradeMessage(torender);var componentType=torender.componentType,tagname=trc.uselump.tagname;if(outDecorators(torender,attrcopy),"UIBound"===componentType||"UISelectChoice"===componentType){var parent;void 0!==torender.choiceindex&&(void 0!==torender.parentRelativeID?(parent=getRelativeComponent(torender,torender.parentRelativeID),parent||makeFail(torender," has parentRelativeID of "+torender.parentRelativeID+" which cannot be resolved")):makeFail(torender," does not have parentRelativeID set"),assignSubmittingName(attrcopy,torender,parent.selection),dumpSelectionBindings(parent));var submittingname=parent?parent.selection.submittingname:torender.submittingname;if(!parent&&torender.valuebinding&&(submittingname=assignSubmittingName(attrcopy,torender)),("input"===tagname||"textarea"===tagname)&&void 0!==submittingname&&(attrcopy.name=submittingname),dumpBoundFields(torender,parent?parent.selection:null),"boolean"==typeof torender.value||"radio"===attrcopy.type||"checkbox"===attrcopy.type){var underlyingValue,directValue=torender.value;void 0!==torender.choiceindex&&(parent.optionlist.value||fluid.fail("Error in component tree - selection control with full ID "+parent.fullID+" has no values"),underlyingValue=parent.optionlist.value[torender.choiceindex],directValue=isSelectedValue(parent,underlyingValue)),isValue(directValue)&&(directValue?attrcopy.checked="checked":delete attrcopy.checked),attrcopy.value=fluid.XMLEncode(underlyingValue?underlyingValue:"true"),rewriteLeaf(null)}else if(fluid.isArrayable(torender.value))renderUnchanged();else{var value=parent?parent["textarea"===tagname||"input"===tagname?"optionlist":"optionnames"].value[torender.choiceindex]:torender.value;"textarea"===tagname?(isPlaceholder(value)&&torender.willinput&&(value=""),rewriteLeaf(value)):"input"===tagname?((torender.willinput||isValue(value))&&(attrcopy.value=fluid.XMLEncode(String(value))),rewriteLeaf(null)):(delete attrcopy.name,rewriteLeafOpen(value))}}else if("UISelect"===componentType){var ishtmlselect="select"===tagname,ismultiple=!1;if(fluid.isArrayable(torender.selection.value)&&(ismultiple=!0,ishtmlselect&&(attrcopy.multiple="multiple")),assignSubmittingName(attrcopy,torender.selection),ishtmlselect&&(torender.selection.willinput!==!1&&(attrcopy.name=torender.selection.submittingname),applyAutoBind(torender,attrcopy.id)),out+=fluid.dumpAttributes(attrcopy),ishtmlselect){out+=">";var values=torender.optionlist.value,names=null!==torender.optionnames&&void 0!==torender.optionnames&&torender.optionnames.value?torender.optionnames.value:values;names&&names.length||fluid.fail("Error in component tree - UISelect component with fullID "+torender.fullID+" does not have optionnames set");for(var i=0;i<names.length;++i){out+='<option value="';var value=values[i];null===value&&(value=fluid.NULL_STRING),out+=fluid.XMLEncode(value),isSelectedValue(torender,value)&&(out+='" selected="selected'),out+='">',out+=fluid.XMLEncode(names[i]),out+="</option>\n"}closeTag()}else dumpTemplateBody();dumpSelectionBindings(torender)}else if("UILink"===componentType){var attrname=LINK_ATTRIBUTES[tagname];if(attrname){degradeMessage(torender.target);var target=torender.target.value;isValue(target)||(target=attrcopy[attrname]),target=rewriteUrl(trc.uselump.parent,target),attrcopy[attrname]=fluid.XMLEncode(target)}var value;torender.linktext&&(degradeMessage(torender.linktext),value=torender.linktext.value),isValue(value)?rewriteLeaf(value):replaceAttributesOpen()}else if(void 0!==torender.markup){degradeMessage(torender.markup);var rendered=torender.markup.value;null===rendered?(out+=fluid.dumpAttributes(attrcopy),out+=">",renderUnchanged()):(trc.iselide||(out+=fluid.dumpAttributes(attrcopy),out+=">"),out+=rendered,closeTag())}void 0!==attrcopy.id&&(usedIDs[attrcopy.id]=!0)}function rewriteIDRelation(context){var attrname,attrval=trc.attrcopy["for"];if(void 0!==attrval?attrname="for":(attrval=trc.attrcopy.headers,void 0!==attrval&&(attrname="headers")),attrname){var tagname=trc.uselump.tagname;if(!("for"===attrname&&"label"!==tagname||"headers"===attrname&&"td"!==tagname&&"th"!==tagname)){var rewritten=rewritemap[getRewriteKey(trc.uselump.parent,context,attrval)];void 0!==rewritten&&(trc.attrcopy[attrname]=rewritten)}}}function renderComment(message){out+="<!-- "+fluid.XMLEncode(message)+"-->"}function renderDebugMessage(message){out+='<span style="background-color:#FF466B;color:white;padding:1px;">',out+=message,out+="</span><br/>"}function reportPath(branch){var path=branch.fullID;return path?"full path "+path:"component tree root"}function renderComponentSystem(context,torendero,lump){var lumpindex=lump.lumpindex,lumps=lump.parent.lumps,nextpos=-1,outerendopen=lumps[lumpindex+1],outerclose=lump.close_tag;nextpos=outerclose.lumpindex+1;var payloadlist=lump.downmap?lump.downmap["payload-component"]:null,payload=payloadlist?payloadlist[0]:null,iselide=126===lump.rsfID.charCodeAt(0),endopen=outerendopen,close=outerclose,uselump=lump,attrcopy={};if($.extend(!0,attrcopy,(null===payload?lump:payload).attributemap),trc.attrcopy=attrcopy,trc.uselump=uselump,trc.endopen=endopen,trc.close=close,trc.nextpos=nextpos,trc.iselide=iselide,rewriteIDRelation(context),null===torendero&&lump.rsfID.indexOf("scr=")===(iselide?1:0)){var scrname=lump.rsfID.substring(4+(iselide?1:0));"ignore"===scrname?nextpos=trc.close.lumpindex+1:"rewrite-url"===scrname?torendero={componentType:"UILink",target:{}}:(openTag(),replaceAttributesOpen(),nextpos=trc.endopen.lumpindex)}return null!==torendero&&(payload&&(trc.endopen=lumps[payload.lumpindex+1],trc.close=payload.close_tag,trc.uselump=payload,dumpTillLump(lumps,lumpindex,payload.lumpindex),lumpindex=payload.lumpindex),adjustForID(attrcopy,torendero),openTag(),renderComponent(torendero),null!==payload&&trc.nextpos===nextpos&&dumpTillLump(lumps,trc.close.lumpindex+1,outerclose.lumpindex+1),nextpos=trc.nextpos),nextpos}function renderContainer(child,targetlump){var t2=targetlump.parent,firstchild=t2.lumps[targetlump.lumpindex+1];void 0!==child.children?dumpBranchHead(child,targetlump):renderComponentSystem(child.parent,child,targetlump),renderRecurse(child,targetlump,firstchild)}function fetchComponents(basecontainer,id){for(var togo;basecontainer&&!(togo=basecontainer.childmap[id]);)basecontainer=basecontainer.parent;return togo}function findChild(sourcescope,child){var split=fluid.SplitID(child.ID),headlumps=sourcescope.downmap[child.ID];return headlumps||(headlumps=sourcescope.downmap[split.prefix+":"]),headlumps?headlumps[0]:null}function renderCollect(collump){dumpTillLump(collump.parent.lumps,collump.lumpindex,collump.close_tag.lumpindex+1)}function renderCollects(){for(var key in collected)for(var collist=collected[key],i=0;i<collist.length;++i)renderCollect(collist[i])}function processDecoratorQueue(){for(var i=0;i<decoratorQueue.length;++i)for(var decorator=decoratorQueue[i],j=0;j<decorator.ids.length;++j){var id=decorator.ids[j],node=fluid.byId(id,renderOptions.document);if(node||fluid.fail("Error during rendering - component with id "+id+" which has a queued decorator was not found in the output markup"),"jQuery"===decorator.type){var jnode=renderOptions.jQuery(node);jnode[decorator.func].apply(jnode,fluid.makeArray(decorator.args))}else if("fluid"===decorator.type){var args=decorator.args;if(!args){var thisContainer=renderOptions.jQuery(node);decorator.container?decorator.container.push(node):decorator.container=thisContainer,args=[thisContainer,decorator.options]}var that=renderer.invokeFluidDecorator(decorator.func,args,id,i,options);decorator.that=that}else"event"===decorator.type&&(node[decorator.event]=decorator.handler)}}options=options||{},tree=tree||{};var debugMode=options.debugMode;!options.messageLocator&&options.messageSource&&(options.messageLocator=fluid.resolveMessageSource(options.messageSource)),options.document=options.document||document,options.jQuery=options.jQuery||$,options.fossils=options.fossils||fossilsIn||{};var fetchComponent,outDecoratorsImpl,globalmap={},branchmap={},rewritemap={},seenset={},collected={},out="",renderOptions=options,decoratorQueue=[],renderedbindings={},usedIDs={},that={options:options},trc={};outDecoratorsImpl=function(torender,decorators,attrcopy,finalID){renderOptions.idMap=renderOptions.idMap||{};for(var i=0;i<decorators.length;++i){var decorator=decorators[i],type=decorator.type;if(type)if("$"===type&&(type=decorator.type="jQuery"),"jQuery"===type||"event"===type||"fluid"===type){var id=adjustForID(attrcopy,torender,!0,finalID);void 0===decorator.ids&&(decorator.ids=[],decoratorQueue[decoratorQueue.length]=decorator),decorator.ids.push(id)}else if("attrs"===type)fluid.each(decorator.attributes,function(value,key){null===value||void 0===value?delete attrcopy[key]:attrcopy[key]=fluid.XMLEncode(value)});else if("addClass"===type||"removeClass"===type){var fakeNode={nodeType:1,className:attrcopy["class"]||""};renderOptions.jQuery(fakeNode)[type](decorator.classes),attrcopy["class"]=fakeNode.className}else if("identify"===type){var id=adjustForID(attrcopy,torender,!0,finalID);renderOptions.idMap[decorator.key]=id}else"null"!==type&&fluid.log("Unrecognised decorator of type "+type+" found at component of ID "+finalID);else{var explodedDecorators=explodeDecorators(decorator);outDecoratorsImpl(torender,explodedDecorators,attrcopy,finalID)}}};var renderRecurse;return fetchComponent=function(basecontainer,id){if(0===id.indexOf("msg=")){var key=id.substring(4);return{componentType:"UIMessage",messagekey:key}}for(;basecontainer;){var togo=basecontainer.childmap[id];if(togo)return togo;basecontainer=basecontainer.parent}return null},renderRecurse=function(basecontainer,parentlump,baselump){var rendered,renderindex=baselump.lumpindex,basedepth=parentlump.nestingdepth,t1=parentlump.parent;for(debugMode&&(rendered={});;){if(renderindex=dumpScan(t1.lumps,renderindex,basedepth,!parentlump.elide,!1),renderindex===t1.lumps.length)break;var lump=t1.lumps[renderindex],id=lump.rsfID;if(lump.nestingdepth<basedepth||void 0===id)break;if(126===id.charCodeAt(0)&&(id=id.substring(1)),-1!==id.indexOf(":")){var prefix=fluid.getPrefix(id),children=fetchComponents(basecontainer,prefix),finallump=lump.uplump.finallump[prefix],closefinal=finallump.close_tag;if(children)for(var i=0;i<children.length;++i){var child=children[i];if(child.children){debugMode&&(rendered[child.fullID]=!0);var targetlump=branchmap[child.fullID];targetlump?(debugMode&&renderComment("Branching for "+child.fullID+" from "+fluid.debugLump(lump)+" to "+fluid.debugLump(targetlump)),renderContainer(child,targetlump),debugMode&&renderComment("Branch returned for "+child.fullID+fluid.debugLump(lump)+" to "+fluid.debugLump(targetlump))):debugMode&&renderDebugMessage("No matching template branch found for branch container with full ID "+child.fullID+" rendering from parent template branch "+fluid.debugLump(baselump))}else{var targetlump=findChild(parentlump,child);if(!targetlump){debugMode&&renderDebugMessage("Repetitive leaf with full ID "+child.fullID+" could not be rendered from parent template branch "+fluid.debugLump(baselump));continue}var renderend=renderComponentSystem(basecontainer,child,targetlump),wasopentag=renderend<t1.lumps.lengtn&&t1.lumps[renderend].nestingdepth>=targetlump.nestingdepth,newbase=child.children?child:basecontainer;wasopentag&&(renderRecurse(newbase,targetlump,t1.lumps[renderend]),renderend=targetlump.close_tag.lumpindex+1),i!==children.length-1?renderend<closefinal.lumpindex&&dumpScan(t1.lumps,renderend,targetlump.nestingdepth-1,!1,!1):dumpScan(t1.lumps,renderend,targetlump.nestingdepth,!0,!1)}}else debugMode&&renderDebugMessage("No branch container with prefix "+prefix+": found in container "+reportPath(basecontainer)+" rendering at template position "+fluid.debugLump(baselump)+", skipping");renderindex=closefinal.lumpindex+1,debugMode&&renderComment("Stack returned from branch for ID "+id+" to "+fluid.debugLump(baselump)+": skipping from "+fluid.debugLump(lump)+" to "+fluid.debugLump(closefinal))}else{var component;id&&(component=fetchComponent(basecontainer,id,lump),debugMode&&component&&(rendered[component.fullID]=!0)),component&&void 0!==component.children?(renderContainer(component),renderindex=lump.close_tag.lumpindex+1):renderindex=renderComponentSystem(basecontainer,component,lump)}if(renderindex===t1.lumps.length)break}if(debugMode)for(var children=basecontainer.children,key=0;key<children.length;++key){var child=children[key];rendered[child.fullID]||renderDebugMessage("Component "+child.componentType+" with full ID "+child.fullID+" could not be found within template "+fluid.debugLump(baselump))}},that.renderTemplates=function(){tree=fixupTree(tree,options.model,options.resolverGetConfig);var template=templates[0];return resolveBranches(templates.globalmap,tree,template.rootlump),renderedbindings={},renderCollects(),renderRecurse(tree,template.rootlump,template.lumps[template.firstdocumentindex]),out},that.processDecoratorQueue=function(){processDecoratorQueue()},that},jQuery.extend(!0,fluid.renderer,renderer),fluid.ComponentReference=function(reference){this.reference=reference},fluid.explode=function(hash,basepath){var togo=[];for(var key in hash){var binding=void 0===basepath?key:basepath+"."+key;togo[togo.length]={ID:key,value:hash[key],valuebinding:binding}}return togo},fluid.explodeSelectionToInputs=function(optionlist,opts){return fluid.transform(optionlist,function(option,index){return{ID:opts.rowID,children:[{ID:opts.inputID,parentRelativeID:"..::"+opts.selectID,choiceindex:index},{ID:opts.labelID,parentRelativeID:"..::"+opts.selectID,choiceindex:index}]}})},fluid.resolveMessageSource=function(messageSource){if("data"===messageSource.type){if(void 0===messageSource.url)return fluid.messageLocator(messageSource.messages,messageSource.resolveFunc)}else if("resolver"===messageSource.type)return messageSource.resolver.resolve},fluid.renderTemplates=function(templates,tree,options,fossilsIn){var renderer=fluid.renderer(templates,tree,options,fossilsIn),rendered=renderer.renderTemplates();return rendered},fluid.reRender=function(templates,node,tree,options){options=options||{};var renderer=fluid.renderer(templates,tree,options,options.fossils);options=renderer.options,node=fluid.unwrap(node);var lastId,lastFocusedElement=fluid.getLastFocusedElement?fluid.getLastFocusedElement():null;lastFocusedElement&&fluid.dom.isContainer(node,lastFocusedElement)&&(lastId=lastFocusedElement.id),$.browser.msie?options.jQuery(node).empty():node.innerHTML="";var rendered=renderer.renderTemplates();if(options.renderRaw&&(rendered=fluid.XMLEncode(rendered),rendered=rendered.replace(/\n/g,"<br/>")),options.model&&fluid.bindFossils(node,options.model,options.fossils),$.browser.msie?options.jQuery(node).html(rendered):node.innerHTML=rendered,renderer.processDecoratorQueue(),lastId){var element=fluid.byId(lastId,options.document);element&&options.jQuery(element).focus()}return templates},fluid.extractTemplate=function(node,armouring){return armouring?findNodeValue(node):node.innerHTML},fluid.render=function(source,target,tree,options){options=options||{};var template=source;"object"==typeof source&&(template=fluid.extractTemplate(fluid.unwrap(source.node),source.armouring)),target=fluid.unwrap(target);var resourceSpec={base:{resourceText:template,href:".",resourceKey:".",cutpoints:options.cutpoints}},templates=fluid.parseTemplates(resourceSpec,["base"],options);return fluid.reRender(templates,target,tree,options)},fluid.selfRender=function(node,tree,options){return options=options||{},fluid.render({node:node,armouring:options.armouring},node,tree,options)}}(jQuery,fluid_1_5);;fluid_1_5=fluid_1_5||{},function($,fluid){fluid.renderer||fluid.fail("fluidRenderer.js is a necessary dependency of RendererUtilities"),fluid.renderer.visitDecorators=function(that,visitor){fluid.visitComponentChildren(that,function(component,name){0===name.indexOf(fluid.renderer.decoratorComponentPrefix)&&visitor(component,name)},{flat:!0})},fluid.renderer.clearDecorators=function(that){var instantiator=fluid.getInstantiator(that);fluid.renderer.visitDecorators(that,function(component,name){instantiator.clearComponent(that,name)})},fluid.renderer.getDecoratorComponents=function(that){var togo={};return fluid.renderer.visitDecorators(that,function(component,name){togo[name]=component}),togo},fluid.renderer.modeliseOptions=function(options,defaults,baseOptions){return $.extend({},defaults,fluid.filterKeys(baseOptions,["model","applier"]),options)},fluid.renderer.reverseMerge=function(target,source,names){names=fluid.makeArray(names),fluid.each(names,function(name){void 0===target[name]&&void 0!==source[name]&&(target[name]=source[name])})},fluid.renderer.createRendererSubcomponent=function(container,selectors,options,parentThat,fossils){options=options||{};var source=options.templateSource?options.templateSource:{node:$(container)},rendererOptions=fluid.renderer.modeliseOptions(options.rendererOptions,null,parentThat);if(rendererOptions.fossils=fossils||{},rendererOptions.parentComponent=parentThat,container.jquery){var cascadeOptions={document:container[0].ownerDocument,jQuery:container.constructor};fluid.renderer.reverseMerge(rendererOptions,cascadeOptions,fluid.keys(cascadeOptions))}var expanderOptions=fluid.renderer.modeliseOptions(options.expanderOptions,{ELstyle:"${}"},parentThat);fluid.renderer.reverseMerge(expanderOptions,options,["resolverGetConfig","resolverSetConfig"]);var that={};options.noexpand||(that.expander=fluid.renderer.makeProtoExpander(expanderOptions,parentThat));var templates=null;return that.render=function(tree){var cutpointFn=options.cutpointGenerator||"fluid.renderer.selectorsToCutpoints";rendererOptions.cutpoints=rendererOptions.cutpoints||fluid.invokeGlobalFunction(cutpointFn,[selectors,options]);var renderTarget=$(options.renderTarget?options.renderTarget:container);templates?(fluid.clear(rendererOptions.fossils),fluid.reRender(templates,renderTarget,tree,rendererOptions)):("function"==typeof source&&(source=source()),templates=fluid.render(source,renderTarget,tree,rendererOptions))},that},fluid.defaults("fluid.commonRendererComponent",{gradeNames:[],initFunction:"fluid.initRendererComponent",mergePolicy:{"rendererOptions.idMap":"nomerge","rendererOptions.model":"preserve",protoTree:"noexpand, replace",parentBundle:"nomerge","changeApplierOptions.resolverSetConfig":"resolverSetConfig"},invokers:{refreshView:{funcName:"fluid.rendererComponent.refreshView",args:"{that}"},produceTree:{funcName:"fluid.rendererComponent.produceTree",args:"{that}"}},rendererOptions:{autoBind:!0},events:{prepareModelForRender:null,onRenderTree:null,afterRender:null},listeners:{onCreate:{funcName:"fluid.rendererComponent.renderOnInit",args:["{that}.options.renderOnInit","{that}"],priority:"last"}}}),fluid.defaults("fluid.rendererComponent",{gradeNames:["fluid.commonRendererComponent","fluid.viewComponent","autoInit"]}),fluid.defaults("fluid.rendererRelayComponent",{gradeNames:["fluid.commonRendererComponent","fluid.viewRelayComponent","autoInit"]}),fluid.rendererComponent.renderOnInit=function(renderOnInit,that){renderOnInit&&that.refreshView()},fluid.rendererComponent.refreshView=function(that){fluid.renderer.clearDecorators(that),that.events.prepareModelForRender.fire(that.model,that.applier,that);var tree=that.produceTree(that);that.renderer.expander&&(tree=that.renderer.expander(tree)),that.events.onRenderTree.fire(that,tree),that.renderer.render(tree),that.events.afterRender.fire(that)},fluid.rendererComponent.produceTree=function(that){var produceTreeOption=that.options.produceTree;return produceTreeOption?("string"==typeof produceTreeOption?fluid.getGlobalValue(produceTreeOption):produceTreeOption)(that):that.options.protoTree},fluid.initRendererComponent=function(componentName,container,options){{var that=fluid.initView(componentName,container,options,{gradeNames:["fluid.rendererComponent"]});fluid.getForComponent(that,"model"),fluid.getForComponent(that,"applier")}fluid.diagnoseFailedView(componentName,that,fluid.defaults(componentName),arguments),fluid.fetchResources(that.options.resources);var messageResolver,rendererOptions=fluid.renderer.modeliseOptions(that.options.rendererOptions,null,that);!rendererOptions.messageSource&&that.options.strings&&(messageResolver=fluid.messageResolver({messageBase:that.options.strings,resolveFunc:that.options.messageResolverFunction,parents:fluid.makeArray(that.options.parentBundle)}),rendererOptions.messageSource={type:"resolver",resolver:messageResolver}),fluid.renderer.reverseMerge(rendererOptions,that.options,["resolverGetConfig","resolverSetConfig"]),that.rendererOptions=rendererOptions;var rendererFnOptions=$.extend({},that.options.rendererFnOptions,{rendererOptions:rendererOptions,repeatingSelectors:that.options.repeatingSelectors,selectorsToIgnore:that.options.selectorsToIgnore,expanderOptions:{envAdd:{styles:that.options.styles}}});that.options.resources&&that.options.resources.template&&(rendererFnOptions.templateSource=function(){return that.options.resources.template.resourceText}),fluid.renderer.reverseMerge(rendererFnOptions,that.options,["resolverGetConfig","resolverSetConfig"]),rendererFnOptions.rendererTargetSelector&&(container=function(){return that.dom.locate(rendererFnOptions.rendererTargetSelector)});var renderer={fossils:{},boundPathForNode:function(node){return fluid.boundPathForNode(node,renderer.fossils)}},rendererSub=fluid.renderer.createRendererSubcomponent(container,that.options.selectors,rendererFnOptions,that,renderer.fossils);return that.renderer=$.extend(renderer,rendererSub),messageResolver&&(that.messageResolver=messageResolver),renderer.refreshView=fluid.getForComponent(that,"refreshView"),that};var removeSelectors=function(selectors,selectorsToIgnore){return fluid.each(fluid.makeArray(selectorsToIgnore),function(selectorToIgnore){delete selectors[selectorToIgnore]}),selectors},markRepeated=function(selectorKey,repeatingSelectors){return repeatingSelectors&&fluid.each(repeatingSelectors,function(repeatingSelector){selectorKey===repeatingSelector&&(selectorKey+=":")}),selectorKey};fluid.renderer.selectorsToCutpoints=function(selectors,options){var togo=[];options=options||{},selectors=fluid.copy(selectors),options.selectorsToIgnore&&(selectors=removeSelectors(selectors,options.selectorsToIgnore));for(var selectorKey in selectors)togo.push({id:markRepeated(selectorKey,options.repeatingSelectors),selector:selectors[selectorKey]});return togo},fluid.renderer.NO_COMPONENT={},fluid.renderer.mergeComponents=function(target,source){for(var key in source)target[key]=source[key];return target},fluid.registerNamespace("fluid.renderer.selection"),fluid.renderer.selection.inputs=function(options,container,key,config){fluid.expect("Selection to inputs expander",["selectID","inputID","labelID","rowID"],options);var selection=config.expander(options.tree),rows=fluid.transform(selection.optionlist.value,function(option,index){var togo={},element={parentRelativeID:"..::"+options.selectID,choiceindex:index};return togo[options.inputID]=element,togo[options.labelID]=fluid.copy(element),togo}),togo={};return togo[options.selectID]=selection,togo[options.rowID]={children:rows},togo=config.expander(togo)},fluid.renderer.repeat=function(options,container,key,config){fluid.expect("Repetition expander",["controlledBy","tree"],options);var env=config.threadLocal(),path=fluid.extractContextualPath(options.controlledBy,{ELstyle:"ALL"},env),list=fluid.get(config.model,path,config.resolverGetConfig),togo={};if(!list||0===list.length)return options.ifEmpty?config.expander(options.ifEmpty):togo;var expanded=[];fluid.each(list,function(element,i){var EL=fluid.model.composePath(path,i),envAdd={};options.pathAs&&(envAdd[options.pathAs]="${"+EL+"}"),options.valueAs&&(envAdd[options.valueAs]=fluid.get(config.model,EL,config.resolverGetConfig));var expandrow=fluid.withEnvironment(envAdd,function(){return config.expander(options.tree)},env);fluid.isArrayable(expandrow)?expandrow.length>0&&expanded.push({children:expandrow}):expandrow!==fluid.renderer.NO_COMPONENT&&expanded.push(expandrow)});var repeatID=options.repeatID;return-1===repeatID.indexOf(":")&&(repeatID+=":"),fluid.each(expanded,function(entry){entry.ID=repeatID}),expanded},fluid.renderer.condition=function(options,container,key,config){fluid.expect("Selection to condition expander",["condition"],options);var condition;if(options.condition.funcName){var args=config.expandLight(options.condition.args);condition=fluid.invoke(options.condition.funcName,args)}else condition=options.condition.expander?config.expander(options.condition):config.expandLight(options.condition);var tree=condition?options.trueTree:options.falseTree;return tree||(tree=fluid.renderer.NO_COMPONENT),config.expander(tree)},fluid.extractContextualPath=function(string,options,env,externalFetcher){var parsed=fluid.extractELWithContext(string,options);return parsed?parsed.context?env[parsed.context]?fluid.transformContextPath(parsed,env).path:{value:externalFetcher(parsed)}:parsed.path:void 0},fluid.transformContextPath=function(parsed,env){if(parsed.context){var EL,fetched=env[parsed.context];if("string"==typeof fetched&&(EL=fluid.extractEL(fetched,{ELstyle:"${}"})),EL)return{noDereference:""===parsed.path,path:fluid.model.composePath(EL,parsed.path)}}return parsed},fluid.renderer.makeExternalFetcher=function(contextThat){return function(parsed){var foundComponent=fluid.resolveContext(parsed.context,contextThat);return foundComponent?fluid.getForComponent(foundComponent,parsed.path):void 0}},fluid.renderer.makeProtoExpander=function(expandOptions,parentThat){function fetchEL(string){var env=threadLocal();return fluid.extractContextualPath(string,options,env,options.externalFetcher)}function detectBareBound(entry){return fluid.find(entry,function(value,key){return"decorators"===key})!==!1}var options=$.extend({ELstyle:"${}"},expandOptions);parentThat&&(options.externalFetcher=fluid.renderer.makeExternalFetcher(parentThat));var threadLocal,IDescape=options.IDescape||"\\",expandLight=function(source){return fluid.expand(source,options)},expandBound=function(value,concrete){if(void 0!==value.messagekey)return{componentType:"UIMessage",messagekey:expandBound(value.messagekey),args:expandLight(value.args)};var proto;fluid.isPrimitive(value)||fluid.isArrayable(value)?proto={}:(proto=$.extend({},value),proto.decorators&&(proto.decorators=expandLight(proto.decorators)),value=proto.value,delete proto.value);var EL;if("string"==typeof value){var fetched=fetchEL(value);EL="string"==typeof fetched?fetched:null,value=fluid.get(fetched,"value")||value}return EL?proto.valuebinding=EL:void 0!==value&&(proto.value=value),options.model&&proto.valuebinding&&void 0===proto.value&&(proto.value=fluid.get(options.model,proto.valuebinding,options.resolverGetConfig)),concrete&&(proto.componentType="UIBound"),proto};options.filter=fluid.expander.lightFilter;var expandCond,expandLeafOrCond,expandEntry=function(entry){var comp=[];return expandCond(entry,comp),{children:comp}},expandExternal=function(entry){if(entry===fluid.renderer.NO_COMPONENT)return entry;var singleTarget,target=[],pusher=function(comp){singleTarget=comp};return expandLeafOrCond(entry,target,pusher),singleTarget||target},expandConfig={model:options.model,resolverGetConfig:options.resolverGetConfig,resolverSetConfig:options.resolverSetConfig,expander:expandExternal,expandLight:expandLight},expandLeaf=function(leaf,componentType){var togo={componentType:componentType},map=fluid.renderer.boundMap[componentType]||{};for(var key in leaf)togo[key]=/decorators|args/.test(key)?expandLight(leaf[key]):map[key]?expandBound(leaf[key]):leaf[key];return togo},expandChildren=function(entry,pusher){for(var children=entry.children,i=0;i<children.length;++i){var target=[],comp={children:target},child=children[i],childPusher=function(comp){target[target.length]=comp};expandLeafOrCond(child,target,childPusher),1!==comp.children.length||comp.children[0].ID||(comp=comp.children[0]),pusher(comp)}},expandLeafOrCond=function(entry,target,pusher){var componentType=fluid.renderer.inferComponentType(entry);componentType||!fluid.isPrimitive(entry)&&!detectBareBound(entry)||(componentType="UIBound"),componentType?pusher("UIBound"===componentType?expandBound(entry,!0):expandLeaf(entry,componentType)):(target||fluid.fail("Illegal cond->cond transition"),expandCond(entry,target))};return expandCond=function(proto,target){for(var key in proto){var entry=proto[key];if(key.charAt(0)===IDescape&&(key=key.substring(1)),"expander"===key){var expanders=fluid.makeArray(entry);fluid.each(expanders,function(expander){var expanded=fluid.invokeGlobalFunction(expander.type,[expander,proto,key,expandConfig]);expanded!==fluid.renderer.NO_COMPONENT&&fluid.each(expanded,function(el){target[target.length]=el})})}else if(entry){var condPusher=function(comp){comp.ID=key,target[target.length]=comp};entry.children?(-1===key.indexOf(":")&&(key+=":"),expandChildren(entry,condPusher)):fluid.renderer.isBoundPrimitive(entry)?condPusher(expandBound(entry,!0)):expandLeafOrCond(entry,null,condPusher)}}},function(entry){return threadLocal=fluid.threadLocal(function(){return $.extend({},options.envAdd)}),options.fetcher=fluid.makeEnvironmentFetcher(options.model,fluid.transformContextPath,threadLocal,options.externalFetcher),expandConfig.threadLocal=threadLocal,expandEntry(entry)}}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.pager"),fluid.pager.updateStyles=function(pageListThat,newModel,oldModel){if(oldModel&&void 0!==oldModel.pageIndex){var oldLink=pageListThat.pageLinks.eq(oldModel.pageIndex);oldLink.removeClass(pageListThat.options.styles.currentPage)}var pageLink=pageListThat.pageLinks.eq(newModel.pageIndex);pageLink.addClass(pageListThat.options.styles.currentPage)},fluid.pager.bindLinkClick=function(link,initiatePageChange,eventArg){link.unbind("click.fluid.pager"),link.bind("click.fluid.pager",function(){return initiatePageChange.fire(eventArg),!1})},fluid.pager.computePageCount=function(model){return Math.max(1,Math.floor((model.totalRange-1)/model.pageSize)+1)},fluid.pager.computePageLimit=function(model){return Math.min(model.totalRange,(model.pageIndex+1)*model.pageSize)},fluid.pager.bindLinkClicks=function(pageLinks,initiatePageChange){fluid.each(pageLinks,function(pageLink,i){fluid.pager.bindLinkClick($(pageLink),initiatePageChange,{pageIndex:i})})},fluid.defaults("fluid.pager.pageList",{gradeNames:["fluid.viewRelayComponent"]}),fluid.defaults("fluid.pager.directPageList",{gradeNames:["fluid.pager.pageList","autoInit"],listeners:{onCreate:{funcName:"fluid.pager.bindLinkClicks",args:["{that}.pageLinks","{pager}.events.initiatePageChange"]}},modelListeners:{"{pager}.model":"fluid.pager.updateStyles({that}, {change}.value, {change}.oldValue)"},members:{pageLinks:"{that}.dom.pageLinks",defaultModel:{totalRange:"{that}.pageLinks.length"}}}),fluid.pager.everyPageStrategy=fluid.iota,fluid.pager.gappedPageStrategy=function(locality,midLocality){return locality||(locality=3),midLocality||(midLocality=locality),function(count,first,mid){for(var togo=[],j=0,lastSkip=!1,i=0;count>i;++i)locality>i||locality>count-i-1||i>=mid-midLocality&&mid+midLocality>=i?(togo[j++]=i,lastSkip=!1):lastSkip||(togo[j++]=-1,lastSkip=!0);return togo}},fluid.pager.consistentGappedPageStrategy=function(endLinkCount,midLinkCount){endLinkCount||(endLinkCount=1),midLinkCount||(midLinkCount=endLinkCount);var endWidth=endLinkCount+2+midLinkCount;return function(count,first,mid){for(var pages=[],anchoredLeft=endWidth>mid,anchoredRight=mid>=count-endWidth,anchoredEndWidth=endWidth+midLinkCount,midStart=mid-midLinkCount,midEnd=mid+midLinkCount,lastSkip=!1,page=0;count>page;page++)endLinkCount>page||endLinkCount>=count-page||anchoredLeft&&anchoredEndWidth>page||anchoredRight&&page>=count-anchoredEndWidth||page>=midStart&&midEnd>=page?(pages.push(page),lastSkip=!1):lastSkip||(pages.push(-1),lastSkip=!0);return pages}},fluid.registerNamespace("fluid.pager.renderedPageList"),fluid.pager.renderedPageList.assembleComponent=function(page,isCurrent,initiatePageChange,currentPageStyle,currentPageIndexMsg){var obj={ID:"page-link:link",localID:page+1,value:page+1,pageIndex:page,decorators:[{identify:"pageLink:"+page},{type:"jQuery",func:"click",args:function(event){initiatePageChange.fire({pageIndex:page}),event.preventDefault()}}]};return isCurrent&&(obj.current=!0,obj.decorators=obj.decorators.concat([{type:"addClass",classes:currentPageStyle},{type:"jQuery",func:"attr",args:["aria-label",currentPageIndexMsg]}])),obj},fluid.pager.renderedPageList.onModelChange=function(that,newModel){function pageToComponent(current){return function(page){return-1===page?{ID:"page-link:skip"}:that.assembleComponent(page,page===current)}}var pages=that.options.pageStrategy(newModel.pageCount,0,newModel.pageIndex),pageTree=fluid.transform(pages,pageToComponent(newModel.pageIndex));pageTree.length>1&&(pageTree[pageTree.length-1].value=pageTree[pageTree.length-1].value+that.options.strings.last),that.events.onRenderPageLinks.fire(pageTree,newModel),that.pageTree=pageTree,that.refreshView()},fluid.pager.renderedPageList.renderLinkBody=function(linkBody,rendererOptions){linkBody&&rendererOptions.cutpoints.push({id:"payload-component",selector:linkBody})},fluid.defaults("fluid.pager.renderedPageList",{gradeNames:["fluid.rendererRelayComponent","fluid.pager.pageList","autoInit"],rendererOptions:{idMap:{},cutpoints:[{id:"page-link:link",selector:"{that}.options.selectors.pageLinks"},{id:"page-link:skip",selector:"{that}.options.selectors.pageLinkSkip"}]},rendererFnOptions:{noexpand:!0,templateSource:{node:"{that}.dom.root"},renderTarget:"{that}.dom.root"},events:{onRenderPageLinks:"{pager}.events.onRenderPageLinks"},listeners:{onCreate:{funcName:"fluid.pager.renderedPageList.renderLinkBody",args:["{that}.options.linkBody","{that}.options.rendererOptions"]}},modelListeners:{"{pager}.model":"fluid.pager.renderedPageList.onModelChange({that}, {change}.value)"},invokers:{produceTree:{funcName:"fluid.identity",args:"{that}.pageTree",dynamic:!0},assembleComponent:{funcName:"fluid.pager.renderedPageList.assembleComponent",args:["{arguments}.0","{arguments}.1","{pager}.events.initiatePageChange","{pagerBar}.options.styles.currentPage","{pagerBar}.options.strings.currentPageIndexMsg"]}},selectors:{root:".flc-pager-links",pageLinks:"{pagerBar}.options.selectors.pageLinks",pageLinkSkip:"{pagerBar}.options.selectors.pageLinkSkip"},strings:"{pager}.options.strings",linkBody:"a",pageStrategy:fluid.pager.everyPageStrategy}),fluid.defaults("fluid.pager.previousNext",{gradeNames:["fluid.viewRelayComponent","autoInit"],members:{previous:"{that}.dom.previous",next:"{that}.dom.next"},selectors:{previous:".flc-pager-previous",next:".flc-pager-next"},listeners:{onCreate:[{funcName:"fluid.pager.bindLinkClick",args:["{that}.previous","{pager}.events.initiatePageChange",{relativePage:-1}]},{funcName:"fluid.pager.bindLinkClick",args:["{that}.next","{pager}.events.initiatePageChange",{relativePage:1}]}]},modelListeners:{"{pager}.model":"fluid.pager.previousNext.update({that}, {that}.options.styles.disabled, {change}.value)"}}),fluid.pager.previousNext.update=function(that,disabledStyle,newModel){that.previous.toggleClass(disabledStyle,0===newModel.pageIndex),that.next.toggleClass(disabledStyle,newModel.pageIndex===newModel.pageCount-1)},fluid.defaults("fluid.pager.pagerBar",{gradeNames:["fluid.viewRelayComponent","autoInit"],components:{pageList:{type:"fluid.pager.pageList",container:"{pagerBar}.container",options:{selectors:{pageLinks:"{pagerBar}.options.selectors.pageLinks"},styles:"{pagerBar}.options.styles"}},previousNext:{type:"fluid.pager.previousNext",container:"{pagerBar}.container",options:{selectors:{previous:"{pagerBar}.options.selectors.previous",next:"{pagerBar}.options.selectors.next"},styles:"{pagerBar}.options.styles"}}},events:{initiatePageChange:null,onModelChange:null},selectors:{pageLinks:".flc-pager-pageLink",pageLinkSkip:".flc-pager-pageLink-skip",previous:".flc-pager-previous",next:".flc-pager-next"},styles:{currentPage:"fl-pager-currentPage",disabled:"fl-pager-disabled"},strings:{currentPageIndexMsg:"Current page"}}),fluid.pager.summaryAria=function(element){element.attr({"aria-relevant":"all","aria-atomic":"false","aria-live":"assertive",role:"status"})},fluid.defaults("fluid.pager.summary",{gradeNames:["fluid.viewRelayComponent","autoInit"],listeners:{onCreate:{funcName:"fluid.pager.summaryAria",args:"{that}.container"}},modelListeners:{"{pager}.model":{funcName:"fluid.pager.summary.onModelChange",args:["{that}.container","{that}.options.strings.message","{change}.value"]}}}),fluid.pager.summary.onModelChange=function(node,message,newModel){var text=fluid.stringTemplate(message,{first:newModel.pageIndex*newModel.pageSize+1,last:fluid.pager.computePageLimit(newModel),total:newModel.totalRange,currentPage:newModel.pageIndex+1});node.text(text)},fluid.defaults("fluid.pager.directPageSize",{gradeNames:["fluid.viewRelayComponent","autoInit"],listeners:{onCreate:{"this":"{that}.container",method:"change",args:{expander:{funcName:"fluid.pager.directPageSize.onChange",args:["{pager}.events.initiatePageSizeChange","{that}.container"]}}}},modelListeners:{"{pager}.model.pageSize":"fluid.pager.updateNodeValue({that}.container, {change}.value)"}}),fluid.pager.directPageSize.onChange=function(initiatePageSizeChange,node){return function(){initiatePageSizeChange.fire(node.val()||1)}},fluid.pager.updateNodeValue=function(node,value){node.val(value)},fluid.pager.initiatePageChangeListener=function(that,arg){var newPageIndex=arg.pageIndex;void 0!==arg.relativePage&&(newPageIndex=that.model.pageIndex+arg.relativePage),that.applier.requestChange("pageIndex",newPageIndex)},fluid.pager.initiatePageSizeChangeListener=function(that,arg){that.applier.requestChange("pageSize",arg)},fluid.defaults("fluid.pager",{gradeNames:["fluid.viewRelayComponent","autoInit"],events:{initiatePageChange:null,initiatePageSizeChange:null,onModelChange:null,onRenderPageLinks:null,afterRender:null},model:{pageIndex:0,pageSize:1,totalRange:{expander:{func:"{that}.acquireDefaultRange"}}},selectors:{pagerBar:".flc-pager-top, .flc-pager-bottom",summary:".flc-pager-summary",pageSize:".flc-pager-page-size"},strings:{last:" (last)"},markup:{rangeAnnotation:"<b> %first </b><br/>&mdash;<br/><b> %last </b>"},distributeOptions:{source:"{that}.options.pageList",removeSource:!0,target:"{that fluid.pager.pageList}"},pageList:{type:"fluid.pager.renderedPageList",options:{pageStrategy:fluid.pager.gappedPageStrategy(3,1)}},modelRelay:[{target:"pageCount",singleTransform:{type:"fluid.transforms.free",args:{totalRange:"{that}.model.totalRange",pageSize:"{that}.model.pageSize"},func:"fluid.pager.computePageCount"}},{target:"pageIndex",singleTransform:{type:"fluid.transforms.limitRange",input:"{that}.model.pageIndex",min:0,max:"{that}.model.pageCount",excludeMax:1}}],modelListeners:{"":"{that}.events.onModelChange.fire({change}.value, {change}.oldValue, {that})"},listeners:{onCreate:{namespace:"containerRole","this":"{that}.container",method:"attr",args:["role","application"]},initiatePageChange:{funcName:"fluid.pager.initiatePageChangeListener",args:["{that}","{arguments}.0"]},initiatePageSizeChange:{funcName:"fluid.pager.initiatePageSizeChangeListener",args:["{that}","{arguments}.0"]}},invokers:{acquireDefaultRange:{funcName:"fluid.identity",args:"{that}.pagerBar.pageList.defaultModel.totalRange"}},dynamicComponents:{summary:{sources:"{that}.dom.summary",type:"fluid.pager.summary",container:"{source}",options:{strings:{message:"Viewing page %currentPage. Showing records %first - %last of %total items."},events:{onModelChange:"{pager}.events.onModelChange"}}},pageSize:{sources:"{that}.dom.pageSize",type:"fluid.pager.directPageSize",container:"{source}"},pagerBar:{sources:"{that}.dom.pagerBar",type:"fluid.pager.pagerBar",container:"{source}",options:{strings:"{pager}.options.strings",events:{initiatePageChange:"{pager}.events.initiatePageChange",onModelChange:"{pager}.events.onModelChange"}}}}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.table"),fluid.table.findColumnDef=function(columnDefs,key){return fluid.find_if(columnDefs,function(def){return def.key===key})},fluid.table.getRoots=function(target,dataOffset,index){target.shortRoot=index,target.longRoot=fluid.pathUtil.composePath(dataOffset,target.shortRoot)},fluid.table.expandPath=function(EL,shortRoot,longRoot){return"*"===EL.charAt(0)?longRoot+EL.substring(1):EL.replace("*",shortRoot)},fluid.table.fetchValue=function(dataOffset,dataModel,index,valuebinding,roots){fluid.table.getRoots(roots,dataOffset,index);var path=fluid.table.expandPath(valuebinding,roots.shortRoot,roots.longRoot);return fluid.get(dataModel,path)},fluid.table.rowComparator=function(sortDir){return function(arec,brec){return(arec.value>brec.value?1:arec.value<brec.value?-1:0)*sortDir}},fluid.table.basicSorter=function(columnDefs,dataModel,dataOffset,model){for(var roots={},columnDef=fluid.table.findColumnDef(columnDefs,model.sortKey),sortrecs=[],i=0;i<model.totalRange;++i)sortrecs[i]={index:i,value:fluid.table.fetchValue(dataOffset,dataModel,i,columnDef.valuebinding,roots)};return sortrecs.sort(fluid.table.rowComparator(model.sortDir)),fluid.getMembers(sortrecs,"index")},fluid.table.IDforColumn=function(columnDef,keyPrefix,roots){var EL=columnDef.valuebinding,key=columnDef.key;if(EL||fluid.fail("Error in definition for column with key "+key+": valuebinding is not set"),!key){var segs=fluid.model.parseEL(EL);key=segs[segs.length-1]}return{ID:(keyPrefix||"")+key,EL:fluid.table.expandPath(EL,roots.shortRoot,roots.longRoot)}},fluid.table.bigHeaderForKey=function(key,options){var id=options.rendererOptions.idMap["header:"+key],smallHeader=fluid.jById(id);if(0===smallHeader.length)return null;var headerSortStylisticOffset=options.selectors.headerSortStylisticOffset,bigHeader=fluid.findAncestor(smallHeader,function(element){return $(element).is(headerSortStylisticOffset)});return bigHeader},fluid.table.setSortHeaderClass=function(styles,element,sort){element=$(element),element.removeClass(styles.ascendingHeader),element.removeClass(styles.descendingHeader),0!==sort&&(element.addClass(1===sort?styles.ascendingHeader:styles.descendingHeader),element.attr("aria-sort",1===sort?"ascending":"descending"))},fluid.table.isCurrentColumnSortable=function(columnDefs,model){var columnDef=model.sortKey?fluid.table.findColumnDef(columnDefs,model.sortKey):null;return columnDef?columnDef.sortable:!1},fluid.table.setModelSortHeaderClass=function(columnDefs,newModel,options){var styles=options.styles,sort=fluid.table.isCurrentColumnSortable(columnDefs,newModel)?newModel.sortDir:0;fluid.table.setSortHeaderClass(styles,fluid.table.bigHeaderForKey(newModel.sortKey,options),sort)},fluid.table.generateColumnClick=function(tableThat,options,model,columnDef){return function(){if(columnDef.sortable===!0){var model=tableThat.model,newModel=fluid.copy(model),styles=tableThat.options.styles,oldKey=model.sortKey;if(columnDef.key!==model.sortKey){newModel.sortKey=columnDef.key,newModel.sortDir=1;var oldBig=fluid.table.bigHeaderForKey(oldKey,options);oldBig&&fluid.table.setSortHeaderClass(styles,oldBig,0)}else{if(newModel.sortKey!==columnDef.key)return!1;newModel.sortDir=-1*newModel.sortDir}newModel.pageIndex=0,tableThat.applier.requestChange("",newModel)}return!1}},fluid.table.fetchHeaderDecorators=function(decorators,columnDef){return decorators[columnDef.sortable?"sortableHeader":"unsortableHeader"]},fluid.table.generateHeader=function(tableThat,options,newModel){var sortableColumnTxt=options.strings.sortableColumnText;1===newModel.sortDir?sortableColumnTxt=options.strings.sortableColumnTextAsc:-1===newModel.sortDir&&(sortableColumnTxt=options.strings.sortableColumnTextDesc);var columnDefs=tableThat.options.columnDefs;return{children:fluid.transform(columnDefs,function(columnDef){return{ID:fluid.table.IDforColumn(columnDef,options.keyPrefix,{}).ID,value:columnDef.label,decorators:[{jQuery:["click",fluid.table.generateColumnClick(tableThat,options,newModel,columnDef)]},{identify:"header:"+columnDef.key},{type:"attrs",attributes:{title:columnDef.key===newModel.sortKey?sortableColumnTxt:options.strings.sortableColumnText}}].concat(fluid.table.fetchHeaderDecorators(options.decorators,columnDef))}})}},fluid.table.expandVariables=function(value,opts){for(var togo="",index=0;;){var nextindex=value.indexOf("${",index);if(-1===nextindex){togo+=value.substring(index);break}togo+=value.substring(index,nextindex);var endi=value.indexOf("}",nextindex+2),EL=value.substring(nextindex+2,endi);EL="VALUE"===EL?opts.EL:fluid.table.expandPath(EL,opts.shortRoot,opts.longRoot);var val=fluid.get(opts.dataModel,EL);togo+=val,index=endi+1}return togo},fluid.table.expandPaths=function(target,tree,opts){for(var i in tree){var val=tree[i];fluid.isMarker(val,fluid.VALUE)?target[i]="valuebinding"===i?opts.EL:{valuebinding:opts.EL}:"valuebinding"===i?target[i]=fluid.table.expandPath(tree[i],opts):"object"==typeof val?(target[i]=void 0!==val.length?[]:{},fluid.table.expandPaths(target[i],val,opts)):target[i]="string"==typeof val?fluid.table.expandVariables(val,opts):tree[i]}return target},fluid.table.expandColumnDefs=function(columnDefs,keyPrefix,dataModel,filteredRow,roots){var tree=fluid.transform(columnDefs,function(columnDef){var togo,record=fluid.table.IDforColumn(columnDef,keyPrefix,roots),opts=$.extend({dataModel:dataModel},roots,record);return columnDef.components?(togo="function"==typeof columnDef.components?columnDef.components(filteredRow.row,filteredRow.index):columnDef.components,togo=fluid.table.expandPaths({},togo,opts),togo.ID=record.ID,togo):{ID:record.ID,valuebinding:record.EL}});return tree},fluid.table.fetchDataModel=function(dataModel,dataOffset){return fluid.get(dataModel,dataOffset)},fluid.table.produceTree=function(tableThat,renderThat){var options=renderThat.options,columnDefs=tableThat.options.columnDefs,roots={},tree=fluid.transform(tableThat.filtered,function(filteredRow){return fluid.table.getRoots(roots,tableThat.options.dataOffset,filteredRow.index),"explode"===columnDefs?fluid.explode(filteredRow.row,roots.longRoot):columnDefs.length?fluid.table.expandColumnDefs(columnDefs,renderThat.options.keyPrefix,tableThat.dataModel,filteredRow,roots):void 0}),fullTree={};return fullTree[options.row]=tree,"object"==typeof columnDefs&&(fullTree[options.header]=fluid.table.generateHeader(tableThat,renderThat.options,tableThat.model)),fullTree},fluid.table.sortInvoker=function(tableThat,newModel){var columnDefs=tableThat.options.columnDefs,sorted=fluid.table.isCurrentColumnSortable(columnDefs,newModel)?tableThat.options.sorter(columnDefs,tableThat.options.dataModel,tableThat.options.dataOffset,newModel):null;tableThat.permutation=sorted},fluid.table.onModelChange=function(tableThat,renderThat,newModel){renderThat.sortInvoker(newModel),tableThat.dataModel=tableThat.fetchDataModel(),tableThat.filtered=tableThat.options.modelFilter(tableThat.dataModel,newModel,tableThat.permutation)},fluid.defaults("fluid.table.selfRender",{gradeNames:["fluid.rendererRelayComponent","autoInit"],listeners:{onCreate:[{"this":"{that}.root",method:"addClass",args:"{that}.options.styles.root"}],onIndexModelChange:[{funcName:"fluid.table.onModelChange",namespace:"onModelChange",args:["{fluid.table}","{fluid.table.selfRender}","{arguments}.0","{arguments}.1"]},{func:"{that}.sortInvoker",namespace:"sortInvoker",args:"{arguments}.0"},{priority:"last",namespace:"refreshView",func:"{that}.refreshView"}],afterRender:{funcName:"fluid.table.setModelSortHeaderClass",args:["{that}.options.columnDefs","{fluid.table}.model","{that}.options"]}},modelListeners:{"{fluid.table}.model":"{that}.events.onIndexModelChange.fire({change}.value, {change}.oldValue)"},events:{onIndexModelChange:null},invokers:{sortInvoker:{funcName:"fluid.table.sortInvoker",args:["{fluid.table}","{arguments}.0"]},produceTree:{funcName:"fluid.table.produceTree",args:["{fluid.table}","{fluid.table.selfRender}"]}},selectors:{root:".flc-pager-body-template",headerSortStylisticOffset:"{table}.options.selectors.headerSortStylisticOffset"},selectorsToIgnore:["root","headerSortStylisticOffset"],styles:{root:"fl-pager",ascendingHeader:"{table}.options.styles.ascendingHeader",descendingHeader:"{table}.options.styles.descendingHeader"},members:{root:"{that}.dom.root"},decorators:{sortableHeader:[],unsortableHeader:[]},keyStrategy:"id",keyPrefix:"",row:"row:",header:"header:",strings:"{table}.options.strings",columnDefs:"{table}.options.columnDefs",rendererFnOptions:{templateSource:{node:"{that}.dom.root"},renderTarget:"{that}.dom.root",noexpand:!0},rendererOptions:{model:"{table}.options.dataModel",idMap:{}}}),fluid.table.checkTotalRange=function(totalRange,pagerBar){void 0!==totalRange||pagerBar||fluid.fail("Error in Pager configuration - cannot determine total range,  since not configured in model.totalRange and no PagerBar is configured")},fluid.defaults("fluid.table",{gradeNames:["fluid.viewComponent","autoInit"],mergePolicy:{dataModel:"preserve",columnDefs:"noexpand"},components:{bodyRenderer:{type:"fluid.table.selfRender",container:"{table}.container"}},listeners:{onCreate:{funcName:"fluid.table.checkTotalRange",namespace:"checkTotalRange",args:["{that}.model.totalRange","{that}.pagerBar"]}},modelFilter:fluid.table.directModelFilter,sorter:fluid.table.basicSorter,members:{dataModel:{expander:{func:"{that}.fetchDataModel"}}},invokers:{fetchDataModel:{funcName:"fluid.table.fetchDataModel",args:["{that}.options.dataModel","{that}.options.dataOffset"]}},styles:{ascendingHeader:"fl-pager-asc",descendingHeader:"fl-pager-desc"},selectors:{headerSortStylisticOffset:".flc-pager-sort-header"},strings:{sortableColumnText:"Select to sort",sortableColumnTextDesc:"Select to sort in ascending, currently in descending order.",sortableColumnTextAsc:"Select to sort in descending, currently in ascending order."},dataOffset:"",columnDefs:[]})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.pagedTable"),fluid.defaults("fluid.pagedTable.rangeAnnotator",{gradeNames:["fluid.eventedComponent","autoInit"]}),fluid.pagedTable.rangeAnnotator.onRenderPageLinks=function(that,tree,newModel,pagerBar){function fetchValue(index){return index=that.permutation?that.permutation[index]:index,fluid.table.fetchValue(that.options.dataOffset,dataModel,index,columnDef.valuebinding,roots)}pagerBar.tooltip.close();var roots={},column=that.options.annotateColumnRange||(that.options.annotateSortedColumn?newModel.sortKey:null);if(column){var dataModel=that.options.dataModel,columnDefs=that.options.columnDefs,columnDef=fluid.table.findColumnDef(columnDefs,column),tModel={};fluid.model.copyModel(tModel,newModel);var tooltipInfo={};fluid.each(tree,function(cell){if("page-link:link"===cell.ID&&!cell.current){var page=cell.pageIndex,start=page*tModel.pageSize;tModel.pageIndex=page;var limit=fluid.pager.computePageLimit(tModel),iValue=fetchValue(start),lValue=fetchValue(limit-1);tooltipInfo[page]={first:iValue,last:lValue}}}),pagerBar.tooltipInfo=tooltipInfo}},fluid.pagedTable.directModelFilter=function(model,pagerModel,perm){for(var togo=[],limit=fluid.pager.computePageLimit(pagerModel),i=pagerModel.pageIndex*pagerModel.pageSize;limit>i;++i){var index=perm?perm[i]:i;togo[togo.length]={index:index,row:model[index]}}return togo},fluid.pagedTable.configureTooltip=function(pagedTable,pagerBar,renderedPageList){var idMap=renderedPageList.rendererOptions.idMap,idToContent={};fluid.each(pagerBar.tooltipInfo,function(value,index){idToContent[idMap["pageLink:"+index]]=fluid.stringTemplate(pagedTable.options.markup.rangeAnnotation,value)}),pagerBar.tooltip.applier.requestChange("idToContent",idToContent)},fluid.defaults("fluid.pagedTable",{gradeNames:["fluid.pager","fluid.table","autoInit"],distributeOptions:[{target:"{that renderedPageList}.options.listeners.afterRender",record:{funcName:"fluid.pagedTable.configureTooltip",args:["{pagedTable}","{pagerBar}","{arguments}.0"]}},{target:"{that renderedPageList}.options.listeners.onRenderPageLinks",record:{funcName:"fluid.pagedTable.rangeAnnotator.onRenderPageLinks",args:["{pagedTable}","{arguments}.0","{arguments}.1","{pagerBar}"]}},{target:"{that pagerBar}.options.components.tooltip",source:"{that}.options.tooltip"}],annotateSortedColumn:!1,annotateColumnRange:void 0,markup:{rangeAnnotation:"<b> %first </b><br/>&mdash;<br/><b> %last </b>"},tooltip:{type:"fluid.tooltip",container:"{that}.container",options:{}},invokers:{acquireDefaultRange:{funcName:"fluid.identity",args:"{that}.dataModel.length"}},modelFilter:fluid.pagedTable.directModelFilter,model:{pageSize:10}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.progress"),fluid.progress.animateDisplay=function(elm,animation,defaultAnimation,callback){animation=animation?animation:defaultAnimation,elm.animate(animation.params,animation.duration,callback)},fluid.progress.animateProgress=function(elm,width,speed){elm.queue("fx",[]),elm.animate({width:width,queue:!1},speed)},fluid.progress.showProgress=function(that,animation){var firer=that.events.onProgressBegin.fire;animation===!1?(that.displayElement.show(),firer()):fluid.progress.animateDisplay(that.displayElement,animation,that.options.showAnimation,firer)},fluid.progress.hideProgress=function(that,delay,animation){if(delay){setTimeout(function(){fluid.progress.hideProgress(that,0,animation)},delay)}else{var firer=that.events.afterProgressHidden.fire;animation===!1?(that.displayElement.hide(),firer()):fluid.progress.animateDisplay(that.displayElement,animation,that.options.hideAnimation,firer)}},fluid.progress.updateWidth=function(that,newWidth,dontAnimate){var currWidth=that.indicator.width(),direction=that.options.animate;newWidth>currWidth&&("both"===direction||"forward"===direction)&&!dontAnimate?fluid.progress.animateProgress(that.indicator,newWidth,that.options.speed):currWidth>newWidth&&("both"===direction||"backward"===direction)&&!dontAnimate?fluid.progress.animateProgress(that.indicator,newWidth,that.options.speed):that.indicator.width(newWidth)},fluid.progress.percentToPixels=function(that,percent){return Math.round(Math.min(percent,100)*that.progressBar.innerWidth()/100)},fluid.progress.refreshRelativeWidth=function(that){var pixels=Math.max(fluid.progress.percentToPixels(that,parseFloat(that.storedPercent)),that.options.minWidth);fluid.progress.updateWidth(that,pixels,!0)},fluid.progress.initARIA=function(ariaElement,ariaBusyText){ariaElement.attr("role","progressbar"),ariaElement.attr("aria-valuemin","0"),ariaElement.attr("aria-valuemax","100"),ariaElement.attr("aria-valuenow","0"),ariaBusyText&&ariaElement.attr("aria-valuetext",""),ariaElement.attr("aria-busy","false")},fluid.progress.updateARIA=function(that,percent){var str=that.options.strings,busy=100>percent&&percent>0;if(that.ariaElement.attr("aria-busy",busy),that.ariaElement.attr("aria-valuenow",percent),str.ariaBusyText)if(busy){var busyString=fluid.stringTemplate(str.ariaBusyText,{percentComplete:percent});that.ariaElement.attr("aria-valuetext",busyString)}else 100===percent&&that.ariaElement.attr("aria-valuetext",str.ariaDoneText)},fluid.progress.updateText=function(label,value){label.html(value)},fluid.progress.repositionIndicator=function(that){that.indicator.css("top",that.progressBar.position().top).css("left",0).height(that.progressBar.height()),fluid.progress.refreshRelativeWidth(that)},fluid.progress.updateProgress=function(that,percent,labelText,animationForShow){if(fluid.progress.showProgress(that,animationForShow),null!==percent){that.storedPercent=percent;var pixels=Math.max(fluid.progress.percentToPixels(that,parseFloat(percent)),that.options.minWidth);fluid.progress.updateWidth(that,pixels)}null!==labelText&&fluid.progress.updateText(that.label,labelText),that.ariaElement&&fluid.progress.updateARIA(that,percent)},fluid.progress.hideElement=function(element,shouldHide){element.toggle(!shouldHide)},fluid.defaults("fluid.progress",{gradeNames:["fluid.viewComponent","autoInit"],members:{displayElement:"{that}.dom.displayElement",progressBar:"{that}.dom.progressBar",label:"{that}.dom.label",indicator:"{that}.dom.indicator",ariaElement:"{that}.dom.ariaElement",storedPercent:0},events:{onProgressBegin:null,afterProgressHidden:null},listeners:{onCreate:[{"this":"{that}.dom.indicator",method:"width",args:"{that}.options.minWidth"},{funcName:"fluid.progress.hideElement",args:["{that}.dom.displayElement","{that}.options.initiallyHidden"]},{funcName:"fluid.progress.initARIA",args:["{that}.ariaElement","{that}.options.strings.ariaBusyText"]}],onProgressBegin:{func:"{that}.options.showAnimation.callback"},afterProgressHidden:{func:"{that}.options.hideAnimation.callback"}},invokers:{show:{funcName:"fluid.progress.showProgress",args:["{that}","{arguments}.0"]},hide:{funcName:"fluid.progress.hideProgress",args:["{that}","{arguments}.0","{arguments}.1"]},update:{funcName:"fluid.progress.updateProgress",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]},refreshView:{funcName:"fluid.progress.repositionIndicator",args:"{that}"}},selectors:{displayElement:".flc-progress",progressBar:".flc-progress-bar",indicator:".flc-progress-indicator",label:".flc-progress-label",ariaElement:".flc-progress-bar"},strings:{ariaBusyText:"Progress is %percentComplete percent complete",ariaDoneText:"Progress is complete."},showAnimation:{params:{opacity:"show"},duration:"slow",callback:fluid.identity},hideAnimation:{params:{opacity:"hide"},duration:"slow",callback:fluid.identity},minWidth:5,delay:0,speed:200,animate:"forward",initiallyHidden:!0,updatePosition:!1})}(jQuery,fluid_1_5);;this.JSON||(JSON=function(){function f(n){return 10>n?"0"+n:n}function stringify(value,whitelist){var a,i,k,l,v,r=/["\\\x00-\x1f\x7f-\x9f]/g;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];return c?c:(c=a.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if("function"==typeof value.toJSON)return stringify(value.toJSON());if(a=[],"number"==typeof value.length&&!value.propertyIsEnumerable("length")){for(l=value.length,i=0;l>i;i+=1)a.push(stringify(value[i],whitelist)||"null");return"["+a.join(",")+"]"}if(whitelist)for(l=whitelist.length,i=0;l>i;i+=1)k=whitelist[i],"string"==typeof k&&(v=stringify(value[k],whitelist),v&&a.push(stringify(k)+":"+v));else for(k in value)"string"==typeof k&&(v=stringify(value[k],whitelist),v&&a.push(stringify(k)+":"+v));return"{"+a.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:stringify,parse:function(text,filter){function walk(k,v){var i,n;if(v&&"object"==typeof v)for(i in v)Object.prototype.hasOwnProperty.apply(v,[i])&&(n=walk(i,v[i]),void 0!==n&&(v[i]=n));return filter(k,v)}var j;if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(:?[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof filter?walk("",j):j;throw new SyntaxError("parseJSON")}}}());;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.dom.computeAbsolutePosition=function(element){var curleft=0,curtop=0;if(element.offsetParent){do curleft+=element.offsetLeft,curtop+=element.offsetTop,element=element.offsetParent;while(element);return[curleft,curtop]}},fluid.dom.cleanseScripts=function(element){var cleansed=$.data(element,fluid.dom.cleanseScripts.MARKER);cleansed||(fluid.dom.iterateDom(element,function(node){return"script"===node.tagName.toLowerCase()?"delete":null}),$.data(element,fluid.dom.cleanseScripts.MARKER,!0))},fluid.dom.cleanseScripts.MARKER="fluid-scripts-cleansed",fluid.dom.insertAfter=function(newChild,refChild){var nextSib=refChild.nextSibling;nextSib?refChild.parentNode.insertBefore(newChild,nextSib):refChild.parentNode.appendChild(newChild)},fluid.dom.isWhitespaceNode=function(node){return!/[^\t\n\r ]/.test(node.data)},fluid.dom.isIgnorableNode=function(node){return 8===node.nodeType||3===node.nodeType&&fluid.dom.isWhitespaceNode(node)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.orientation={HORIZONTAL:4,VERTICAL:1},fluid.rectSides={4:["left","right"],1:["top","bottom"],8:"top",12:"bottom",2:"left",3:"right"},fluid.position={BEFORE:-1,AFTER:1,INSIDE:2,REPLACE:3},fluid.direction={NEXT:1,PREVIOUS:-1,UP:8,DOWN:12,LEFT:2,RIGHT:3},fluid.directionSign=function(direction){return direction===fluid.direction.UP||direction===fluid.direction.LEFT?fluid.direction.PREVIOUS:fluid.direction.NEXT},fluid.directionAxis=function(direction){return direction===fluid.direction.LEFT||direction===fluid.direction.RIGHT?0:1},fluid.directionOrientation=function(direction){return fluid.directionAxis(direction)?fluid.orientation.VERTICAL:fluid.orientation.HORIZONTAL},fluid.keycodeDirection={up:fluid.direction.UP,down:fluid.direction.DOWN,left:fluid.direction.LEFT,right:fluid.direction.RIGHT},fluid.registerNamespace("fluid.dom"),fluid.dom.moveDom=function(source,target,position){source=fluid.unwrap(source),target=fluid.unwrap(target);var scan;if(position===fluid.position.INSIDE)target.appendChild(source);else if(position===fluid.position.BEFORE){for(scan=target.previousSibling;;scan=scan.previousSibling)if(!scan||!fluid.dom.isIgnorableNode(scan)){scan!==source&&(fluid.dom.cleanseScripts(source),target.parentNode.insertBefore(source,target));break}}else if(position===fluid.position.AFTER){for(scan=target.nextSibling;;scan=scan.nextSibling)if(!scan||!fluid.dom.isIgnorableNode(scan)){scan!==source&&(fluid.dom.cleanseScripts(source),fluid.dom.insertAfter(source,target));break}}else fluid.fail("Unrecognised position supplied to fluid.moveDom: "+position)},fluid.dom.normalisePosition=function(position,samespan,targeti,sourcei){return position===fluid.position.REPLACE&&(position=samespan&&targeti>=sourcei?fluid.position.AFTER:fluid.position.BEFORE),position},fluid.dom.permuteDom=function(element,target,position,sourceelements,targetelements){element=fluid.unwrap(element),target=fluid.unwrap(target);var sourcei=$.inArray(element,sourceelements);-1===sourcei&&fluid.fail("Error in permuteDom: source element "+fluid.dumpEl(element)+" not found in source list "+fluid.dumpEl(sourceelements));var targeti=$.inArray(target,targetelements);-1===targeti&&fluid.fail("Error in permuteDom: target element "+fluid.dumpEl(target)+" not found in source list "+fluid.dumpEl(targetelements));var samespan=sourceelements===targetelements;position=fluid.dom.normalisePosition(position,samespan,targeti,sourcei);var oldn={};oldn[fluid.position.AFTER]=element.nextSibling,oldn[fluid.position.BEFORE]=element.previousSibling,fluid.dom.moveDom(sourceelements[sourcei],targetelements[targeti],position);var i,frontlimit=samespan?targeti-1:sourceelements.length-2;if(position===fluid.position.BEFORE&&samespan&&frontlimit--,!samespan||targeti>sourcei){for(i=frontlimit;i>sourcei;--i)fluid.dom.moveDom(sourceelements[i+1],sourceelements[i],fluid.position.AFTER);sourcei+1<sourceelements.length&&fluid.dom.moveDom(sourceelements[sourcei+1],oldn[fluid.position.AFTER],fluid.position.BEFORE)}var backlimit=samespan?sourcei-1:targetelements.length-1;if(position===fluid.position.AFTER&&targeti++,!samespan||sourcei>targeti){for(i=targeti;backlimit>i;++i)fluid.dom.moveDom(targetelements[i],targetelements[i+1],fluid.position.BEFORE);backlimit>=0&&backlimit<targetelements.length-1&&fluid.dom.moveDom(targetelements[backlimit],oldn[fluid.position.BEFORE],fluid.position.AFTER)}};var curCss=function(a,name){return window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(name):a.currentStyle[name]};fluid.dom.isAttached=function(node){for(;node&&node.nodeName;){if("BODY"===node.nodeName)return!0;node=node.parentNode}return!1},fluid.dom.generalHidden=function(a){return"hidden"===a.type||"none"===curCss(a,"display")||"hidden"===curCss(a,"visibility")||!fluid.dom.isAttached(a)},fluid.registerNamespace("fluid.geometricManager"),fluid.geometricManager.computeGeometry=function(element,orientation,disposition){var elem={};elem.element=element,elem.orientation=orientation,disposition===fluid.position.INSIDE&&(elem.position=disposition),fluid.dom.generalHidden(element)&&(elem.clazz="hidden");var pos=fluid.dom.computeAbsolutePosition(element)||[0,0],width=element.offsetWidth,height=element.offsetHeight;return elem.rect={left:pos[0],top:pos[1]},elem.rect.right=pos[0]+width,elem.rect.bottom=pos[1]+height,elem};var SENTINEL_DIMENSION=1e4;fluid.geometricManager.dumprect=function(rect){return"Rect top: "+rect.top+" left: "+rect.left+" bottom: "+rect.bottom+" right: "+rect.right},fluid.geometricManager.dumpelem=function(cacheelem){return cacheelem&&cacheelem.rect?fluid.geometricManager.dumprect(cacheelem.rect)+" position: "+cacheelem.position+" for "+fluid.dumpEl(cacheelem.element):"null"},fluid.dropManager=function(){var lastClosest,lastGeometry,displacementX,displacementY,targets=[],cache={},that={};that.updateGeometry=function(geometricInfo){lastGeometry=geometricInfo,targets=[],cache={};for(var mapper=geometricInfo.elementMapper,geometryComputor=geometricInfo.geometryComputor||fluid.geometricManager.computeGeometry,i=0;i<geometricInfo.extents.length;++i){for(var thisInfo=geometricInfo.extents[i],orientation=thisInfo.orientation,sides=fluid.rectSides[orientation],processElement=function(element,sentB,sentF,disposition,j){var cacheelem=geometryComputor(element,orientation,disposition);cacheelem.owner=thisInfo,"hidden"!==cacheelem.clazz&&mapper&&(cacheelem.clazz=mapper(element)),cache[fluid.dropManager.cacheKey(element)]=cacheelem;var backClass=fluid.dropManager.getRelativeClass(thisInfo.elements,j,fluid.position.BEFORE,cacheelem.clazz,mapper),frontClass=fluid.dropManager.getRelativeClass(thisInfo.elements,j,fluid.position.AFTER,cacheelem.clazz,mapper);return disposition===fluid.position.INSIDE?targets[targets.length]=cacheelem:fluid.dropManager.splitElement(targets,sides,cacheelem,disposition,backClass,frontClass),sentB&&geometricInfo.sentinelize&&fluid.dropManager.sentinelizeElement(targets,sides,cacheelem,1,disposition,backClass),sentF&&geometricInfo.sentinelize&&fluid.dropManager.sentinelizeElement(targets,sides,cacheelem,0,disposition,frontClass),cacheelem},allHidden=!0,j=0;j<thisInfo.elements.length;++j){var element=thisInfo.elements[j],cacheelem=processElement(element,0===j,j===thisInfo.elements.length-1,fluid.position.INTERLEAVED,j);"hidden"!==cacheelem.clazz&&(allHidden=!1)}allHidden&&thisInfo.parentElement&&processElement(thisInfo.parentElement,!0,!0,fluid.position.INSIDE)}fluid.dropManager.normalizeSentinels(targets)},that.startDrag=function(event,handlePos,handleWidth,handleHeight){var handleMidX=handlePos[0]+handleWidth/2,handleMidY=handlePos[1]+handleHeight/2,dX=handleMidX-event.pageX,dY=handleMidY-event.pageY;that.updateGeometry(lastGeometry),lastClosest=null,displacementX=dX,displacementY=dY,$("body").bind("mousemove.fluid-dropManager",that.mouseMove)},that.lastPosition=function(){return lastClosest},that.endDrag=function(){$("body").unbind("mousemove.fluid-dropManager")},that.mouseMove=function(evt){var x=evt.pageX+displacementX,y=evt.pageY+displacementY,closestTarget=that.closestTarget(x,y,lastClosest);closestTarget&&closestTarget!==fluid.dropManager.NO_CHANGE&&(lastClosest=closestTarget,that.dropChangeFirer.fire(closestTarget))},that.dropChangeFirer=fluid.event.getEventFirer();var blankHolder={element:null};return that.closestTarget=function(x,y,lastClosest){for(var mindistance=Number.MAX_VALUE,minelem=blankHolder,minlockeddistance=Number.MAX_VALUE,minlockedelem=blankHolder,i=0;i<targets.length;++i){var cacheelem=targets[i];if("hidden"!==cacheelem.clazz){var distance=fluid.geom.minPointRectangle(x,y,cacheelem.rect);if("locked"===cacheelem.clazz)minlockeddistance>distance&&(minlockeddistance=distance,minlockedelem=cacheelem);else if(mindistance>distance&&(mindistance=distance,minelem=cacheelem),0===distance)break}}return minelem?(minlockeddistance>=mindistance&&(minlockedelem=blankHolder),lastClosest&&lastClosest.position===minelem.position&&fluid.unwrap(lastClosest.element)===fluid.unwrap(minelem.element)&&fluid.unwrap(lastClosest.lockedelem)===fluid.unwrap(minlockedelem.element)?fluid.dropManager.NO_CHANGE:{position:minelem.position,element:minelem.element,lockedelem:minlockedelem.element}):minelem},that.shuffleProjectFrom=function(element,direction,includeLocked,disableWrap){var togo=that.projectFrom(element,direction,includeLocked,disableWrap);return togo&&(togo.position=fluid.position.REPLACE),togo},that.projectFrom=function(element,direction,includeLocked,disableWrap){that.updateGeometry(lastGeometry);var cacheelem=cache[fluid.dropManager.cacheKey(element)],projected=fluid.geom.projectFrom(cacheelem.rect,direction,targets,includeLocked,disableWrap);if(!projected.cacheelem)return null;var retpos=projected.cacheelem.position;return{element:projected.cacheelem.element,position:retpos?retpos:fluid.position.BEFORE}},that.logicalFrom=function(element,direction,includeLocked,disableWrap){var orderables=that.getOwningSpan(element,fluid.position.INTERLEAVED,includeLocked);return{element:fluid.dropManager.getRelativeElement(element,direction,orderables,disableWrap),position:fluid.position.REPLACE}},that.lockedWrapFrom=function(element,direction,includeLocked,disableWrap){var base=that.logicalFrom(element,direction,includeLocked,disableWrap),selectables=that.getOwningSpan(element,fluid.position.INTERLEAVED,includeLocked),allElements=cache[fluid.dropManager.cacheKey(element)].owner.elements;if(includeLocked||selectables[0]===allElements[0])return base;var directElement=fluid.dropManager.getRelativeElement(element,direction,allElements,disableWrap);return"locked"===lastGeometry.elementMapper(directElement)&&(base.element=null,base.clazz="locked"),base},that.getOwningSpan=function(element,position,includeLocked){var owner=cache[fluid.dropManager.cacheKey(element)].owner,elements=position===fluid.position.INSIDE?[owner.parentElement]:owner.elements;return!includeLocked&&lastGeometry.elementMapper&&(elements=fluid.makeArray(elements),fluid.remove_if(elements,function(element){return"locked"===lastGeometry.elementMapper(element)})),elements},that.geometricMove=function(element,target,position){var sourceElements=that.getOwningSpan(element,null,!0),targetElements=that.getOwningSpan(target,position,!0);fluid.dom.permuteDom(element,target,position,sourceElements,targetElements)},that},fluid.dropManager.NO_CHANGE="no change",fluid.dropManager.cacheKey=function(element){return fluid.allocateSimpleId(element)},fluid.dropManager.sentinelizeElement=function(targets,sides,cacheelem,fc,disposition,clazz){var elemCopy=$.extend(!0,{},cacheelem);elemCopy.origRect=fluid.copy(elemCopy.rect),elemCopy.rect[sides[fc]]=elemCopy.rect[sides[1-fc]]+(fc?1:-1),elemCopy.rect[sides[1-fc]]=(fc?-1:1)*SENTINEL_DIMENSION,elemCopy.position=disposition===fluid.position.INSIDE?disposition:fc?fluid.position.BEFORE:fluid.position.AFTER,elemCopy.clazz=clazz,targets[targets.length]=elemCopy},fluid.dropManager.normalizeSentinels=function(targets){for(var i=0;i<targets.length;++i)for(var j=0;j<targets.length;++j){var ti=targets[i],tj=targets[j],jrect=tj.origRect||tj.rect;ti.element!==tj.element&&ti.origRect&&0===fluid.geom.minRectRect(ti.rect,jrect)&&(ti.rect=ti.origRect,delete ti.origRect)}},fluid.dropManager.splitElement=function(targets,sides,cacheelem,disposition,clazz1,clazz2){var elem1=$.extend(!0,{},cacheelem),elem2=$.extend(!0,{},cacheelem),midpoint=(elem1.rect[sides[0]]+elem1.rect[sides[1]])/2;elem1.rect[sides[1]]=midpoint,elem1.position=fluid.position.BEFORE,elem2.rect[sides[0]]=midpoint,elem2.position=fluid.position.AFTER,elem1.clazz=clazz1,elem2.clazz=clazz2,targets[targets.length]=elem1,targets[targets.length]=elem2},fluid.dropManager.getRelativeClass=function(thisElements,index,relative,thisclazz,mapper){return index+=relative,0>index&&"locked"===thisclazz?"locked":index>=thisElements.length||null===mapper?null:(relative=thisElements[index],"locked"===mapper(relative)&&"locked"===thisclazz?"locked":null)},fluid.dropManager.getRelativeElement=function(element,direction,elements,disableWrap){var folded=fluid.directionSign(direction),index=$(elements).index(element)+folded;return 0>index&&(index+=elements.length),!disableWrap||index!==elements.length&&index!==elements.length+folded?(index%=elements.length,elements[index]):element},fluid.geom=fluid.geom||{},fluid.geom.minPointRectangle=function(x,y,rectangle){var dx=x<rectangle.left?rectangle.left-x:x>rectangle.right?x-rectangle.right:0,dy=y<rectangle.top?rectangle.top-y:y>rectangle.bottom?y-rectangle.bottom:0;return dx*dx+dy*dy},fluid.geom.minRectRect=function(rect1,rect2){var dx=rect1.right<rect2.left?rect2.left-rect1.right:rect2.right<rect1.left?rect1.left-rect2.right:0,dy=rect1.bottom<rect2.top?rect2.top-rect1.bottom:rect2.bottom<rect1.top?rect1.top-rect2.bottom:0;return dx*dx+dy*dy};var makePenCollect=function(){return{mindist:Number.MAX_VALUE,minrdist:Number.MAX_VALUE}};fluid.geom.projectFrom=function(baserect,direction,targets,forSelection,disableWrap){function accPen(collect,cacheelem,backSign){var thisrect=cacheelem.rect,pdist=fluid.geom.minRectRect(penrect,thisrect),rdist=-dirSign*backSign*(baserect[1===backSign?frontSide:backSide]-thisrect[1===backSign?backSide:frontSide]);if(pdist<=collect.mindist&&rdist>=0){if(pdist===collect.mindist&&rdist*backSign>collect.minrdist)return;collect.minrdist=rdist*backSign,collect.mindist=pdist,collect.minelem=cacheelem}}var axis=fluid.directionAxis(direction),frontSide=fluid.rectSides[direction],backSide=fluid.rectSides[15*axis+5-direction],dirSign=fluid.directionSign(direction),penrect={left:(7*baserect.left+1*baserect.right)/8,right:(5*baserect.left+3*baserect.right)/8,top:(7*baserect.top+1*baserect.bottom)/8,bottom:(5*baserect.top+3*baserect.bottom)/8};penrect[frontSide]=dirSign*SENTINEL_DIMENSION,penrect[backSide]=-penrect[frontSide];for(var collect=makePenCollect(),backcollect=makePenCollect(),lockedcollect=makePenCollect(),i=0;i<targets.length;++i){var elem=targets[i],isPure=elem.owner&&elem.element===elem.owner.parentElement;"hidden"===elem.clazz||forSelection&&isPure||(forSelection||"locked"!==elem.clazz?(accPen(collect,elem,1),accPen(backcollect,elem,-1)):accPen(lockedcollect,elem,1))}var wrap=!collect.minelem||backcollect.mindist<collect.mindist;wrap=wrap&&!disableWrap;var mincollect=wrap?backcollect:collect,togo={wrapped:wrap,cacheelem:mincollect.minelem};return lockedcollect.mindist<mincollect.mindist&&(togo.lockedelem=lockedcollect.minelem),togo}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.reorderer=fluid.registerNamespace("fluid.reorderer"),fluid.reorderer.defaultAvatarCreator=function(item,cssClass,dropWarning){fluid.dom.cleanseScripts(fluid.unwrap(item));var avatar=$(item).clone();if(fluid.dom.iterateDom(avatar.get(0),function(node){node.removeAttribute("id"),"input"===node.tagName.toLowerCase()&&node.setAttribute("disabled","disabled")}),avatar.removeProp("id"),avatar.removeClass("ui-droppable"),avatar.addClass(cssClass),dropWarning){var avatarContainer=$(document.createElement("div"));avatarContainer.append(avatar),avatarContainer.append(dropWarning),avatar=avatarContainer}return $("body").append(avatar),$.browser.safari||avatar.css("display","block").width(item.offsetWidth).height(item.offsetHeight),$.browser.opera&&avatar.hide(),avatar},fluid.reorderer.bindHandlersToContainer=function(container,keyDownHandler,keyUpHandler){var actualKeyDown=keyDownHandler,advancedPrevention=!1;$.browser.opera&&(container.keypress(function(evt){return advancedPrevention?(advancedPrevention=!1,evt.preventDefault(),!1):void 0}),actualKeyDown=function(evt){var oldret=keyDownHandler(evt);oldret===!1&&(advancedPrevention=!0)}),container.keydown(actualKeyDown),container.keyup(keyUpHandler)},fluid.reorderer.addRolesToContainer=function(that){that.container.attr("role",that.options.containerRole.container),that.container.attr("aria-multiselectable","false"),that.container.attr("aria-readonly","false"),that.container.attr("aria-disabled","false")},fluid.reorderer.createAvatarId=function(parentId){return parentId+"_avatar"},fluid.reorderer.keys={TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:19,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,i:73,j:74,k:75,m:77},fluid.reorderer.defaultKeysets=[{modifier:function(evt){return evt.ctrlKey},up:fluid.reorderer.keys.UP,down:fluid.reorderer.keys.DOWN,right:fluid.reorderer.keys.RIGHT,left:fluid.reorderer.keys.LEFT},{modifier:function(evt){return evt.ctrlKey},up:fluid.reorderer.keys.i,down:fluid.reorderer.keys.m,right:fluid.reorderer.keys.k,left:fluid.reorderer.keys.j}],fluid.defaults("fluid.reorderer",{gradeNames:["fluid.viewComponent","autoInit"],styles:{defaultStyle:"fl-reorderer-movable-default",selected:"fl-reorderer-movable-selected",dragging:"fl-reorderer-movable-dragging",mouseDrag:"fl-reorderer-movable-dragging",hover:"fl-reorderer-movable-hover",dropMarker:"fl-reorderer-dropMarker",avatar:"fl-reorderer-avatar"},selectors:{dropWarning:".flc-reorderer-dropWarning",movables:".flc-reorderer-movable",selectables:".flc-reorderer-movable",dropTargets:".flc-reorderer-movable",grabHandle:"",stylisticOffset:""},avatarCreator:fluid.reorderer.defaultAvatarCreator,keysets:fluid.reorderer.defaultKeysets,containerRole:"{that}.layoutHandler.options.containerRole",selectablesTabindex:"{that}.layoutHandler.options.selectablesTabindex",layoutHandler:"fluid.listLayoutHandler",members:{activeItem:null,kbDropWarning:"{that}.dom.dropWarning"},events:{onShowKeyboardDropWarning:null,onSelect:null,onBeginMove:"preventable",onMove:null,afterMove:null,onHover:null,onRefresh:null},listeners:{onCreate:[{funcName:"fluid.reorderer.bindHandlersToContainer",args:["{that}.container","{that}.handleKeyDown","{that}.handleKeyUp"]},{funcName:"fluid.reorderer.addRolesToContainer",args:"{that}"},{funcName:"fluid.tabbable",args:"{that}.container"},{funcName:"fluid.reorderer.processAfterMoveCallbackUrl",args:"{that}"},"{that}.refresh"],onRefresh:{listener:"fluid.reorderer.initItems",args:"{that}",priority:-1e3},onHover:{funcName:"fluid.reorderer.hoverStyleHandler",args:["{that}.dom","{that}.options.styles","{arguments}.0","{arguments}.1"]}},invokers:{changeSelectedToDefault:{funcName:"fluid.reorderer.changeSelectedToDefault",args:["{arguments}.0","{that}.options.styles"]},setDropEffects:{funcName:"fluid.reorderer.setDropEffects",args:["{that}.dom","{arguments}.0"]},createDropMarker:{funcName:"fluid.reorderer.createDropMarker",args:["{arguments}.0","{that}.options.styles.dropMarker"]},refresh:{funcName:"fluid.reorderer.refresh",args:["{that}.dom","{that}.events","{that}.selectableContext","{that}.activeItem"],dynamic:!0},selectItem:{funcName:"fluid.reorderer.selectItem",args:["{that}","{arguments}.0"]},initSelectables:{funcName:"fluid.reorderer.initSelectables",args:["{that}"]},initMovable:{funcName:"fluid.reorderer.initMovable",args:["{that}","{that}.dropManager","{arguments}.0"]},isMove:{funcName:"fluid.reorderer.isMove",args:["{that}.options.keysets","{arguments}.0"]},isActiveItemMovable:{funcName:"fluid.reorderer.isActiveItemMovable",args:["{that}.activeItem","{that}.dom"],dynamic:!0},handleKeyDown:{funcName:"fluid.reorderer.handleKeyDown",args:["{that}","{that}.options.styles","{arguments}.0"]},handleDirectionKeyDown:{funcName:"fluid.reorderer.handleDirectionKeyDown",args:["{that}","{arguments}.0"]},handleKeyUp:{funcName:"fluid.reorderer.handleKeyUp",args:["{that}","{that}.options.styles","{arguments}.0"]},requestMovement:{funcName:"fluid.reorderer.requestMovement",args:["{that}","{arguments}.0","{arguments}.1"]}},mergePolicy:{keysets:"replace","selectors.labelSource":"selectors.grabHandle","selectors.selectables":"selectors.movables","selectors.dropTargets":"selectors.movables"},components:{layoutHandler:{type:"{that}.options.layoutHandler",container:"{reorderer}.container"},dropManager:{type:"fluid.dropManager"},labeller:{type:"fluid.reorderer.labeller",options:{members:{dom:"{reorderer}.dom"},getGeometricInfo:"{reorderer}.layoutHandler.getGeometricInfo",orientation:"{reorderer}.layoutHandler.options.orientation",layoutType:"{reorderer}.options.layoutHandler"}}},disableWrap:!1}),fluid.reorderer.noModifier=function(evt){return!(evt.ctrlKey||evt.altKey||evt.shiftKey||evt.metaKey)},fluid.reorderer.isMove=function(keysets,evt){for(var i=0;i<keysets.length;i++)if(keysets[i].modifier(evt))return!0;return!1},fluid.reorderer.isActiveItemMovable=function(activeItem,dom){return $.inArray(activeItem,dom.fastLocate("movables"))>=0},fluid.reorderer.handleKeyDown=function(thatReorderer,styles,evt){if(!thatReorderer.activeItem||thatReorderer.activeItem!==evt.target)return!0;var jActiveItem=$(thatReorderer.activeItem);return!jActiveItem.hasClass(styles.dragging)&&thatReorderer.isMove(evt)?(thatReorderer.isActiveItemMovable()&&(jActiveItem.removeClass(styles.selected),jActiveItem.addClass(styles.dragging),jActiveItem.attr("aria-grabbed","true"),thatReorderer.setDropEffects("move")),!1):thatReorderer.handleDirectionKeyDown(evt)},fluid.reorderer.handleDirectionKeyDown=function(thatReorderer,evt){var item=thatReorderer.activeItem;if(!item)return!0;for(var keysets=thatReorderer.options.keysets,i=0;i<keysets.length;i++){var keyset=keysets[i],keydir=fluid.keyForValue(keyset,evt.keyCode);if(keydir){var isMovement=keyset.modifier(evt),dirnum=fluid.keycodeDirection[keydir],relativeItem=thatReorderer.layoutHandler.getRelativePosition(item,dirnum,!isMovement);if(relativeItem){if(isMovement){var prevent=thatReorderer.events.onBeginMove.fire(item);if(prevent===!1)return!1;var kbDropWarning=thatReorderer.kbDropWarning;kbDropWarning.length>0&&("locked"===relativeItem.clazz?(thatReorderer.events.onShowKeyboardDropWarning.fire(item,kbDropWarning),kbDropWarning.show()):kbDropWarning.hide()),relativeItem.element&&thatReorderer.requestMovement(relativeItem,item)}else fluid.reorderer.noModifier(evt)&&(fluid.blur(item),fluid.focus($(relativeItem.element)));return!1}}}return!0},fluid.reorderer.handleKeyUp=function(thatReorderer,styles,evt){if(!thatReorderer.activeItem||thatReorderer.activeItem!==evt.target)return!0;var jActiveItem=$(thatReorderer.activeItem);return jActiveItem.hasClass(styles.dragging)&&!thatReorderer.isMove(evt)?(thatReorderer.kbDropWarning&&thatReorderer.kbDropWarning.hide(),jActiveItem.removeClass(styles.dragging),jActiveItem.addClass(styles.selected),jActiveItem.attr("aria-grabbed","false"),thatReorderer.setDropEffects("none"),!1):!1},fluid.reorderer.requestMovement=function(thatReorderer,requestedPosition,item){if(item=fluid.unwrap(item),requestedPosition&&fluid.unwrap(requestedPosition.element)!==item){var activeItem=$(thatReorderer.activeItem);activeItem.unbind("blur.fluid.reorderer"),thatReorderer.events.onMove.fire(item,requestedPosition),thatReorderer.dropManager.geometricMove(item,requestedPosition.element,requestedPosition.position),fluid.focus(activeItem),thatReorderer.refresh(),thatReorderer.dropManager.updateGeometry(thatReorderer.layoutHandler.getGeometricInfo()),thatReorderer.events.afterMove.fire(item,requestedPosition,thatReorderer.dom.fastLocate("movables"))}},fluid.reorderer.hoverStyleHandler=function(dom,styles,item,state){dom.fastLocate("grabHandle",item)[state?"addClass":"removeClass"](styles.hover)},fluid.reorderer.processAfterMoveCallbackUrl=function(thatReorderer){var options=thatReorderer.options;options.afterMoveCallbackUrl&&thatReorderer.events.afterMove.addListener(function(){var layoutHandler=thatReorderer.layoutHandler,model=layoutHandler.getModel?layoutHandler.getModel():options.acquireModel(thatReorderer);$.post(options.afterMoveCallbackUrl,JSON.stringify(model))},"postModel")},fluid.reorderer.postInit=function(that){that.kbDropWarning&&(that.mouseDropWarning=that.kbDropWarning.clone()),that.options.keysets=fluid.makeArray(that.options.keysets)},fluid.reorderer.setDropEffects=function(dom,value){dom.fastLocate("dropTargets").attr("aria-dropeffect",value)},fluid.reorderer.createDropMarker=function(tagName,dropClass){var dropMarker=$(document.createElement(tagName));return dropMarker.addClass(dropClass),dropMarker.hide(),dropMarker},fluid.reorderer.changeSelectedToDefault=function(jItem,styles){jItem.removeClass(styles.selected),jItem.removeClass(styles.dragging),jItem.addClass(styles.defaultStyle),jItem.attr("aria-selected","false")},fluid.reorderer.initSelectables=function(thatReorderer){for(var handleBlur=function(evt){return thatReorderer.changeSelectedToDefault($(this)),evt.stopPropagation()},handleFocus=function(evt){return thatReorderer.selectItem(this),evt.stopPropagation()},selectables=thatReorderer.dom.fastLocate("selectables"),i=0;i<selectables.length;++i){var selectable=$(selectables[i]);$.data(selectable[0],"fluid.reorderer.selectable-initialised")||(selectable.addClass(thatReorderer.options.styles.defaultStyle),selectable.bind("blur.fluid.reorderer",handleBlur),selectable.focus(handleFocus),selectable.click(function(evt){var handle=fluid.unwrap(thatReorderer.dom.fastLocate("grabHandle",this));fluid.dom.isContainer(handle,evt.target)&&$(this).focus()}),selectable.attr("role",thatReorderer.options.containerRole.item),selectable.attr("aria-selected","false"),selectable.attr("aria-disabled","false"),$.data(selectable[0],"fluid.reorderer.selectable-initialised",!0))}thatReorderer.selectableContext||(thatReorderer.selectableContext=fluid.selectable(thatReorderer.container,{selectableElements:selectables,selectablesTabindex:thatReorderer.options.selectablesTabindex,direction:null}))},fluid.reorderer.selectItem=function(thatReorderer,anItem){thatReorderer.events.onSelect.fire(anItem),thatReorderer.activeItem&&thatReorderer.activeItem!==anItem&&thatReorderer.changeSelectedToDefault($(thatReorderer.activeItem)),thatReorderer.activeItem=anItem;var jItem=$(anItem),styles=thatReorderer.options.styles;jItem.removeClass(styles.defaultStyle),jItem.addClass(styles.selected),jItem.attr("aria-selected","true")},fluid.reorderer.initMovable=function(thatReorderer,dropManager,item){var options=thatReorderer.options,styles=options.styles;item.attr("aria-grabbed","false"),item.mouseover(function(){thatReorderer.events.onHover.fire(item,!0)}),item.mouseout(function(){thatReorderer.events.onHover.fire(item,!1)});var avatar,handle=thatReorderer.dom.fastLocate("grabHandle",item);item.draggable({refreshPositions:!1,scroll:!0,helper:function(){var dropWarningEl;return thatReorderer.mouseDropWarning&&(dropWarningEl=thatReorderer.mouseDropWarning[0]),avatar=$(options.avatarCreator(item[0],styles.avatar,dropWarningEl)),avatar.prop("id",fluid.reorderer.createAvatarId(thatReorderer.container.id)),avatar},start:function(e){var prevent=thatReorderer.events.onBeginMove.fire(item);if(prevent===!1)return!1;var handle=thatReorderer.dom.fastLocate("grabHandle",item)[0],handlePos=fluid.dom.computeAbsolutePosition(handle),handleWidth=handle.offsetWidth,handleHeight=handle.offsetHeight;item.focus(),item.removeClass(options.styles.selected),item.addClass(options.styles.mouseDrag),item.attr("aria-grabbed","true"),thatReorderer.setDropEffects("move"),dropManager.startDrag(e,handlePos,handleWidth,handleHeight),avatar.show()},stop:function(e,ui){item.removeClass(options.styles.mouseDrag),item.addClass(options.styles.selected),$(thatReorderer.activeItem).attr("aria-grabbed","false");var markerNode=fluid.unwrap(thatReorderer.dropMarker);markerNode.parentNode&&markerNode.parentNode.removeChild(markerNode),avatar.hide(),ui.helper=null,thatReorderer.setDropEffects("none"),dropManager.endDrag(),thatReorderer.requestMovement(dropManager.lastPosition(),item),thatReorderer.activeItem.focus()},handle:handle===item?null:handle})},fluid.reorderer.initItems=function(thatReorderer){var movables=thatReorderer.dom.fastLocate("movables"),dropTargets=thatReorderer.dom.fastLocate("dropTargets");thatReorderer.initSelectables();for(var i=0;i<movables.length;i++){var item=movables[i];$.data(item,"fluid.reorderer.movable-initialised")||(thatReorderer.initMovable($(item)),$.data(item,"fluid.reorderer.movable-initialised",!0))}movables.length>0&&!thatReorderer.dropMarker&&(thatReorderer.dropMarker=thatReorderer.createDropMarker(movables[0].tagName)),thatReorderer.dropManager.updateGeometry(thatReorderer.layoutHandler.getGeometricInfo());var dropChangeListener=function(dropTarget){fluid.dom.moveDom(thatReorderer.dropMarker,dropTarget.element,dropTarget.position),thatReorderer.dropMarker.css("display",""),thatReorderer.mouseDropWarning&&(dropTarget.lockedelem?thatReorderer.mouseDropWarning.show():thatReorderer.mouseDropWarning.hide())};thatReorderer.dropManager.dropChangeFirer.addListener(dropChangeListener,"fluid.reorderer"),dropTargets.attr("aria-dropeffect","none")},fluid.reorderer.refresh=function(dom,events,selectableContext,activeItem){dom.refresh("movables"),dom.refresh("selectables"),dom.refresh("grabHandle",dom.fastLocate("movables")),dom.refresh("stylisticOffset",dom.fastLocate("movables")),dom.refresh("dropTargets"),selectableContext&&(selectableContext.selectables=dom.fastLocate("selectables"),selectableContext.selectablesUpdated(activeItem)),events.onRefresh.fire()},fluid.reorderer.roles={GRID:{container:"grid",item:"gridcell"},LIST:{container:"list",item:"listitem"},REGIONS:{container:"main",item:"article"}};var simpleInit=function(container,layoutHandler,options){return options=options||{},options.layoutHandler=layoutHandler,fluid.reorderer(container,options)};fluid.reorderList=function(container,options){return simpleInit(container,"fluid.listLayoutHandler",options)},fluid.reorderGrid=function(container,options){return simpleInit(container,"fluid.gridLayoutHandler",options)},fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY="shuffleProjectFrom",fluid.reorderer.GEOMETRIC_STRATEGY="projectFrom",fluid.reorderer.LOGICAL_STRATEGY="logicalFrom",fluid.reorderer.WRAP_LOCKED_STRATEGY="lockedWrapFrom",fluid.reorderer.NO_STRATEGY=null,fluid.reorderer.relativeInfoGetter=function(orientation,coStrategy,contraStrategy,dropManager,disableWrap){return function(item,direction,forSelection){var dirorient=fluid.directionOrientation(direction),strategy=dirorient===orientation?coStrategy:contraStrategy;return null!==strategy?dropManager[strategy](item,direction,forSelection,disableWrap):null}},fluid.reorderer.makeGeometricInfoGetter=function(orientation,sentinelize,dom){return function(){var that={sentinelize:sentinelize,extents:[{orientation:orientation,elements:dom.fastLocate("dropTargets")}],elementMapper:function(element){return-1===$.inArray(element,dom.fastLocate("movables"))?"locked":null},elementIndexer:function(element){var selectables=dom.fastLocate("selectables");return{elementClass:that.elementMapper(element),index:$.inArray(element,selectables),length:selectables.length}}};return that}},fluid.defaults("fluid.layoutHandler",{gradeNames:["fluid.viewComponent"],disableWrap:"{reorderer}.options.disableWrap",members:{reordererDom:"{reorderer}.dom"},components:{dropManager:"{reorderer}.dropManager"}}),fluid.defaults("fluid.listLayoutHandler",{gradeNames:["fluid.layoutHandler","autoInit"],orientation:fluid.orientation.VERTICAL,containerRole:fluid.reorderer.roles.LIST,selectablesTabindex:-1,sentinelize:!0}),fluid.listLayoutHandler.finalInit=function(that){var options=that.options;that.getRelativePosition=fluid.reorderer.relativeInfoGetter(options.orientation,fluid.reorderer.LOGICAL_STRATEGY,null,that.dropManager,options.disableWrap),that.getGeometricInfo=fluid.reorderer.makeGeometricInfoGetter(options.orientation,options.sentinelize,that.reordererDom)},fluid.defaults("fluid.gridLayoutHandler",{gradeNames:["fluid.layoutHandler","autoInit"],orientation:fluid.orientation.HORIZONTAL,containerRole:fluid.reorderer.roles.GRID,selectablesTabindex:-1,sentinelize:!1}),fluid.gridLayoutHandler.finalInit=function(that){var options=that.options;that.getRelativePosition=fluid.reorderer.relativeInfoGetter(options.orientation,options.disableWrap?fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY:fluid.reorderer.LOGICAL_STRATEGY,fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY,that.dropManager,options.disableWrap),that.getGeometricInfo=fluid.reorderer.makeGeometricInfoGetter(options.orientation,options.sentinelize,that.reordererDom)},fluid.defaults("fluid.reorderer.labeller",{gradeNames:["fluid.eventedComponent","autoInit"],members:{movedMap:{},moduleCell:{expander:{funcName:"fluid.reorderer.labeller.computeModuleCell",args:["{that}.resolver","{that}.options.orientation"]}},layoutType:{expander:{funcName:"fluid.computeNickName",args:"{that}.options.layoutType"}},positionTemplate:{expander:{funcName:"fluid.reorderer.labeller.computePositionTemplate",args:["{that}.resolver","{that}.layoutType"]}}},strings:{overallTemplate:"%recentStatus %item %position %movable",position:"%index of %length",position_moduleLayoutHandler:"%index of %length in %moduleCell %moduleIndex of %moduleLength",moduleCell_0:"row",moduleCell_1:"column",movable:"movable",fixed:"fixed",recentStatus:"moved from position %position"},components:{resolver:{type:"fluid.messageResolver",options:{messageBase:"{labeller}.options.strings"}}},invokers:{renderLabel:{funcName:"fluid.reorderer.labeller.renderLabel",args:["{labeller}","{arguments}.0","{arguments}.1"]}},listeners:{"{reorderer}.events.onRefresh":{listener:"fluid.reorderer.labeller.onRefresh",args:"{that}"},"{reorderer}.events.onMove":{listener:"fluid.reorderer.labeller.onMove",args:["{that}","{arguments}.0","{arguments}.1"]}}}),fluid.reorderer.labeller.computeModuleCell=function(resolver,orientation){return resolver.resolve("moduleCell_"+orientation)},fluid.reorderer.labeller.computePositionTemplate=function(resolver,layoutType){return resolver.lookup(["position_"+layoutType,"position"])},fluid.reorderer.labeller.onRefresh=function(that){var selectables=that.dom.locate("selectables"),movedMap=that.movedMap;fluid.each(selectables,function(selectable){var labelOptions={},id=fluid.allocateSimpleId(selectable),moved=movedMap[id],label=that.renderLabel(selectable),plainLabel=label;moved&&(moved.newRender=plainLabel,label=that.renderLabel(selectable,moved.oldRender.position),$(selectable).one("focusout.ariaLabeller",function(){if(movedMap[id]){var oldLabel=movedMap[id].newRender.label;delete movedMap[id],fluid.updateAriaLabel(selectable,oldLabel)}}),labelOptions.dynamicLabel=!0),fluid.updateAriaLabel(selectable,label.label,labelOptions)})},fluid.reorderer.labeller.onMove=function(that,item){fluid.clear(that.movedMap),$(item).unbind("focusout.ariaLabeller");var movingId=fluid.allocateSimpleId(item);that.movedMap[movingId]={oldRender:that.renderLabel(item)}},fluid.reorderer.indexRebaser=function(indices){return indices.index++,void 0!==indices.moduleIndex&&indices.moduleIndex++,indices},fluid.reorderer.labeller.renderLabel=function(that,selectable,recentPosition){var geom=that.options.getGeometricInfo(),indices=fluid.reorderer.indexRebaser(geom.elementIndexer(selectable));indices.moduleCell=that.moduleCell;var recentStatus,elementClass=geom.elementMapper(selectable),labelSource=that.dom.locate("labelSource",selectable);recentPosition&&(recentStatus=that.resolver.resolve("recentStatus",{position:recentPosition}));var topModel={item:"string"==typeof labelSource?labelSource:fluid.dom.getElementText(fluid.unwrap(labelSource)),position:that.positionTemplate.resolveFunc(that.positionTemplate.template,indices),movable:that.resolver.resolve("locked"===elementClass?"fixed":"movable"),recentStatus:recentStatus||""},template=that.resolver.lookup(["overallTemplate"]),label=template.resolveFunc(template.template,topModel);return{position:topModel.position,label:label}}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.reorderImages"),fluid.reorderImages.deriveLightboxCellBase=function(namebase,index){return namebase+"lightbox-cell:"+index+":"},fluid.reorderImages.addThumbnailActivateHandler=function(container){var enterKeyHandler=function(evt){if(evt.which===fluid.reorderer.keys.ENTER){var thumbnailAnchors=$("a",evt.target);document.location=thumbnailAnchors.attr("href")}};container.keypress(enterKeyHandler)},fluid.reorderImages.seekNodesById=function(rootnode,tagname,idmatch){for(var inputs=rootnode.getElementsByTagName(tagname),togo=[],i=0;i<inputs.length;i+=1){var input=inputs[i],id=input.id;id&&id.match(idmatch)&&togo.push(input)}return togo},fluid.reorderImages.createImageCellFinder=function(parentNode,containerId){containerId=containerId||parentNode.prop("id"),parentNode=fluid.unwrap(parentNode);var lightboxCellNamePattern="^"+fluid.reorderImages.deriveLightboxCellBase(containerId,"[0-9]+")+"$";return function(){return fluid.reorderImages.seekNodesById(parentNode,"div",lightboxCellNamePattern)}},fluid.reorderImages.seekForm=function(container){return fluid.findAncestor(container,function(element){return $(element).is("form")})},fluid.reorderImages.seekInputs=function(container,reorderform){return fluid.reorderImages.seekNodesById(reorderform,"input","^"+fluid.reorderImages.deriveLightboxCellBase(container.prop("id"),"[^:]*")+"reorder-index$")},fluid.reorderImages.mapIdsToNames=function(container,reorderform){for(var inputs=fluid.reorderImages.seekInputs(container,reorderform),i=0;i<inputs.length;i++){var input=inputs[i],name=input.name;input.name=name||input.id}},fluid.reorderImages.createIDAfterMoveListener=function(container){var reorderform=fluid.reorderImages.seekForm(container);return fluid.reorderImages.mapIdsToNames(container,reorderform),function(){var inputs,i;for(inputs=fluid.reorderImages.seekInputs(container,reorderform),i=0;i<inputs.length;i+=1)inputs[i].value=i;if(reorderform&&reorderform.action){var order=$(reorderform).serialize();$.post(reorderform.action,order,function(){})}}},fluid.defaults("fluid.reorderImages",{gradeNames:["fluid.reorderer","autoInit"],layoutHandler:"fluid.gridLayoutHandler",listeners:{"afterMove.postModel":{expander:{funcName:"fluid.reorderImages.createIDAfterMoveListener",args:"{that}.container"}}},selectors:{movables:{expander:{funcName:"fluid.reorderImages.createImageCellFinder",args:"{that}.container"}},labelSource:".flc-reorderer-imageTitle"}}),fluid.lightbox=fluid.reorderImages}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.moduleLayout"),fluid.moduleLayout.findColumnAndItemIndices=function(item,layout){return fluid.find(layout.columns,function(column,colIndex){var index=$.inArray(item,column.elements);return-1===index?void 0:{columnIndex:colIndex,itemIndex:index}},{columnIndex:-1,itemIndex:-1})},fluid.moduleLayout.findColIndex=function(item,layout){return fluid.find(layout.columns,function(column,colIndex){return item===column.container?colIndex:void 0},-1)},fluid.moduleLayout.updateLayout=function(item,target,position,layout){item=fluid.unwrap(item),target=fluid.unwrap(target);var itemIndices=fluid.moduleLayout.findColumnAndItemIndices(item,layout);layout.columns[itemIndices.columnIndex].elements.splice(itemIndices.itemIndex,1);var targetCol;if(position===fluid.position.INSIDE)targetCol=layout.columns[fluid.moduleLayout.findColIndex(target,layout)].elements,targetCol.splice(targetCol.length,0,item);else{var relativeItemIndices=fluid.moduleLayout.findColumnAndItemIndices(target,layout);targetCol=layout.columns[relativeItemIndices.columnIndex].elements,position=fluid.dom.normalisePosition(position,itemIndices.columnIndex===relativeItemIndices.columnIndex,relativeItemIndices.itemIndex,itemIndices.itemIndex);var relative=position===fluid.position.BEFORE?0:1;targetCol.splice(relativeItemIndices.itemIndex+relative,0,item)}},fluid.moduleLayout.layoutFromFlat=function(container,columns,portlets){var layout={};return layout.container=container,layout.columns=fluid.transform(columns,function(column){return{container:column,elements:fluid.makeArray(portlets.filter(function(){return fluid.dom.isContainer(column,this)}))}}),layout},fluid.moduleLayout.layoutFromIds=function(idLayout){return{container:fluid.byId(idLayout.id),columns:fluid.transform(idLayout.columns,function(column){return{container:fluid.byId(column.id),elements:fluid.transform(column.children,fluid.byId)}})}},fluid.moduleLayout.layoutToIds=function(idLayout){return{id:fluid.getId(idLayout.container),columns:fluid.transform(idLayout.columns,function(column){return{id:fluid.getId(column.container),children:fluid.transform(column.elements,fluid.getId)}})}},fluid.moduleLayout.defaultOnShowKeyboardDropWarning=function(item,dropWarning){if(dropWarning){var offset=$(item).offset();dropWarning=$(dropWarning),dropWarning.css("position","absolute"),dropWarning.css("top",offset.top),dropWarning.css("left",offset.left)}},fluid.defaults("fluid.moduleLayoutHandler",{gradeNames:["fluid.layoutHandler","autoInit"],orientation:fluid.orientation.VERTICAL,containerRole:fluid.reorderer.roles.REGIONS,selectablesTabindex:-1,sentinelize:!0,events:{onMove:"{reorderer}.events.onMove",onRefresh:"{reorderer}.events.onRefresh",onShowKeyboardDropWarning:"{reorderer}.events.onShowKeyboardDropWarning"},listeners:{"onShowKeyboardDropWarning.setPosition":"fluid.moduleLayout.defaultOnShowKeyboardDropWarning",onRefresh:{priority:"first",listener:"{that}.computeLayout"},onMove:{priority:"last",listener:"fluid.moduleLayout.onMoveListener",args:["{arguments}.0","{arguments}.1","{that}.layout"]}},members:{layout:{expander:{func:"{that}.computeLayout"}}},invokers:{computeLayout:{funcName:"fluid.moduleLayout.computeLayout",args:["{that}","{reorderer}.options.selectors.modules","{that}.dom"],dynamic:!0},computeModules:{funcName:"fluid.moduleLayout.computeModules",args:["{that}.layout","{that}.isLocked","{arguments}.0"],dynamic:!0},makeComputeModules:{funcName:"fluid.moduleLayout.makeComputeModules",args:["{that}","{arguments}.0"]},isLocked:{funcName:"fluid.moduleLayout.isLocked",args:["{arguments}.0","{reorderer}.options.selectors.lockedModules","{that}.reordererDom"]}},selectors:{modules:"{reorderer}.options.selectors.modules",columns:"{reorderer}.options.selectors.columns"},distributeOptions:{target:"{reorderer}.options",record:{selectors:{movables:{expander:{func:"{that}.makeComputeModules",args:[!1]}},dropTargets:{expander:{func:"{that}.makeComputeModules",args:[!1]}},selectables:{expander:{func:"{that}.makeComputeModules",args:[!0]}}}}}}),fluid.moduleLayout.computeLayout=function(that,modulesSelector,dom){var togo;if(modulesSelector&&(togo=fluid.moduleLayout.layoutFromFlat(that.container,dom.locate("columns"),dom.locate("modules"))),!togo){var idLayout=fluid.get(that.options,"moduleLayout.layout");togo=fluid.moduleLayout.layoutFromIds(idLayout)}return that.layout=togo,togo},fluid.moduleLayout.computeModules=function(layout,isLocked,all){var modules=fluid.accumulate(layout.columns,function(column,list){return list.concat(column.elements)},[]);return all||fluid.remove_if(modules,isLocked),modules},fluid.moduleLayout.makeComputeModules=function(that,all){return function(){return that.computeModules(all)}},fluid.moduleLayout.isLocked=function(item,lockedModulesSelector,dom){var lockedModules=lockedModulesSelector?dom.fastLocate("lockedModules"):[];return-1!==$.inArray(item,lockedModules)},fluid.moduleLayout.onMoveListener=function(item,requestedPosition,layout){fluid.moduleLayout.updateLayout(item,requestedPosition.element,requestedPosition.position,layout)},fluid.moduleLayoutHandler.finalInit=function(that){var options=that.options;that.getRelativePosition=fluid.reorderer.relativeInfoGetter(options.orientation,fluid.reorderer.WRAP_LOCKED_STRATEGY,fluid.reorderer.GEOMETRIC_STRATEGY,that.dropManager,options.disableWrap),that.getGeometricInfo=function(){var extents=[],togo={extents:extents,sentinelize:options.sentinelize};togo.elementMapper=function(element){return that.isLocked(element)?"locked":null},togo.elementIndexer=function(element){var indices=fluid.moduleLayout.findColumnAndItemIndices(element,that.layout);return{index:indices.itemIndex,length:that.layout.columns[indices.columnIndex].elements.length,moduleIndex:indices.columnIndex,moduleLength:that.layout.columns.length}};for(var col=0;col<that.layout.columns.length;col++){var column=that.layout.columns[col],thisEls={orientation:options.orientation,elements:fluid.makeArray(column.elements),parentElement:column.container};extents.push(thisEls)}return togo},that.getModel=function(){return fluid.moduleLayout.layoutToIds(that.layout)}}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.reorderLayout=function(container,userOptions){var assembleOptions={layoutHandler:"fluid.moduleLayoutHandler",selectors:{columns:".flc-reorderer-column",modules:".flc-reorderer-module"}},options=$.extend(!0,assembleOptions,userOptions);return fluid.reorderer(container,options)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.slidingPanel",{gradeNames:["fluid.viewComponent","autoInit"],selectors:{panel:".flc-slidingPanel-panel",toggleButton:".flc-slidingPanel-toggleButton",toggleButtonLabel:".flc-slidingPanel-toggleButton"},strings:{showText:"show",hideText:"hide"},events:{onPanelHide:null,onPanelShow:null,afterPanelHide:null,afterPanelShow:null},listeners:{"onCreate.bindClick":{"this":"{that}.dom.toggleButton",method:"click",args:["{that}.togglePanel"]},"onCreate.bindModelChange":{listener:"{that}.applier.modelChanged.addListener",args:["isShowing","{that}.refreshView"]},"onCreate.setInitialState":{listener:"{that}.refreshView"},"onPanelHide.setText":{"this":"{that}.dom.toggleButtonLabel",method:"text",args:["{that}.options.strings.showText"],priority:"first"},"onPanelShow.setText":{"this":"{that}.dom.toggleButtonLabel",method:"text",args:["{that}.options.strings.hideText"],priority:"first"},"onPanelHide.operate":{listener:"{that}.operateHide"},"onPanelShow.operate":{listener:"{that}.operateShow"}},invokers:{operateHide:{"this":"{that}.dom.panel",method:"slideUp",args:["{that}.options.animationDurations.hide","{that}.events.afterPanelHide.fire"]},operateShow:{"this":"{that}.dom.panel",method:"slideDown",args:["{that}.options.animationDurations.show","{that}.events.afterPanelShow.fire"]},hidePanel:{func:"{that}.applier.requestChange",args:["isShowing",!1]},showPanel:{func:"{that}.applier.requestChange",args:["isShowing",!0]},togglePanel:{funcName:"fluid.slidingPanel.togglePanel",args:["{that}"]},refreshView:{funcName:"fluid.slidingPanel.refreshView",args:["{that}"]}},model:{isShowing:!1},animationDurations:{hide:400,show:400}}),fluid.slidingPanel.togglePanel=function(that){that.applier.requestChange("isShowing",!that.model.isShowing)},fluid.slidingPanel.refreshView=function(that){that.events[that.model.isShowing?"onPanelShow":"onPanelHide"].fire()}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.tableOfContents"),fluid.tableOfContents.insertAnchor=function(name,element,anchorClass){var anchor=$("<a></a>",element.ownerDocument);anchor.prop({"class":anchorClass,name:name,id:name}),anchor.insertBefore(element)},fluid.tableOfContents.headingTextToAnchorInfo=function(heading,guidFunc){var guid=guidFunc(),anchorInfo={id:guid,url:"#"+guid};return anchorInfo},fluid.tableOfContents.refreshView=function(that){var headings=that.locate("headings");that.locate("tocAnchors").remove(),that.anchorInfo=fluid.transform(headings,function(heading){var info=that.headingTextToAnchorInfo(heading);return that.insertAnchor(info.id,heading,that.options.anchorClass),info});var headingsModel=that.modelBuilder.assembleModel(headings,that.anchorInfo);that.applier.requestChange("",headingsModel),that.events.onRefresh.fire()},fluid.defaults("fluid.tableOfContents",{gradeNames:["fluid.viewComponent","autoInit"],components:{levels:{type:"fluid.tableOfContents.levels",createOnEvent:"onCreate",container:"{tableOfContents}.dom.tocContainer",options:{model:{headings:"{tableOfContents}.model"},events:{afterRender:"{tableOfContents}.events.afterRender"},listeners:{"{tableOfContents}.events.onRefresh":"{that}.refreshView"}}},modelBuilder:{type:"fluid.tableOfContents.modelBuilder"}},model:[],invokers:{headingTextToAnchorInfo:{funcName:"fluid.tableOfContents.headingTextToAnchorInfo",args:["{arguments}.0","{that}.generateGUID"]},insertAnchor:"fluid.tableOfContents.insertAnchor",generateGUID:"fluid.allocateSimpleId",refreshView:{funcName:"fluid.tableOfContents.refreshView",args:["{that}"]},hide:{"this":"{that}.dom.tocContainer",method:"hide"},show:{"this":"{that}.dom.tocContainer",method:"show"}},selectors:{headings:":header:visible:not(.flc-toc-tocContainer :header)",tocContainer:".flc-toc-tocContainer",tocAnchors:".flc-toc-anchors"},anchorClass:"flc-toc-anchors",events:{onRefresh:null,afterRender:null,onReady:{events:{onCreate:"onCreate",afterRender:"afterRender"},args:["{that}"]}},listeners:{"onCreate.refreshView":"{that}.refreshView"}}),fluid.registerNamespace("fluid.tableOfContents.modelBuilder"),fluid.tableOfContents.modelBuilder.toModel=function(headingInfo,modelLevelFn){var headings=fluid.copy(headingInfo),buildModelLevel=function(headings,level){for(var modelLevel=[];headings.length>0;){var heading=headings[0];if(heading.level<level)break;if(heading.level>level){var subHeadings=buildModelLevel(headings,level+1);modelLevel.length>0?modelLevel[modelLevel.length-1].headings=subHeadings:modelLevel=modelLevelFn(modelLevel,subHeadings)}heading.level===level&&(modelLevel.push(heading),headings.shift())}return modelLevel};return buildModelLevel(headings,1)},fluid.tableOfContents.modelBuilder.gradualModelLevelFn=function(modelLevel,subHeadings){var subHeadingsClone=fluid.copy(subHeadings);return subHeadingsClone[0].level--,subHeadingsClone},fluid.tableOfContents.modelBuilder.skippedModelLevelFn=function(modelLevel,subHeadings){return modelLevel.push({headings:subHeadings}),modelLevel},fluid.tableOfContents.modelBuilder.finalInit=function(that){that.convertToHeadingObjects=function(headings,anchorInfo){return headings=$(headings),fluid.transform(headings,function(heading,index){return{level:that.headingCalculator.getHeadingLevel(heading),text:$(heading).text(),url:anchorInfo[index].url}})},that.assembleModel=function(headings,anchorInfo){var headingInfo=that.convertToHeadingObjects(headings,anchorInfo);return that.toModel(headingInfo)}},fluid.defaults("fluid.tableOfContents.modelBuilder",{gradeNames:["fluid.littleComponent","autoInit"],finalInitFunction:"fluid.tableOfContents.modelBuilder.finalInit",components:{headingCalculator:{type:"fluid.tableOfContents.modelBuilder.headingCalculator"}},invokers:{toModel:{funcName:"fluid.tableOfContents.modelBuilder.toModel",args:["{arguments}.0","{modelBuilder}.modelLevelFn"]},modelLevelFn:"fluid.tableOfContents.modelBuilder.gradualModelLevelFn"}}),fluid.registerNamespace("fluid.tableOfContents.modelBuilder.headingCalculator"),fluid.tableOfContents.modelBuilder.headingCalculator.finalInit=function(that){that.getHeadingLevel=function(heading){return $.inArray(heading.tagName,that.options.levels)+1}},fluid.defaults("fluid.tableOfContents.modelBuilder.headingCalculator",{gradeNames:["fluid.littleComponent","autoInit"],finalInitFunction:"fluid.tableOfContents.modelBuilder.headingCalculator.finalInit",levels:["H1","H2","H3","H4","H5","H6"]}),fluid.registerNamespace("fluid.tableOfContents.levels"),fluid.tableOfContents.levels.finalInit=function(that){fluid.fetchResources(that.options.resources,function(){that.container.append(that.options.resources.template.resourceText),that.refreshView()})},fluid.tableOfContents.levels.objModel=function(type,ID){var objModel={ID:type+ID+":",children:[]};return objModel},fluid.tableOfContents.levels.handleEmptyItemObj=function(itemObj){itemObj.decorators=[{type:"addClass",classes:"fl-tableOfContents-hide-bullet"}]},fluid.tableOfContents.levels.generateTree=function(headingsModel,currentLevel){currentLevel=currentLevel||0;var levelObj=fluid.tableOfContents.levels.objModel("level",currentLevel);if(0===headingsModel.headings.length)return[];if(0===currentLevel){var tree={children:[fluid.tableOfContents.levels.generateTree(headingsModel,currentLevel+1)]};return tree}return $.each(headingsModel.headings,function(index,model){var itemObj=fluid.tableOfContents.levels.objModel("items",currentLevel),linkObj={ID:"link"+currentLevel,target:model.url,linktext:model.text};model.level?itemObj.children.push(linkObj):fluid.tableOfContents.levels.handleEmptyItemObj(itemObj),model.headings&&itemObj.children.push(fluid.tableOfContents.levels.generateTree(model,currentLevel+1)),levelObj.children.push(itemObj)}),levelObj},fluid.tableOfContents.levels.produceTree=function(that){return fluid.tableOfContents.levels.generateTree(that.model)},fluid.defaults("fluid.tableOfContents.levels",{gradeNames:["fluid.rendererComponent","autoInit"],finalInitFunction:"fluid.tableOfContents.levels.finalInit",produceTree:"fluid.tableOfContents.levels.produceTree",selectors:{level1:".flc-toc-levels-level1",level2:".flc-toc-levels-level2",level3:".flc-toc-levels-level3",level4:".flc-toc-levels-level4",level5:".flc-toc-levels-level5",level6:".flc-toc-levels-level6",items1:".flc-toc-levels-items1",items2:".flc-toc-levels-items2",items3:".flc-toc-levels-items3",items4:".flc-toc-levels-items4",items5:".flc-toc-levels-items5",items6:".flc-toc-levels-items6",link1:".flc-toc-levels-link1",link2:".flc-toc-levels-link2",link3:".flc-toc-levels-link3",link4:".flc-toc-levels-link4",link5:".flc-toc-levels-link5",link6:".flc-toc-levels-link6"},repeatingSelectors:["level1","level2","level3","level4","level5","level6","items1","items2","items3","items4","items5","items6"],model:{headings:[]},resources:{template:{forceCache:!0,url:"../html/TableOfContents.html"}},rendererFnOptions:{noexpand:!0},rendererOptions:{debugMode:!1}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.tabs",{gradeNames:["fluid.viewComponent","autoInit"],tabOptions:{},events:{tabsselect:"preventable",tabsload:null,tabsshow:null},listeners:{"onCreate.initTabs":{"this":"{that}.container",method:"tabs",args:"{that}.options.tabOptions"}},finalInitFunction:"fluid.tabs.finalInit"}),fluid.tabs.finalInit=function(that){that.container.tabs(that.options.tabOptions),fluid.each(that.options.events,function(value,eventName){that.container.bind(eventName,function(event,ui){return that.events[eventName].fire(that,event,ui)})})}}(jQuery,fluid_1_5);;!function($){function simulateMouseEvent(event,simulatedType){if(!(event.originalEvent.touches.length>1)){event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent)}}if($.support.touch="ontouchend"in document,$.support.touch){var touchHandled,mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit;mouseProto._touchStart=function(event){var self=this;!touchHandled&&self._mouseCapture(event.originalEvent.changedTouches[0])&&(touchHandled=!0,self._touchMoved=!1,simulateMouseEvent(event,"mouseover"),simulateMouseEvent(event,"mousemove"),simulateMouseEvent(event,"mousedown"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,"mousemove"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,"mouseup"),simulateMouseEvent(event,"mouseout"),this._touchMoved||simulateMouseEvent(event,"click"),touchHandled=!1)},mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd")),_mouseInit.call(self)}}}(jQuery);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.textfieldSlider",{gradeNames:["fluid.viewComponent","fluid.prefs.modelRelay","autoInit"],components:{textfield:{type:"fluid.textfieldSlider.textfield",container:"{textfieldSlider}.dom.textfield",options:{model:"{textfieldSlider}.model",range:"{textfieldSlider}.options.range",members:{applier:"{textfieldSlider}.applier"}}},slider:{type:"fluid.textfieldSlider.slider",container:"{textfieldSlider}.dom.slider",options:{model:"{textfieldSlider}.model",range:"{textfieldSlider}.options.range",members:{applier:"{textfieldSlider}.applier"},sliderOptions:"{textfieldSlider}.options.sliderOptions"}}},selectors:{textfield:".flc-textfieldSlider-field",slider:".flc-textfieldSlider-slider"},events:{modelChanged:null,afterRender:null},listeners:{modelChanged:"{that}.refreshView"},model:{value:null},range:{min:0,max:100},sliderOptions:{orientation:"horizontal",step:1},invokers:{refreshView:{funcName:"fluid.textfieldSlider.refreshView",args:["{that}"]}},finalInitFunction:"fluid.textfieldSlider.finalInit",renderOnInit:!0}),fluid.textfieldSlider.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.events.modelChanged.fire(newModel.value)}),that.options.renderOnInit&&that.refreshView()},fluid.textfieldSlider.refreshView=function(that){that.textfield.container.val(that.model.value),that.events.afterRender.fire(that)},fluid.defaults("fluid.textfieldSlider.textfield",{gradeNames:["fluid.viewComponent","autoInit"],listeners:{onCreate:{listener:"fluid.textfieldSlider.textfield.init",args:"{that}"}},range:{}}),fluid.textfieldSlider.validateValue=function(model,range,changeRequest){var oldValue=model.value,newValue=changeRequest.value,isValidNum=!isNaN(parseInt(newValue,10));isValidNum?(newValue<range.min?newValue=range.min:newValue>range.max&&(newValue=range.max),changeRequest.value=newValue):changeRequest.value=oldValue},fluid.textfieldSlider.textfield.init=function(that){that.applier.guards.addListener({path:"value",transactional:!0},function(model,changeRequest){fluid.textfieldSlider.validateValue(model,that.options.range,changeRequest)}),that.container.change(function(source){that.applier.requestChange("value",source.target.value)})},fluid.defaults("fluid.textfieldSlider.slider",{gradeNames:["fluid.viewComponent","autoInit"],selectors:{thumb:".ui-slider-handle"},events:{modelChanged:null},listeners:{onCreate:{listener:"fluid.textfieldSlider.slider.init",args:"{that}"}},range:{}});var initSliderAria=function(thumb,opts){var ariaDefaults={role:"slider","aria-valuenow":opts.value,"aria-valuemin":opts.min,"aria-valuemax":opts.max};thumb.attr(ariaDefaults)};fluid.textfieldSlider.slider.init=function(that){var sliderOptions=$.extend(!0,{},that.options.sliderOptions,that.model,that.options.range);that.slider=that.container.slider(sliderOptions),initSliderAria(that.locate("thumb"),sliderOptions),that.setSliderValue=function(value){that.slider.slider("value",value)},that.setSliderAria=function(value){that.locate("thumb").attr("aria-valuenow",value)},that.slider.bind("slide",function(e,ui){that.applier.requestChange("value",ui.value)}),that.applier.modelChanged.addListener("value",function(newModel){that.setSliderValue(newModel.value),that.setSliderAria(newModel.value),that.events.modelChanged.fire(newModel.value)})}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.enhance"),fluid.enhance.isBrowser=function(){return"undefined"!=typeof window&&window.document},fluid.enhance.supportsBinaryXHR=function(){return window.FormData||window.XMLHttpRequest&&window.XMLHttpRequest.prototype&&window.XMLHttpRequest.prototype.sendAsBinary},fluid.enhance.supportsFormData=function(){return!!window.FormData},fluid.enhance.supportsFlash=function(){return"undefined"!=typeof swfobject&&swfobject.getFlashPlayerVersion().major>8},fluid.enhance.majorFlashVersion=function(){return"undefined"==typeof swfobject?0:swfobject.getFlashPlayerVersion().major},fluid.enhance.checked={},fluid.enhance.sep="--",fluid.enhance.typeToKey=function(typeName){return typeName.replace(/[.]/gi,fluid.enhance.sep)},fluid.enhance.check=function(stuffToCheck){fluid.each(stuffToCheck,function(val,key){var staticKey=fluid.enhance.typeToKey(key);if(void 0===fluid.enhance.checked[staticKey]){var results="boolean"==typeof val?val:"string"==typeof val?fluid.invokeGlobalFunction(val):val();fluid.enhance.checked[staticKey]=!!results,results&&(fluid.staticEnvironment[staticKey]=fluid.typeTag(key))}})},fluid.enhance.forget=function(typeName){var key=fluid.enhance.typeToKey(typeName);void 0!==fluid.enhance.checked[key]&&(delete fluid.staticEnvironment[key],delete fluid.enhance.checked[key])},fluid.enhance.forgetAll=function(){fluid.each(fluid.enhance.checked,function(val,key){fluid.enhance.forget(key)})},fluid.defaults("fluid.progressiveChecker",{gradeNames:["fluid.typeFount","fluid.littleComponent","autoInit","{that}.check"],checks:[],defaultContextName:void 0,invokers:{check:{funcName:"fluid.progressiveChecker.check",args:["{that}.options.checks","{that}.options.defaultContextName"]}}}),fluid.progressiveChecker.check=function(checks,defaultContextName){return fluid.find(checks,function(check){return check.feature?check.contextName:void 0},defaultContextName)},fluid.progressiveChecker.forComponent=function(that,componentName){var defaults=fluid.defaults(componentName),expanded=fluid.expandOptions(fluid.copy(defaults.progressiveCheckerOptions),that),checkTag=fluid.progressiveChecker.check(expanded.checks,expanded.defaultContextName),horizon=componentName+".progressiveCheck";return[horizon,checkTag]},fluid.defaults("fluid.progressiveCheckerForComponent",{gradeNames:["fluid.typeFount","fluid.littleComponent","autoInit","{that}.check"],invokers:{check:{funcName:"fluid.progressiveChecker.forComponent",args:["{that}","{that}.options.componentName"]}}}),fluid.enhance.check({"fluid.browser":"fluid.enhance.isBrowser"}),fluid.enhance.isBrowser()&&$.fn&&$("head").append("<style type='text/css'>.fl-progEnhance-basic, .fl-ProgEnhance-basic { display: none; } .fl-progEnhance-enhanced, .fl-ProgEnhance-enhanced { display: block; }</style>")}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.url"),fluid.url.generateDepth=function(depth){return fluid.generate(depth,"../").join("")},fluid.url.parsePathInfo=function(pathInfo){var togo={},segs=pathInfo.split("/");if(segs.length>0){var top=segs.length-1,dotpos=segs[top].indexOf(".");-1!==dotpos&&(togo.extension=segs[top].substring(dotpos+1),segs[top]=segs[top].substring(0,dotpos))}return togo.pathInfo=segs,togo},fluid.url.parsePathInfoTrim=function(pathInfo){var togo=fluid.url.parsePathInfo(pathInfo);return""===togo.pathInfo[togo.pathInfo.length-1]&&togo.pathInfo.length--,togo},fluid.url.collapseSegs=function(segs,from,to){var togo="";void 0===from&&(from=0),void 0===to&&(to=segs.length);for(var i=from;to-1>i;++i)togo+=segs[i]+"/";return to>from&&(togo+=segs[to-1]),togo},fluid.url.makeRelPath=function(parsed,index){var togo=fluid.kettle.collapseSegs(parsed.pathInfo,index);return parsed.extension&&(togo+="."+parsed.extension),togo},fluid.url.cononocolosePath=function(pathInfo){for(var consume=0,i=0;i<pathInfo.length;++i)".."===pathInfo[i]?++consume:0!==consume&&(pathInfo.splice(i-2*consume,2*consume),i-=2*consume,consume=0);return pathInfo},fluid.url.parseUri=function(str){for(var o=fluid.url.parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri},fluid.url.parseUri.options={strictMode:!0,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},fluid.url.parseSegs=function(url){var parsed=fluid.url.parseUri(url),parsedSegs=fluid.url.parsePathInfoTrim(parsed.directory);return parsedSegs.pathInfo},fluid.url.isAbsoluteUrl=function(url){var parseRel=fluid.url.parseUri(url);return parseRel.host||parseRel.protocol||"/"===parseRel.directory.charAt(0)},fluid.url.computeRelativePrefix=function(outerLocation,iframeLocation,relPath){if(fluid.url.isAbsoluteUrl(relPath))return relPath;var relSegs=fluid.url.parsePathInfo(relPath).pathInfo,parsedOuter=fluid.url.parseSegs(outerLocation),parsedRel=parsedOuter.concat(relSegs);fluid.url.cononocolosePath(parsedRel);for(var parsedInner=fluid.url.parseSegs(iframeLocation),seg=0;seg<parsedRel.length&&parsedRel[seg]==parsedInner[seg];++seg);var excess=parsedInner.length-seg,back=fluid.url.generateDepth(excess),front=fluid.url.collapseSegs(parsedRel,seg);return back+front}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.dataSource",{gradeNames:["fluid.littleComponent"],invokers:{get:"fluid.prefs.dataSource.get",set:"fluid.prefs.dataSource.set"}}),fluid.defaults("fluid.cookieStore",{gradeNames:["fluid.prefs.dataSource","autoInit"],cookie:{name:"fluid-ui-settings",path:"/",expires:""}}),fluid.demands("fluid.prefs.dataSource.get","fluid.cookieStore",{funcName:"fluid.cookieStore.get",args:"{that}.options.cookie.name"}),fluid.demands("fluid.prefs.dataSource.set","fluid.cookieStore",{funcName:"fluid.cookieStore.set",args:["{arguments}.0","{that}.options.cookie"]}),fluid.cookieStore.get=function(cookieName){var cookie=document.cookie;if(!(cookie.length<=0)){var cookiePrefix=cookieName+"=",startIndex=cookie.indexOf(cookiePrefix);if(!(0>startIndex)){startIndex+=cookiePrefix.length;var endIndex=cookie.indexOf(";",startIndex);startIndex>endIndex&&(endIndex=cookie.length);var retObj=JSON.parse(decodeURIComponent(cookie.substring(startIndex,endIndex)));return retObj}}},fluid.cookieStore.assembleCookie=function(cookieOptions){var cookieStr=cookieOptions.name+"="+cookieOptions.data;return cookieOptions.expires&&(cookieStr+="; expires="+cookieOptions.expires),cookieOptions.path&&(cookieStr+="; path="+cookieOptions.path),cookieStr},fluid.cookieStore.set=function(settings,cookieOptions){cookieOptions.data=encodeURIComponent(JSON.stringify(settings)),document.cookie=fluid.cookieStore.assembleCookie(cookieOptions)},fluid.defaults("fluid.tempStore",{gradeNames:["fluid.prefs.dataSource","fluid.modelComponent","autoInit"]}),fluid.demands("fluid.prefs.dataSource.get","fluid.tempStore",{funcName:"fluid.identity",args:"{that}.model"}),fluid.demands("fluid.prefs.dataSource.set","fluid.tempStore",{funcName:"fluid.tempStore.set",args:["{arguments}.0","{that}.applier"]}),fluid.tempStore.set=function(settings,applier){applier.requestChange("",settings)},fluid.defaults("fluid.globalSettingsStore",{gradeNames:["autoInit","fluid.littleComponent"],components:{settingsStore:{type:"fluid.prefs.store"}}}),fluid.globalSettingsStore.finalInit=function(that){fluid.staticEnvironment.settingsStore=that.settingsStore},fluid.demands("fluid.prefs.store",["fluid.globalSettingsStore"],{funcName:"fluid.cookieStore"})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.rootModel",{gradeNames:["fluid.littleComponent","autoInit"],members:{rootModel:{}}}),fluid.defaults("fluid.uiEnhancer",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{updateModel:{funcName:"fluid.uiEnhancer.updateModel",args:["{arguments}.0","{uiEnhancer}.applier"]}}}),fluid.uiEnhancer.updateModel=function(newModel,applier){applier.requestChange("",newModel)},fluid.defaults("fluid.pageEnhancer",{gradeNames:["fluid.eventedComponent","fluid.originalEnhancerOptions","fluid.prefs.rootModel","fluid.prefs.settingsGetter","autoInit"],components:{uiEnhancer:{type:"fluid.uiEnhancer",container:"body"}},distributeOptions:{source:"{that}.options.uiEnhancer",target:"{that > uiEnhancer}.options"},invokers:{init:{funcName:"fluid.pageEnhancer.init",args:"{that}"}},listeners:{onCreate:[{listener:"{that}.init"}]}}),fluid.pageEnhancer.init=function(that){that.options.originalUserOptions=$.extend(!0,that.uiEnhancer.options,fluid.copy(that.options.uiEnhancer)),fluid.staticEnvironment.originalEnhancerOptions=that,that.uiEnhancer.updateModel(that.getSettings()),fluid.staticEnvironment.uiEnhancer=that.uiEnhancer}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.prefsEditorLoader",{gradeNames:["fluid.viewComponent","autoInit"],components:{prefsEditor:{priority:"last",type:"fluid.prefs.prefsEditor",createOnEvent:"onCreatePrefsEditorReady"},templateLoader:{type:"fluid.prefs.resourceLoader",options:{events:{onResourcesLoaded:"{prefsEditorLoader}.events.onPrefsEditorTemplatesLoaded"}}},messageLoader:{type:"fluid.prefs.resourceLoader",options:{events:{onResourcesLoaded:"{prefsEditorLoader}.events.onPrefsEditorMessagesLoaded"}}}},events:{onPrefsEditorTemplatesLoaded:null,onPrefsEditorMessagesLoaded:null,onMsgBundleReady:null,onCreatePrefsEditorReady:{events:{templateLoaded:"onPrefsEditorTemplatesLoaded",msgBundleReady:"onMsgBundleReady"}}},listeners:{onPrefsEditorMessagesLoaded:{funcName:"fluid.prefs.prefsEditorLoader.createMsgBundle",args:["{arguments}.0","{that}"]}},distributeOptions:[{source:"{that}.options.templateLoader",removeSource:!0,target:"{that > templateLoader}.options"},{source:"{that}.options.messageLoader",removeSource:!0,target:"{that > messageLoader}.options"},{source:"{that}.options.templatePrefix",target:"{that > templateLoader > resourcePath}.options.value"},{source:"{that}.options.messagePrefix",target:"{that > messageLoader > resourcePath}.options.value"},{source:"{that}.options.prefsEditor",removeSource:!0,target:"{that > prefsEditor}.options"}]}),fluid.prefs.prefsEditorLoader.createMsgBundle=function(messageResources,that){var completeMessage;fluid.each(messageResources,function(oneResource){var message=JSON.parse(oneResource.resourceText);completeMessage=$.extend({},completeMessage,message)});var parentResolver=fluid.messageResolver({messageBase:completeMessage});that.msgBundle=fluid.messageResolver({messageBase:{},parents:[parentResolver]}),that.events.onMsgBundleReady.fire()},fluid.defaults("fluid.prefs.transformDefaultPanelsOptions",{gradeNames:["fluid.viewComponent","autoInit"],distributeOptions:[{source:"{that}.options.textSize",removeSource:!0,target:"{that textSize}.options"},{source:"{that}.options.lineSpace",removeSource:!0,target:"{that lineSpace}.options"},{source:"{that}.options.textFont",removeSource:!0,target:"{that textFont}.options"},{source:"{that}.options.contrast",removeSource:!0,target:"{that contrast}.options"},{source:"{that}.options.layoutControls",removeSource:!0,target:"{that layoutControls}.options"},{source:"{that}.options.linksControls",removeSource:!0,target:"{that linksControls}.options"}]}),fluid.defaults("fluid.prefs.resourceLoader",{gradeNames:["fluid.eventedComponent","autoInit"],listeners:{onCreate:{listener:"fluid.prefs.resourceLoader.loadTemplates",args:["{that}",{expander:{func:"{that}.resolveTemplates"}}]}},templates:{},components:{resourcePath:{type:"fluid.prefs.resourcePath"}},invokers:{transformURL:{funcName:"fluid.stringTemplate",args:["{arguments}.0",{"prefix/":"{that}.resourcePath.options.value"}]},resolveTemplates:{funcName:"fluid.prefs.resourceLoader.resolveTemplates",args:"{that}"}},events:{onResourcesLoaded:null}}),fluid.prefs.resourceLoader.resolveTemplates=function(that){var mapped=fluid.transform(that.options.templates,that.transformURL);return fluid.transform(mapped,function(url){return{url:url,forceCache:!0}})},fluid.prefs.resourceLoader.loadTemplates=function(that,resources){delete resources.expander,fluid.fetchResources(resources,function(){that.resources=resources,that.events.onResourcesLoaded.fire(resources)})},fluid.defaults("fluid.prefs.resourcePath",{gradeNames:["fluid.littleComponent","autoInit"],value:"../html/"}),fluid.defaults("fluid.prefs.settingsGetter",{gradeNames:["fluid.littleComponent","autoInit"],members:{getSettings:"{settingsStore}.get"}}),fluid.defaults("fluid.prefs.settingsSetter",{gradeNames:["fluid.littleComponent","autoInit"],invokers:{setSettings:{funcName:"fluid.prefs.settingsSetter.setSettings",args:["{arguments}.0","{settingsStore}.set"]}}}),fluid.prefs.settingsSetter.setSettings=function(model,set){var userSettings=fluid.copy(model);set(userSettings)},fluid.defaults("fluid.prefs.uiEnhancerRelay",{gradeNames:["autoInit","fluid.eventedComponent"],listeners:{onCreate:"{that}.addListener",onDestroy:"{that}.removeListener"},events:{updateEnhancerModel:"{fluid.prefs.prefsEditor}.events.onUpdateEnhancerModel"},invokers:{addListener:{funcName:"fluid.prefs.uiEnhancerRelay.addListener",args:["{that}.events.updateEnhancerModel","{that}.updateEnhancerModel"]},removeListener:{funcName:"fluid.prefs.uiEnhancerRelay.removeListener",args:["{that}.events.updateEnhancerModel","{that}.updateEnhancerModel"]},updateEnhancerModel:{funcName:"fluid.prefs.uiEnhancerRelay.updateEnhancerModel",args:["{uiEnhancer}","{fluid.prefs.prefsEditor}.model"]}}}),fluid.prefs.uiEnhancerRelay.addListener=function(modelChanged,listener){modelChanged.addListener(listener)},fluid.prefs.uiEnhancerRelay.removeListener=function(modelChanged,listener){modelChanged.removeListener(listener)},fluid.prefs.uiEnhancerRelay.updateEnhancerModel=function(uiEnhancer,newModel){uiEnhancer.updateModel(newModel)},fluid.defaults("fluid.prefs.prefsEditor",{gradeNames:["fluid.viewComponent","fluid.prefs.settingsGetter","fluid.prefs.settingsSetter","fluid.prefs.rootModel","autoInit"],invokers:{updateModel:{funcName:"fluid.fireSourcedChange",args:["{that}.applier","","{arguments}.0","{arguments}.1"]},fetch:{funcName:"fluid.prefs.prefsEditor.fetch",args:["{that}"]},applyChanges:{funcName:"fluid.prefs.prefsEditor.applyChanges",args:["{that}"]},save:{funcName:"fluid.prefs.prefsEditor.save",args:["{that}"]},saveAndApply:{funcName:"fluid.prefs.prefsEditor.saveAndApply",args:["{that}"]},reset:{funcName:"fluid.prefs.prefsEditor.reset",args:["{that}"]},cancel:{funcName:"fluid.prefs.prefsEditor.cancel",args:["{that}"]}},selectors:{cancel:".flc-prefsEditor-cancel",reset:".flc-prefsEditor-reset",save:".flc-prefsEditor-save",previewFrame:".flc-prefsEditor-preview-frame"},events:{onSave:null,onCancel:null,onReset:null,onAutoSave:null,modelChanged:null,onPrefsEditorRefresh:null,onUpdateEnhancerModel:null,onPrefsEditorMarkupReady:null,onReady:null},listeners:{onCreate:"fluid.prefs.prefsEditor.init",onAutoSave:"{that}.save"},resources:{template:"{templateLoader}.resources.prefsEditor"},autoSave:!1}),fluid.prefs.prefsEditor.applyChanges=function(that){that.events.onUpdateEnhancerModel.fire()},fluid.prefs.prefsEditor.fetch=function(that){var completeModel=that.getSettings();completeModel=$.extend(!0,{},that.rootModel,completeModel),that.updateModel(completeModel,"settingsStore"),that.events.onPrefsEditorRefresh.fire(),that.applyChanges()},fluid.prefs.prefsEditor.save=function(that){that.events.onSave.fire(that.model);var savedSelections=fluid.copy(that.model);that.setSettings(savedSelections)},fluid.prefs.prefsEditor.saveAndApply=function(that){that.save(),that.events.onPrefsEditorRefresh.fire(),that.applyChanges()},fluid.prefs.prefsEditor.reset=function(that){that.updateModel(fluid.copy(that.rootModel)),that.events.onPrefsEditorRefresh.fire(),that.events.onReset.fire(that)},fluid.prefs.prefsEditor.cancel=function(that){that.events.onCancel.fire(),that.fetch()},fluid.prefs.prefsEditor.finishInit=function(that){var bindHandlers=function(that){var saveButton=that.locate("save");if(saveButton.length>0){saveButton.click(that.saveAndApply);var form=fluid.findForm(saveButton);$(form).submit(function(){that.saveAndApply()})}that.locate("reset").click(that.reset),that.locate("cancel").click(that.cancel)};that.container.append(that.options.resources.template.resourceText),bindHandlers(that),that.events.onPrefsEditorMarkupReady.fire(that),that.fetch(),that.events.onReady.fire(that)},fluid.prefs.prefsEditor.init=function(that){that.applier.modelChanged.addListener("",function(newModel,oldModel,changeRequest){that.events.modelChanged.fire(newModel,oldModel,changeRequest[0].source),that.options.autoSave&&that.events.onAutoSave.fire()}),setTimeout(function(){fluid.prefs.prefsEditor.finishInit(that)},1)},fluid.defaults("fluid.prefs.preview",{gradeNames:["fluid.viewComponent","autoInit"],components:{enhancer:{type:"fluid.uiEnhancer",container:"{preview}.enhancerContainer",createOnEvent:"onReady"},templateLoader:"{templateLoader}"},invokers:{updateModel:{funcName:"fluid.prefs.preview.updateModel",args:["{preview}","{prefsEditor}.model"]}},finalInitFunction:"fluid.prefs.preview.finalInit",events:{onReady:null},listeners:{"{prefsEditor}.events.modelChanged":"{that}.updateModel",onReady:"{that}.updateModel"},templateUrl:"%prefix/PrefsEditorPreview.html"}),fluid.prefs.preview.updateModel=function(that,model){setTimeout(function(){that.enhancer&&that.enhancer.updateModel(model)},0)},fluid.prefs.preview.finalInit=function(that){var templateUrl=that.templateLoader.transformURL(that.options.templateUrl);that.container.load(function(){that.enhancerContainer=$("body",that.container.contents()),that.events.onReady.fire()}),that.container.attr("src",templateUrl)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.stringBundle",{gradeNames:["fluid.littleComponent","autoInit"],members:{stringBundle:{expander:{funcName:"fluid.prefs.stringLookup",args:["{that}.messageResolver","{that}.options.stringArrayIndex"]}}},stringArrayIndex:{}}),fluid.prefs.stringLookup=function(messageResolver,stringArrayIndex){var that={id:fluid.allocateGuid()};return that.singleLookup=function(value){var looked=messageResolver.lookup([value]);return fluid.get(looked,"template")},that.multiLookup=function(values){return fluid.transform(values,function(value){return that.singleLookup(value)})},that.lookup=function(value){var values=fluid.get(stringArrayIndex,value)||value,lookupFn=fluid.isArrayable(values)?"multiLookup":"singleLookup";return that[lookupFn](values)},that.resolvePathSegment=that.lookup,that},fluid.defaults("fluid.prefs.panel",{gradeNames:["fluid.rendererComponent","fluid.prefs.stringBundle","fluid.prefs.modelRelay","autoInit"],events:{onDomBind:null},listeners:{"onCreate.onDomBind":"{that}.events.onDomBind"}}),fluid.defaults("fluid.prefs.subPanel",{gradeNames:["fluid.prefs.panel","{that}.getDomBindGrade","autoInit"],mergePolicy:{sourceApplier:"nomerge"},sourceApplier:"{compositePanel}.applier",listeners:{"{compositePanel}.events.afterRender":{listener:"{that}.events.afterRender",args:["{that}"]},"onCreate.onDomBind":null,"afterRender.onDomBind":"{that}.resetDomBinder"},rules:{expander:{func:"fluid.prefs.subPanel.generateRules",args:["{that}.options.preferenceMap"]}},model:{expander:{func:"fluid.prefs.subPanel.getInitialModel",args:["{compositePanel}.model","{that}.options.preferenceMap"]}},invokers:{refreshView:"{compositePanel}.refreshView",resetDomBinder:{funcName:"fluid.prefs.subPanel.resetDomBinder",args:["{that}"]},getDomBindGrade:{funcName:"fluid.prefs.subPanel.getDomBindGrade",args:["{prefsEditor}"]}},strings:{},parentBundle:"{compositePanel}.messageResolver",renderOnInit:!1}),fluid.defaults("fluid.prefs.subPanel.domBind",{gradeNames:["fluid.eventedComponent","autoInit"],listeners:{"onDomBind.domChange":{listener:"{prefsEditor}.events.onSignificantDOMChange"}}}),fluid.prefs.subPanel.getDomBindGrade=function(prefsEditor){var hasListener=void 0!==fluid.get(prefsEditor,"options.events.onSignificantDOMChange");return hasListener?"fluid.prefs.subPanel.domBind":void 0},fluid.prefs.subPanel.resetDomBinder=function(that){that.container=$(that.container.selector),fluid.initDomBinder(that,that.options.selectors),that.events.onDomBind.fire(that)},fluid.prefs.subPanel.safePrefKey=function(prefKey){return prefKey.replace(/[.]/g,"_")},fluid.prefs.subPanel.generateRules=function(preferenceMap){var rules={};return fluid.each(preferenceMap,function(prefObj,prefKey){$.each(prefObj,function(prefRule){0===prefRule.indexOf("model.")&&(rules[fluid.prefs.subPanel.safePrefKey(prefKey)]=prefRule.slice(6))})}),rules},fluid.prefs.subPanel.getInitialModel=function(parentModel,preferenceMap){var initialModel={};return fluid.each(preferenceMap,function(prefObj,prefKey){$.each(prefObj,function(prefRule){0===prefRule.indexOf("model.")&&fluid.set(initialModel,prefRule.slice(6),fluid.get(parentModel,fluid.prefs.subPanel.safePrefKey(prefKey)))})}),initialModel},fluid.registerNamespace("fluid.prefs.compositePanel"),fluid.prefs.compositePanel.arrayMergePolicy=function(target,source){return target=fluid.makeArray(target),source=fluid.makeArray(source),fluid.each(source,function(selector){$.inArray(selector,target)<0&&target.push(selector)}),target},fluid.defaults("fluid.prefs.compositePanel",{gradeNames:["fluid.prefs.panel","autoInit","{that}.getDistributeOptionsGrade","{that}.getSubPanelLifecycleBindings"],mergePolicy:{subPanelOverrides:"noexpand",selectorsToIgnore:fluid.prefs.compositePanel.arrayMergePolicy},selectors:{},selectorsToIgnore:[],repeatingSelectors:[],events:{onRefreshView:null,initSubPanels:null},listeners:{"onCreate.combineResources":"{that}.combineResources","onCreate.appendTemplate":{"this":"{that}.container",method:"append",args:["{that}.options.resources.template.resourceText"]},"onCreate.initSubPanels":"{that}.events.initSubPanels","onCreate.hideInactive":"{that}.hideInactive","onCreate.surfaceSubpanelRendererSelectors":"{that}.surfaceSubpanelRendererSelectors","afterRender.hideInactive":"{that}.hideInactive"},invokers:{getDistributeOptionsGrade:{funcName:"fluid.prefs.compositePanel.assembleDistributeOptions",args:["{that}.options.components"]},getSubPanelLifecycleBindings:{funcName:"fluid.prefs.compositePanel.subPanelLifecycleBindings",args:["{that}.options.components"]},combineResources:{funcName:"fluid.prefs.compositePanel.combineTemplates",args:["{that}.options.resources","{that}.options.selectors"]},surfaceSubpanelRendererSelectors:{funcName:"fluid.prefs.compositePanel.surfaceSubpanelRendererSelectors",args:["{that}","{that}.options.components","{that}.options.selectors"]},produceSubPanelTrees:{funcName:"fluid.prefs.compositePanel.produceSubPanelTrees",args:["{that}"]},expandProtoTree:{funcName:"fluid.prefs.compositePanel.expandProtoTree",args:["{that}"]},produceTree:{funcName:"fluid.prefs.compositePanel.produceTree",args:["{that}"]},hideInactive:{funcName:"fluid.prefs.compositePanel.hideInactive",args:["{that}"]},handleRenderOnPreference:{funcName:"fluid.prefs.compositePanel.handleRenderOnPreference",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]},conditionalCreateEvent:{funcName:"fluid.prefs.compositePanel.conditionalCreateEvent"}},subPanelOverrides:{gradeNames:["fluid.prefs.subPanel"]},rendererFnOptions:{noexpand:!0,cutpointGenerator:"fluid.prefs.compositePanel.cutpointGenerator",subPanelRepeatingSelectors:{expander:{funcName:"fluid.prefs.compositePanel.surfaceRepeatingSelectors",args:["{that}.options.components"]}}},components:{},resources:{}}),fluid.prefs.compositePanel.prefetchComponentOptions=function(type,options){var baseOptions=fluid.getGradedDefaults(type,fluid.get(options,"gradeNames"));return fluid.merge(baseOptions.mergePolicy,baseOptions,options)},fluid.prefs.compositePanel.isPanel=function(type,options){var opts=fluid.prefs.compositePanel.prefetchComponentOptions(type,options);return fluid.hasGrade(opts,"fluid.prefs.panel")},fluid.prefs.compositePanel.isActivePanel=function(comp){return comp&&fluid.hasGrade(comp.options,"fluid.prefs.panel")},fluid.prefs.compositePanel.assembleDistributeOptions=function(components){var gradeName="fluid.prefs.compositePanel.distributeOptions_"+fluid.allocateGuid(),distributeRules=[];return $.each(components,function(componentName,componentOptions){fluid.prefs.compositePanel.isPanel(componentOptions.type,componentOptions.options)&&distributeRules.push({source:"{that}.options.subPanelOverrides",target:"{that > "+componentName+"}.options"})}),fluid.defaults(gradeName,{gradeNames:["fluid.littleComponent","autoInit"],distributeOptions:distributeRules}),gradeName},fluid.prefs.compositePanel.conditionalCreateEvent=function(value,createEvent){value&&createEvent()},fluid.prefs.compositePanel.handleRenderOnPreference=function(that,value,createEvent,componentNames){componentNames=fluid.makeArray(componentNames),that.conditionalCreateEvent(value,createEvent),fluid.each(componentNames,function(componentName){var comp=that[componentName];!value&&comp&&comp.destroy()}),that.refreshView()},fluid.prefs.compositePanel.creationEventName=function(pref){return"initOn_"+pref},fluid.prefs.compositePanel.generateModelListeners=function(conditionals){return fluid.transform(conditionals,function(componentNames,pref){var eventName=fluid.prefs.compositePanel.creationEventName(pref);return{func:"{that}.handleRenderOnPreference",args:["{change}.value","{that}.events."+eventName+".fire",componentNames]}})},fluid.prefs.compositePanel.subPanelLifecycleBindings=function(components){var gradeName="fluid.prefs.compositePanel.subPanelCreationTimingDistibution_"+fluid.allocateGuid(),distributeOptions=[],subPanelCreationOpts={"default":"initSubPanels"},conditionals={},listeners={},events={};return $.each(components,function(componentName,componentOptions){if(fluid.prefs.compositePanel.isPanel(componentOptions.type,componentOptions.options)){var creationEventOpt="default",renderOnPreference=fluid.get(componentOptions,"options.renderOnPreference");if(renderOnPreference){var pref=fluid.prefs.subPanel.safePrefKey(renderOnPreference),onCreateListener="onCreate."+pref;creationEventOpt=fluid.prefs.compositePanel.creationEventName(pref),subPanelCreationOpts[creationEventOpt]=creationEventOpt,events[creationEventOpt]=null,conditionals[pref]=conditionals[pref]||[],conditionals[pref].push(componentName),listeners[onCreateListener]={listener:"{that}.conditionalCreateEvent",args:["{that}.model."+pref,"{that}.events."+creationEventOpt+".fire"]}}distributeOptions.push({source:"{that}.options.subPanelCreationOpts."+creationEventOpt,target:"{that}.options.components."+componentName+".createOnEvent"})}}),fluid.defaults(gradeName,{gradeNames:["fluid.eventedComponent","autoInit"],events:events,listeners:listeners,modelListeners:fluid.prefs.compositePanel.generateModelListeners(conditionals),subPanelCreationOpts:subPanelCreationOpts,distributeOptions:distributeOptions}),gradeName},fluid.prefs.compositePanel.hideInactive=function(that){fluid.each(that.options.components,function(componentOpts,componentName){that[componentName];fluid.prefs.compositePanel.isPanel(componentOpts.type,componentOpts.options)&&!fluid.prefs.compositePanel.isActivePanel(that[componentName])&&that.locate(componentName).hide()})},fluid.prefs.compositePanel.combineTemplates=function(resources,selectors){var cutpoints=[],tree={children:[]};fluid.each(resources,function(resource,resourceName){"template"!==resourceName&&(tree.children.push({ID:resourceName,markup:resource.resourceText}),cutpoints.push({id:resourceName,selector:selectors[resourceName]}))});var resourceSpec={base:{resourceText:resources.template.resourceText,href:".",resourceKey:".",cutpoints:cutpoints}},templates=fluid.parseTemplates(resourceSpec,["base"]),renderer=fluid.renderer(templates,tree,{cutpoints:cutpoints,debugMode:!0});resources.template.resourceText=renderer.renderTemplates()},fluid.prefs.compositePanel.rebaseSelectorName=function(memberName,selectorName){return memberName+"_"+selectorName},fluid.prefs.compositePanel.surfaceSubpanelRendererSelectors=function(that,components,selectors){fluid.each(components,function(compOpts,compName){if(fluid.prefs.compositePanel.isPanel(compOpts.type,compOpts.options)){var opts=fluid.prefs.compositePanel.prefetchComponentOptions(compOpts.type,compOpts.options);fluid.each(opts.selectors,function(selector,selName){(!opts.selectorsToIgnore||$.inArray(selName,opts.selectorsToIgnore)<0)&&fluid.set(selectors,fluid.prefs.compositePanel.rebaseSelectorName(compName,selName),selectors[compName]+" "+selector)})}})},fluid.prefs.compositePanel.surfaceRepeatingSelectors=function(components){var repeatingSelectors=[];return fluid.each(components,function(compOpts,compName){if(fluid.prefs.compositePanel.isPanel(compOpts.type,compOpts.options)){var opts=fluid.prefs.compositePanel.prefetchComponentOptions(compOpts.type,compOpts.options),rebasedRepeatingSelectors=fluid.transform(opts.repeatingSelectors,function(selector){return fluid.prefs.compositePanel.rebaseSelectorName(compName,selector)});repeatingSelectors=repeatingSelectors.concat(rebasedRepeatingSelectors)}}),repeatingSelectors},fluid.prefs.compositePanel.cutpointGenerator=function(selectors,options){var opts={selectorsToIgnore:options.selectorsToIgnore,repeatingSelectors:options.repeatingSelectors.concat(options.subPanelRepeatingSelectors)};return fluid.renderer.selectorsToCutpoints(selectors,opts)},fluid.prefs.compositePanel.rebaseID=function(value,memberName){return memberName+"_"+value},fluid.prefs.compositePanel.rebaseParentRelativeID=function(val,memberName){var slicePos="..::".length;return val.slice(0,slicePos)+fluid.prefs.compositePanel.rebaseID(val.slice(slicePos),memberName)},fluid.prefs.compositePanel.rebaseValueBinding=function(value,modelRelayRules){return fluid.find(modelRelayRules,function(oldModelPath,newModelPath){return value===oldModelPath?newModelPath:0===value.indexOf(oldModelPath)?value.replace(oldModelPath,newModelPath):void 0})||value},fluid.prefs.compositePanel.rebaseTree=function(model,tree,memberName,modelRelayRules){var rebased=fluid.transform(tree,function(val,key){if("children"===key)return fluid.transform(val,function(v){return fluid.prefs.compositePanel.rebaseTree(model,v,memberName,modelRelayRules)});if("selection"===key)return fluid.prefs.compositePanel.rebaseTree(model,val,memberName,modelRelayRules);if("ID"===key)return fluid.prefs.compositePanel.rebaseID(val,memberName);if("parentRelativeID"===key)return fluid.prefs.compositePanel.rebaseParentRelativeID(val,memberName);if("valuebinding"===key)return fluid.prefs.compositePanel.rebaseValueBinding(val,modelRelayRules);if("value"===key&&tree.valuebinding){var valuebinding=tree.valuebinding,modelValue=fluid.get(model,fluid.prefs.compositePanel.rebaseValueBinding(valuebinding,modelRelayRules));return void 0!==modelValue?modelValue:val}return val});return rebased},fluid.prefs.compositePanel.produceTree=function(that){var produceTreeOption=that.options.produceTree,ownTree=produceTreeOption?("string"==typeof produceTreeOption?fluid.getGlobalValue(produceTreeOption):produceTreeOption)(that):that.expandProtoTree(),subPanelTree=that.produceSubPanelTrees(),tree={children:ownTree.children.concat(subPanelTree.children)};return tree},fluid.prefs.compositePanel.expandProtoTree=function(that){var expanderOptions=fluid.renderer.modeliseOptions(that.options.expanderOptions,{ELstyle:"${}"},that),expander=fluid.renderer.makeProtoExpander(expanderOptions,that);return expander(that.options.protoTree||{})},fluid.prefs.compositePanel.produceSubPanelTrees=function(that){var tree={children:[]};return fluid.each(that.options.components,function(options,componentName){var subPanel=that[componentName];if(fluid.prefs.compositePanel.isActivePanel(subPanel)){var expanderOptions=fluid.renderer.modeliseOptions(subPanel.options.expanderOptions,{ELstyle:"${}"},subPanel),expander=fluid.renderer.makeProtoExpander(expanderOptions,subPanel),subTree=subPanel.produceTree();subTree=fluid.get(subPanel.options,"rendererFnOptions.noexpand")?subTree:expander(subTree);var rebasedTree=fluid.prefs.compositePanel.rebaseTree(that.model,subTree,componentName,subPanel.options.rules);tree.children=tree.children.concat(rebasedTree.children)}}),tree},fluid.defaults("fluid.prefs.prefsEditorConnections",{gradeNames:["fluid.eventedComponent","autoInit"],mergePolicy:{sourceApplier:"nomerge"},sourceApplier:"{fluid.prefs.prefsEditor}.applier",listeners:{"{fluid.prefs.prefsEditor}.events.onPrefsEditorRefresh":"{fluid.prefs.panel}.refreshView"},strings:{},parentBundle:"{fluid.prefs.prefsEditorLoader}.msgBundle"}),fluid.defaults("fluid.prefs.panel.textSize",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.textSize":{"model.textSize":"default","range.min":"minimum","range.max":"maximum"}},range:{min:1,max:2},selectors:{textSize:".flc-prefsEditor-min-text-size",label:".flc-prefsEditor-min-text-size-label",smallIcon:".flc-prefsEditor-min-text-size-smallIcon",largeIcon:".flc-prefsEditor-min-text-size-largeIcon",multiplier:".flc-prefsEditor-multiplier"},protoTree:{label:{messagekey:"textSizeLabel"},smallIcon:{messagekey:"textSizeSmallIcon"},largeIcon:{messagekey:"textSizeLargeIcon"},multiplier:{messagekey:"multiplier"},textSize:{decorators:{type:"fluid",func:"fluid.textfieldSlider",options:{rules:{textSize:"value"},model:{value:"{that}.model.textSize"},sourceApplier:"{that}.applier",range:"{that}.options.range",sliderOptions:"{that}.options.sliderOptions"}}}},sliderOptions:{orientation:"horizontal",step:.1,range:"min"}}),fluid.defaults("fluid.prefs.panel.textFont",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.textFont":{"model.value":"default","controlValues.textFont":"enum"}},selectors:{textFont:".flc-prefsEditor-text-font",label:".flc-prefsEditor-text-font-label"},stringArrayIndex:{textFont:["textFont-default","textFont-times","textFont-comic","textFont-arial","textFont-verdana"]},protoTree:{label:{messagekey:"textFontLabel"},textFont:{optionnames:"${{that}.stringBundle.textFont}",optionlist:"${{that}.options.controlValues.textFont}",selection:"${value}",decorators:{type:"fluid",func:"fluid.prefs.selectDecorator",options:{styles:"{that}.options.classnameMap.textFont"}}}},classnameMap:null,controlValues:{textFont:["default","times","comic","arial","verdana"]}}),fluid.defaults("fluid.prefs.panel.lineSpace",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.lineSpace":{"model.lineSpace":"default","range.min":"minimum","range.max":"maximum"}},range:{min:1,max:2},selectors:{lineSpace:".flc-prefsEditor-line-space",label:".flc-prefsEditor-line-space-label",narrowIcon:".flc-prefsEditor-line-space-narrowIcon",wideIcon:".flc-prefsEditor-line-space-wideIcon",multiplier:".flc-prefsEditor-multiplier"},protoTree:{label:{messagekey:"lineSpaceLabel"},narrowIcon:{messagekey:"lineSpaceNarrowIcon"},wideIcon:{messagekey:"lineSpaceWideIcon"},multiplier:{messagekey:"multiplier"},lineSpace:{decorators:{type:"fluid",func:"fluid.textfieldSlider",options:{rules:{lineSpace:"value"},model:{value:"{that}.model.lineSpace"},sourceApplier:"{that}.applier",range:"{that}.options.range",sliderOptions:"{that}.options.sliderOptions"}}}},sliderOptions:{orientation:"horizontal",step:.1,range:"min"}}),fluid.defaults("fluid.prefs.panel.contrast",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.contrast":{"model.value":"default","controlValues.theme":"enum"}},listeners:{afterRender:"{that}.style"},selectors:{themeRow:".flc-prefsEditor-themeRow",themeLabel:".flc-prefsEditor-theme-label",themeInput:".flc-prefsEditor-themeInput",label:".flc-prefsEditor-contrast-label"},stringArrayIndex:{theme:["contrast-default","contrast-bw","contrast-wb","contrast-by","contrast-yb","contrast-lgdg"]},repeatingSelectors:["themeRow"],protoTree:{label:{messagekey:"contrastLabel"},expander:{type:"fluid.renderer.selection.inputs",rowID:"themeRow",labelID:"themeLabel",inputID:"themeInput",selectID:"theme-radio",tree:{optionnames:"${{that}.stringBundle.theme}",optionlist:"${{that}.options.controlValues.theme}",selection:"${value}"}}},controlValues:{theme:["default","bw","wb","by","yb","lgdg"]},markup:{label:'<span class="fl-preview-A">A</span><span class="fl-hidden-accessible">%theme</span><div class="fl-crossout"></div>'},invokers:{style:{funcName:"fluid.prefs.panel.contrast.style",args:["{that}.dom.themeLabel","{that}.stringBundle.theme","{that}.options.markup.label","{that}.options.controlValues.theme","{that}.options.classnameMap.theme"],dynamic:!0}}}),fluid.prefs.panel.contrast.style=function(labels,strings,markup,theme,style){fluid.each(labels,function(label,index){label=$(label),label.html(fluid.stringTemplate(markup,{theme:strings[index]})),label.addClass(style[theme[index]])})},fluid.defaults("fluid.prefs.panel.layoutControls",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.tableOfContents":{"model.toc":"default"}},selectors:{toc:".flc-prefsEditor-toc",label:".flc-prefsEditor-toc-label",choiceLabel:".flc-prefsEditor-toc-choice-label"},protoTree:{label:{messagekey:"tocLabel"},choiceLabel:{messagekey:"tocChoiceLabel"},toc:"${toc}"}}),fluid.defaults("fluid.prefs.panel.emphasizeLinks",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.emphasizeLinks":{"model.links":"default"}},selectors:{links:".flc-prefsEditor-links",linksChoiceLabel:".flc-prefsEditor-links-choice-label"},protoTree:{linksChoiceLabel:{messagekey:"linksChoiceLabel"},links:"${links}"}}),fluid.defaults("fluid.prefs.panel.inputsLarger",{gradeNames:["fluid.prefs.panel","autoInit"],preferenceMap:{"fluid.prefs.inputsLarger":{"model.inputsLarger":"default"}},selectors:{inputsLarger:".flc-prefsEditor-inputs-larger",inputsChoiceLabel:".flc-prefsEditor-links-inputs-choice-label"},protoTree:{inputsChoiceLabel:{messagekey:"inputsChoiceLabel"},inputsLarger:"${inputsLarger}"}}),fluid.defaults("fluid.prefs.panel.linksControls",{gradeNames:["fluid.prefs.compositePanel","autoInit"],selectors:{label:".flc-prefsEditor-linksControls-label"},protoTree:{label:{messagekey:"linksControlsLabel"}}}),fluid.defaults("fluid.prefs.selectDecorator",{gradeNames:["fluid.viewComponent","autoInit"],listeners:{onCreate:"fluid.prefs.selectDecorator.decorateOptions"},styles:{preview:"fl-preview-theme"}}),fluid.prefs.selectDecorator.decorateOptions=function(that){fluid.each($("option",that.container),function(option){var styles=that.options.styles;$(option).addClass(styles.preview+" "+styles[fluid.value(option)])})}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.modelRelay",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"],listenerNamespaces:[],mergePolicy:{sourceApplier:"nomerge"},listeners:{onCreate:"{that}.addListeners",onDestroy:"{that}.removeListeners"},invokers:{addListeners:{funcName:"fluid.prefs.modelRelay.addListeners",args:["{that}.options.rules","{that}.applier","{that}.options.sourceApplier","{that}.options.listenerNamespaces"]},removeListeners:{funcName:"fluid.prefs.modelRelay.removeListeners",args:["{that}.options.sourceApplier.modelChanged","{that}.options.listenerNamespaces"]}},rules:{}}),fluid.prefs.modelRelay.removeListeners=function(modelChanged,namespaces){fluid.each(namespaces,function(namespace){modelChanged.removeListener(namespace)})},fluid.prefs.modelRelay.addListeners=function(rules,applier,sourceApplier,listenerNamespaces){fluid.each(rules,function(internalKey,sourceKey){var uniqueNamespace=fluid.allocateGuid();listenerNamespaces.push(uniqueNamespace),fluid.addSourceGuardedListener(applier,internalKey,sourceKey,function(newModel){fluid.fireSourcedChange(sourceApplier,sourceKey,fluid.get(newModel,internalKey),internalKey)}),fluid.addSourceGuardedListener(sourceApplier,sourceKey,internalKey,function(newModel){fluid.fireSourcedChange(applier,internalKey,fluid.get(newModel,sourceKey),sourceKey)},null,uniqueNamespace)})}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.enactor",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","fluid.prefs.modelRelay","autoInit"]}),fluid.defaults("fluid.prefs.uiEnhancerConnections",{gradeNames:["fluid.eventedComponent","autoInit"],mergePolicy:{sourceApplier:"nomerge"},sourceApplier:"{uiEnhancer}.applier"}),fluid.defaults("fluid.prefs.enactor.styleElements",{gradeNames:["fluid.prefs.enactor","autoInit"],cssClass:null,invokers:{applyStyle:{funcName:"fluid.prefs.enactor.styleElements.applyStyle",args:["{arguments}.0","{arguments}.1"]},resetStyle:{funcName:"fluid.prefs.enactor.styleElements.resetStyle",args:["{arguments}.0","{arguments}.1"]},handleStyle:{funcName:"fluid.prefs.enactor.styleElements.handleStyle",args:["{arguments}.0",{expander:{func:"{that}.getElements"}},"{that}"],dynamic:!0},getElements:"fluid.prefs.enactor.getElements"},listeners:{onCreate:{listener:"{that}.handleStyle",args:["{that}.model.value"]}}}),fluid.prefs.enactor.styleElements.applyStyle=function(elements,cssClass){elements.addClass(cssClass)},fluid.prefs.enactor.styleElements.resetStyle=function(elements,cssClass){$(elements,"."+cssClass).andSelf().removeClass(cssClass)},fluid.prefs.enactor.styleElements.handleStyle=function(value,elements,that){value?that.applyStyle(elements,that.options.cssClass):that.resetStyle(elements,that.options.cssClass)},fluid.prefs.enactor.styleElements.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.handleStyle(newModel.value)})},fluid.defaults("fluid.prefs.enactor.classSwapper",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor","autoInit"],classes:{},invokers:{clearClasses:{funcName:"fluid.prefs.enactor.classSwapper.clearClasses",args:["{that}.container","{that}.classStr"]},swap:{funcName:"fluid.prefs.enactor.classSwapper.swap",args:["{arguments}.0","{that}"]}},listeners:{onCreate:{listener:"{that}.swap",args:["{that}.model.value"]}},members:{classStr:{expander:{func:"fluid.prefs.enactor.classSwapper.joinClassStr",args:"{that}.options.classes"}}}}),fluid.prefs.enactor.classSwapper.clearClasses=function(container,classStr){container.removeClass(classStr)},fluid.prefs.enactor.classSwapper.swap=function(value,that){that.clearClasses(),that.container.addClass(that.options.classes[value])},fluid.prefs.enactor.classSwapper.joinClassStr=function(classes){var classStr="";return fluid.each(classes,function(oneClassName){oneClassName&&(classStr+=classStr?" "+oneClassName:oneClassName)}),classStr},fluid.prefs.enactor.classSwapper.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.swap(newModel.value)})},fluid.defaults("fluid.prefs.enactor.emphasizeLinks",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor.styleElements","autoInit"],preferenceMap:{"fluid.prefs.emphasizeLinks":{"model.value":"default"}},cssClass:null,invokers:{getElements:{funcName:"fluid.prefs.enactor.emphasizeLinks.getLinks",args:"{that}.container"}}}),fluid.prefs.enactor.emphasizeLinks.getLinks=function(container){return $("a",container)},fluid.defaults("fluid.prefs.enactor.inputsLarger",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor.styleElements","autoInit"],preferenceMap:{"fluid.prefs.inputsLarger":{"model.value":"default"}},cssClass:null,invokers:{getElements:{funcName:"fluid.prefs.enactor.inputsLarger.getInputs",args:"{that}.container"}}}),fluid.prefs.enactor.inputsLarger.getInputs=function(container){return $("input, button",container)},fluid.defaults("fluid.prefs.enactor.textFont",{gradeNames:["fluid.prefs.enactor.classSwapper","autoInit"],preferenceMap:{"fluid.prefs.textFont":{"model.value":"default"}}}),fluid.defaults("fluid.prefs.enactor.contrast",{gradeNames:["fluid.prefs.enactor.classSwapper","autoInit"],preferenceMap:{"fluid.prefs.contrast":{"model.value":"default"}}}),fluid.prefs.enactor.getTextSizeInPx=function(container,fontSizeMap){var fontSize=container.css("font-size");return fontSizeMap[fontSize]&&(fontSize=fontSizeMap[fontSize]),parseFloat(fontSize)},fluid.defaults("fluid.prefs.enactor.textSize",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor","autoInit"],preferenceMap:{"fluid.prefs.textSize":{"model.value":"default"}},fontSizeMap:{},invokers:{set:{funcName:"fluid.prefs.enactor.textSize.set",args:["{arguments}.0","{that}"]},getTextSizeInPx:{funcName:"fluid.prefs.enactor.getTextSizeInPx",args:["{that}.container","{that}.options.fontSizeMap"]},getTextSizeInEm:{funcName:"fluid.prefs.enactor.textSize.getTextSizeInEm",args:[{expander:{func:"{that}.getTextSizeInPx"}},{expander:{func:"{that}.getPx2EmFactor"}}],dynamic:!0},getPx2EmFactor:{funcName:"fluid.prefs.enactor.textSize.getPx2EmFactor",args:["{that}.container","{that}.options.fontSizeMap"]}},listeners:{onCreate:{listener:"{that}.set",args:"{that}.model.value"}}}),fluid.prefs.enactor.textSize.set=function(times,that){if(that.initialSize||(that.initialSize=that.getTextSizeInEm()),that.initialSize){var targetSize=times*that.initialSize;that.container.css("font-size",targetSize+"em")}},fluid.prefs.enactor.textSize.getTextSizeInEm=function(textSizeInPx,px2emFactor){return Math.round(textSizeInPx/px2emFactor*1e4)/1e4},fluid.prefs.enactor.textSize.getPx2EmFactor=function(container,fontSizeMap){return"HTML"!==container.get(0).tagName&&(container=container.parent()),fluid.prefs.enactor.getTextSizeInPx(container,fontSizeMap)},fluid.prefs.enactor.textSize.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.set(newModel.value)})},fluid.defaults("fluid.prefs.enactor.lineSpace",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor","autoInit"],preferenceMap:{"fluid.prefs.lineSpace":{"model.value":"default"}},fontSizeMap:{},invokers:{set:{funcName:"fluid.prefs.enactor.lineSpace.set",args:["{arguments}.0","{that}"]},getTextSizeInPx:{funcName:"fluid.prefs.enactor.getTextSizeInPx",args:["{that}.container","{that}.options.fontSizeMap"]},getLineHeight:{funcName:"fluid.prefs.enactor.lineSpace.getLineHeight",args:"{that}.container"},numerizeLineHeight:{funcName:"fluid.prefs.enactor.lineSpace.numerizeLineHeight",args:[{expander:{func:"{that}.getLineHeight"}},{expander:{func:"{that}.getTextSizeInPx"}}],dynamic:!0}},listeners:{onCreate:{listener:"{that}.set",args:"{that}.model.value"}}}),fluid.prefs.enactor.lineSpace.getLineHeight=function(container){var lineHeight;return lineHeight=container[0].currentStyle?container[0].currentStyle.lineHeight:container.css("line-height")},fluid.prefs.enactor.lineSpace.numerizeLineHeight=function(lineHeight,fontSize){return lineHeight?"normal"===lineHeight?1.2:lineHeight.match(/[0-9]$/)?lineHeight:Math.round(parseFloat(lineHeight)/fontSize*100)/100:0},fluid.prefs.enactor.lineSpace.set=function(times,that){if(that.initialSize||(that.initialSize=that.numerizeLineHeight()),that.initialSize){var targetLineSpace=times*that.initialSize;that.container.css("line-height",targetLineSpace)}},fluid.prefs.enactor.lineSpace.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.set(newModel.value)})},fluid.defaults("fluid.prefs.enactor.tableOfContents",{gradeNames:["fluid.viewComponent","fluid.prefs.enactor","autoInit"],preferenceMap:{"fluid.prefs.tableOfContents":{"model.value":"default"}},tocTemplate:null,components:{tableOfContents:{type:"fluid.tableOfContents",container:"{fluid.prefs.enactor.tableOfContents}.container",createOnEvent:"onCreateTOCReady",options:{components:{levels:{type:"fluid.tableOfContents.levels",options:{resources:{template:{forceCache:!0,url:"{fluid.prefs.enactor.tableOfContents}.options.tocTemplate"}}}}},listeners:{afterRender:"{fluid.prefs.enactor.tableOfContents}.events.afterTocRender"}}}},invokers:{applyToc:{funcName:"fluid.prefs.enactor.tableOfContents.applyToc",args:["{arguments}.0","{that}"]}},events:{onCreateTOCReady:null,afterTocRender:null,onLateRefreshRelay:null},listeners:{onCreate:{listener:"{that}.applyToc",args:"{that}.model.value"}}}),fluid.prefs.enactor.tableOfContents.applyToc=function(value,that){var async=!1;value?that.tableOfContents?that.tableOfContents.show():(that.events.onCreateTOCReady.fire(),async=!0):that.tableOfContents&&that.tableOfContents.hide(),async||that.events.onLateRefreshRelay.fire(that)},fluid.prefs.enactor.tableOfContents.finalInit=function(that){that.applier.modelChanged.addListener("value",function(newModel){that.applyToc(newModel.value)})},fluid.defaults("fluid.prefs.tocWithEmphasizeLinks",{gradeNames:["fluid.eventedComponent","autoInit"],listeners:{afterTocRender:{listener:"{uiEnhancer}.emphasizeLinks.handleStyle",args:"{uiEnhancer}.model.links"},onLateRefreshRelay:{listener:"{uiEnhancer}.emphasizeLinks.handleStyle",args:"{uiEnhancer}.model.links"}}}),fluid.defaults("fluid.prefs.tocWithInputsLarger",{gradeNames:["fluid.eventedComponent","autoInit"],listeners:{afterTocRender:{listener:"{uiEnhancer}.inputsLarger.handleStyle",args:"{uiEnhancer}.model.inputsLarger"},onLateRefreshRelay:{listener:"{uiEnhancer}.inputsLarger.handleStyle",args:"{uiEnhancer}.model.inputsLarger"}}}),fluid.demands("fluid.prefs.enactor.tableOfContents","fluid.prefs.enactor.emphasizeLinks",{options:{gradeNames:"fluid.prefs.tocWithEmphasizeLinks"}}),fluid.demands("fluid.prefs.enactor.tableOfContents","fluid.prefs.enactor.inputsLarger",{options:{gradeNames:"fluid.prefs.tocWithInputsLarger"}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.rootModel.starter",{gradeNames:["fluid.prefs.rootModel","autoInit"],members:{rootModel:{textFont:"default",theme:"default",textSize:1,lineSpace:1,toc:!1,links:!1,inputsLarger:!1}}}),fluid.defaults("fluid.uiEnhancer.cssClassEnhancerBase",{gradeNames:["fluid.littleComponent","autoInit"],classnameMap:{textFont:{"default":"",times:"fl-font-prefsEditor-times",comic:"fl-font-prefsEditor-comic-sans",arial:"fl-font-prefsEditor-arial",verdana:"fl-font-prefsEditor-verdana"},theme:{"default":"fl-theme-prefsEditor-default",bw:"fl-theme-prefsEditor-bw fl-theme-bw",wb:"fl-theme-prefsEditor-wb fl-theme-wb",by:"fl-theme-prefsEditor-by fl-theme-by",yb:"fl-theme-prefsEditor-yb fl-theme-yb",lgdg:"fl-theme-prefsEditor-lgdg fl-theme-lgdg"},links:"fl-link-enhanced",inputsLarger:"fl-text-larger"}}),fluid.defaults("fluid.uiEnhancer.browserTextEnhancerBase",{gradeNames:["fluid.littleComponent","autoInit"],fontSizeMap:{"xx-small":"9px","x-small":"11px",small:"13px",medium:"15px",large:"18px","x-large":"23px","xx-large":"30px"}}),fluid.defaults("fluid.uiEnhancer.starterEnactors",{gradeNames:["fluid.uiEnhancer","fluid.uiEnhancer.cssClassEnhancerBase","fluid.uiEnhancer.browserTextEnhancerBase","autoInit"],connectionsGrade:"fluid.prefs.uiEnhancerConnections",distributeOptions:{source:"{that}.options.connectionsGrade",removeSource:!0,target:"{that > fluid.prefs.enactor}.options.gradeNames"},components:{textSize:{type:"fluid.prefs.enactor.textSize",container:"{uiEnhancer}.container",options:{fontSizeMap:"{uiEnhancer}.options.fontSizeMap",rules:{textSize:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.textSize"}}},textFont:{type:"fluid.prefs.enactor.textFont",container:"{uiEnhancer}.container",options:{classes:"{uiEnhancer}.options.classnameMap.textFont",rules:{textFont:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.textFont"}}},lineSpace:{type:"fluid.prefs.enactor.lineSpace",container:"{uiEnhancer}.container",options:{fontSizeMap:"{uiEnhancer}.options.fontSizeMap",rules:{lineSpace:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.lineSpace"}}},contrast:{type:"fluid.prefs.enactor.contrast",container:"{uiEnhancer}.container",options:{classes:"{uiEnhancer}.options.classnameMap.theme",rules:{theme:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.theme"}}},emphasizeLinks:{type:"fluid.prefs.enactor.emphasizeLinks",container:"{uiEnhancer}.container",options:{cssClass:"{uiEnhancer}.options.classnameMap.links",rules:{links:"value"},model:{links:"{fluid.prefs.rootModel}.rootModel.links"}}},inputsLarger:{type:"fluid.prefs.enactor.inputsLarger",container:"{uiEnhancer}.container",options:{cssClass:"{uiEnhancer}.options.classnameMap.inputsLarger",rules:{inputsLarger:"value"},model:{inputsLarger:"{fluid.prefs.rootModel}.rootModel.inputsLarger"}}},tableOfContents:{type:"fluid.prefs.enactor.tableOfContents",container:"{uiEnhancer}.container",options:{tocTemplate:"{uiEnhancer}.options.tocTemplate",rules:{toc:"value"},model:{toc:"{fluid.prefs.rootModel}.rootModel.toc"}}}}}),fluid.defaults("fluid.prefs.starterPanels",{gradeNames:["fluid.prefs.prefsEditor","autoInit"],selectors:{textSize:".flc-prefsEditor-text-size",textFont:".flc-prefsEditor-text-font",lineSpace:".flc-prefsEditor-line-space",contrast:".flc-prefsEditor-contrast",textControls:".flc-prefsEditor-text-controls",layoutControls:".flc-prefsEditor-layout-controls",linksControls:".flc-prefsEditor-links-controls"},components:{textSize:{type:"fluid.prefs.panel.textSize",container:"{prefsEditor}.dom.textSize",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",rules:{textSize:"textSize"},model:{value:"{fluid.prefs.rootModel}.rootModel.textSize"},resources:{template:"{templateLoader}.resources.textSize"}}},lineSpace:{type:"fluid.prefs.panel.lineSpace",container:"{prefsEditor}.dom.lineSpace",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",rules:{lineSpace:"lineSpace"},model:{value:"{fluid.prefs.rootModel}.rootModel.lineSpace"},resources:{template:"{templateLoader}.resources.lineSpace"}}},textFont:{type:"fluid.prefs.panel.textFont",container:"{prefsEditor}.dom.textFont",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",classnameMap:"{uiEnhancer}.options.classnameMap",rules:{textFont:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.textFont"},resources:{template:"{templateLoader}.resources.textFont"}}},contrast:{type:"fluid.prefs.panel.contrast",container:"{prefsEditor}.dom.contrast",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",classnameMap:"{uiEnhancer}.options.classnameMap",rules:{theme:"value"},model:{value:"{fluid.prefs.rootModel}.rootModel.theme"},resources:{template:"{templateLoader}.resources.contrast"}}},layoutControls:{type:"fluid.prefs.panel.layoutControls",container:"{prefsEditor}.dom.layoutControls",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",rules:{toc:"toc"},model:{toc:"{fluid.prefs.rootModel}.rootModel.toc"},resources:{template:"{templateLoader}.resources.layoutControls"}}},linksControls:{type:"fluid.prefs.panel.linksControls",container:"{prefsEditor}.dom.linksControls",createOnEvent:"onPrefsEditorMarkupReady",options:{gradeNames:"fluid.prefs.prefsEditorConnections",rules:{links:"fluid_prefs_emphasizeLinks",inputsLarger:"fluid_prefs_inputsLarger"},selectors:{emphasizeLinks:".flc-prefsEditor-emphasizeLinks",inputsLarger:".flc-prefsEditor-inputsLarger"},selectorsToIgnore:["emphasizeLinks","inputsLarger"],model:{fluid_prefs_emphasizeLinks:"{fluid.prefs.rootModel}.rootModel.links",fluid_prefs_inputsLarger:"{fluid.prefs.rootModel}.rootModel.inputsLarger"},components:{emphasizeLinks:{type:"fluid.prefs.panel.emphasizeLinks",container:"{that}.dom.emphasizeLinks",createOnEvent:"initSubPanels"},inputsLarger:{type:"fluid.prefs.panel.inputsLarger",container:"{that}.dom.inputsLarger",createOnEvent:"initSubPanels"}},resources:{template:"{templateLoader}.resources.linksControls",emphasizeLinks:"{templateLoader}.resources.emphasizeLinks",inputsLarger:"{templateLoader}.resources.inputsLarger"}}}}}),fluid.defaults("fluid.prefs.starterTemplateLoader",{gradeNames:["fluid.prefs.resourceLoader","autoInit"],templates:{textSize:"%prefix/PrefsEditorTemplate-textSize.html",textFont:"%prefix/PrefsEditorTemplate-textFont.html",lineSpace:"%prefix/PrefsEditorTemplate-lineSpace.html",contrast:"%prefix/PrefsEditorTemplate-contrast.html",layoutControls:"%prefix/PrefsEditorTemplate-layout.html",linksControls:"%prefix/PrefsEditorTemplate-linksControls.html",emphasizeLinks:"%prefix/PrefsEditorTemplate-emphasizeLinks.html",inputsLarger:"%prefix/PrefsEditorTemplate-inputsLarger.html"}}),fluid.defaults("fluid.prefs.starterSeparatedPanelTemplateLoader",{gradeNames:["fluid.prefs.starterTemplateLoader","autoInit"],templates:{prefsEditor:"%prefix/SeparatedPanelPrefsEditor.html"}}),fluid.defaults("fluid.prefs.starterFullPreviewTemplateLoader",{gradeNames:["fluid.prefs.starterTemplateLoader","autoInit"],templates:{prefsEditor:"%prefix/FullPreviewPrefsEditor.html"}}),fluid.defaults("fluid.prefs.starterFullNoPreviewTemplateLoader",{gradeNames:["fluid.prefs.starterTemplateLoader","autoInit"],templates:{prefsEditor:"%prefix/FullNoPreviewPrefsEditor.html"}}),fluid.defaults("fluid.prefs.starterMessageLoader",{gradeNames:["fluid.prefs.resourceLoader","autoInit"],templates:{prefsEditor:"%prefix/prefsEditor.json",textSize:"%prefix/textSize.json",textFont:"%prefix/textFont.json",lineSpace:"%prefix/lineSpace.json",contrast:"%prefix/contrast.json",layoutControls:"%prefix/tableOfContents.json",linksControls:"%prefix/linksControls.json",emphasizeLinks:"%prefix/emphasizeLinks.json",inputsLarger:"%prefix/inputsLarger.json"}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.dom"),fluid.dom.getDocumentHeight=function(dokkument){var body=$("body",dokkument)[0];return body.offsetHeight},fluid.defaults("fluid.prefs.separatedPanel",{gradeNames:["fluid.prefs.prefsEditorLoader","autoInit"],events:{afterRender:null,onReady:null,onCreateSlidingPanelReady:{events:{iframeRendered:"afterRender",onMsgBundleReady:"onMsgBundleReady"}},templatesAndIframeReady:{events:{iframeReady:"afterRender",templatesLoaded:"onPrefsEditorTemplatesLoaded",messagesLoaded:"onPrefsEditorMessagesLoaded"}}},listeners:{onReady:{listener:"fluid.prefs.separatedPanel.bindEvents",args:["{separatedPanel}.prefsEditor","{iframeRenderer}.iframeEnhancer","{separatedPanel}"]},onCreate:{listener:"fluid.prefs.separatedPanel.hideReset",args:["{separatedPanel}"]}},selectors:{reset:".flc-prefsEditor-reset",iframe:".flc-prefsEditor-iframe"},invokers:{bindReset:{funcName:"fluid.bind",args:["{separatedPanel}.dom.reset","click","{arguments}.0"]}},components:{pageEnhancer:"{uiEnhancer}",slidingPanel:{type:"fluid.slidingPanel",container:"{separatedPanel}.container",createOnEvent:"onCreateSlidingPanelReady",options:{gradeNames:["fluid.prefs.stringBundle"],members:{messageResolver:"{separatedPanel}.msgBundle"},strings:{showText:"{that}.stringBundle.slidingPanelShowText",hideText:"{that}.stringBundle.slidingPanelHideText"},invokers:{operateShow:{funcName:"fluid.prefs.separatedPanel.showPanel",args:["{that}.dom.panel","{that}.events.afterPanelShow.fire"],"this":null,method:null},operateHide:{funcName:"fluid.prefs.separatedPanel.hidePanel",args:["{that}.dom.panel","{that}.events.afterPanelHide.fire"],"this":null,method:null}}}},iframeRenderer:{type:"fluid.prefs.separatedPanel.renderIframe",container:"{separatedPanel}.dom.iframe",options:{markupProps:{src:"%templatePrefix/SeparatedPanelPrefsEditorFrame.html"},events:{afterRender:"{separatedPanel}.events.afterRender"},components:{iframeEnhancer:{type:"fluid.uiEnhancer",container:"{iframeRenderer}.renderPrefsEditorContainer",createOnEvent:"afterRender",options:{gradeNames:["{pageEnhancer}.options.gradeNames"],jQuery:"{iframeRenderer}.jQuery",tocTemplate:"{pageEnhancer}.options.tocTemplate"}}}}},prefsEditor:{createOnEvent:"templatesAndIframeReady",container:"{iframeRenderer}.renderPrefsEditorContainer",options:{gradeNames:["fluid.prefs.uiEnhancerRelay"],model:"{separatedPanel}.model",applier:"{separatedPanel}.applier",events:{onSignificantDOMChange:null,updateEnhancerModel:"{that}.events.modelChanged"},listeners:{modelChanged:"{that}.save",onCreate:{listener:"{separatedPanel}.bindReset",args:["{that}.reset"]},onReset:"{that}.applyChanges",onReady:{listener:"{separatedPanel}.events.onReady",args:"{separatedPanel}"}}}}},outerEnhancerOptions:"{originalEnhancerOptions}.options.originalUserOptions",distributeOptions:[{source:"{that}.options.slidingPanel",removeSource:!0,target:"{that > slidingPanel}.options"},{source:"{that}.options.iframeRenderer",removeSource:!0,target:"{that > iframeRenderer}.options"},{source:"{that}.options.iframe",removeSource:!0,target:"{that}.options.selectors.iframe"},{source:"{that}.options.outerEnhancerOptions",removeSource:!0,target:"{that iframeEnhancer}.options"},{source:"{that}.options.templatePrefix",target:"{that > iframeRenderer}.options.templatePrefix"}]}),fluid.prefs.separatedPanel.hideReset=function(separatedPanel){separatedPanel.locate("reset").hide()},fluid.defaults("fluid.prefs.separatedPanel.renderIframe",{gradeNames:["fluid.viewComponent","autoInit"],events:{afterRender:null},styles:{containerFlex:"fl-container-flex",container:"fl-prefsEditor-separatedPanel-iframe"},templatePrefix:"./",markupProps:{"class":"flc-iframe",src:"%templatePrefix/prefsEditorIframe.html"}}),fluid.prefs.separatedPanel.renderIframe.finalInit=function(that){var styles=that.options.styles;that.options.markupProps.src=fluid.stringTemplate(that.options.markupProps.src,{"templatePrefix/":that.options.templatePrefix}),that.iframeSrc=that.options.markupProps.src,that.iframe=$("<iframe/>"),that.iframe.load(function(){var iframeWindow=that.iframe[0].contentWindow;that.iframeDocument=iframeWindow.document,that.jQuery=iframeWindow.jQuery,that.renderPrefsEditorContainer=that.jQuery("body",that.iframeDocument),that.jQuery(that.iframeDocument).ready(that.events.afterRender.fire)}),that.iframe.attr(that.options.markupProps),that.iframe.addClass(styles.containerFlex),that.iframe.addClass(styles.container),that.iframe.hide(),that.iframe.appendTo(that.container)},fluid.prefs.separatedPanel.updateView=function(prefsEditor){prefsEditor.events.onPrefsEditorRefresh.fire(),prefsEditor.events.onSignificantDOMChange.fire()},fluid.prefs.separatedPanel.bindEvents=function(prefsEditor,iframeEnhancer,separatedPanel){separatedPanel.slidingPanel.events.afterPanelShow.addListener(function(){fluid.prefs.separatedPanel.updateView(prefsEditor)}),prefsEditor.events.onPrefsEditorRefresh.addListener(function(){iframeEnhancer.updateModel(prefsEditor.model)}),prefsEditor.events.onReset.addListener(function(prefsEditor){fluid.prefs.separatedPanel.updateView(prefsEditor)}),prefsEditor.events.onSignificantDOMChange.addListener(function(){var dokkument=prefsEditor.container[0].ownerDocument,height=fluid.dom.getDocumentHeight(dokkument),iframe=separatedPanel.iframeRenderer.iframe,attrs={height:height+15},panel=separatedPanel.slidingPanel.locate("panel");panel.css({height:""}),iframe.animate(attrs,400)}),separatedPanel.slidingPanel.events.afterPanelHide.addListener(function(){separatedPanel.iframeRenderer.iframe.height(0),separatedPanel.iframeRenderer.iframe.hide()}),separatedPanel.slidingPanel.events.onPanelShow.addListener(function(){separatedPanel.iframeRenderer.iframe.show(),separatedPanel.locate("reset").show()}),separatedPanel.slidingPanel.events.onPanelHide.addListener(function(){separatedPanel.locate("reset").hide()})},fluid.prefs.separatedPanel.hidePanel=function(panel,callback){$(panel).animate({height:0},{duration:400,complete:callback})},fluid.prefs.separatedPanel.showPanel=function(panel,callback){setTimeout(callback,1)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.fullNoPreview",{gradeNames:["fluid.prefs.prefsEditorLoader","autoInit"],components:{prefsEditor:{container:"{that}.container",options:{listeners:{onReset:[{listener:"{that}.applyChanges"},{listener:"{that}.save"}],onReady:{listener:"{fullNoPreview}.events.onReady",args:"{fullNoPreview}"}}}}},events:{onReady:null}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.defaults("fluid.prefs.fullPreview",{gradeNames:["fluid.prefs.prefsEditorLoader","autoInit"],outerPreviewEnhancerOptions:"{originalEnhancerOptions}.options.originalUserOptions",components:{prefsEditor:{container:"{that}.container",options:{components:{preview:{type:"fluid.prefs.preview",createOnEvent:"onReady",container:"{prefsEditor}.dom.previewFrame",options:{listeners:{onReady:"{fullPreview}.events.onPreviewReady"}}}},listeners:{onReady:"{fullPreview}.events.onPrefsEditorReady"},distributeOptions:{source:"{that}.options.preview",removeSource:!0,target:"{that > preview}.options"}}}},events:{onPrefsEditorReady:null,onPreviewReady:null,onReady:{events:{onPrefsEditorReady:"onPrefsEditorReady",onPreviewReady:"onPreviewReady"},args:"{that}"}},distributeOptions:[{source:"{that}.options.outerPreviewEnhancerOptions",removeSource:!0,target:"{that enhancer}.options"},{source:"{that}.options.preview",target:"{that preview}.options"},{source:"{that}.options.previewEnhancer",removeSource:!0,target:"{that enhancer}.options"}]})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){"use strict";fluid.registerNamespace("fluid.prefs.schemas"),fluid.prefs.schemas.merge=function(target,source){return target||(target={type:"object",properties:{}}),source=source.properties||source,$.extend(!0,target.properties,source),target},fluid.defaults("fluid.prefs.primaryBuilder",{gradeNames:["fluid.littleComponent","autoInit","{that}.buildPrimary"],schemaIndex:{expander:{func:"fluid.indexDefaults",args:["schemaIndex",{gradeNames:"fluid.prefs.schemas",indexFunc:"fluid.prefs.primaryBuilder.defaultSchemaIndexer"}]}},primarySchema:{},typeFilter:[],invokers:{buildPrimary:{funcName:"fluid.prefs.primaryBuilder.buildPrimary",args:["{that}.options.schemaIndex","{that}.options.typeFilter","{that}.options.primarySchema"]}}}),fluid.prefs.primaryBuilder.buildPrimary=function(schemaIndex,typeFilter,primarySchema){var suppliedPrimaryGradeName="fluid.prefs.schemas.suppliedPrimary"+fluid.allocateGuid();fluid.defaults(suppliedPrimaryGradeName,{gradeNames:["autoInit","fluid.prefs.schemas"],schema:fluid.filterKeys(primarySchema.properties||primarySchema,typeFilter,!1)});var primary=[];return fluid.each(typeFilter,function(type){var schemaGrades=schemaIndex[type];schemaGrades&&primary.push.apply(primary,schemaGrades)}),primary.push(suppliedPrimaryGradeName),primary},fluid.prefs.primaryBuilder.defaultSchemaIndexer=function(defaults){return defaults.schema?fluid.keys(defaults.schema.properties):void 0},fluid.defaults("fluid.prefs.schemas",{gradeNames:["autoInit","fluid.littleComponent"],mergePolicy:{schema:fluid.prefs.schemas.merge}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.prefs"),fluid.defaults("fluid.prefs.auxSchema",{gradeNames:["fluid.littleComponent","autoInit"],auxiliarySchema:{}}),fluid.prefs.expandSchemaValue=function(root,pathRef){return"@"!==pathRef.charAt(0)?pathRef:fluid.get(root,pathRef.substring(1))},fluid.prefs.addAtPath=function(root,path,object){var existingObject=fluid.get(root,path);return fluid.set(root,path,$.extend(!0,{},existingObject,object)),root},fluid.prefs.removeKey=function(root,key){var value=root[key];return delete root[key],value},fluid.prefs.rearrangeDirect=function(root,toPath,sourcePath){var result={},sourceValue=fluid.prefs.removeKey(root,sourcePath);return sourceValue&&fluid.set(result,toPath,sourceValue),result},fluid.prefs.addCommonOptions=function(root,path,commonOptions,templateValues){templateValues=templateValues||{};var existingValue=fluid.get(root,path);if(!existingValue)return root;var opts={},mergePolicy={};return fluid.each(commonOptions,function(value,key){if("container"===key){var componentType=fluid.get(root,[path,"type"]),componentOptions=fluid.defaults(componentType);if(void 0===fluid.get(componentOptions,["argumentMap","container"]))return!1}-1!==key.indexOf("gradeNames")&&(mergePolicy[key]=fluid.arrayConcatPolicy),key=fluid.stringTemplate(key,templateValues),value="string"==typeof value?fluid.stringTemplate(value,templateValues):value,fluid.set(opts,key,value)}),fluid.set(root,path,fluid.merge(mergePolicy,existingValue,opts)),root},fluid.prefs.containerNeeded=function(root,path){var componentType=fluid.get(root,[path,"type"]),componentOptions=fluid.defaults(componentType);return fluid.hasGrade(componentOptions,"fluid.viewComponent")||fluid.hasGrade(componentOptions,"fluid.rendererComponent")},fluid.prefs.checkPrimarySchema=function(primarySchema,prefKey){return primarySchema||fluid.fail("The primary schema for "+prefKey+" is not defined."),!!primarySchema},fluid.prefs.expandSchemaComponents=function(auxSchema,type,prefKey,componentConfig,index,commonOptions,mappedDefaults){var componentOptions=fluid.copy(componentConfig)||{},components={},rootModel={},componentName=fluid.prefs.removeKey(componentOptions,"type"),regexp=new RegExp("\\.","g"),memberName=componentName.replace(regexp,"_"),flattenedPrefKey=prefKey.replace(regexp,"_");if(componentName){components[memberName]={type:componentName,options:componentOptions};var selectors=fluid.prefs.rearrangeDirect(componentOptions,memberName,"container"),templates=fluid.prefs.rearrangeDirect(componentOptions,memberName,"template"),messages=fluid.prefs.rearrangeDirect(componentOptions,memberName,"message"),preferenceMap=fluid.defaults(componentName).preferenceMap,map=preferenceMap[prefKey],prefSchema=mappedDefaults[prefKey];fluid.each(map,function(primaryPath,internalPath){if(fluid.prefs.checkPrimarySchema(prefSchema,prefKey)){var opts={};if(0===internalPath.indexOf("model.")){var internalModelName=internalPath.slice(6);fluid.set(opts,["rules",flattenedPrefKey],internalModelName),fluid.set(opts,["model",internalModelName],prefSchema[primaryPath]),fluid.set(rootModel,["members","rootModel",flattenedPrefKey],prefSchema[primaryPath])}else fluid.set(opts,internalPath,prefSchema[primaryPath]);$.extend(!0,componentOptions,opts)}}),fluid.prefs.addCommonOptions(components,memberName,commonOptions,{prefKey:memberName}),fluid.prefs.addAtPath(auxSchema,[type,"components"],components),fluid.prefs.addAtPath(auxSchema,[type,"selectors"],selectors),fluid.prefs.addAtPath(auxSchema,["templateLoader","templates"],templates),fluid.prefs.addAtPath(auxSchema,["messageLoader","templates"],messages),fluid.prefs.addAtPath(auxSchema,"rootModel",rootModel)}return auxSchema},fluid.prefs.expandSchemaDirectOption=function(auxSchema,type,targetPath){var value=auxSchema[type];value&&(delete auxSchema[type],fluid.set(auxSchema,targetPath,value))},fluid.prefs.expandSchemaImpl=function(schemaToExpand,altSource){var expandedSchema=fluid.copy(schemaToExpand);return altSource=altSource||expandedSchema,fluid.each(expandedSchema,function(value,key){if("object"==typeof value)expandedSchema[key]=fluid.prefs.expandSchemaImpl(value,altSource);else if("string"==typeof value){var expandedVal=fluid.prefs.expandSchemaValue(altSource,value);void 0!==expandedVal?expandedSchema[key]=expandedVal:delete expandedSchema[key]}}),expandedSchema},fluid.prefs.expandCompositePanels=function(auxSchema,compositePanelList,panelIndex,panelCommonOptions,subPanelCommonOptions,compositePanelBasedOnSubCommonOptions,mappedDefaults){var panelsToIgnore=[];return fluid.each(compositePanelList,function(compositeDetail,compositeKey){var compositePanelOptions={},components={},rootModel={},selectors={},templates={},messages={},selectorsToIgnore=[],thisCompositeOptions=fluid.copy(compositeDetail);fluid.set(compositePanelOptions,"type",thisCompositeOptions.type),delete thisCompositeOptions.type,selectors=fluid.prefs.rearrangeDirect(thisCompositeOptions,compositeKey,"container"),templates=fluid.prefs.rearrangeDirect(thisCompositeOptions,compositeKey,"template"),messages=fluid.prefs.rearrangeDirect(thisCompositeOptions,compositeKey,"message");var subPanelList=[],subPanels={},subPanelRenderOn={};fluid.isPrimitive(thisCompositeOptions.panels)?subPanelList=thisCompositeOptions.panels:fluid.each(thisCompositeOptions.panels,function(subpanelArray,pref){subPanelList=subPanelList.concat(subpanelArray),"always"!==pref&&fluid.each(subpanelArray,function(onePanel){fluid.set(subPanelRenderOn,onePanel,pref)})}),fluid.each(subPanelList,function(subPanelID){panelsToIgnore.push(subPanelID);var subPanelPrefsKey=fluid.get(auxSchema,[subPanelID,"type"]),safeSubPanelPrefsKey=fluid.prefs.subPanel.safePrefKey(subPanelPrefsKey);selectorsToIgnore.push(safeSubPanelPrefsKey);var subPanelOptions=fluid.copy(fluid.get(auxSchema,[subPanelID,"panel"])),subPanelType=fluid.get(subPanelOptions,"type");fluid.set(subPanels,[safeSubPanelPrefsKey,"type"],subPanelType);var renderOn=fluid.get(subPanelRenderOn,subPanelID);renderOn&&fluid.set(subPanels,[safeSubPanelPrefsKey,"options","renderOnPreference"],renderOn);var map=fluid.defaults(subPanelType).preferenceMap[subPanelPrefsKey],prefSchema=mappedDefaults[subPanelPrefsKey];fluid.each(map,function(primaryPath,internalPath){if(fluid.prefs.checkPrimarySchema(prefSchema,subPanelPrefsKey)){var opts;0===internalPath.indexOf("model.")?(fluid.set(compositePanelOptions,["options","rules",safeSubPanelPrefsKey],safeSubPanelPrefsKey),fluid.set(compositePanelOptions,["options","model",safeSubPanelPrefsKey],prefSchema[primaryPath]),fluid.set(rootModel,["members","rootModel",safeSubPanelPrefsKey],prefSchema[primaryPath])):(opts=opts||{options:{}},fluid.set(opts,"options."+internalPath,prefSchema[primaryPath])),$.extend(!0,subPanels[safeSubPanelPrefsKey],opts)}}),fluid.set(templates,safeSubPanelPrefsKey,fluid.get(subPanelOptions,"template")),fluid.set(messages,safeSubPanelPrefsKey,fluid.get(subPanelOptions,"message")),fluid.set(compositePanelOptions,["options","selectors",safeSubPanelPrefsKey],fluid.get(subPanelOptions,"container")),fluid.set(compositePanelOptions,["options","resources"],fluid.get(compositePanelOptions,["options","resources"])||{}),fluid.prefs.addCommonOptions(compositePanelOptions.options,"resources",compositePanelBasedOnSubCommonOptions,{subPrefKey:safeSubPanelPrefsKey}),delete subPanelOptions.type,delete subPanelOptions.template,delete subPanelOptions.message,delete subPanelOptions.container,fluid.set(subPanels,[safeSubPanelPrefsKey,"options"],$.extend(!0,{},fluid.get(subPanels,[safeSubPanelPrefsKey,"options"]),subPanelOptions)),fluid.prefs.addCommonOptions(subPanels,safeSubPanelPrefsKey,subPanelCommonOptions,{compositePanel:compositeKey,prefKey:safeSubPanelPrefsKey})}),delete thisCompositeOptions.panels,fluid.set(compositePanelOptions,["options"],$.extend(!0,{},compositePanelOptions.options,thisCompositeOptions)),fluid.set(compositePanelOptions,["options","selectorsToIgnore"],selectorsToIgnore),fluid.set(compositePanelOptions,["options","components"],subPanels),components[compositeKey]=compositePanelOptions,fluid.prefs.addCommonOptions(components,compositeKey,panelCommonOptions,{prefKey:compositeKey}),fluid.prefs.addAtPath(auxSchema,["panels","components"],components),fluid.prefs.addAtPath(auxSchema,["panels","selectors"],selectors),fluid.prefs.addAtPath(auxSchema,["templateLoader","templates"],templates),fluid.prefs.addAtPath(auxSchema,["messageLoader","templates"],messages),fluid.prefs.addAtPath(auxSchema,"rootModel",rootModel),$.extend(!0,auxSchema,{panelsToIgnore:panelsToIgnore})}),auxSchema},fluid.prefs.expandSchema=function(schemaToExpand,indexes,topCommonOptions,elementCommonOptions,mappedDefaults){var auxSchema=fluid.prefs.expandSchemaImpl(schemaToExpand);auxSchema.namespace=auxSchema.namespace||"fluid.prefs.created_"+fluid.allocateGuid();var compositePanelList=fluid.get(auxSchema,"groups");return compositePanelList&&fluid.prefs.expandCompositePanels(auxSchema,compositePanelList,fluid.get(indexes,"panel"),fluid.get(elementCommonOptions,"panel"),fluid.get(elementCommonOptions,"subPanel"),fluid.get(elementCommonOptions,"compositePanelBasedOnSub"),mappedDefaults),fluid.each(auxSchema,function(category,prefName){var type="panel";category[type]&&-1===$.inArray(prefName,auxSchema.panelsToIgnore)&&fluid.prefs.expandSchemaComponents(auxSchema,"panels",category.type,category[type],fluid.get(indexes,type),fluid.get(elementCommonOptions,type),mappedDefaults),type="enactor",category[type]&&fluid.prefs.expandSchemaComponents(auxSchema,"enactors",category.type,category[type],fluid.get(indexes,type),fluid.get(elementCommonOptions,type),mappedDefaults),type="template",prefName===type&&(fluid.set(auxSchema,["templateLoader","templates","prefsEditor"],auxSchema[type]),delete auxSchema[type]),type="templatePrefix",prefName===type&&fluid.prefs.expandSchemaDirectOption(auxSchema,type,"templatePrefix.templatePrefix"),type="message",prefName===type&&(fluid.set(auxSchema,["messageLoader","templates","prefsEditor"],auxSchema[type]),delete auxSchema[type]),type="messagePrefix",prefName===type&&fluid.prefs.expandSchemaDirectOption(auxSchema,type,"messagePrefix.messagePrefix")}),auxSchema.panelsToIgnore&&delete auxSchema.panelsToIgnore,fluid.each(topCommonOptions,function(topOptions,type){fluid.prefs.addCommonOptions(auxSchema,type,topOptions)}),auxSchema},fluid.defaults("fluid.prefs.auxBuilder",{gradeNames:["fluid.prefs.auxSchema","autoInit"],mergePolicy:{elementCommonOptions:"noexpand"},topCommonOptions:{panels:{gradeNames:["fluid.prefs.prefsEditor","autoInit"]},enactors:{gradeNames:["fluid.uiEnhancer","autoInit"]},templateLoader:{gradeNames:["fluid.prefs.resourceLoader","autoInit"]},messageLoader:{gradeNames:["fluid.prefs.resourceLoader","autoInit"]},rootModel:{gradeNames:["fluid.prefs.rootModel","autoInit"]},templatePrefix:{gradeNames:["fluid.littleComponent","autoInit"]},messagePrefix:{gradeNames:["fluid.littleComponent","autoInit"]}},elementCommonOptions:{panel:{createOnEvent:"onPrefsEditorMarkupReady",container:"{prefsEditor}.dom.%prefKey","options.gradeNames":"fluid.prefs.prefsEditorConnections","options.resources.template":"{templateLoader}.resources.%prefKey"},compositePanelBasedOnSub:{"%subPrefKey":"{templateLoader}.resources.%subPrefKey"},subPanel:{container:"{%compositePanel}.dom.%prefKey"},enactor:{"options.gradeNames":"fluid.prefs.uiEnhancerConnections",container:"{uiEnhancer}.container"}},indexes:{panel:{expander:{func:"fluid.indexDefaults",args:["panelsIndex",{gradeNames:"fluid.prefs.panel",indexFunc:"fluid.prefs.auxBuilder.prefMapIndexer"}]}},enactor:{expander:{func:"fluid.indexDefaults",args:["enactorsIndex",{gradeNames:"fluid.prefs.enactor",indexFunc:"fluid.prefs.auxBuilder.prefMapIndexer"}]}}},mappedDefaults:{},expandedAuxSchema:{expander:{func:"fluid.prefs.expandSchema",args:["{that}.options.auxiliarySchema","{that}.options.indexes","{that}.options.topCommonOptions","{that}.options.elementCommonOptions","{that}.options.mappedDefaults"]}}}),fluid.prefs.auxBuilder.prefMapIndexer=function(defaults){return fluid.keys(defaults.preferenceMap)}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function(fluid){fluid.defaults("fluid.prefs.auxSchema.starter",{gradeNames:["fluid.prefs.auxSchema","autoInit"],auxiliarySchema:{namespace:"fluid.prefs.constructed",templatePrefix:"../../../framework/preferences/html/",template:"%prefix/SeparatedPanelPrefsEditor.html",messagePrefix:"../../../framework/preferences/messages/",message:"%prefix/prefsEditor.json",textSize:{type:"fluid.prefs.textSize",enactor:{type:"fluid.prefs.enactor.textSize"},panel:{type:"fluid.prefs.panel.textSize",container:".flc-prefsEditor-text-size",template:"%prefix/PrefsEditorTemplate-textSize.html",message:"%prefix/textSize.json"}},lineSpace:{type:"fluid.prefs.lineSpace",enactor:{type:"fluid.prefs.enactor.lineSpace",fontSizeMap:{"xx-small":"9px","x-small":"11px",small:"13px",medium:"15px",large:"18px","x-large":"23px","xx-large":"30px"}},panel:{type:"fluid.prefs.panel.lineSpace",container:".flc-prefsEditor-line-space",template:"%prefix/PrefsEditorTemplate-lineSpace.html",message:"%prefix/lineSpace.json"}},textFont:{type:"fluid.prefs.textFont",classes:{"default":"",times:"fl-font-prefsEditor-times",comic:"fl-font-prefsEditor-comic-sans",arial:"fl-font-prefsEditor-arial",verdana:"fl-font-prefsEditor-verdana"},enactor:{type:"fluid.prefs.enactor.textFont",classes:"@textFont.classes"},panel:{type:"fluid.prefs.panel.textFont",container:".flc-prefsEditor-text-font",classnameMap:{textFont:"@textFont.classes"},template:"%prefix/PrefsEditorTemplate-textFont.html",message:"%prefix/textFont.json"}},contrast:{type:"fluid.prefs.contrast",classes:{"default":"fl-theme-prefsEditor-default",bw:"fl-theme-prefsEditor-bw fl-theme-bw",wb:"fl-theme-prefsEditor-wb fl-theme-wb",by:"fl-theme-prefsEditor-by fl-theme-by",yb:"fl-theme-prefsEditor-yb fl-theme-yb",lgdg:"fl-theme-prefsEditor-lgdg fl-theme-lgdg"},enactor:{type:"fluid.prefs.enactor.contrast",classes:"@contrast.classes"},panel:{type:"fluid.prefs.panel.contrast",container:".flc-prefsEditor-contrast",classnameMap:{theme:"@contrast.classes"},template:"%prefix/PrefsEditorTemplate-contrast.html",message:"%prefix/contrast.json"}},tableOfContents:{type:"fluid.prefs.tableOfContents",enactor:{type:"fluid.prefs.enactor.tableOfContents",tocTemplate:"../../../components/tableOfContents/html/TableOfContents.html"},panel:{type:"fluid.prefs.panel.layoutControls",container:".flc-prefsEditor-layout-controls",template:"%prefix/PrefsEditorTemplate-layout.html",message:"%prefix/tableOfContents.json"}},emphasizeLinks:{type:"fluid.prefs.emphasizeLinks",enactor:{type:"fluid.prefs.enactor.emphasizeLinks",cssClass:"fl-link-enhanced"},panel:{type:"fluid.prefs.panel.emphasizeLinks",container:".flc-prefsEditor-emphasizeLinks",template:"%prefix/PrefsEditorTemplate-emphasizeLinks.html",message:"%prefix/emphasizeLinks.json"}},inputsLarger:{type:"fluid.prefs.inputsLarger",enactor:{type:"fluid.prefs.enactor.inputsLarger",cssClass:"fl-text-larger"},panel:{type:"fluid.prefs.panel.inputsLarger",container:".flc-prefsEditor-inputsLarger",template:"%prefix/PrefsEditorTemplate-inputsLarger.html",message:"%prefix/inputsLarger.json"}},groups:{linksControls:{container:".flc-prefsEditor-links-controls",template:"%prefix/PrefsEditorTemplate-linksControls.html",message:"%prefix/linksControls.json",type:"fluid.prefs.panel.linksControls",panels:["emphasizeLinks","inputsLarger"]}}}}),fluid.defaults("fluid.prefs.schemas.textSize",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.textSize":{type:"number","default":1,minimum:1,maximum:2,divisibleBy:.1}}}),fluid.defaults("fluid.prefs.schemas.lineSpace",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.lineSpace":{type:"number","default":1,minimum:1,maximum:2,divisibleBy:.1}}}),fluid.defaults("fluid.prefs.schemas.textFont",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.textFont":{type:"string","default":"","enum":["default","times","comic","arial","verdana"]}}}),fluid.defaults("fluid.prefs.schemas.contrast",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.contrast":{type:"string","default":"default","enum":["default","bw","wb","by","yb","lgdg"]}}}),fluid.defaults("fluid.prefs.schemas.tableOfContents",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.tableOfContents":{type:"boolean","default":!1}}}),fluid.defaults("fluid.prefs.schemas.emphasizeLinks",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.emphasizeLinks":{type:"boolean","default":!1}}}),fluid.defaults("fluid.prefs.schemas.inputsLarger",{gradeNames:["autoInit","fluid.prefs.schemas"],schema:{"fluid.prefs.inputsLarger":{type:"boolean","default":!1}}})}(fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.prefs"),fluid.defaults("fluid.prefs.builder",{gradeNames:["fluid.eventedComponent","fluid.prefs.auxBuilder","autoInit"],mergePolicy:{auxSchema:"expandedAuxSchema"},assembledPrefsEditorGrade:{expander:{func:"fluid.prefs.builder.generateGrade",args:["prefsEditor","{that}.options.auxSchema.namespace",{gradeNames:["fluid.viewComponent","autoInit","fluid.prefs.assembler.prefsEd"],componentGrades:"{that}.options.constructedGrades"}]}},assembledUIEGrade:{expander:{func:"fluid.prefs.builder.generateGrade",args:["uie","{that}.options.auxSchema.namespace",{gradeNames:["fluid.viewComponent","autoInit","fluid.prefs.assembler.uie"],componentGrades:"{that}.options.constructedGrades"}]}},constructedGrades:{expander:{func:"fluid.prefs.builder.constructGrades",args:["{that}.options.auxSchema",["enactors","messages","panels","rootModel","templateLoader","messageLoader","templatePrefix","messagePrefix"]]}},mappedDefaults:"{primaryBuilder}.options.schema.properties",components:{primaryBuilder:{type:"fluid.prefs.primaryBuilder",options:{typeFilter:{expander:{func:"fluid.prefs.builder.parseAuxSchema",args:"{builder}.options.auxiliarySchema"}}}}},distributeOptions:[{source:"{that}.options.primarySchema",removeSource:!0,target:"{that > primaryBuilder}.options.primarySchema"}]}),fluid.defaults("fluid.prefs.assembler.uie",{gradeNames:["autoInit","fluid.viewComponent"],components:{store:{type:"fluid.littleComponent",options:{gradeNames:["{that}.options.storeType"],storeType:"fluid.globalSettingsStore"}},enhancer:{type:"fluid.littleComponent",options:{gradeNames:"{that}.options.enhancerType",enhancerType:"fluid.pageEnhancer",components:{uiEnhancer:{options:{gradeNames:["{fluid.prefs.assembler.uie}.options.componentGrades.enactors"]}}}}}},distributeOptions:[{source:"{that}.options.enhancer",removeSource:!0,target:"{that uiEnhancer}.options"},{source:"{that}.options.store",removeSource:!0,target:"{that settingsStore}.options"},{source:"{that}.options.storeType",removeSource:!0,target:"{that > store}.options.storeType"},{source:"{that}.options.enhancerType",removeSource:!0,target:"{that > enhancer}.options.enhancerType"}]}),fluid.defaults("fluid.prefs.assembler.prefsEd",{gradeNames:["autoInit","fluid.viewComponent","fluid.prefs.assembler.uie"],components:{prefsEditorLoader:{type:"fluid.viewComponent",container:"{fluid.prefs.assembler.prefsEd}.container",priority:"last",options:{gradeNames:["{fluid.prefs.assembler.prefsEd}.options.componentGrades.templatePrefix","{fluid.prefs.assembler.prefsEd}.options.componentGrades.messagePrefix","{fluid.prefs.assembler.prefsEd}.options.componentGrades.messages","{that}.options.prefsEditorType"],prefsEditorType:"fluid.prefs.separatedPanel",templateLoader:{gradeNames:["{fluid.prefs.assembler.prefsEd}.options.componentGrades.templateLoader"]},messageLoader:{gradeNames:["{fluid.prefs.assembler.prefsEd}.options.componentGrades.messageLoader"]},prefsEditor:{gradeNames:["{fluid.prefs.assembler.prefsEd}.options.componentGrades.panels","{fluid.prefs.assembler.prefsEd}.options.componentGrades.rootModel","fluid.prefs.uiEnhancerRelay"]},events:{onReady:"{fluid.prefs.assembler.prefsEd}.events.onPrefsEditorReady"}}}},events:{onPrefsEditorReady:null,onReady:{events:{onPrefsEditorReady:"onPrefsEditorReady",onCreate:"onCreate"},args:["{that}"]}},distributeOptions:[{source:"{that}.options.prefsEditorType",removeSource:!0,target:"{that > prefsEditorLoader}.options.prefsEditorType"},{source:"{that}.options.prefsEditor",removeSource:!0,target:"{that prefsEditor}.options"},{source:"{that}.options.templatePrefix",removeSource:!0,target:"{that prefsEditorLoader}.options.templatePrefix"},{source:"{that}.options.messagePrefix",removeSource:!0,target:"{that prefsEditorLoader}.options.messagePrefix"}]}),fluid.prefs.builder.generateGrade=function(name,namespace,options){var gradeNameTemplate="%namespace.%name",gradeName=fluid.stringTemplate(gradeNameTemplate,{name:name,namespace:namespace});return fluid.defaults(gradeName,options),gradeName},fluid.prefs.builder.constructGrades=function(auxSchema,gradeCategories){var constructedGrades={};return fluid.each(gradeCategories,function(category){var gradeOpts=auxSchema[category];fluid.get(gradeOpts,"gradeNames")&&(constructedGrades[category]=fluid.prefs.builder.generateGrade(category,auxSchema.namespace,gradeOpts))}),constructedGrades},fluid.prefs.builder.parseAuxSchema=function(auxSchema){var auxTypes=[];return fluid.each(auxSchema,function(field){var type=field.type;type&&auxTypes.push(type)}),auxTypes},fluid.prefs.create=function(container,options){options=options||{};var builder=fluid.prefs.builder(options.build);return fluid.invokeGlobalFunction(builder.options.assembledPrefsEditorGrade,[container,options.prefsEditor])}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.prefs.builder({gradeNames:["fluid.prefs.auxSchema.starter"],auxiliarySchema:{namespace:"fluid.uiOptions"}})}(jQuery,fluid_1_5);;!function($){function both(val){return"object"==typeof val?val:{top:val,left:val}}var $scrollTo=$.scrollTo=function(target,duration,settings){$(window).scrollTo(target,duration,settings)};$scrollTo.defaults={axis:"xy",duration:parseFloat($.fn.jquery)>=1.3?0:1},$scrollTo.window=function(){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||-1!=$.inArray(elem.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!isWin)return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return $.browser.safari||"BackCompat"==doc.compatMode?doc.body:doc.documentElement})},$.fn.scrollTo=function(target,duration,settings){return"object"==typeof duration&&(settings=duration,duration=0),"function"==typeof settings&&(settings={onAfter:settings}),"max"==target&&(target=9e9),settings=$.extend({},$scrollTo.defaults,settings),duration=duration||settings.speed||settings.duration,settings.queue=settings.queue&&settings.axis.length>1,settings.queue&&(duration/=2),settings.offset=both(settings.offset),settings.over=both(settings.over),this._scrollable().each(function(){function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,target,settings)})}var toff,elem=this,$elem=$(elem),targ=target,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}targ=$(targ,this);case"object":(targ.is||targ.style)&&(toff=(targ=$(targ)).offset())}$.each(settings.axis.split(""),function(i,axis){var Pos="x"==axis?"Left":"Top",pos=Pos.toLowerCase(),key="scroll"+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff)attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]),settings.margin&&(attr[key]-=parseInt(targ.css("margin"+Pos))||0,attr[key]-=parseInt(targ.css("border"+Pos+"Width"))||0),attr[key]+=settings.offset[pos]||0,settings.over[pos]&&(attr[key]+=targ["x"==axis?"width":"height"]()*settings.over[pos]);else{var val=targ[pos];attr[key]=val.slice&&"%"==val.slice(-1)?parseFloat(val)/100*max:val}/^\d+$/.test(attr[key])&&(attr[key]=attr[key]<=0?0:Math.min(attr[key],max)),!i&&settings.queue&&(old!=attr[key]&&animate(settings.onAfterFirst),delete attr[key])}),animate(settings.onAfter)}).end()},$scrollTo.max=function(elem,axis){var Dim="x"==axis?"Width":"Height",scroll="scroll"+Dim;if(!$(elem).is("html,body"))return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size="client"+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size])}}(jQuery);;var swfobject=function(){function callDomLoadFunctions(){if(!isDomLoaded){try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=!0;for(var dl=domLoadFnArr.length,i=0;dl>i;i++)domLoadFnArr[i]()}}function addDomLoadEvent(fn){isDomLoaded?fn():domLoadFnArr[domLoadFnArr.length]=fn}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF)win.addEventListener("load",fn,!1);else if(typeof doc.addEventListener!=UNDEF)doc.addEventListener("load",fn,!1);else if(typeof win.attachEvent!=UNDEF)addListener(win,"onload",fn);else if("function"==typeof win.onload){var fnOld=win.onload;win.onload=function(){fnOld(),fn()}}else win.onload=fn}function main(){plugin?testPlayerVersion():matchVersions()}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0],o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;!function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");d&&(d=d.split(" ")[1].split(","),ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}else if(10>counter)return counter++,void setTimeout(arguments.callee,10);b.removeChild(o),t=null,matchVersions()}()}else matchVersions()}function matchVersions(){var rl=regObjArr.length;if(rl>0)for(var i=0;rl>i;i++){var id=regObjArr[i].id,cb=regObjArr[i].callbackFn,cbObj={success:!1,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj)if(!hasPlayerVersion(regObjArr[i].swfVersion)||ua.wk&&ua.wk<312)if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall,att.width=obj.getAttribute("width")||"0",att.height=obj.getAttribute("height")||"0",obj.getAttribute("class")&&(att.styleclass=obj.getAttribute("class")),obj.getAttribute("align")&&(att.align=obj.getAttribute("align"));for(var par={},p=obj.getElementsByTagName("param"),pl=p.length,j=0;pl>j;j++)"movie"!=p[j].getAttribute("name").toLowerCase()&&(par[p[j].getAttribute("name")]=p[j].getAttribute("value"));showExpressInstall(att,par,id,cb)}else displayAltContent(obj),cb&&cb(cbObj);else setVisibility(id,!0),cb&&(cbObj.success=!0,cbObj.ref=getObjectById(id),cb(cbObj))}else if(setVisibility(id,!0),cb){var o=getObjectById(id);o&&typeof o.SetVariable!=UNDEF&&(cbObj.success=!0,cbObj.ref=o),cb(cbObj)}}}function getObjectById(objectIdStr){var r=null,o=getElementById(objectIdStr);if(o&&"OBJECT"==o.nodeName)if(typeof o.SetVariable!=UNDEF)r=o;else{var n=o.getElementsByTagName(OBJECT)[0];n&&(r=n)}return r}function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=!0,storedCallbackFn=callbackFn||null,storedCallbackObj={success:!1,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){"OBJECT"==obj.nodeName?(storedAltContent=abstractAltContent(obj),storedAltContentId=null):(storedAltContent=obj,storedAltContentId=replaceElemIdStr),att.id=EXPRESS_INSTALL_ID,(typeof att.width==UNDEF||!/%$/.test(att.width)&&parseInt(att.width,10)<310)&&(att.width="310"),(typeof att.height==UNDEF||!/%$/.test(att.height)&&parseInt(att.height,10)<137)&&(att.height="137"),doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF?par.flashvars+="&"+fv:par.flashvars=fv,ua.ie&&ua.win&&4!=obj.readyState){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew",newObj.setAttribute("id",replaceElemIdStr),obj.parentNode.insertBefore(newObj,obj),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&4!=obj.readyState){var el=createElement("div");obj.parentNode.insertBefore(el,obj),el.parentNode.replaceChild(abstractAltContent(obj),el),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}else obj.parentNode.replaceChild(abstractAltContent(obj),obj)}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie)ac.innerHTML=obj.innerHTML;else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c)for(var cl=c.length,i=0;cl>i;i++)1==c[i].nodeType&&"PARAM"==c[i].nodeName||8==c[i].nodeType||ac.appendChild(c[i].cloneNode(!0))}}return ac}function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312)return r;if(el)if(typeof attObj.id==UNDEF&&(attObj.id=id),ua.ie&&ua.win){var att="";for(var i in attObj)attObj[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?parObj.movie=attObj[i]:"styleclass"==i.toLowerCase()?att+=' class="'+attObj[i]+'"':"classid"!=i.toLowerCase()&&(att+=" "+i+'="'+attObj[i]+'"'));var par="";for(var j in parObj)parObj[j]!=Object.prototype[j]&&(par+='<param name="'+j+'" value="'+parObj[j]+'" />');el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>",objIdArr[objIdArr.length]=attObj.id,r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj)attObj[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?o.setAttribute("class",attObj[m]):"classid"!=m.toLowerCase()&&o.setAttribute(m,attObj[m]));for(var n in parObj)parObj[n]!=Object.prototype[n]&&"movie"!=n.toLowerCase()&&createObjParam(o,n,parObj[n]);el.parentNode.replaceChild(o,el),r=o}return r}function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName),p.setAttribute("value",pValue),el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);obj&&"OBJECT"==obj.nodeName&&(ua.ie&&ua.win?(obj.style.display="none",function(){4==obj.readyState?removeObjectInIE(id):setTimeout(arguments.callee,10)}()):obj.parentNode.removeChild(obj))}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj)"function"==typeof obj[i]&&(obj[i]=null);obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn),listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");return v[0]=parseInt(v[0],10),v[1]=parseInt(v[1],10)||0,v[2]=parseInt(v[2],10)||0,pv[0]>v[0]||pv[0]==v[0]&&pv[1]>v[1]||pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]?!0:!1}function createCSS(sel,decl,media,newStyle){if(!ua.ie||!ua.mac){var h=doc.getElementsByTagName("head")[0];if(h){var m=media&&"string"==typeof media?media:"screen";if(newStyle&&(dynamicStylesheet=null,dynamicStylesheetMedia=null),!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css"),s.setAttribute("media",m),dynamicStylesheet=h.appendChild(s),ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0&&(dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1]),dynamicStylesheetMedia=m}ua.ie&&ua.win?dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT&&dynamicStylesheet.addRule(sel,decl):dynamicStylesheet&&typeof doc.createTextNode!=UNDEF&&dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}}}function setVisibility(id,isVisible){if(autoHideShow){var v=isVisible?"visible":"hidden";isDomLoaded&&getElementById(id)?getElementById(id).style.visibility=v:createCSS("#"+id,"visibility:"+v)}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/,hasBadChars=null!=regex.exec(s);return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}{var storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,dynamicStylesheet,dynamicStylesheetMedia,UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=!1,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],isDomLoaded=!1,isExpressInstallActive=!1,autoHideShow=!0,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=/win/.test(p?p:u),mac=/mac/.test(p?p:u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,ie=!1,playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT)d=nav.plugins[SHOCKWAVE_FLASH].description,!d||typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin||(plugin=!0,ie=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof win.ActiveXObject!=UNDEF)try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);a&&(d=a.GetVariable("$version"),d&&(ie=!0,d=d.split(" ")[1].split(","),playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]))}catch(e){}return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}();!function(){ua.w3&&((typeof doc.readyState!=UNDEF&&"complete"==doc.readyState||typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))&&callDomLoadFunctions(),isDomLoaded||(typeof doc.addEventListener!=UNDEF&&doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,!1),ua.ie&&ua.win&&(doc.attachEvent(ON_READY_STATE_CHANGE,function(){"complete"==doc.readyState&&(doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee),callDomLoadFunctions())}),win==top&&!function(){if(!isDomLoaded){try{doc.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}callDomLoadFunctions()}}()),ua.wk&&!function(){return isDomLoaded?void 0:/loaded|complete/.test(doc.readyState)?void callDomLoadFunctions():void setTimeout(arguments.callee,0)}(),addLoadEvent(callDomLoadFunctions)))}(),function(){ua.ie&&ua.win&&window.attachEvent("onunload",function(){for(var ll=listenersArr.length,i=0;ll>i;i++)listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);for(var il=objIdArr.length,j=0;il>j;j++)removeSWF(objIdArr[j]);for(var k in ua)ua[k]=null;ua=null;for(var l in swfobject)swfobject[l]=null;swfobject=null})}()}return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr,regObj.swfVersion=swfVersionStr,regObj.expressInstall=xiSwfUrlStr,regObj.callbackFn=callbackFn,regObjArr[regObjArr.length]=regObj,setVisibility(objectIdStr,!1)}else callbackFn&&callbackFn({success:!1,id:objectIdStr})},getObjectById:function(objectIdStr){return ua.w3?getObjectById(objectIdStr):void 0},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:!1,id:replaceElemIdStr};ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr?(setVisibility(replaceElemIdStr,!1),addDomLoadEvent(function(){widthStr+="",heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT)for(var i in attObj)att[i]=attObj[i];att.data=swfUrlStr,att.width=widthStr,att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT)for(var j in parObj)par[j]=parObj[j];if(flashvarsObj&&typeof flashvarsObj===OBJECT)for(var k in flashvarsObj)typeof par.flashvars!=UNDEF?par.flashvars+="&"+k+"="+flashvarsObj[k]:par.flashvars=k+"="+flashvarsObj[k];if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);att.id==replaceElemIdStr&&setVisibility(replaceElemIdStr,!0),callbackObj.success=!0,callbackObj.ref=obj}else{if(xiSwfUrlStr&&canExpressInstall())return att.data=xiSwfUrlStr,void showExpressInstall(att,par,replaceElemIdStr,callbackFn);setVisibility(replaceElemIdStr,!0)}callbackFn&&callbackFn(callbackObj)})):callbackFn&&callbackFn(callbackObj)},switchOffAutoHideShow:function(){autoHideShow=!1},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){return ua.w3?createSWF(attObj,parObj,replaceElemIdStr):void 0},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){ua.w3&&canExpressInstall()&&showExpressInstall(att,par,replaceElemIdStr,callbackFn)},removeSWF:function(objElemIdStr){ua.w3&&removeSWF(objElemIdStr)},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){ua.w3&&createCSS(selStr,declStr,mediaStr,newStyleBoolean)},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)&&(q=q.split("?")[1]),null==param)return urlEncodeIfNecessary(q);for(var pairs=q.split("&"),i=0;i<pairs.length;i++)if(pairs[i].substring(0,pairs[i].indexOf("="))==param)return urlEncodeIfNecessary(pairs[i].substring(pairs[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);obj&&storedAltContent&&(obj.parentNode.replaceChild(storedAltContent,obj),storedAltContentId&&(setVisibility(storedAltContentId,!0),ua.ie&&ua.win&&(storedAltContent.style.display="block")),storedCallbackFn&&storedCallbackFn(storedCallbackObj)),isExpressInstallActive=!1}}}}();;var SWFUpload;void 0==SWFUpload&&(SWFUpload=function(settings){this.initSWFUpload(settings)}),SWFUpload.prototype.initSWFUpload=function(settings){try{this.customSettings={},this.settings=settings,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(ex){throw delete SWFUpload.instances[this.movieName],ex}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(url){if("string"!=typeof url||url.match(/^https?:\/\//i)||url.match(/^\//))return url;var indexSlash=(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.location.pathname.lastIndexOf("/"));return path=0>=indexSlash?"/":window.location.pathname.substr(0,indexSlash)+"/",path+url},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=void 0==this.settings[settingName]?defaultValue:this.settings[settingName]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==targetElement)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;tempParent=document.createElement("div"),tempParent.innerHTML=this.getFlashHTML(),targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var paramString=this.buildParamString(),httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var postParams=this.settings.post_params,paramStringPairs=[];if("object"==typeof postParams)for(var name in postParams)postParams.hasOwnProperty(name)&&paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()));return paramStringPairs.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var movieElement=null;if(movieElement=this.getMovieElement(),movieElement&&"unknown"==typeof movieElement.CallFunction){for(var i in movieElement)try{"function"==typeof movieElement[i]&&(movieElement[i]=null)}catch(ex1){}try{movieElement.parentNode.removeChild(movieElement)}catch(ex){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(ex2){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(name,value,default_value){return this.settings[name]=void 0==value?default_value:value},SWFUpload.prototype.getSetting=function(name){return void 0!=this.settings[name]?this.settings[name]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID])},SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){triggerErrorEvent!==!1&&(triggerErrorEvent=!0),this.callFlash("CancelUpload",[fileID,triggerErrorEvent])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject])},SWFUpload.prototype.getFile=function(fileID){return"number"==typeof fileID?this.callFlash("GetFileByIndex",[fileID]):this.callFlash("GetFile",[fileID])},SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value])},SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name])},SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString(),this.callFlash("SetUploadURL",[url])},SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject,this.callFlash("SetPostParams",[paramsObject])},SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types,this.settings.file_types_description=description,this.callFlash("SetFileTypes",[types,description])},SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit,this.callFlash("SetFileSizeLimit",[fileSizeLimit])},SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit,this.callFlash("SetFileUploadLimit",[fileUploadLimit])},SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit,this.callFlash("SetFileQueueLimit",[fileQueueLimit])},SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName,this.callFlash("SetFilePostName",[filePostName])},SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString,this.callFlash("SetUseQueryString",[useQueryString])},SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError,this.callFlash("SetRequeueOnError",[requeueOnError])},SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){"string"==typeof http_status_codes&&(http_status_codes=http_status_codes.replace(" ","").split(",")),this.settings.http_success=http_status_codes,this.callFlash("SetHTTPSuccess",[http_status_codes])},SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds,this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds])},SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled,this.callFlash("SetDebugEnabled",[debugEnabled])},SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){void 0==buttonImageURL&&(buttonImageURL=""),this.settings.button_image_url=buttonImageURL,this.callFlash("SetButtonImageURL",[buttonImageURL])},SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width,this.settings.button_height=height;var movie=this.getMovieElement();void 0!=movie&&(movie.style.width=width+"px",movie.style.height=height+"px"),this.callFlash("SetButtonDimensions",[width,height])},SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html,this.callFlash("SetButtonText",[html])},SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top,this.settings.button_text_left_padding=left,this.callFlash("SetButtonTextPadding",[left,top])},SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css,this.callFlash("SetButtonTextStyle",[css])},SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled,this.callFlash("SetButtonDisabled",[isDisabled])},SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction,this.callFlash("SetButtonAction",[buttonAction])},SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor,this.callFlash("SetButtonCursor",[cursor])},SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){void 0==argumentArray?argumentArray=[]:argumentArray instanceof Array||(argumentArray=[argumentArray]);var self=this;if("function"==typeof this.settings[handlerName])this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray)}),setTimeout(function(){self.executeNextEvent()},0);else if(null!==this.settings[handlerName])throw"Event handler "+handlerName+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;"function"==typeof f&&f.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(file){var uk,reg=/[$]([0-9a-f]{4})/i,unescapedPost={};if(void 0!=file){for(var k in file.post)if(file.post.hasOwnProperty(k)){uk=k;for(var match;null!==(match=reg.exec(uk));)uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)));unescapedPost[uk]=file.post[k]}file.post=unescapedPost}return file},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(ex){return!1}},SWFUpload.prototype.flashReady=function(){var movieElement=this.getMovieElement();return movieElement?(this.cleanUp(movieElement),void this.queueEvent("swfupload_loaded_handler")):void this.debug("Flash called back ready but the flash movie can't be found.")},SWFUpload.prototype.cleanUp=function(movieElement){try{if(this.movieElement&&"unknown"==typeof movieElement.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement)try{"function"==typeof movieElement[key]&&(movieElement[key]=null)}catch(ex){}}}catch(ex1){}window.__flash__removeCallback=function(instance,name){try{instance&&(instance[name]=null)}catch(flashEx){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file),this.queueEvent("file_queued_handler",file)},SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file),this.queueEvent("file_queue_error_handler",[file,errorCode,message])},SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue])},SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file),this.queueEvent("return_upload_start_handler",file)},SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if("function"==typeof this.settings.upload_start_handler)file=this.unescapeFilePostParams(file),returnValue=this.settings.upload_start_handler.call(this,file);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===returnValue&&(returnValue=!0),returnValue=!!returnValue,this.callFlash("ReturnUploadStart",[returnValue])},SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file),this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal])},SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file),this.queueEvent("upload_error_handler",[file,errorCode,message])},SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file),this.queueEvent("upload_success_handler",[file,serverData,responseReceived])},SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file),this.queueEvent("upload_complete_handler",file)},SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message)},SWFUpload.prototype.debugMessage=function(message){if(this.settings.debug){var exceptionMessage,exceptionValues=[];if("object"==typeof message&&"string"==typeof message.name&&"string"==typeof message.message){for(var key in message)message.hasOwnProperty(key)&&exceptionValues.push(key+": "+message[key]);exceptionMessage=exceptionValues.join("\n")||"",exceptionValues=exceptionMessage.split("\n"),exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(exceptionMessage)}else SWFUpload.Console.writeLine(message)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console"),console||(documentForm=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(documentForm),console=document.createElement("textarea"),console.id="SWFUpload_Console",console.style.fontFamily="monospace",console.setAttribute("wrap","off"),console.wrap="off",console.style.overflow="auto",console.style.width="700px",console.style.height="350px",console.style.margin="5px",documentForm.appendChild(console)),console.value+=message+"\n",console.scrollTop=console.scrollHeight-console.clientHeight}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message)}};;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.uploader"),fluid.uploader.fileOrFiles=function(that,numFiles){return 1===numFiles?that.options.strings.progress.singleFile:that.options.strings.progress.pluralFiles},fluid.uploader.enableElement=function(that,elm){elm.prop("disabled",!1),elm.removeClass(that.options.styles.dim)},fluid.uploader.disableElement=function(that,elm){elm.prop("disabled",!0),elm.addClass(that.options.styles.dim)},fluid.uploader.showElement=function(that,elm){elm.removeClass(that.options.styles.hidden)},fluid.uploader.hideElement=function(that,elm){elm.addClass(that.options.styles.hidden)},fluid.uploader.maxFilesUploaded=function(that){var fileUploadLimit=that.queue.getUploadedFiles().length+that.queue.getReadyFiles().length+that.queue.getErroredFiles().length;return fileUploadLimit===that.options.queueSettings.fileUploadLimit},fluid.uploader.setTotalProgressStyle=function(that,didError){didError=didError||!1;var indicator=that.totalProgress.indicator;indicator.toggleClass(that.options.styles.totalProgress,!didError),indicator.toggleClass(that.options.styles.totalProgressError,didError)},fluid.uploader.setStateEmpty=function(that){fluid.uploader.disableElement(that,that.locate("uploadButton")),0===that.queue.files.length&&(that.locate("browseButtonText").text(that.options.strings.buttons.browse),that.locate("browseButton").removeClass(that.options.styles.browseButton),fluid.uploader.showElement(that,that.locate("instructions")))},fluid.uploader.enableBrowseButton=function(that){fluid.uploader.maxFilesUploaded(that)||(fluid.uploader.enableElement(that,that.locate("browseButton")),that.strategy.local.enableBrowseButton())},fluid.uploader.setStateDone=function(that){fluid.uploader.disableElement(that,that.locate("uploadButton")),fluid.uploader.hideElement(that,that.locate("pauseButton")),fluid.uploader.showElement(that,that.locate("uploadButton")),fluid.uploader.enableBrowseButton(that)},fluid.uploader.setStateLoaded=function(that){that.locate("browseButtonText").text(that.options.strings.buttons.addMore),that.locate("browseButton").addClass(that.options.styles.browseButton),fluid.uploader.hideElement(that,that.locate("pauseButton")),fluid.uploader.showElement(that,that.locate("uploadButton")),fluid.uploader.enableElement(that,that.locate("uploadButton")),fluid.uploader.hideElement(that,that.locate("instructions")),that.totalProgress.hide(),fluid.uploader.enableBrowseButton(that)},fluid.uploader.setStateUploading=function(that){that.totalProgress.hide(!1,!1),fluid.uploader.setTotalProgressStyle(that),fluid.uploader.hideElement(that,that.locate("uploadButton")),fluid.uploader.disableElement(that,that.locate("browseButton")),that.strategy.local.disableBrowseButton(),fluid.uploader.enableElement(that,that.locate("pauseButton")),fluid.uploader.showElement(that,that.locate("pauseButton"))},fluid.uploader.setStateFull=function(that){that.locate("browseButtonText").text(that.options.strings.buttons.addMore),that.locate("browseButton").addClass(that.options.styles.browseButton),fluid.uploader.hideElement(that,that.locate("pauseButton")),fluid.uploader.showElement(that,that.locate("uploadButton")),fluid.uploader.enableElement(that,that.locate("uploadButton")),fluid.uploader.disableElement(that,that.locate("browseButton")),that.strategy.local.disableBrowseButton(),fluid.uploader.hideElement(that,that.locate("instructions")),that.totalProgress.hide()},fluid.uploader.ariaLiveRegionUpdater=function(statusRegion,totalFileStatusText,events){statusRegion.attr("role","log"),statusRegion.attr("aria-live","assertive"),statusRegion.attr("aria-relevant","text"),statusRegion.attr("aria-atomic","true");var regionUpdater=function(){statusRegion.text(totalFileStatusText.text())};events.afterFileDialog.addListener(regionUpdater),events.afterFileRemoved.addListener(regionUpdater),events.afterUploadComplete.addListener(regionUpdater)},fluid.uploader.renderUploadTotalMessage=function(that){var numReadyFiles=that.queue.getReadyFiles().length,bytesReadyFiles=that.queue.sizeOfReadyFiles(),fileLabelStr=fluid.uploader.fileOrFiles(that,numReadyFiles),totalStateStr=fluid.stringTemplate(that.options.strings.progress.toUploadLabel,{fileCount:numReadyFiles,fileLabel:fileLabelStr,totalBytes:fluid.uploader.formatFileSize(bytesReadyFiles)});that.locate("totalFileStatusText").html(totalStateStr)},fluid.uploader.renderFileUploadLimit=function(that){if(that.options.queueSettings.fileUploadLimit>0){var fileUploadLimitText=fluid.stringTemplate(that.options.strings.progress.fileUploadLimitLabel,{fileUploadLimit:that.options.queueSettings.fileUploadLimit,fileLabel:fluid.uploader.fileOrFiles(that,that.options.queueSettings.fileUploadLimit)});that.locate("fileUploadLimitText").html(fileUploadLimitText)}},fluid.uploader.formatFileSize=function(bytes){if("number"==typeof bytes){if(0===bytes)return"0.0 KB";if(bytes>0)return 1048576>bytes?(Math.ceil(bytes/1024*10)/10).toFixed(1)+" KB":(Math.ceil(bytes/1048576*10)/10).toFixed(1)+" MB"}return""},fluid.uploader.derivePercent=function(num,total){return Math.round(100*num/total)},fluid.uploader.updateTotalProgress=function(that){var batch=that.queue.currentBatch,totalPercent=fluid.uploader.derivePercent(batch.totalBytesUploaded,batch.totalBytes),numFilesInBatch=batch.files.length,fileLabelStr=fluid.uploader.fileOrFiles(that,numFilesInBatch),totalProgressStr=fluid.stringTemplate(that.options.strings.progress.totalProgressLabel,{curFileN:batch.fileIdx,totalFilesN:numFilesInBatch,fileLabel:fileLabelStr,currBytes:fluid.uploader.formatFileSize(batch.totalBytesUploaded),totalBytes:fluid.uploader.formatFileSize(batch.totalBytes)});that.totalProgress.update(totalPercent,totalProgressStr)},fluid.uploader.updateTotalAtCompletion=function(that){var numErroredFiles=that.queue.getErroredFiles().length,numTotalFiles=that.queue.files.length,fileLabelStr=fluid.uploader.fileOrFiles(that,numTotalFiles),errorStr="";if(numErroredFiles>0){var errorLabelString=1===numErroredFiles?that.options.strings.progress.singleError:that.options.strings.progress.pluralErrors;fluid.uploader.setTotalProgressStyle(that,!0),errorStr=fluid.stringTemplate(that.options.strings.progress.numberOfErrors,{errorsN:numErroredFiles,errorLabel:errorLabelString})}var totalProgressStr=fluid.stringTemplate(that.options.strings.progress.completedLabel,{curFileN:that.queue.getUploadedFiles().length,totalFilesN:numTotalFiles,errorString:errorStr,fileLabel:fileLabelStr,totalCurrBytes:fluid.uploader.formatFileSize(that.queue.sizeOfUploadedFiles())});that.totalProgress.update(100,totalProgressStr)},fluid.uploader.updateQueueSummaryText=function(that){var fileQueueTable=that.locate("fileQueue");if(0===that.queue.files.length)fileQueueTable.attr("summary",that.options.strings.queue.emptyQueue);else{var queueSummary=fluid.stringTemplate(that.options.strings.queue.queueSummary,{totalUploaded:that.queue.getUploadedFiles().length,totalInUploadQueue:that.queue.files.length-that.queue.getUploadedFiles().length});fileQueueTable.attr("summary",queueSummary)}},fluid.uploader.updateStateAfterFileDialog=function(that){var queueLength=that.queue.getReadyFiles().length;queueLength>0&&(fluid.uploader[queueLength===that.options.queueSettings.fileUploadLimit?"setStateFull":"setStateLoaded"](that),fluid.uploader.renderUploadTotalMessage(that),that.locate(that.options.focusWithEvent.afterFileDialog).focus(),fluid.uploader.updateQueueSummaryText(that))},fluid.uploader.updateStateAfterFileRemoval=function(that){fluid.uploader[0===that.queue.getReadyFiles().length?"setStateEmpty":"setStateLoaded"](that),fluid.uploader.renderUploadTotalMessage(that),fluid.uploader.updateQueueSummaryText(that)},fluid.uploader.updateStateAfterCompletion=function(that){fluid.uploader[0===that.queue.getReadyFiles().length?"setStateDone":"setStateLoaded"](that),fluid.uploader.updateTotalAtCompletion(that),fluid.uploader.updateQueueSummaryText(that)},fluid.uploader.uploadNextOrFinish=function(that){that.queue.shouldUploadNextFile()?that.strategy.remote.uploadNextFile():(that.events.afterUploadComplete.fire(that.queue.currentBatch.files),that.queue.clearCurrentBatch())},fluid.uploader.onFileStart=function(file,queue){file.filestatus=fluid.uploader.fileStatusConstants.IN_PROGRESS,queue.startFile()},fluid.uploader.onFileProgress=function(that,currentBytes){that.queue.updateBatchStatus(currentBytes),fluid.uploader.updateTotalProgress(that)},fluid.uploader.onFileComplete=function(file,that){that.queue.finishFile(file),that.events.afterFileComplete.fire(file),fluid.uploader.uploadNextOrFinish(that)},fluid.uploader.onFileSuccess=function(file,that){file.filestatus=fluid.uploader.fileStatusConstants.COMPLETE,0===that.queue.currentBatch.bytesUploadedForFile&&(that.queue.currentBatch.totalBytesUploaded+=file.size),fluid.uploader.updateTotalProgress(that)},fluid.uploader.onFileError=function(file,error,that){error===fluid.uploader.errorConstants.UPLOAD_STOPPED?file.filestatus=fluid.uploader.fileStatusConstants.CANCELLED:(file.filestatus=fluid.uploader.fileStatusConstants.ERROR,that.queue.isUploading&&(that.queue.currentBatch.totalBytesUploaded+=file.size,that.queue.currentBatch.numFilesErrored++,fluid.uploader.uploadNextOrFinish(that)))},fluid.uploader.afterUploadComplete=function(that){that.queue.isUploading=!1,fluid.uploader.updateStateAfterCompletion(that)},fluid.uploaderImpl=function(){fluid.fail('Error creating uploader component - please make sure that a progressiveCheckerForComponent for "fluid.uploader" is registered either in the static environment or else is visible in the current component tree')},fluid.enhance.check({"fluid.browser.supportsBinaryXHR":"fluid.enhance.supportsBinaryXHR","fluid.browser.supportsFormData":"fluid.enhance.supportsFormData","fluid.browser.supportsFlash":"fluid.enhance.supportsFlash"}),fluid.defaults("fluid.uploader",{gradeNames:["fluid.viewComponent","autoInit"],components:{uploaderContext:{type:"fluid.progressiveCheckerForComponent",options:{componentName:"fluid.uploader"}},uploaderImpl:{type:"fluid.uploaderImpl",container:"{uploader}.container"}},returnedPath:"uploaderImpl",distributeOptions:{source:"{that}.options",removeSource:!0,exclusions:["components.uploaderContext","components.uploaderImpl"],target:"{that > uploaderImpl}.options"},progressiveCheckerOptions:{checks:[{feature:"{fluid.browser.supportsBinaryXHR}",contextName:"fluid.uploader.html5"},{feature:"{fluid.browser.supportsFlash}",contextName:"fluid.uploader.swfUpload"}],defaultContextName:"fluid.uploader.singleFile"}}),fluid.uploader.demoTypeTag=function(demo){return demo?"fluid.uploader.demo":"fluid.uploader.live"},fluid.uploader.browse=function(queue,localStrategy){queue.isUploading||localStrategy.browse()},fluid.uploader.removeFile=function(queue,localStrategy,afterFileRemoved,file){queue.removeFile(file),localStrategy.removeFile(file),afterFileRemoved.fire(file)},fluid.uploader.start=function(queue,remoteStrategy,onUploadStart){queue.start(),onUploadStart.fire(queue.currentBatch.files),remoteStrategy.uploadNextFile()},fluid.uploader.stop=function(remoteStrategy,onUploadStop){onUploadStop.fire(),remoteStrategy.stop()},fluid.uploader.defaultQueueSettings={uploadURL:"",postParams:{},fileSizeLimit:"20480",fileTypes:null,fileTypesDescription:null,fileUploadLimit:0,fileQueueLimit:0},fluid.uploader.bindFocus=function(focusWithEvent,noAutoFocus,events,dom){fluid.each(focusWithEvent,function(element,event){noAutoFocus[event]||events[event].addListener(function(){dom.locate(element).focus()})})},fluid.defaults("fluid.uploader.multiFileUploader",{gradeNames:["fluid.viewComponent","autoInit"],nickName:"uploader",invokers:{browse:{funcName:"fluid.uploader.browse",args:["{that}.queue","{that}.strategy.local"]},removeFile:{funcName:"fluid.uploader.removeFile",args:["{that}.queue","{that}.strategy.local","{that}.events.afterFileRemoved","{arguments}.0"]},start:{funcName:"fluid.uploader.start",args:["{that}.queue","{that}.strategy.remote","{that}.events.onUploadStart"]},stop:{funcName:"fluid.uploader.stop",args:["{that}.strategy.remote","{that}.events.onUploadStop"]},statusUpdater:{funcName:"fluid.uploader.ariaLiveRegionUpdater",args:["{that}.dom.statusRegion","{that}.dom.totalFileStatusText","{that}.events"]}},components:{demoTag:{type:"fluid.typeFount",options:{targetTypeName:{expander:{funcName:"fluid.uploader.demoTypeTag",args:"{uploader}.options.demo"}}}},queue:{type:"fluid.uploader.fileQueue"},strategy:{type:"fluid.uploader.strategy"},errorPanel:{type:"fluid.uploader.errorPanel"},fileQueueView:{type:"fluid.uploader.fileQueueView",options:{model:"{uploader}.queue.files",uploaderContainer:"{uploader}.container"}},totalProgress:{type:"fluid.progress",container:"{uploader}.container",options:{selectors:{progressBar:".flc-uploader-queue-footer",displayElement:".flc-uploader-total-progress",label:".flc-uploader-total-progress-text",indicator:".flc-uploader-total-progress",ariaElement:".flc-uploader-total-progress"}}}},queueSettings:fluid.uploader.defaultQueueSettings,demo:!1,selectors:{fileQueue:".flc-uploader-queue",browseButton:".flc-uploader-button-browse",browseButtonText:".flc-uploader-button-browse-text",uploadButton:".flc-uploader-button-upload",pauseButton:".flc-uploader-button-pause",totalFileStatusText:".flc-uploader-total-progress-text",fileUploadLimitText:".flc-uploader-upload-limit-text",instructions:".flc-uploader-browse-instructions",statusRegion:".flc-uploader-status-region",errorsPanel:".flc-uploader-errorsPanel"},noAutoFocus:{afterFileDialog:!0},focusWithEvent:{afterFileDialog:"uploadButton",onUploadStart:"pauseButton",onUploadStop:"uploadButton"},styles:{disabled:"fl-uploader-disabled",hidden:"fl-uploader-hidden",dim:"fl-uploader-dim",totalProgress:"fl-uploader-total-progress-okay",totalProgressError:"fl-uploader-total-progress-errored",browseButton:"fl-uploader-browseMore"},events:{afterReady:null,onFileDialog:null,onFilesSelected:null,onFileQueued:null,afterFileQueued:null,onFileRemoved:null,afterFileRemoved:null,afterFileDialog:null,onUploadStart:null,onUploadStop:null,onFileStart:null,onFileProgress:null,onFileError:null,onQueueError:null,onFileSuccess:null,onFileComplete:null,afterFileComplete:null,afterUploadComplete:null},listeners:{onCreate:[{listener:"fluid.uploader.bindFocus",args:["{that}.options.focusWithEvent","{that}.options.noAutoFocus","{that}.events","{that}.dom"]},{"this":"{that}.dom.uploadButton",method:"click",args:"{that}.start"},{"this":"{that}.dom.pauseButton",method:"click",args:"{that}.stop"}],"afterFileDialog.uploader":{listener:"fluid.uploader.updateStateAfterFileDialog",args:"{that}"},"afterFileQueued.uploader":{listener:"{that}.queue.addFile",args:"{arguments}.0"},"onFileRemoved.uploader":{listener:"{that}.removeFile",args:"{arguments}.0"},"afterFileRemoved.uploader":{listener:"fluid.uploader.updateStateAfterFileRemoval",args:"{that}"},"onUploadStart.uploader":{listener:"fluid.uploader.setStateUploading",args:"{that}"},"onFileStart.uploader":{listener:"fluid.uploader.onFileStart",args:["{arguments}.0","{that}.queue"]},"onFileProgress.uploader":{listener:"fluid.uploader.onFileProgress",args:["{that}","{arguments}.1"]},"onFileComplete.uploader":{listener:"fluid.uploader.onFileComplete",args:["{arguments}.0","{that}"]},"onFileSuccess.uploader":{listener:"fluid.uploader.onFileSuccess",args:["{arguments}.0","{that}"]},"onFileError.uploader":{listener:"fluid.uploader.onFileError",args:["{arguments}.0","{arguments}.1","{that}"]},"afterUploadComplete.uploader":{listener:"fluid.uploader.afterUploadComplete",args:"{that}"}},strings:{progress:{fileUploadLimitLabel:"%fileUploadLimit %fileLabel maximum",toUploadLabel:"To upload: %fileCount %fileLabel (%totalBytes)",totalProgressLabel:"Uploading: %curFileN of %totalFilesN %fileLabel (%currBytes of %totalBytes)",completedLabel:"Uploaded: %curFileN of %totalFilesN %fileLabel (%totalCurrBytes)%errorString",numberOfErrors:", %errorsN %errorLabel",singleFile:"file",pluralFiles:"files",singleError:"error",pluralErrors:"errors"},buttons:{browse:"Browse Files",addMore:"Add More",stopUpload:"Stop Upload",cancelRemaning:"Cancel remaining Uploads",resumeUpload:"Resume Upload"},queue:{emptyQueue:"File list: No files waiting to be uploaded.",queueSummary:"File list: %totalUploaded files uploaded, %totalInUploadQueue file waiting to be uploaded."}}}),fluid.uploader.multiFileUploader.finalInit=function(that){fluid.uploader.disableElement(that,that.locate("uploadButton")),fluid.uploader.updateQueueSummaryText(that),that.statusUpdater(),fluid.uploader.renderFileUploadLimit(that),that.container.attr("role","application")},fluid.defaults("fluid.uploader.strategy",{gradeNames:["fluid.littleComponent"],components:{local:{type:"fluid.uploader.local"},remote:{type:"fluid.uploader.remote"}}}),fluid.defaults("fluid.uploader.local",{gradeNames:["fluid.eventedComponent"],queueSettings:"{uploader}.options.queueSettings",members:{queue:"{uploader}.queue"},events:{onFileDialog:"{uploader}.events.onFileDialog",onFilesSelected:"{uploader}.events.onFilesSelected",afterFileDialog:"{uploader}.events.afterFileDialog",afterFileQueued:"{uploader}.events.afterFileQueued",onQueueError:"{uploader}.events.onQueueError"},invokers:{enableBrowseButton:"fluid.uploader.local.enableBrowseButton",disableBrowseButton:"fluid.uploader.local.disableBrowseButton"}}),fluid.defaults("fluid.uploader.remote",{gradeNames:["fluid.eventedComponent"],members:{queue:"{uploader}.queue",queueSettings:"{uploader}.options.queueSettings"},events:{onFileStart:"{uploader}.events.onFileStart",onFileProgress:"{uploader}.events.onFileProgress",onFileSuccess:"{uploader}.events.onFileSuccess",onFileError:"{uploader}.events.onFileError",onFileComplete:"{uploader}.events.onFileComplete",onUploadStop:"{uploader}.events.onUploadStop",afterFileComplete:"{uploader}.events.afterFileComplete",afterUploadComplete:"{uploader}.events.afterUploadComplete"},invokers:{uploadNextFile:"fluid.uploader.uploadNextFile",stop:"fluid.uploader.stop"}}),fluid.demands("fluid.uploader.fileQueueView","fluid.uploader.multiFileUploader",{container:"{uploader}.dom.fileQueue",options:{events:{onFileRemoved:"{uploader}.events.onFileRemoved"}}}),fluid.demands("fluid.uploader.fileQueueView.eventBinder",["fluid.uploader.multiFileUploader","fluid.uploader.fileQueueView"],{options:{listeners:{"{uploader}.events.afterFileQueued":"{fileQueueView}.addFile","{uploader}.events.onUploadStart":"{fileQueueView}.prepareForUpload","{uploader}.events.onFileStart":"{fileQueueView}.showFileProgress","{uploader}.events.onFileProgress":"{fileQueueView}.updateFileProgress","{uploader}.events.onFileSuccess":"{fileQueueView}.markFileComplete","{uploader}.events.onFileError":"{fileQueueView}.showErrorForFile","{uploader}.events.afterFileComplete":"{fileQueueView}.hideFileProgress","{uploader}.events.afterUploadComplete":"{fileQueueView}.refreshAfterUpload"}}}),fluid.uploader.queueErrorConstants={QUEUE_LIMIT_EXCEEDED:"queue limit exceeded",FILE_EXCEEDS_SIZE_LIMIT:"file exceeds size limit",ZERO_BYTE_FILE:"zero byte file",INVALID_FILETYPE:"invalid filetype"},fluid.uploader.errorConstants={HTTP_ERROR:"HTTP error",MISSING_UPLOAD_URL:"Missing upload URL",IO_ERROR:"I/O error",SECURITY_ERROR:"Security error",UPLOAD_LIMIT_EXCEEDED:"Upload limit exceeded",UPLOAD_FAILED:"Uploader failed",SPECIFIED_FILE_ID_NOT_FOUND:"Specified file ID not found",FILE_VALIDATION_FAILED:"File validation failed",FILE_CANCELLED:"File cancelled",UPLOAD_STOPPED:"Upload stopped"},fluid.uploader.fileStatusConstants={QUEUED:"queued",IN_PROGRESS:"in progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled"};var toggleVisibility=function(toShow,toHide){window.opera?(toShow.show().removeClass("hideUploaderForOpera"),toHide.show().addClass("hideUploaderForOpera")):(toShow.show(),toHide.hide())};fluid.defaults("fluid.uploader.singleFileUploader",{gradeNames:["fluid.viewComponent","autoInit"],selectors:{basicUpload:".fl-progEnhance-basic"}}),fluid.uploader.singleFileUploader.finalInit=function(that){toggleVisibility($(that.options.selectors.basicUpload),that.container)},fluid.demands("fluid.uploaderImpl","fluid.uploader.singleFile",{funcName:"fluid.uploader.singleFileUploader"})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.uploader"),fluid.defaults("fluid.uploader.fileQueue",{gradeNames:["fluid.littleComponent","autoInit"],members:{files:[],isUploading:!1},invokers:{start:{funcName:"fluid.uploader.fileQueue.start",args:"{that}"},startFile:{funcName:"fluid.uploader.fileQueue.startFile",args:"{that}.currentBatch",dynamic:!0},finishFile:{funcName:"fluid.uploader.fileQueue.finishFile",args:"{that}.currentBatch",dynamic:!0},shouldUploadNextFile:{funcName:"fluid.uploader.fileQueue.shouldUploadNextFile",args:"{that}"},addFile:{funcName:"fluid.uploader.fileQueue.addFile",args:["{that}.files","{arguments}.0"]},removeFile:{funcName:"fluid.uploader.fileQueue.removeFile",args:["{that}.files","{arguments}.0"]},totalBytes:{funcName:"fluid.uploader.fileQueue.sizeOfFiles",args:"{that}.files"},getReadyFiles:{funcName:"fluid.uploader.fileQueue.filesByStatus",args:["{that}.files",["QUEUED","CANCELLED"]]},getErroredFiles:{funcName:"fluid.uploader.fileQueue.filesByStatus",args:["{that}.files","ERROR"]},getUploadedFiles:{funcName:"fluid.uploader.fileQueue.filesByStatus",args:["{that}.files","COMPLETE"]},sizeOfReadyFiles:{funcName:"fluid.uploader.fileQueue.sizeOfFilesByStatus",args:["{that}.files",["QUEUED","CANCELLED"]]},sizeOfUploadedFiles:{funcName:"fluid.uploader.fileQueue.sizeOfFilesByStatus",args:["{that}.files","COMPLETE"]},setupCurrentBatch:{funcName:"fluid.uploader.fileQueue.setupCurrentBatch",args:"{that}"},clearCurrentBatch:{funcName:"fluid.uploader.fileQueue.clearCurrentBatch",args:"{that}"},updateCurrentBatch:{funcName:"fluid.uploader.fileQueue.updateCurrentBatch",args:[{expander:{func:"{that}.getReadyFiles"}},"{that}.currentBatch"],dynamic:!0},updateBatchStatus:{funcName:"fluid.uploader.fileQueue.updateBatchStatus",args:["{arguments}.0","{that}.currentBatch"],dynamic:!0}}}),fluid.uploader.fileQueue.start=function(that){that.setupCurrentBatch(),that.isUploading=!0,that.shouldStop=!1},fluid.uploader.fileQueue.startFile=function(currentBatch){currentBatch.fileIdx++,currentBatch.bytesUploadedForFile=0,currentBatch.previousBytesUploadedForFile=0},fluid.uploader.fileQueue.finishFile=function(currentBatch){currentBatch.numFilesCompleted++},fluid.uploader.fileQueue.shouldUploadNextFile=function(that){return!that.shouldStop&&that.isUploading&&that.currentBatch.numFilesCompleted+that.currentBatch.numFilesErrored<that.currentBatch.files.length},fluid.uploader.fileQueue.addFile=function(files,file){files.push(file)},fluid.uploader.fileQueue.removeFile=function(files,file){fluid.remove_if(files,function(thisFile){return file===thisFile})},fluid.uploader.fileQueue.sizeOfFiles=function(files){return fluid.accumulate(files,function(file,totalBytes){return totalBytes+file.size},0)},fluid.uploader.fileQueue.filterFiles=function(files,filterFn){var filteredFiles=[];return fluid.remove_if(fluid.makeArray(files),filterFn,filteredFiles)},fluid.uploader.fileQueue.filesByStatus=function(files,statuses){return statuses=fluid.makeArray(statuses),fluid.uploader.fileQueue.filterFiles(files,function(file){return fluid.find_if(statuses,function(status){return file.filestatus===fluid.uploader.fileStatusConstants[status]})})},fluid.uploader.fileQueue.sizeOfFilesByStatus=function(files,statuses){var files=fluid.uploader.fileQueue.filesByStatus(files,statuses);return fluid.uploader.fileQueue.sizeOfFiles(files)},fluid.uploader.fileQueue.setupCurrentBatch=function(that){that.clearCurrentBatch(),that.updateCurrentBatch()},fluid.uploader.fileQueue.clearCurrentBatch=function(that){that.currentBatch={fileIdx:0,files:[],totalBytes:0,numFilesCompleted:0,numFilesErrored:0,bytesUploadedForFile:0,previousBytesUploadedForFile:0,totalBytesUploaded:0}},fluid.uploader.fileQueue.updateCurrentBatch=function(readyFiles,currentBatch){currentBatch.files=readyFiles,currentBatch.totalBytes=fluid.uploader.fileQueue.sizeOfFiles(readyFiles)},fluid.uploader.fileQueue.updateBatchStatus=function(currentBytes,currentBatch){var byteIncrement=currentBytes-currentBatch.previousBytesUploadedForFile;currentBatch.totalBytesUploaded+=byteIncrement,currentBatch.bytesUploadedForFile+=byteIncrement,currentBatch.previousBytesUploadedForFile=currentBytes}}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.uploader.fileQueueView"),fluid.uploader.fileQueueView.rowForFile=function(that,file){return that.locate("fileQueue").find("#"+file.id)},fluid.uploader.fileQueueView.errorRowForFile=function(that,file){return $("#"+file.id+"_error",that.container)},fluid.uploader.fileQueueView.fileForRow=function(that,row){return fluid.find_if(that.model,function(file){return file.id.toString()===row.prop("id")})},fluid.uploader.fileQueueView.progressorForFile=function(that,file){var progressId=file.id+"_progress";return that.fileProgressors[progressId]},fluid.uploader.fileQueueView.startFileProgress=function(that,file){var fileRowElm=fluid.uploader.fileQueueView.rowForFile(that,file);that.scroller.scrollTo(fileRowElm);var fileProgressor=fluid.uploader.fileQueueView.progressorForFile(that,file);fileProgressor.refreshView(),fileProgressor.show()},fluid.uploader.fileQueueView.updateFileProgress=function(that,file,fileBytesComplete,fileTotalBytes){var filePercent=fluid.uploader.derivePercent(fileBytesComplete,fileTotalBytes),filePercentStr=filePercent+"%";fluid.uploader.fileQueueView.progressorForFile(that,file).update(filePercent,filePercentStr)},fluid.uploader.fileQueueView.hideFileProgress=function(that,file){var fileRowElm=fluid.uploader.fileQueueView.rowForFile(that,file);fluid.uploader.fileQueueView.progressorForFile(that,file).hide(),file.filestatus===fluid.uploader.fileStatusConstants.COMPLETE&&that.locate("fileIconBtn",fileRowElm).removeClass(that.options.styles.dim)},fluid.uploader.fileQueueView.removeFileProgress=function(that,file){var fileProgressor=fluid.uploader.fileQueueView.progressorForFile(that,file);if(fileProgressor){var rowProgressor=fileProgressor.displayElement;rowProgressor.remove()}},fluid.uploader.fileQueueView.animateRowRemoval=function(that,row){row.fadeOut("fast",function(){row.remove(),that.refreshView()})},fluid.uploader.fileQueueView.removeFileErrorRow=function(that,file){file.filestatus===fluid.uploader.fileStatusConstants.ERROR&&fluid.uploader.fileQueueView.animateRowRemoval(that,errorRowForFile(that,file))},fluid.uploader.fileQueueView.removeFileAndRow=function(that,file,row){fluid.uploader.fileQueueView.removeFileProgress(that,file),fluid.uploader.fileQueueView.removeFileErrorRow(that,file),that.events.onFileRemoved.fire(file),fluid.uploader.fileQueueView.animateRowRemoval(that,row)},fluid.uploader.fileQueueView.removeFileForRow=function(that,row){var file=fluid.uploader.fileQueueView.fileForRow(that,row);file&&file.filestatus!==fluid.uploader.fileStatusConstants.COMPLETE&&fluid.uploader.fileQueueView.removeFileAndRow(that,file,row)},fluid.uploader.fileQueueView.removeRowForFile=function(that,file){var row=fluid.uploader.fileQueueView.rowForFile(that,file);fluid.uploader.fileQueueView.removeFileAndRow(that,file,row)},fluid.uploader.fileQueueView.bindHover=function(row,styles){var over=function(){row.hasClass(styles.ready)&&!row.hasClass(styles.uploading)&&row.addClass(styles.hover)},out=function(){row.hasClass(styles.ready)&&!row.hasClass(styles.uploading)&&row.removeClass(styles.hover)};row.hover(over,out)},fluid.uploader.fileQueueView.bindDeleteKey=function(that,row){var deleteHandler=function(){fluid.uploader.fileQueueView.removeFileForRow(that,row)};fluid.activatable(row,null,{additionalBindings:[{key:$.ui.keyCode.DELETE,activateHandler:deleteHandler}]})},fluid.uploader.fileQueueView.bindRowHandlers=function(that,row){$.browser.msie&&$.browser.version<7&&fluid.uploader.fileQueueView.bindHover(row,that.options.styles),that.locate("fileIconBtn",row).click(function(){fluid.uploader.fileQueueView.removeFileForRow(that,row)}),fluid.uploader.fileQueueView.bindDeleteKey(that,row)},fluid.uploader.fileQueueView.renderRowFromTemplate=function(that,file){var row=that.rowTemplate.clone(),fileName=file.name,fileSize=fluid.uploader.formatFileSize(file.size);return row.removeClass(that.options.styles.hiddenTemplate),that.locate("fileName",row).text(fileName),that.locate("fileSize",row).text(fileSize),that.locate("fileIconBtn",row).addClass(that.options.styles.remove),row.prop("id",file.id),row.addClass(that.options.styles.ready),fluid.uploader.fileQueueView.bindRowHandlers(that,row),fluid.updateAriaLabel(row,fileName+" "+fileSize),row},fluid.uploader.fileQueueView.createProgressorFromTemplate=function(that,row){var rowProgressor=that.rowProgressorTemplate.clone(),rowId=row.prop("id"),progressId=rowId+"_progress";rowProgressor.prop("id",progressId),rowProgressor.css("top",row.position().top),rowProgressor.height(row.height()).width(5),that.container.after(rowProgressor),that.fileProgressors[progressId]=fluid.progress(that.options.uploaderContainer,{selectors:{progressBar:"#"+rowId,displayElement:"#"+progressId,label:"#"+progressId+" .fl-uploader-file-progress-text",indicator:"#"+progressId}})},fluid.uploader.fileQueueView.addFile=function(that,file){var row=fluid.uploader.fileQueueView.renderRowFromTemplate(that,file);$.browser.msie&&$.browser.version>=8||row.hide(),that.container.append(row),row.attr("title",that.options.strings.status.remove),row.fadeIn("slow"),fluid.uploader.fileQueueView.createProgressorFromTemplate(that,row),that.refreshView(),that.scroller.scrollTo("100%")},fluid.uploader.fileQueueView.enableRows=function(rows,state){for(var i=0;i<rows.length;i++)fluid.enabled(rows[i],state)},fluid.uploader.fileQueueView.prepareForUpload=function(that){var rowButtons=that.locate("fileIconBtn",that.locate("fileRows"));rowButtons.prop("disabled",!0),rowButtons.addClass(that.options.styles.dim),fluid.uploader.fileQueueView.enableRows(that.locate("fileRows"),!1)},fluid.uploader.fileQueueView.refreshAfterUpload=function(that){var rowButtons=that.locate("fileIconBtn",that.locate("fileRows"));rowButtons.prop("disabled",!1),rowButtons.removeClass(that.options.styles.dim),fluid.uploader.fileQueueView.enableRows(that.locate("fileRows"),!0)},fluid.uploader.fileQueueView.changeRowState=function(that,row,newState){row.removeClass(that.options.styles.ready).removeClass(that.options.styles.error).addClass(newState)},fluid.uploader.fileQueueView.markRowAsComplete=function(that,file){var row=fluid.uploader.fileQueueView.rowForFile(that,file);fluid.uploader.fileQueueView.changeRowState(that,row,that.options.styles.uploaded),row.attr("title",that.options.strings.status.success),fluid.enabled(row,!1);var removeRowBtn=that.locate("fileIconBtn",row);removeRowBtn.unbind("click"),removeRowBtn.removeClass(that.options.styles.remove),removeRowBtn.attr("title",that.options.strings.status.success)},fluid.uploader.fileQueueView.renderErrorInfoFromTemplate=function(that,fileRow,error){var errorRow=that.errorInfoTemplate.clone();errorRow.prop("id",fileRow.prop("id")+"_error");var errorType=fluid.keyForValue(fluid.uploader.errorConstants,error),errorMsg=that.options.strings.errors[errorType];that.locate("errorText",errorRow).text(errorMsg),that.locate("fileName",fileRow).after(errorRow),that.scroller.scrollTo(errorRow)},fluid.uploader.fileQueueView.showErrorForFile=function(that,file,error){if(fluid.uploader.fileQueueView.hideFileProgress(that,file),file.filestatus===fluid.uploader.fileStatusConstants.ERROR){var fileRowElm=fluid.uploader.fileQueueView.rowForFile(that,file);fluid.uploader.fileQueueView.changeRowState(that,fileRowElm,that.options.styles.error),fluid.uploader.fileQueueView.renderErrorInfoFromTemplate(that,fileRowElm,error)}},fluid.uploader.fileQueueView.addKeyboardNavigation=function(that){fluid.tabbable(that.container),that.selectableContext=fluid.selectable(that.container,{selectableSelector:that.options.selectors.fileRows,onSelect:function(itemToSelect){$(itemToSelect).addClass(that.options.styles.selected)},onUnselect:function(selectedItem){$(selectedItem).removeClass(that.options.styles.selected)}})},fluid.uploader.fileQueueView.prepareTemplateElements=function(that){that.errorInfoTemplate=that.locate("errorInfoTemplate").remove(),that.errorInfoTemplate.removeClass(that.options.styles.hiddenTemplate),that.rowTemplate=that.locate("rowTemplate").remove(),that.rowProgressorTemplate=that.locate("rowProgressorTemplate",that.options.uploaderContainer).remove()},fluid.uploader.fileQueueView.markFileComplete=function(that,file){fluid.uploader.fileQueueView.progressorForFile(that,file).update(100,"100%"),fluid.uploader.fileQueueView.markRowAsComplete(that,file)},fluid.uploader.fileQueueView.refreshView=function(that){that.selectableContext.refresh(),that.scroller.refreshView()},fluid.defaults("fluid.uploader.fileQueueView",{gradeNames:["fluid.viewComponent","autoInit"],members:{fileProgressors:{}},invokers:{addFile:{funcName:"fluid.uploader.fileQueueView.addFile",args:["{that}","{arguments}.0"]},removeFile:{funcName:"fluid.uploader.fileQueueView.removeRowForFile",args:["{that}","{arguments}.0"]},prepareForUpload:{funcName:"fluid.uploader.fileQueueView.prepareForUpload",args:"{that}"},refreshAfterUpload:{funcName:"fluid.uploader.fileQueueView.refreshAfterUpload",args:"{that}"},showFileProgress:{funcName:"fluid.uploader.fileQueueView.startFileProgress",args:["{that}","{arguments}.0"]},updateFileProgress:{funcName:"fluid.uploader.fileQueueView.updateFileProgress",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]},markFileComplete:{funcName:"fluid.uploader.fileQueueView.markFileComplete",args:["{that}","{arguments}.0"]},showErrorForFile:{funcName:"fluid.uploader.fileQueueView.showErrorForFile",args:["{that}","{arguments}.0","{arguments}.1"]},hideFileProgress:{funcName:"fluid.uploader.fileQueueView.hideFileProgress",args:["{that}","{arguments}.0"]},refreshView:{funcName:"fluid.uploader.fileQueueView.refreshView",args:"{that}"}},components:{scroller:{type:"fluid.scrollableTable"},eventBinder:{type:"fluid.uploader.fileQueueView.eventBinder"}},selectors:{fileRows:".flc-uploader-file",fileName:".flc-uploader-file-name",fileSize:".flc-uploader-file-size",fileIconBtn:".flc-uploader-file-action",errorText:".flc-uploader-file-error",rowTemplate:".flc-uploader-file-tmplt",errorInfoTemplate:".flc-uploader-file-error-tmplt",rowProgressorTemplate:".flc-uploader-file-progressor-tmplt"},styles:{hover:"fl-uploader-file-hover",selected:"fl-uploader-file-focus",ready:"fl-uploader-file-state-ready",uploading:"fl-uploader-file-state-uploading",uploaded:"fl-uploader-file-state-uploaded",error:"fl-uploader-file-state-error",remove:"fl-uploader-file-action-remove",dim:"fl-uploader-dim",hiddenTemplate:"fl-uploader-hidden-templates"},strings:{progress:{toUploadLabel:"To upload: %fileCount %fileLabel (%totalBytes)",singleFile:"file",pluralFiles:"files"},status:{success:"File Uploaded",error:"File Upload Error",remove:"Press Delete key to remove file"},errors:{HTTP_ERROR:"File upload error: a network error occured or the file was rejected (reason unknown).",IO_ERROR:"File upload error: a network error occured.",UPLOAD_LIMIT_EXCEEDED:"File upload error: you have uploaded as many files as you are allowed during this session",UPLOAD_FAILED:"File upload error: the upload failed for an unknown reason.",QUEUE_LIMIT_EXCEEDED:"You have as many files in the queue as can be added at one time. Removing files from the queue may allow you to add different files.",FILE_EXCEEDS_SIZE_LIMIT:"One or more of the files that you attempted to add to the queue exceeded the limit of %fileSizeLimit.",ZERO_BYTE_FILE:"One or more of the files that you attempted to add contained no data.",INVALID_FILETYPE:"One or more files were not added to the queue because they were of the wrong type."}},events:{onFileRemoved:null},listeners:{onCreate:[{listener:"fluid.uploader.fileQueueView.prepareTemplateElements",args:"{that}"},{listener:"fluid.uploader.fileQueueView.addKeyboardNavigation",args:"{that}"}]}}),fluid.defaults("fluid.uploader.fileQueueView.eventBinder",{gradeNames:["fluid.eventedComponent","autoInit"]}),fluid.registerNamespace("fluid.scrollable"),fluid.scrollable.makeSimple=function(element){return fluid.container(element)},fluid.scrollable.makeTable=function(table,options){return table.wrap(options.wrapperMarkup),table.closest(".fl-scrollable-scroller")},fluid.defaults("fluid.scrollable",{gradeNames:["fluid.viewComponent","autoInit"],makeScrollableFn:fluid.scrollable.makeSimple,members:{scrollable:{expander:{func:"{that}.options.makeScrollableFn",args:["{that}.container","{that}.options"]}},maxHeight:{expander:{"this":"{that}.scrollable",method:"css",args:"max-height"}}},invokers:{scrollTo:{"this":"{that}.scrollable",method:"scrollTo",args:"{arguments}.0"},refreshView:{funcName:"fluid.scrollable.refreshView",args:"{that}"}},listeners:{onCreate:"{that}.refreshView"}}),fluid.scrollable.refreshView=function(that){$.browser.msie&&"6.0"===$.browser.version&&(that.scrollable.css("height",""),that.scrollable.height()>=parseInt(that.maxHeight,10)&&that.scrollable.css("height",that.maxHeight))},fluid.defaults("fluid.scrollableTable",{gradeNames:["fluid.scrollable","autoInit"],makeScrollableFn:fluid.scrollable.makeTable,wrapperMarkup:"<div class='fl-scrollable-scroller'><div class='fl-scrollable-inner'></div></div>"}),fluid.demands("fluid.scrollableTable","fluid.uploader.fileQueueView",{container:"{fileQueueView}.container"})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.uploader=fluid.uploader||{},fluid.defaults("fluid.uploader.errorPanel",{gradeNames:["fluid.viewComponent","autoInit"],preInitFunction:"fluid.uploader.errorPanel.preInit",postInitFunction:"fluid.uploader.errorPanel.renderSectionTemplates",finalInitFunction:"fluid.uploader.errorPanel.finalInit",components:{fileSizeErrorSection:{type:"fluid.uploader.errorPanel.section",container:"{errorPanel}.dom.fileSizeErrorSection",options:{model:{errorCode:fluid.uploader.queueErrorConstants.FILE_EXCEEDS_SIZE_LIMIT},strings:{header:"{errorPanel}.options.strings.exceedsFileSize"}}},numFilesErrorSection:{type:"fluid.uploader.errorPanel.section",container:"{errorPanel}.dom.numFilesErrorSection",options:{model:{errorCode:fluid.uploader.queueErrorConstants.QUEUE_LIMIT_EXCEEDED},strings:{header:"{errorPanel}.options.strings.exceedsNumFilesLimit"}}}},selectors:{header:".flc-uploader-errorPanel-header",sectionTemplate:".flc-uploader-errorPanel-section-tmplt",fileSizeErrorSection:".flc-uploader-errorPanel-section-fileSize",numFilesErrorSection:".flc-uploader-errorPanel-section-numFiles"},strings:{headerText:"Warning(s)",exceedsNumFilesLimit:"Too many files were selected. %numFiles were not added to the queue.",exceedsFileSize:"%numFiles files were too large and were not added to the queue."},styles:{hiddenTemplate:"fl-hidden-templates"}}),fluid.uploader.errorPanel.preInit=function(that){that.refreshView=function(){for(var i=0;i<that.sections.length;i++)if(that.sections[i].model.files.length>0)return void that.container.show();that.container.hide()}},fluid.uploader.errorPanel.renderSectionTemplates=function(that){var sectionTmpl=that.locate("sectionTemplate").remove().removeClass(that.options.styles.hiddenTemplate);that.locate("fileSizeErrorSection").append(sectionTmpl.clone()),that.locate("numFilesErrorSection").append(sectionTmpl.clone())},fluid.uploader.errorPanel.finalInit=function(that){that.sections=[that.fileSizeErrorSection,that.numFilesErrorSection],that.locate("header").text(that.options.strings.headerText),that.container.hide()},fluid.demands("fluid.uploader.errorPanel","fluid.uploader.multiFileUploader",{container:"{multiFileUploader}.dom.errorsPanel",options:{listeners:{"{multiFileUploader}.events.afterFileDialog":"{errorPanel}.refreshView"}}}),fluid.defaults("fluid.uploader.errorPanel.section",{gradeNames:["fluid.viewComponent","autoInit"],preInitFunction:"fluid.uploader.errorPanel.section.preInit",finalInitFunction:"fluid.uploader.errorPanel.section.finalInit",model:{errorCode:void 0,files:[],showingDetails:!1},events:{afterErrorsCleared:null},selectors:{errorTitle:".fl-uploader-errorPanel-section-title",deleteErrorButton:".flc-uploader-errorPanel-section-removeButton",errorDetails:".flc-uploader-errorPanel-section-details",erroredFiles:".flc-uploader-errorPanel-section-files",showHideFilesToggle:".flc-uploader-errorPanel-section-toggleDetails"},strings:{hideFiles:"Hide files",showFiles:"Show files",fileListDelimiter:", "}}),fluid.uploader.errorPanel.section.preInit=function(that){that.toggleDetails=function(){var detailsAction=that.model.showingDetails?that.hideDetails:that.showDetails;detailsAction()},that.showDetails=function(){that.locate("errorDetails").show(),that.locate("showHideFilesToggle").text(that.options.strings.hideFiles),that.model.showingDetails=!0},that.hideDetails=function(){that.locate("errorDetails").hide(),that.locate("showHideFilesToggle").text(that.options.strings.showFiles),that.model.showingDetails=!1},that.addFile=function(file,errorCode){errorCode===that.model.errorCode&&(that.model.files.push(file.name),that.refreshView())},that.clear=function(){that.model.files=[],that.refreshView(),that.events.afterErrorsCleared.fire()},that.refreshView=function(){fluid.uploader.errorPanel.section.renderHeader(that),fluid.uploader.errorPanel.section.renderErrorDetails(that),that.hideDetails(),that.model.files.length<=0?that.container.hide():that.container.show()}},fluid.uploader.errorPanel.section.finalInit=function(that){that.locate("deleteErrorButton").click(that.clear),that.locate("showHideFilesToggle").click(that.toggleDetails),that.refreshView()},fluid.uploader.errorPanel.section.renderHeader=function(that){var errorTitle=fluid.stringTemplate(that.options.strings.header,{numFiles:that.model.files.length});that.locate("errorTitle").text(errorTitle)},fluid.uploader.errorPanel.section.renderErrorDetails=function(that){var files=that.model.files,filesList=files.length>0?files.join(that.options.strings.fileListDelimiter):"";that.locate("erroredFiles").text(filesList)},fluid.demands("fluid.uploader.errorPanel.section",["fluid.uploader.errorPanel","fluid.uploader.multiFileUploader"],{options:{listeners:{"{multiFileUploader}.events.onQueueError":"{section}.addFile","{multiFileUploader}.events.onFilesSelected":"{section}.clear","{multiFileUploader}.events.onUploadStart":"{section}.clear","{section}.events.afterErrorsCleared":"{errorPanel}.refreshView"}}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.enhance.check({"fluid.uploader.flash.10":!0}),fluid.demands("fluid.uploaderImpl","fluid.uploader.swfUpload",{horizon:"fluid.uploader.progressiveCheck",funcName:"fluid.uploader.multiFileUploader"}),fluid.demands("fluid.uploader.strategy","fluid.uploader.swfUpload",{horizon:"fluid.uploader.progressiveCheck",funcName:"fluid.uploader.swfUploadStrategy"}),fluid.defaults("fluid.uploader.swfUploadStrategy",{gradeNames:["fluid.uploader.strategy","autoInit"],components:{local:{type:"fluid.uploader.swfUploadStrategy.local"},engine:{type:"fluid.uploader.swfUploadStrategy.engine",options:{queueSettings:"{uploader}.options.queueSettings",flashMovieSettings:"{swfUploadStrategy}.options.flashMovieSettings"}}},flashMovieSettings:{flashURL:"../../../lib/swfupload/flash/swfupload.swf",flashButtonPeerId:"",flashButtonAlwaysVisible:!1,flashButtonTransparentEvenInIE:!0,flashButtonImageURL:"../images/browse.png",flashButtonCursorEffect:SWFUpload.CURSOR.HAND,debug:!1},styles:{browseButtonOverlay:"fl-uploader-browse-overlay",flash9Container:"fl-uploader-flash9-container",uploaderWrapperFlash10:"fl-uploader-flash10-wrapper"}}),fluid.uploader.swfUploadStrategy.stop=function(){that.queue.shouldStop=!0},fluid.defaults("fluid.uploader.swfUploadStrategy.remote",{gradeNames:["fluid.uploader.remote","autoInit"],invokers:{uploadNextFile:{"this":"{engine}.swfUpload",method:"startUpload"},stop:{funcName:"fluid.uploader.swfUploadStrategy.stop",args:"{strategy}.queue"}}}),fluid.demands("fluid.uploader.remote",["fluid.uploader.swfUploadStrategy","fluid.uploader.live"],{funcName:"fluid.uploader.swfUploadStrategy.remote"}),fluid.defaults("fluid.uploader.swfUploadStrategy.local",{gradeNames:["fluid.uploader.local","autoInit"],members:{swfUpload:"{engine}.swfUpload"},invokers:{browse:{funcName:"fluid.uploader.swfUploadStrategy.browse",args:"{that}"},removeFile:{"this":"{that}.swfUpload",method:"cancelUpload",args:"{arguments}.0.id"},enableBrowseButton:{"this":"{that}.swfUpload",method:"setButtonDisabled",args:!1},disableBrowseButton:{"this":"{that}.swfUpload",method:"setButtonDisabled",args:!0}}}),fluid.uploader.swfUploadStrategy.browse=function(that){1===that.options.file_queue_limit?that.swfUpload.selectFile():that.swfUpload.selectFiles()},fluid.uploader.swfUploadStrategy.flashVersionTag=function(){return"fluid.uploader.flash."+fluid.enhance.majorFlashVersion()},fluid.uploader.swfUploadStrategy.mergeSwfConfig=function(queueSettings,flashMovieSettings){return $.extend({},queueSettings,flashMovieSettings)},fluid.uploader.swfUploadStrategy.makeSwfUpload=function(swfUploadConfig){return new SWFUpload(swfUploadConfig)},fluid.defaults("fluid.uploader.swfUploadStrategy.engine",{gradeNames:["fluid.eventedComponent","autoInit"],components:{versionTag:{type:"fluid.typeFount",options:{targetTypeName:{expander:{funcName:"fluid.uploader.swfUploadStrategy.flashVersionTag"}}}}},invokers:{setupDOM:"fluid.uploader.swfUploadStrategy.setupDOM",setupConfig:"fluid.uploader.swfUploadStrategy.setupConfig",bindEvents:"fluid.uploader.swfUploadStrategy.eventBinder"},members:{config:{expander:{funcName:"fluid.uploader.swfUploadStrategy.mergeSwfConfig",args:["{that}.options.queueSettings","{that}.options.flashMovieSettings"]}},flashContainer:{expander:{func:"{that}.setupDOM"}},swfUploadConfig:{expander:{func:"{that}.setupConfig"}},swfUpload:{expander:{funcName:"fluid.uploader.swfUploadStrategy.makeSwfUpload",args:"{that}.swfUploadConfig"}}},listeners:{onCreate:"{that}.bindEvents"}}),fluid.uploader.swfUploadStrategy.fileTypeTransformer=function(model,expandSpec){var fileExts="",mimeTypes=fluid.get(model,expandSpec.path),mimeTypesMap=fluid.uploader.mimeTypeRegistry;return mimeTypes?"string"==typeof mimeTypes?mimeTypes:(fluid.each(mimeTypes,function(mimeType){fluid.each(mimeTypesMap,function(mimeTypeForExt,ext){mimeTypeForExt===mimeType&&(fileExts+="*."+ext+";")})}),0===fileExts.length?"*":fileExts.substring(0,fileExts.length-1)):"*"},fluid.uploader.swfUploadStrategy.flash10SetupDOM=function(uploaderContainer,browseButton,progressBar,styles){uploaderContainer.wrap("<div class='"+styles.uploaderWrapperFlash10+"'></div>");var flashContainer=$("<div><span></span></div>");return flashContainer.addClass(styles.browseButtonOverlay),uploaderContainer.after(flashContainer),progressBar.append(flashContainer),browseButton.attr("tabindex",-1),flashContainer},fluid.demands("fluid.uploader.swfUploadStrategy.setupDOM",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.10"],{funcName:"fluid.uploader.swfUploadStrategy.flash10SetupDOM",args:["{uploader}.container","{uploader}.dom.browseButton","{totalProgress}.dom.progressBar","{swfUploadStrategy}.options.styles"]}),fluid.uploader.swfUploadStrategy.swfUploadOptionsMap={uploadURL:"upload_url",flashURL:"flash_url",postParams:"post_params",fileSizeLimit:"file_size_limit",fileTypes:"file_types",fileUploadLimit:"file_upload_limit",fileQueueLimit:"file_queue_limit",flashButtonPeerId:"button_placeholder_id",flashButtonImageURL:"button_image_url",flashButtonHeight:"button_height",flashButtonWidth:"button_width",flashButtonWindowMode:"button_window_mode",flashButtonCursorEffect:"button_cursor",debug:"debug"},fluid.uploader.swfUploadStrategy.swfUploadEventMap={swfupload_loaded_handler:"afterReady",file_dialog_start_handler:"onFileDialog",file_queued_handler:"onFileQueued",file_queue_error_handler:"onQueueError",file_dialog_complete_handler:"afterFileDialog",upload_start_handler:"onFileStart",upload_progress_handler:"onFileProgress",upload_complete_handler:"onFileComplete",upload_error_handler:"onFileError",upload_success_handler:"onFileSuccess"},fluid.uploader.swfUploadStrategy.mapNames=function(nameMap,source,target){var result=target||{};for(var key in source){var mappedKey=nameMap[key];mappedKey&&(result[mappedKey]=source[key])}return result},fluid.uploader.swfUploadStrategy.convertConfigForSWFUpload=function(flashContainer,config,events,queueSettings){config.flashButtonPeerId=fluid.allocateSimpleId(flashContainer.children().eq(0)),config.fileTypes=fluid.uploader.swfUploadStrategy.fileTypeTransformer(queueSettings,{path:"fileTypes"});var convertedConfig=fluid.uploader.swfUploadStrategy.mapNames(fluid.uploader.swfUploadStrategy.swfUploadOptionsMap,config);convertedConfig.file_upload_limit=0,convertedConfig.file_size_limit=0;var firers=fluid.transform(fluid.uploader.swfUploadStrategy.swfUploadEventMap,function(origEvent){return events[origEvent].fire});return $.extend(convertedConfig,firers)},fluid.uploader.swfUploadStrategy.flash10SetupConfig=function(config,events,flashContainer,browseButton,queueSettings){var isTransparent=config.flashButtonAlwaysVisible?!1:!$.browser.msie||config.flashButtonTransparentEvenInIE;return config.flashButtonImageURL=isTransparent?void 0:config.flashButtonImageURL,config.flashButtonHeight=config.flashButtonHeight||browseButton.outerHeight(),config.flashButtonWidth=config.flashButtonWidth||browseButton.outerWidth(),config.flashButtonWindowMode=isTransparent?SWFUpload.WINDOW_MODE.TRANSPARENT:SWFUpload.WINDOW_MODE.OPAQUE,fluid.uploader.swfUploadStrategy.convertConfigForSWFUpload(flashContainer,config,events,queueSettings)},fluid.demands("fluid.uploader.swfUploadStrategy.setupConfig",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.10"],{funcName:"fluid.uploader.swfUploadStrategy.flash10SetupConfig",args:["{engine}.config","{uploader}.events","{engine}.flashContainer","{uploader}.dom.browseButton","{uploader}.options.queueSettings"]});var unbindSWFUploadSelectFiles=function(){SWFUpload.prototype.selectFile=fluid.identity,SWFUpload.prototype.selectFiles=fluid.identity},convertFileStatus=function(swfFileStatus){var converted=fluid.uploader.swfUploadStrategy.convertCode(swfFileStatus,fluid.uploader.fileStatusConstants,SWFUpload.FILE_STATUS);return converted||swfFileStatus};fluid.uploader.swfUploadStrategy.bindFileEventListeners=function(model,events){var manualModelUpdater=function(file){var modelFile=fluid.find_if(model,function(modelFile){return modelFile.id===file.id});modelFile&&(modelFile.filestatus=convertFileStatus(file.filestatus))};fluid.each(["onFileStart","onFileProgress","onFileError","onFileSuccess"],function(event){events[event].addListener(manualModelUpdater)})},fluid.uploader.swfUploadStrategy.convertCode=function(value,uploaderCodes,swfCodes){var key=fluid.keyForValue(swfCodes,value);return uploaderCodes[key]},fluid.uploader.swfUploadStrategy.mapQueuedFile=function(origFile,events,queue,queueSettings){var file=$.extend({},origFile);file.filestatus=convertFileStatus(origFile.filestatus);var fileSizeLimit=1e3*queueSettings.fileSizeLimit,fileUploadLimit=queueSettings.fileUploadLimit,processedFiles=queue.getReadyFiles().length+queue.getUploadedFiles().length;file.size>fileSizeLimit?(file.filestatus=fluid.uploader.fileStatusConstants.ERROR,events.onQueueError.fire(file,fluid.uploader.queueErrorConstants.FILE_EXCEEDS_SIZE_LIMIT)):0!==fileUploadLimit&&processedFiles>=fileUploadLimit?events.onQueueError.fire(file,fluid.uploader.queueErrorConstants.QUEUE_LIMIT_EXCEEDED):events.afterFileQueued.fire(file)},fluid.uploader.swfUploadStrategy.flash10EventBinder=function(queue,queueSettings,events){unbindSWFUploadSelectFiles(),events.onFileQueued.addListener(function(file){fluid.uploader.swfUploadStrategy.mapQueuedFile(file,events,queue,queueSettings)}),fluid.uploader.swfUploadStrategy.bindFileEventListeners(queue.files,events)},fluid.demands("fluid.uploader.swfUploadStrategy.eventBinder",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.10"],{funcName:"fluid.uploader.swfUploadStrategy.flash10EventBinder",args:["{uploader}.queue","{uploader}.options.queueSettings","{uploader}.events"]})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.enhance.check({"fluid.uploader.flash.9":!0}),fluid.registerNamespace("fluid.uploader.swfUploadStrategy"),fluid.uploader.swfUploadStrategy.flash9SetupDOM=function(styles){var container=$("<div><span></span></div>");return container.addClass(styles.flash9Container),$("body").append(container),container},fluid.demands("fluid.uploader.swfUploadStrategy.setupDOM",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.9"],{funcName:"fluid.uploader.swfUploadStrategy.flash9SetupDOM",args:["{swfUploadStrategy}.options.styles"]}),fluid.uploader.swfUploadStrategy.flash9SetupConfig=function(flashContainer,config,events){return fluid.uploader.swfUploadStrategy.convertConfigForSWFUpload(flashContainer,config,events)},fluid.demands("fluid.uploader.swfUploadStrategy.setupConfig",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.9"],{funcName:"fluid.uploader.swfUploadStrategy.flash9SetupConfig",args:["{engine}.flashContainer","{engine}.config","{uploader}.events"]}),fluid.uploader.swfUploadStrategy.flash9EventBinder=function(model,events,local,browseButton){browseButton.click(function(e){local.browse(),e.preventDefault()}),fluid.uploader.swfUploadStrategy.bindFileEventListeners(model,events)},fluid.demands("fluid.uploader.swfUploadStrategy.eventBinder",["fluid.uploader.swfUploadStrategy.engine","fluid.uploader.flash.9"],{funcName:"fluid.uploader.swfUploadStrategy.flash9EventBinder",args:["{uploader}.queue.files","{uploader}.events","{local}","{uploader}.dom.browseButton"]})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.demands("fluid.uploaderImpl","fluid.uploader.html5",{horizon:"fluid.uploader.progressiveCheck",funcName:"fluid.uploader.multiFileUploader"}),fluid.demands("fluid.uploader.strategy","fluid.uploader.html5",{horizon:"fluid.uploader.progressiveCheck",funcName:"fluid.uploader.html5Strategy"}),fluid.defaults("fluid.uploader.html5Strategy",{gradeNames:["fluid.uploader.strategy","autoInit"],components:{local:{type:"fluid.uploader.html5Strategy.local"}}}),fluid.uploader.html5Strategy.fileSuccessHandler=function(file,events,xhr){events.onFileSuccess.fire(file,xhr.responseText,xhr),events.onFileComplete.fire(file)},fluid.uploader.html5Strategy.fileErrorHandler=function(file,events,xhr){events.onFileError.fire(file,fluid.uploader.errorConstants.UPLOAD_FAILED,xhr.status,xhr),events.onFileComplete.fire(file)},fluid.uploader.html5Strategy.fileStopHandler=function(file,events,xhr){events.onFileError.fire(file,fluid.uploader.errorConstants.UPLOAD_STOPPED,xhr.status,xhr),events.onFileComplete.fire(file)},fluid.uploader.html5Strategy.monitorFileUploadXHR=function(file,events,xhr){xhr.onreadystatechange=function(){if(4===xhr.readyState){var status=xhr.status;status>=200&&204>=status?fluid.uploader.html5Strategy.fileSuccessHandler(file,events,xhr):0===status?fluid.uploader.html5Strategy.fileStopHandler(file,events,xhr):fluid.uploader.html5Strategy.fileErrorHandler(file,events,xhr)}},xhr.upload.onprogress=function(pe){events.onFileProgress.fire(file,pe.loaded,pe.total)}},fluid.uploader.html5Strategy.uploadNextFile=function(queue,uploadFile){var batch=queue.currentBatch,file=batch.files[batch.fileIdx];uploadFile(file)},fluid.uploader.html5Strategy.uploadFile=function(that,file){that.events.onFileStart.fire(file),that.currentXHR=that.createXHR(),fluid.uploader.html5Strategy.monitorFileUploadXHR(file,that.events,that.currentXHR),that.fileSender.send(file,that.queueSettings,that.currentXHR)},fluid.uploader.html5Strategy.stop=function(that){that.queue.isUploading=!1,that.currentXHR.abort(),that.events.onUploadStop.fire()},fluid.defaults("fluid.uploader.html5Strategy.remote",{gradeNames:["fluid.uploader.remote","autoInit"],components:{fileSender:{type:"fluid.uploader.html5Strategy.fileSender"}},invokers:{createXHR:"fluid.uploader.html5Strategy.createXHR",uploadNextFile:{funcName:"fluid.uploader.html5Strategy.uploadNextFile",args:["{that}.queue","{that}.uploadFile"]},uploadFile:{funcName:"fluid.uploader.html5Strategy.uploadFile",args:["{that}","{arguments}.0"]},stop:{funcName:"fluid.uploader.html5Strategy.stop",args:["{that}"]}}}),fluid.demands("fluid.uploader.remote",["fluid.uploader.html5Strategy","fluid.uploader.live"],{funcName:"fluid.uploader.html5Strategy.remote"}),fluid.uploader.html5Strategy.createXHR=function(){return new XMLHttpRequest},fluid.uploader.html5Strategy.createFormData=function(){return new FormData},fluid.uploader.html5Strategy.setPostParams=function(formData,postParams){$.each(postParams,function(key,value){formData.append(key,value)})},fluid.uploader.html5Strategy.fileSender=function(){fluid.fail("Error instantiating HTML5 Uploader - browser does not support FormData feature. Please try version 1.4 or earlier of Uploader which has Firefox 3.x support")},fluid.defaults("fluid.uploader.html5Strategy.formDataSender",{gradeNames:["fluid.littleComponent","autoInit"],invokers:{createFormData:"fluid.uploader.html5Strategy.createFormData",send:{funcName:"fluid.uploader.html5Strategy.sendFormData",args:["{that}.createFormData","{arguments}.0","{arguments}.1","{arguments}.2"]}}}),fluid.uploader.html5Strategy.sendFormData=function(formCreator,file,queueSettings,xhr){var formData=formCreator();return formData.append("file",file),fluid.uploader.html5Strategy.setPostParams(formData,queueSettings.postParams),xhr.open("POST",queueSettings.uploadURL,!0),xhr.send(formData),formData},fluid.demands("fluid.uploader.html5Strategy.fileSender",["fluid.uploader.html5Strategy.remote","fluid.browser.supportsFormData"],{funcName:"fluid.uploader.html5Strategy.formDataSender"}),fluid.defaults("fluid.uploader.html5Strategy.local",{gradeNames:["fluid.uploader.local","autoInit"],invokers:{addFiles:{funcName:"fluid.uploader.html5Strategy.local.addFiles",args:["{that}","{arguments}.0"]},removeFile:"fluid.identity",enableBrowseButton:"{that}.browseButtonView.enable",disableBrowseButton:"{that}.browseButtonView.disable"},components:{browseButtonView:{type:"fluid.uploader.html5Strategy.browseButtonView",options:{queueSettings:"{uploader}.options.queueSettings",selectors:{browseButton:"{uploader}.options.selectors.browseButton"},listeners:{onFilesQueued:"{local}.addFiles"}}}}}),fluid.uploader.html5Strategy.local.addFiles=function(that,files){var queueSettings=that.options.queueSettings,sizeLimit=1024*queueSettings.fileSizeLimit,fileLimit=queueSettings.fileUploadLimit,uploaded=that.queue.getUploadedFiles().length,queued=that.queue.getReadyFiles().length,remainingUploadLimit=fileLimit-uploaded-queued;that.events.onFilesSelected.fire(files.length);for(var numFilesAdded=0,i=0;i<files.length;i++){var file=files[i];fileLimit&&0===remainingUploadLimit?that.events.onQueueError.fire(file,fluid.uploader.queueErrorConstants.QUEUE_LIMIT_EXCEEDED):file.size>=sizeLimit?(file.filestatus=fluid.uploader.fileStatusConstants.ERROR,that.events.onQueueError.fire(file,fluid.uploader.queueErrorConstants.FILE_EXCEEDS_SIZE_LIMIT)):(!fileLimit||remainingUploadLimit>0)&&(file.id="file-"+fluid.allocateGuid(),file.filestatus=fluid.uploader.fileStatusConstants.QUEUED,that.events.afterFileQueued.fire(file),remainingUploadLimit--,numFilesAdded++)}that.events.afterFileDialog.fire(numFilesAdded)},fluid.uploader.bindEventsToFileInput=function(that,fileInput){fileInput.click(function(){that.events.onBrowse.fire()}),fileInput.change(function(){var files=fileInput[0].files;that.renderFreshMultiFileInput(),that.events.onFilesQueued.fire(files)}),fileInput.focus(function(){that.browseButton.addClass("focus"),that.events.onFocusFileInput.fire(that,fileInput,!0)}),fileInput.blur(function(){that.browseButton.removeClass("focus"),that.events.onFocusFileInput.fire(that,fileInput,!1)})},fluid.uploader.renderMultiFileInput=function(that){var multiFileInput=$(that.options.multiFileInputMarkup),fileTypes=that.options.queueSettings.fileTypes;return fluid.isArrayable(fileTypes)&&(fileTypes=fileTypes.join(),multiFileInput.attr("accept",fileTypes)),multiFileInput},fluid.uploader.renderFreshMultiFileInput=function(that){var previousInput=that.locate("fileInputs").last();previousInput.hide(),previousInput.prop("tabindex",-1);var newInput=fluid.uploader.renderMultiFileInput(that);previousInput.after(newInput),fluid.uploader.bindEventsToFileInput(that,newInput)},fluid.uploader.setupBrowseButtonView=function(that){var multiFileInput=fluid.uploader.renderMultiFileInput(that);that.browseButton.append(multiFileInput),fluid.uploader.bindEventsToFileInput(that,multiFileInput),that.browseButton.prop("tabindex",-1)},fluid.uploader.isEnabled=function(element){return!element.prop("disabled")},fluid.defaults("fluid.uploader.html5Strategy.browseButtonView",{gradeNames:["fluid.viewComponent","autoInit"],multiFileInputMarkup:"<input type='file' multiple='' class='flc-uploader-html5-input' />",queueSettings:{},members:{browseButton:"{that}.dom.browseButton"},invokers:{enable:{"this":"{that}.dom.fileInputs",method:"prop",args:["disabled",!1]},disable:{"this":"{that}.dom.fileInputs",method:"prop",args:["disabled",!0]},isEnabled:{funcName:"fluid.uploader.isEnabled",args:"{that}.dom.fileInputs"},renderFreshMultiFileInput:{funcName:"fluid.uploader.renderFreshMultiFileInput",args:"{that}"}},selectors:{browseButton:".flc-uploader-button-browse",fileInputs:".flc-uploader-html5-input"},events:{onFocusFileInput:null,onBrowse:null,onFilesQueued:null},listeners:{onCreate:{funcName:"fluid.uploader.setupBrowseButtonView",args:"{that}"}}}),fluid.demands("fluid.uploader.html5Strategy.browseButtonView","fluid.uploader.html5Strategy.local",{container:"{multiFileUploader}.container",mergeOptions:{events:{onBrowse:"{local}.events.onFileDialog"}}})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function($,fluid){fluid.registerNamespace("fluid.uploader.demo"),fluid.uploader.demo.uploadNextFile=function(that){that.demoState.currentFile=that.queue.files[that.demoState.fileIdx],that.demoState.chunksForCurrentFile=Math.ceil(that.demoState.currentFile/that.demoState.chunkSize),that.demoState.bytesUploaded=0,that.queue.isUploading=!0,that.events.onFileStart.fire(that.demoState.currentFile),fluid.uploader.demo.simulateUpload(that)},fluid.uploader.demo.updateProgress=function(file,events,demoState,isUploading){if(isUploading){var chunk=Math.min(demoState.chunkSize,file.size);demoState.bytesUploaded=Math.min(demoState.bytesUploaded+chunk,file.size),events.onFileProgress.fire(file,demoState.bytesUploaded,file.size)}},fluid.uploader.demo.finishAndContinueOrCleanup=function(that,file){that.queue.finishFile(file),that.events.afterFileComplete.fire(file),that.queue.shouldUploadNextFile()?fluid.uploader.demo.uploadNextFile(that):(that.events.afterUploadComplete.fire(that.queue.currentBatch.files),file.status!==fluid.uploader.fileStatusConstants.CANCELLED&&that.queue.clearCurrentBatch())},fluid.uploader.demo.finishUploading=function(that){if(that.queue.isUploading){var file=that.demoState.currentFile;that.events.onFileSuccess.fire(file),that.demoState.fileIdx++,fluid.uploader.demo.finishAndContinueOrCleanup(that,file)}},fluid.uploader.demo.simulateUpload=function(that){if(that.queue.isUploading){var file=that.demoState.currentFile;that.demoState.bytesUploaded<file.size?fluid.invokeAfterRandomDelay(function(){fluid.uploader.demo.updateProgress(file,that.events,that.demoState,that.queue.isUploading),fluid.uploader.demo.simulateUpload(that)}):fluid.uploader.demo.finishUploading(that)}},fluid.uploader.demo.stop=function(that){var file=that.demoState.currentFile;file.filestatus=fluid.uploader.fileStatusConstants.CANCELLED,that.queue.shouldStop=!0,that.events.onFileError.fire(file,fluid.uploader.errorConstants.UPLOAD_STOPPED,"The demo upload was paused by the user."),fluid.uploader.demo.finishAndContinueOrCleanup(that,file),that.events.onUploadStop.fire()},fluid.demands("fluid.uploader.uploadNextFile","fluid.uploader.demo.remote",{funcName:"fluid.uploader.demo.uploadNextFile",args:"{that}"}),fluid.demands("fluid.uploader.stop","fluid.uploader.demo.remote",{funcName:"fluid.uploader.demo.stop",args:"{that}"}),fluid.invokeAfterRandomDelay=function(fn){var delay=Math.floor(200*Math.random()+100);setTimeout(fn,delay)},fluid.defaults("fluid.uploader.demo.remote",{gradeNames:["fluid.uploader.remote","autoInit"],members:{demoState:{fileIdx:0,chunkSize:2e5}}}),fluid.demands("fluid.uploader.remote",["fluid.uploader.multiFileUploader","fluid.uploader.demo"],{funcName:"fluid.uploader.demo.remote"})}(jQuery,fluid_1_5);;var fluid_1_5=fluid_1_5||{};!function(fluid){fluid.registerNamespace("fluid.uploader"),fluid.uploader.mimeTypeRegistry={jpg:"image/jpeg",jpeg:"image/jpeg",bmp:"image/bmp",png:"image/png",tif:"image/tiff",tiff:"image/tiff",mp3:"audio/mpeg",m4a:"audio/mp4a-latm",ogg:"audio/ogg",wav:"audio/x-wav",aiff:"audio/x-aiff",mpg:"video/mpeg",mpeg:"video/mpeg",m4v:"video/x-m4v",ogv:"video/ogg",mov:"video/quicktime",avi:"video/x-msvideo",html:"text/html",htm:"text/html",text:"text/plain",doc:"application/msword",docx:"application/msword",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint"}}(fluid_1_5);